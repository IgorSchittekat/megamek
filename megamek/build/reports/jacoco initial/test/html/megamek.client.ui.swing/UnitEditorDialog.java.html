<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UnitEditorDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">UnitEditorDialog.java</span></div><h1>UnitEditorDialog.java</h1><pre class="source lang-java linenums">/*
 * MechEditor.java - Copyright (C) 2013 Jay Lawson
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

package megamek.client.ui.swing;

import java.awt.BorderLayout;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.TreeMap;
import java.util.Vector;
import java.util.function.BiConsumer;

import javax.swing.BorderFactory;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.SpinnerNumberModel;

import megamek.client.ui.Messages;

import megamek.common.ASFBay;
import megamek.common.Aero;
import megamek.common.Bay;
import megamek.common.CriticalSlot;
import megamek.common.DockingCollar;
import megamek.common.Dropship;
import megamek.common.Entity;
import megamek.common.IArmorState;
import megamek.common.Infantry;
import megamek.common.Jumpship;
import megamek.common.LandAirMech;
import megamek.common.Mech;
import megamek.common.Mounted;
import megamek.common.Protomech;
import megamek.common.QuadMech;
import megamek.common.QuadVee;
import megamek.common.SmallCraft;
import megamek.common.SmallCraftBay;
import megamek.common.Tank;
import megamek.common.VTOL;
import megamek.common.options.OptionsConstants;

/**
 *
 * @author Jay Lawson &lt;jaylawson39 at yahoo.com&gt; This dialog will allow the user
 *         to edit the damage and status characteristics of a unit This designed
 *         for use in both MegaMek and MHQ so don't go messing things up for MHQ
 *         by changing a bunch of stuff
 */
public class UnitEditorDialog extends JDialog {

    /**
     *
     */
    private static final long serialVersionUID = 8144354264100884817L;

    private Entity entity;

    JPanel panArmor;
    JPanel panSystem;
    JPanel panEquip;

    JSpinner[] spnInternal;
    JSpinner[] spnArmor;
    JSpinner[] spnRear;

    HashMap&lt;Integer, CheckCritPanel&gt; equipCrits;

    /* system crits */
    CheckCritPanel engineCrit;
    CheckCritPanel leftEngineCrit;
    CheckCritPanel rightEngineCrit;
    CheckCritPanel centerEngineCrit;
    CheckCritPanel gyroCrit;
    CheckCritPanel sensorCrit;
    CheckCritPanel lifeSupportCrit;
    CheckCritPanel cockpitCrit;
    Map&lt;Integer,CheckCritPanel&gt; lamAvionicsCrit;
    Map&lt;Integer,CheckCritPanel&gt; lamLandingGearCrit;
    CheckCritPanel[][] actuatorCrits;
    CheckCritPanel turretlockCrit;
    CheckCritPanel motiveCrit;
    CheckCritPanel[] stabilizerCrits;
    CheckCritPanel flightStabilizerCrit;
    CheckCritPanel avionicsCrit;
    CheckCritPanel fcsCrit;
    CheckCritPanel cicCrit;
    CheckCritPanel gearCrit;
    CheckCritPanel leftThrusterCrit;
    CheckCritPanel rightThrusterCrit;
    CheckCritPanel kfboomCrit;
    CheckCritPanel dockCollarCrit;
    CheckCritPanel gravDeckCrit;
    JSpinner[] bayDamage;
    CheckCritPanel[] bayDoorCrit;
    JSpinner collarDamage;
    JSpinner kfDamage;
    CheckCritPanel driveCoilCrit;
    CheckCritPanel chargingSystemCrit;
    CheckCritPanel fieldInitiatorCrit;
    CheckCritPanel driveControllerCrit;
    CheckCritPanel heliumTankCrit;
    CheckCritPanel lfBatteryCrit;
    JSpinner sailDamage;
    CheckCritPanel[] protoCrits;

    public UnitEditorDialog(JFrame parent, Entity m) {
<span class="nc" id="L132">        super(parent, true);</span>
<span class="nc" id="L133">        entity = m;</span>
<span class="nc" id="L134">        initComponents();</span>
<span class="nc" id="L135">        setLocationRelativeTo(parent);</span>
<span class="nc" id="L136">    }</span>

    private void initComponents() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L141">        getContentPane().setLayout(new BorderLayout());</span>

<span class="nc" id="L143">        setTitle(&quot;Edit damage for &quot; + entity.getDisplayName());</span>

<span class="nc" id="L145">        JPanel panMain = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L146">        JPanel panButtons = new JPanel(new GridLayout(1, 2));</span>

        // TODO: protomeks
<span class="nc" id="L149">        initArmorPanel();</span>
<span class="nc" id="L150">        initSystemPanel();</span>
<span class="nc" id="L151">        initEquipPanel();</span>

<span class="nc" id="L153">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L154">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L155">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L156">        gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L157">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L158">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L159">        gridBagConstraints.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L160">        panMain.add(panArmor, gridBagConstraints);</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (!entity.isConventionalInfantry()) {</span>
<span class="nc" id="L162">            gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L163">            gridBagConstraints.weighty = 1.0;</span>
<span class="nc" id="L164">            panMain.add(new JScrollPane(panSystem), gridBagConstraints);</span>
<span class="nc" id="L165">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L166">            gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L167">            gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L168">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L169">            gridBagConstraints.gridheight = 2;</span>
<span class="nc" id="L170">            panMain.add(new JScrollPane(panEquip), gridBagConstraints);</span>
        }

<span class="nc" id="L173">        getContentPane().add(panMain, BorderLayout.CENTER);</span>

<span class="nc" id="L175">        JButton butOK = new JButton(Messages.getString(&quot;Okay&quot;));</span>
<span class="nc" id="L176">        butOK.addActionListener(evt -&gt; {</span>
<span class="nc" id="L177">            btnOkayActionPerformed(evt);</span>
<span class="nc" id="L178">            setVisible(false);</span>
<span class="nc" id="L179">        });</span>
<span class="nc" id="L180">        JButton butCancel = new JButton(Messages.getString(&quot;Cancel&quot;));</span>
<span class="nc" id="L181">        butCancel.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L183">                setVisible(false);</span>
<span class="nc" id="L184">            }</span>
        });

<span class="nc" id="L187">        panButtons.add(butOK);</span>
<span class="nc" id="L188">        panButtons.add(butCancel);</span>

<span class="nc" id="L190">        getContentPane().add(panButtons, BorderLayout.PAGE_END);</span>

        // TODO: size right

<span class="nc" id="L194">        pack();</span>
<span class="nc" id="L195">    }</span>

    private void initArmorPanel() {
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (entity instanceof Aero) {</span>
<span class="nc" id="L199">            initAeroArmorPanel();</span>
<span class="nc" id="L200">            return;</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">        } else if (entity.isConventionalInfantry()) {</span>
<span class="nc" id="L202">            initInfantryArmorPanel();</span>
<span class="nc" id="L203">            return;</span>
        }

        GridBagConstraints gridBagConstraints;

<span class="nc" id="L208">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L209">        panArmor.setBorder(BorderFactory</span>
<span class="nc" id="L210">                .createTitledBorder(Messages.getString(&quot;UnitEditorDialog.internalsAndArmor&quot;)));</span>

<span class="nc" id="L212">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L213">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L214">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L216">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L217">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L218">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L219">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L220">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L221">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.location&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L223">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L224">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.internal&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L226">        gridBagConstraints.gridx = 2;</span>
<span class="nc" id="L227">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.frontArmor&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L229">        gridBagConstraints.gridx = 3;</span>
<span class="nc" id="L230">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.rearArmor&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);

<span class="nc bnc" id="L233" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
            // some units have hidden locations, skip these
<span class="nc bnc" id="L235" title="All 2 branches missed.">            if (entity.getOInternal(i) &lt;= 0) {</span>
<span class="nc" id="L236">                continue;</span>
            }
<span class="nc" id="L238">            int internal = Math.max(entity.getInternal(i), 0);</span>
<span class="nc" id="L239">            int armor = Math.max(entity.getArmor(i, false), 0);</span>
<span class="nc" id="L240">            spnArmor[i] = new JSpinner(new SpinnerNumberModel(armor, 0,</span>
<span class="nc" id="L241">                    entity.getOArmor(i), 1));</span>
<span class="nc" id="L242">            spnInternal[i] = new JSpinner(new SpinnerNumberModel(internal, 0,</span>
<span class="nc" id="L243">                    entity.getOInternal(i), 1));</span>
<span class="nc" id="L244">            gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L245">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L246">            gridBagConstraints.gridy = i + 1;</span>
<span class="nc" id="L247">            gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L248">            gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L249">            panArmor.add(new JLabel(entity.getLocationName(i)),</span>
                    gridBagConstraints);
<span class="nc" id="L251">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L252">            panArmor.add(spnInternal[i], gridBagConstraints);</span>
<span class="nc" id="L253">            gridBagConstraints.gridx = 2;</span>
<span class="nc" id="L254">            panArmor.add(spnArmor[i], gridBagConstraints);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">            if (entity.hasRearArmor(i)) {</span>
<span class="nc" id="L256">                int rear = Math.max(entity.getArmor(i, true), 0);</span>
<span class="nc" id="L257">                spnRear[i] = new JSpinner(new SpinnerNumberModel(rear, 0,</span>
<span class="nc" id="L258">                        entity.getOArmor(i, true), 1));</span>
<span class="nc" id="L259">                gridBagConstraints.gridx = 3;</span>
<span class="nc" id="L260">                panArmor.add(spnRear[i], gridBagConstraints);</span>
            }
        }
<span class="nc" id="L263">    }</span>

    private void initAeroArmorPanel() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L268">        Aero aero = (Aero) entity;</span>

<span class="nc" id="L270">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L271">        panArmor.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.siAndArmor&quot;)));</span>

<span class="nc" id="L273">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L274">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L275">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L277">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L278">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L279">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L280">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L281">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L282">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.location&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L284">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L285">        panArmor.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.points&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);

<span class="nc" id="L288">        int si = Math.max(aero.getSI(), 0);</span>
<span class="nc" id="L289">        spnInternal[0] = new JSpinner(new SpinnerNumberModel(si, 0,</span>
<span class="nc" id="L290">                aero.get0SI(), 1));</span>
<span class="nc" id="L291">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L292">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L293">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L294">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L295">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L296">        panArmor.add(new JLabel(Messages.getString(&quot;UnitEditorDialog.structuralIntegrity&quot;)), gridBagConstraints);</span>
<span class="nc" id="L297">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L298">        panArmor.add(spnInternal[0], gridBagConstraints);</span>

<span class="nc bnc" id="L300" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
            // some units have hidden locations, skip these
<span class="nc bnc" id="L302" title="All 2 branches missed.">            if (entity.getOArmor(i) &lt;= 0) {</span>
<span class="nc" id="L303">                continue;</span>
            }
<span class="nc" id="L305">            int armor = Math.max(entity.getArmor(i, false), 0);</span>
<span class="nc" id="L306">            spnArmor[i] = new JSpinner(new SpinnerNumberModel(armor, 0,</span>
<span class="nc" id="L307">                    entity.getOArmor(i), 1));</span>
<span class="nc" id="L308">            gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L309">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L310">            gridBagConstraints.gridy = i + 2;</span>
<span class="nc" id="L311">            gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L312">            gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L313">            panArmor.add(new JLabel(entity.getLocationName(i)),</span>
                    gridBagConstraints);
<span class="nc" id="L315">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L316">            panArmor.add(spnArmor[i], gridBagConstraints);</span>
        }
<span class="nc" id="L318">    }</span>

    private void initInfantryArmorPanel() {
        GridBagConstraints gridBagConstraints;

<span class="nc" id="L323">        Infantry infantry = (Infantry) entity;</span>

<span class="nc" id="L325">        panArmor = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L326">        panArmor.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.troopersLeft&quot;)));</span>

<span class="nc" id="L328">        spnArmor = new JSpinner[entity.locations()];</span>
<span class="nc" id="L329">        spnInternal = new JSpinner[entity.locations()];</span>
<span class="nc" id="L330">        spnRear = new JSpinner[entity.locations()];</span>

<span class="nc" id="L332">        int men = Math.max(infantry.getShootingStrength(), 0);</span>
<span class="nc" id="L333">        spnInternal[0] = new JSpinner(new SpinnerNumberModel(men, 0,</span>
<span class="nc" id="L334">                infantry.getSquadN() * infantry.getSquadSize(), 1));</span>
<span class="nc" id="L335">        gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L336">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L337">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L338">        gridBagConstraints.insets = new Insets(1, 10, 1, 1);</span>
<span class="nc" id="L339">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc" id="L340">        panArmor.add(new JLabel(Messages.getString(&quot;UnitEditorDialog.menLeft&quot;)), gridBagConstraints);</span>
<span class="nc" id="L341">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L342">        panArmor.add(spnInternal[0], gridBagConstraints);</span>
<span class="nc" id="L343">    }</span>

    private void initEquipPanel() {
<span class="nc" id="L346">        equipCrits = new HashMap&lt;Integer, CheckCritPanel&gt;();</span>
<span class="nc" id="L347">        panEquip = new JPanel();</span>
<span class="nc" id="L348">        panEquip.setLayout(new GridBagLayout());</span>
<span class="nc" id="L349">        panEquip.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.equipment&quot;)));</span>
<span class="nc" id="L350">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>
<span class="nc" id="L351">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L352">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L353">        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">        for (Mounted m : entity.getEquipment()) {</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">            if ((m.getLocation() == Entity.LOC_NONE)</span>
<span class="nc bnc" id="L356" title="All 4 branches missed.">                    || !m.getType().isHittable() || m.isWeaponGroup()) {</span>
<span class="nc" id="L357">                continue;</span>
            }
<span class="nc" id="L359">            int nCrits = m.getCriticals();</span>
<span class="nc" id="L360">            int eqNum = entity.getEquipmentNum(m);</span>
<span class="nc" id="L361">            int hits = entity.getDamagedCriticals(CriticalSlot.TYPE_EQUIPMENT,</span>
<span class="nc" id="L362">                    eqNum, m.getLocation());</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">            if (m.isSplit()) {</span>
<span class="nc" id="L364">                hits += entity.getDamagedCriticals(CriticalSlot.TYPE_EQUIPMENT,</span>
<span class="nc" id="L365">                        eqNum, m.getSecondLocation());</span>
            }
<span class="nc bnc" id="L367" title="All 2 branches missed.">            if (!(entity instanceof Mech)) {</span>
<span class="nc" id="L368">                nCrits = 1;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">                if (hits &gt; 1) {</span>
<span class="nc" id="L370">                    hits = 1;</span>
                }
            }
<span class="nc" id="L373">            CheckCritPanel crit = new CheckCritPanel(nCrits, hits);</span>
<span class="nc" id="L374">            equipCrits.put(eqNum, crit);</span>
<span class="nc" id="L375">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L376">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L377">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L378">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L379">            panEquip.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + m.getName() + &quot;&lt;/b&gt;&lt;br&gt;&quot;</span>
<span class="nc" id="L380">                    + entity.getLocationName(m.getLocation()) + &quot;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L382">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L383">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L384">            panEquip.add(crit, gridBagConstraints);</span>
<span class="nc" id="L385">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L386">        }</span>
<span class="nc" id="L387">    }</span>

    private void initSystemPanel() {

        // systems are the hard part, because these are all unit specific
        // lets start with a mech
<span class="nc" id="L393">        panSystem = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L394">        panSystem.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;UnitEditorDialog.system&quot;)));</span>

<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (entity instanceof Mech) {</span>
<span class="nc" id="L397">            setupMechSystemPanel();</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">        } else if (entity instanceof VTOL) {</span>
<span class="nc" id="L399">            setupVtolSystemPanel();</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        } else if (entity instanceof Tank) {</span>
<span class="nc" id="L401">            setupTankSystemPanel();</span>
<span class="nc bnc" id="L402" title="All 2 branches missed.">        } else if (entity instanceof Aero) {</span>
<span class="nc" id="L403">            setupAeroSystemPanel();</span>
<span class="nc bnc" id="L404" title="All 2 branches missed.">        } else if (entity instanceof Protomech) {</span>
<span class="nc" id="L405">            setupProtoSystemPanel();</span>
        }
<span class="nc" id="L407">    }</span>

    private void setupMechSystemPanel() {
<span class="nc" id="L410">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>
        /*
         * For the moment, I am going to cap out the number of hits at what the
         * record sheets show (i.e. 3 for engines). If we want to switch this to
         * the actual number then we can, see
         * enginePart.updateConditionFromEntity in MekHQ for an example of how
         * to retrieve all of the available system crits
         */
<span class="nc" id="L418">        int centerEngineHits = 0;</span>
<span class="nc" id="L419">        int leftEngineHits = 0;</span>
<span class="nc" id="L420">        int rightEngineHits = 0;</span>
<span class="nc" id="L421">        int gyroHits = 0;</span>
<span class="nc" id="L422">        int cockpitHits = 0;</span>
<span class="nc" id="L423">        int sensorHits = 0;</span>
<span class="nc" id="L424">        int lifeSupportHits = 0;</span>

<span class="nc" id="L426">        int centerEngineCrits = 0;</span>
<span class="nc" id="L427">        int leftEngineCrits = 0;</span>
<span class="nc" id="L428">        int rightEngineCrits = 0;</span>
<span class="nc" id="L429">        int gyroCrits = 0;</span>
<span class="nc" id="L430">        int cockpitCrits = 0;</span>
<span class="nc" id="L431">        int sensorCrits = 0;</span>
<span class="nc" id="L432">        int lifeSupportCrits = 0;</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">            if (i == Mech.LOC_CT) {</span>
<span class="nc" id="L435">                centerEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L437">                centerEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (i == Mech.LOC_LT) {</span>
<span class="nc" id="L441">                leftEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L443">                leftEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc bnc" id="L446" title="All 2 branches missed.">            if (i == Mech.LOC_RT) {</span>
<span class="nc" id="L447">                rightEngineHits = entity.getDamagedCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
<span class="nc" id="L449">                rightEngineCrits = entity.getNumberOfCriticals(</span>
                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, i);
            }
<span class="nc" id="L452">            gyroHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_GYRO, i);
<span class="nc" id="L454">            gyroCrits += entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_GYRO, i);
<span class="nc" id="L456">            cockpitHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_COCKPIT, i);
<span class="nc" id="L458">            cockpitCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_COCKPIT, i);
<span class="nc" id="L460">            sensorHits += entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                    Mech.SYSTEM_SENSORS, i);
<span class="nc" id="L462">            sensorCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_SENSORS, i);
<span class="nc" id="L464">            lifeSupportHits += entity.getDamagedCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_LIFE_SUPPORT, i);
<span class="nc" id="L466">            lifeSupportCrits += entity.getNumberOfCriticals(</span>
                    CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_LIFE_SUPPORT, i);
        }
<span class="nc" id="L469">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L470">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L471">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L472">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L473">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L474">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L475">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L476">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L478">        centerEngineCrit = new CheckCritPanel(centerEngineCrits,</span>
                centerEngineHits);
<span class="nc" id="L480">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L481">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L482">        panSystem.add(centerEngineCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, Mech.LOC_RT) &gt; 0) {</span>
<span class="nc" id="L485">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L486">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L487">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L488">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engineLT&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L490">            leftEngineCrit = new CheckCritPanel(leftEngineCrits, leftEngineHits);</span>
<span class="nc" id="L491">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L492">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L493">            panSystem.add(leftEngineCrit, gridBagConstraints);</span>
    
<span class="nc" id="L495">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L496">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L497">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L498">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engineRT&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L500">            rightEngineCrit = new CheckCritPanel(rightEngineCrits, rightEngineHits);</span>
<span class="nc" id="L501">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L502">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L503">            panSystem.add(rightEngineCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L506">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L507">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L508">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L509">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.gyro&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L511">        gyroCrit = new CheckCritPanel(gyroCrits, gyroHits);</span>
<span class="nc" id="L512">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L513">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L514">        panSystem.add(gyroCrit, gridBagConstraints);</span>

<span class="nc" id="L516">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L517">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L518">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L519">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L521">        sensorCrit = new CheckCritPanel(sensorCrits, sensorHits);</span>
<span class="nc" id="L522">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L523">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L524">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L526">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L527">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L528">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L529">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lifeSupport&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L531">        lifeSupportCrit = new CheckCritPanel(lifeSupportCrits, lifeSupportHits);</span>
<span class="nc" id="L532">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L533">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L534">        panSystem.add(lifeSupportCrit, gridBagConstraints);</span>

<span class="nc" id="L536">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L537">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L538">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L539">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L540">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.cockpit&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L542">        cockpitCrit = new CheckCritPanel(cockpitCrits, cockpitHits);</span>
<span class="nc" id="L543">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L544">        panSystem.add(cockpitCrit, gridBagConstraints);</span>
        
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (entity instanceof LandAirMech) {</span>
<span class="nc" id="L547">            lamAvionicsCrit = new TreeMap&lt;&gt;();</span>
<span class="nc" id="L548">            lamLandingGearCrit = new TreeMap&lt;&gt;();</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">            for (int loc = 0; loc &lt; entity.locations(); loc++) {</span>
<span class="nc" id="L550">                int crits = entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS, loc);</span>
<span class="nc bnc" id="L551" title="All 2 branches missed.">                if (crits &gt; 0) {</span>
<span class="nc" id="L552">                    int hits = entity.getBadCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS, loc);</span>
<span class="nc" id="L553">                    CheckCritPanel critPanel = new CheckCritPanel(crits, hits);</span>
<span class="nc" id="L554">                    lamAvionicsCrit.put(loc, critPanel);</span>
                }
<span class="nc" id="L556">                crits = entity.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR, loc);</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">                if (crits &gt; 0) {</span>
<span class="nc" id="L558">                    int hits = entity.getBadCriticals(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR, loc);</span>
<span class="nc" id="L559">                    CheckCritPanel critPanel = new CheckCritPanel(crits, hits);</span>
<span class="nc" id="L560">                    lamLandingGearCrit.put(loc, critPanel);</span>
                }
            }
<span class="nc" id="L563">            BiConsumer&lt;Map.Entry&lt;Integer,CheckCritPanel&gt;, String&gt; addToPanel = (entry, critName) -&gt; {</span>
<span class="nc" id="L564">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L565">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L566">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L567">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L568">                        String.format(Messages.getString(&quot;UnitEditorDialog.critStringLocation&quot;), critName, entity.getLocationAbbr(entry.getKey())) </span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),
                        gridBagConstraints);
<span class="nc" id="L571">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L572">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L573">                panSystem.add(entry.getValue(), gridBagConstraints);</span>
<span class="nc" id="L574">            };</span>
<span class="nc" id="L575">            lamAvionicsCrit.entrySet().forEach(e -&gt; addToPanel.accept(e, Messages.getString(&quot;UnitEditorDialog.avionics&quot;)));</span>
<span class="nc" id="L576">            lamLandingGearCrit.entrySet().forEach(e -&gt; addToPanel.accept(e, Messages.getString(&quot;UnitEditorDialog.landingGear&quot;)));</span>
        }

<span class="nc bnc" id="L579" title="All 2 branches missed.">        if (entity instanceof QuadVee) {</span>
<span class="nc" id="L580">            actuatorCrits = new CheckCritPanel[4][5];</span>
        } else {
<span class="nc" id="L582">            actuatorCrits = new CheckCritPanel[4][4];</span>
        }

<span class="nc bnc" id="L585" title="All 2 branches missed.">        for (int loc = Mech.LOC_RARM; loc &lt;= Mech.LOC_LLEG; loc++) {</span>
<span class="nc" id="L586">            int start = Mech.ACTUATOR_SHOULDER;</span>
<span class="nc" id="L587">            int end = Mech.ACTUATOR_HAND;</span>
<span class="nc bnc" id="L588" title="All 4 branches missed.">            if ((loc &gt;= Mech.LOC_RLEG) || (entity instanceof QuadMech)) {</span>
<span class="nc" id="L589">                start = Mech.ACTUATOR_HIP;</span>
<span class="nc" id="L590">                end = Mech.ACTUATOR_FOOT;</span>
            }
<span class="nc bnc" id="L592" title="All 2 branches missed.">            for (int i = start; i &lt;= end; i++) {</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">                if (!entity.hasSystem(i, loc)) {</span>
<span class="nc" id="L594">                    continue;</span>
                }
<span class="nc" id="L596">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L597">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L598">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L599">                gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L600" title="All 6 branches missed.">                if ((loc == Mech.LOC_LLEG) &amp;&amp; (i == end) &amp;&amp; !(entity instanceof QuadVee)) {</span>
<span class="nc" id="L601">                    gridBagConstraints.weighty = 1.0;</span>
                }
<span class="nc" id="L603">                panSystem.add(</span>
                        new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + 
<span class="nc" id="L605">                                String.format(Messages.getString(&quot;UnitEditorDialog.critString&quot;), </span>
<span class="nc" id="L606">                                        entity.getLocationName(loc), </span>
<span class="nc" id="L607">                                        ((Mech) entity).getSystemName(i))</span>
                                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L609">                CheckCritPanel actuatorCrit = new CheckCritPanel(1,</span>
<span class="nc" id="L610">                        entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM, i,</span>
                                loc));
<span class="nc" id="L612">                actuatorCrits[loc - Mech.LOC_RARM][i - start] = actuatorCrit;</span>
<span class="nc" id="L613">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L614">                panSystem.add(actuatorCrit, gridBagConstraints);</span>
            }
<span class="nc bnc" id="L616" title="All 2 branches missed.">            if (entity instanceof QuadVee) {</span>
<span class="nc" id="L617">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L618">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L619">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L620">                gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">                if (loc == Mech.LOC_LLEG) {</span>
<span class="nc" id="L622">                    gridBagConstraints.weighty = 1.0;</span>
                }
<span class="nc" id="L624">                panSystem.add(</span>
                        new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + 
<span class="nc" id="L626">                                String.format(Messages.getString(&quot;UnitEditorDialog.critString&quot;), </span>
<span class="nc" id="L627">                                        entity.getLocationName(loc), </span>
<span class="nc" id="L628">                                        ((Mech) entity).getSystemName(QuadVee.SYSTEM_CONVERSION_GEAR))</span>
                                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L630">                CheckCritPanel actuatorCrit = new CheckCritPanel(1,</span>
<span class="nc" id="L631">                        entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM, QuadVee.SYSTEM_CONVERSION_GEAR,</span>
                                loc));
<span class="nc" id="L633">                actuatorCrits[loc - Mech.LOC_RARM][Mech.ACTUATOR_FOOT - Mech.ACTUATOR_HIP + 1] = actuatorCrit;</span>
<span class="nc" id="L634">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L635">                panSystem.add(actuatorCrit, gridBagConstraints);</span>
            }
        }

<span class="nc" id="L639">    }</span>

    private void setupTankSystemPanel() {
<span class="nc" id="L642">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L644">        Tank tank = (Tank) entity;</span>

<span class="nc" id="L646">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L647">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L648">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L649">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L650">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L651">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L652">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.turretLock&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L654">        int lock = 0;</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        if (tank.isTurretLocked(0)) {</span>
<span class="nc" id="L656">            lock = 1;</span>
        }
<span class="nc" id="L658">        turretlockCrit = new CheckCritPanel(1, lock);</span>
<span class="nc" id="L659">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L660">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L661">        panSystem.add(turretlockCrit, gridBagConstraints);</span>

<span class="nc" id="L663">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L664">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L665">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L666">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L667">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L668">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L670">        engineCrit = new CheckCritPanel(1, tank.getEngineHits());</span>
<span class="nc" id="L671">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L672">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L673">        panSystem.add(engineCrit, gridBagConstraints);</span>

<span class="nc" id="L675">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L676">        gridBagConstraints.gridy = 2;</span>
<span class="nc" id="L677">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L678">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L680">        sensorCrit = new CheckCritPanel(4, tank.getSensorHits());</span>
<span class="nc" id="L681">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L682">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L683">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L685">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L686">        gridBagConstraints.gridy = 3;</span>
<span class="nc" id="L687">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L688">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.motiveDamage&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L690">        int motiveHits = 0;</span>
        // Do not check the crew when determining if we're immobile here
<span class="nc bnc" id="L692" title="All 2 branches missed.">        if (tank.isImmobile(false)) {</span>
<span class="nc" id="L693">            motiveHits = 4;</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">        } else if (tank.hasHeavyMovementDamage()) {</span>
<span class="nc" id="L695">            motiveHits = 3;</span>
<span class="nc bnc" id="L696" title="All 2 branches missed.">        } else if (tank.hasModerateMovementDamage()) {</span>
<span class="nc" id="L697">            motiveHits = 2;</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">        } else if (tank.hasMinorMovementDamage()) {</span>
<span class="nc" id="L699">            motiveHits = 1;</span>
        }
<span class="nc" id="L701">        motiveCrit = new CheckCritPanel(4, motiveHits);</span>
<span class="nc" id="L702">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L703">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L704">        panSystem.add(motiveCrit, gridBagConstraints);</span>

<span class="nc" id="L706">        stabilizerCrits = new CheckCritPanel[tank.locations()];</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">        for (int loc = 0; loc &lt; tank.locations(); loc++) {</span>
<span class="nc bnc" id="L708" title="All 4 branches missed.">            if ((loc == Tank.LOC_BODY) || (loc == tank.getLocTurret())</span>
<span class="nc bnc" id="L709" title="All 2 branches missed.">                    || (loc == tank.getLocTurret2())) {</span>
<span class="nc" id="L710">                continue;</span>
            }
<span class="nc" id="L712">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L713">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L714">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L715">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">            if (loc == (tank.locations() - 1)) {</span>
<span class="nc" id="L717">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L719">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L720">                    String.format(Messages.getString(&quot;UnitEditorDialog.locationStabilizer&quot;), entity.getLocationName(loc)) </span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L722">            int hits = 0;</span>
<span class="nc bnc" id="L723" title="All 2 branches missed.">            if (tank.isStabiliserHit(loc)) {</span>
<span class="nc" id="L724">                hits = 1;</span>
            }
<span class="nc" id="L726">            CheckCritPanel stabCrit = new CheckCritPanel(1, hits);</span>
<span class="nc" id="L727">            stabilizerCrits[loc] = stabCrit;</span>
<span class="nc" id="L728">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L729">            panSystem.add(stabCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L732">    }</span>

    private void setupProtoSystemPanel() {
<span class="nc" id="L735">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L737">        Protomech proto = (Protomech) entity;</span>

<span class="nc" id="L739">        protoCrits = new CheckCritPanel[proto.locations()];</span>
<span class="nc" id="L740">        gridBagConstraints.gridy = 0;</span>

<span class="nc bnc" id="L742" title="All 2 branches missed.">        for (int loc = 0; loc &lt; proto.locations(); loc++) {</span>
<span class="nc bnc" id="L743" title="All 4 branches missed.">            if ((loc == Protomech.LOC_MAINGUN) || (loc == Protomech.LOC_NMISS)) {</span>
<span class="nc" id="L744">                continue;</span>
            }
<span class="nc" id="L746">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L747">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L748">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L749">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">            if (loc == (proto.locations() - 1)) {</span>
<span class="nc" id="L751">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L753">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L754">                    String.format(Messages.getString(&quot;UnitEditorDialog.protoCritString&quot;), entity.getLocationName(loc))  </span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L756">            int hits = 0;</span>
<span class="nc bnc" id="L757" title="All 4 branches missed.">            if ((loc == Protomech.LOC_LARM) || (loc == Protomech.LOC_RARM)) {</span>
<span class="nc" id="L758">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_ARMCRIT, loc);
            }
<span class="nc bnc" id="L761" title="All 2 branches missed.">            if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L762">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_LEGCRIT, loc);
            }
<span class="nc bnc" id="L765" title="All 2 branches missed.">            if (loc == Protomech.LOC_HEAD) {</span>
<span class="nc" id="L766">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_HEADCRIT, loc);
            }
<span class="nc bnc" id="L769" title="All 2 branches missed.">            if (loc == Protomech.LOC_TORSO) {</span>
<span class="nc" id="L770">                hits = entity.getDamagedCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                        Protomech.SYSTEM_TORSOCRIT, loc);
            }
<span class="nc" id="L773">            int nCrits = 2;</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">            if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L775">                nCrits = 3;</span>
            }
<span class="nc" id="L777">            CheckCritPanel protoCrit = new CheckCritPanel(nCrits, hits);</span>
<span class="nc" id="L778">            protoCrits[loc] = protoCrit;</span>
<span class="nc" id="L779">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L780">            panSystem.add(protoCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L783">    }</span>

    private void setupVtolSystemPanel() {
<span class="nc" id="L786">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L788">        VTOL vtol = (VTOL) entity;</span>

<span class="nc" id="L790">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L791">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L792">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L793">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L794">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L795">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L796">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.flightStabilizer&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L798">        int flightStabHit = 0;</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">        if (vtol.isStabiliserHit(VTOL.LOC_ROTOR)) {</span>
<span class="nc" id="L800">            flightStabHit = 1;</span>
        }
<span class="nc" id="L802">        flightStabilizerCrit = new CheckCritPanel(1, flightStabHit);</span>
<span class="nc" id="L803">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L804">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L805">        panSystem.add(flightStabilizerCrit, gridBagConstraints);</span>

<span class="nc" id="L807">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L808">        gridBagConstraints.gridy = 1;</span>
<span class="nc" id="L809">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L810">        gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L811">        gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L812">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L814">        engineCrit = new CheckCritPanel(1, vtol.getEngineHits());</span>
<span class="nc" id="L815">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L816">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L817">        panSystem.add(engineCrit, gridBagConstraints);</span>

<span class="nc" id="L819">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L820">        gridBagConstraints.gridy = 2;</span>
<span class="nc" id="L821">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L822">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L824">        sensorCrit = new CheckCritPanel(4, vtol.getSensorHits());</span>
<span class="nc" id="L825">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L826">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L827">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L829">        stabilizerCrits = new CheckCritPanel[vtol.locations()];</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">        for (int loc = 0; loc &lt; vtol.locations(); loc++) {</span>
<span class="nc bnc" id="L831" title="All 4 branches missed.">            if ((loc == Tank.LOC_BODY) || (loc == VTOL.LOC_ROTOR)) {</span>
<span class="nc" id="L832">                continue;</span>
            }
<span class="nc" id="L834">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L835">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L836">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L837">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc bnc" id="L838" title="All 2 branches missed.">            if (loc == (vtol.locations() - 1)) {</span>
<span class="nc" id="L839">                gridBagConstraints.weighty = 1.0;</span>
            }
<span class="nc" id="L841">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L842">                    String.format(Messages.getString(&quot;UnitEditorDialog.locationStabilizer&quot;), entity.getLocationName(loc))</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L844">            int hits = 0;</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">            if (vtol.isStabiliserHit(loc)) {</span>
<span class="nc" id="L846">                hits = 1;</span>
            }
<span class="nc" id="L848">            CheckCritPanel stabCrit = new CheckCritPanel(1, hits);</span>
<span class="nc" id="L849">            stabilizerCrits[loc] = stabCrit;</span>
<span class="nc" id="L850">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L851">            panSystem.add(stabCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L854">    }</span>

    private void setupAeroSystemPanel() {
<span class="nc" id="L857">        GridBagConstraints gridBagConstraints = new GridBagConstraints();</span>

<span class="nc" id="L859">        Aero aero = (Aero) entity;</span>

<span class="nc" id="L861">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L862">        gridBagConstraints.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L863">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L864">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L865">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L866">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L867">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.avionics&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L869">        avionicsCrit = new CheckCritPanel(3, aero.getAvionicsHits());</span>
<span class="nc" id="L870">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L871">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L872">        panSystem.add(avionicsCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L874" title="All 2 branches missed.">        if (aero instanceof Jumpship) {</span>
<span class="nc" id="L875">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L876">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L877">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L878">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L879">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L880">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.cic&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L882">            cicCrit = new CheckCritPanel(3, aero.getCICHits());</span>
<span class="nc" id="L883">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L884">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L885">            panSystem.add(cicCrit, gridBagConstraints);</span>
        } else {
<span class="nc" id="L887">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L888">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L889">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L890">            gridBagConstraints.weighty = 0.0;</span>
<span class="nc" id="L891">            gridBagConstraints.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L892">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.fcs&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                    gridBagConstraints);
<span class="nc" id="L894">            fcsCrit = new CheckCritPanel(3, aero.getFCSHits());</span>
<span class="nc" id="L895">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L896">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L897">            panSystem.add(fcsCrit, gridBagConstraints);</span>
        }

<span class="nc" id="L900">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L901">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L902">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L903">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sensor&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L905">        sensorCrit = new CheckCritPanel(3, aero.getSensorHits());</span>
<span class="nc" id="L906">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L907">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L908">        panSystem.add(sensorCrit, gridBagConstraints);</span>

<span class="nc" id="L910">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L911">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L912">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L913">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.engine&quot;) + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;),</span>
                gridBagConstraints);
<span class="nc" id="L915">        engineCrit = new CheckCritPanel(3, aero.getEngineHits());</span>
<span class="nc bnc" id="L916" title="All 4 branches missed.">        if ((aero instanceof Dropship) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L917">            engineCrit = new CheckCritPanel(6, aero.getEngineHits());</span>
        }
<span class="nc" id="L919">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L920">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L921">        panSystem.add(engineCrit, gridBagConstraints);</span>
        
<span class="nc bnc" id="L923" title="All 2 branches missed.">    if (!(aero instanceof Jumpship)) {</span>
<span class="nc" id="L924">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L925">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L926">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L927">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.landingGear&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L929">        int gearHits = 0;</span>
<span class="nc bnc" id="L930" title="All 2 branches missed.">        if (aero.isGearHit()) {</span>
<span class="nc" id="L931">            gearHits = 1;</span>
        }
<span class="nc" id="L933">        gearCrit = new CheckCritPanel(1, gearHits);</span>
<span class="nc" id="L934">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L935">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L936">        panSystem.add(gearCrit, gridBagConstraints);</span>
    }
    
<span class="nc" id="L939">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L940">        gridBagConstraints.gridy++;</span>
<span class="nc" id="L941">        gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L942">        panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lifeSupport&quot;)</span>
                + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L944">        int lifeHits = 0;</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">        if (!aero.hasLifeSupport()) {</span>
<span class="nc" id="L946">            lifeHits = 1;</span>
        }
<span class="nc" id="L948">        lifeSupportCrit = new CheckCritPanel(1, lifeHits);</span>
<span class="nc" id="L949">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L950">        gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L951">        panSystem.add(lifeSupportCrit, gridBagConstraints);</span>

<span class="nc bnc" id="L953" title="All 4 branches missed.">        if ((aero instanceof SmallCraft) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L954">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L955">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L956">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L957">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.leftThruster&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L959">            leftThrusterCrit = new CheckCritPanel(4, aero.getLeftThrustHits());</span>
<span class="nc" id="L960">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L961">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L962">            panSystem.add(leftThrusterCrit, gridBagConstraints);</span>

<span class="nc" id="L964">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L965">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L966">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L967">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.rightThruster&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L969">            rightThrusterCrit = new CheckCritPanel(4, aero.getRightThrustHits());</span>
<span class="nc" id="L970">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L971">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L972">            panSystem.add(rightThrusterCrit, gridBagConstraints);</span>
        }
        
<span class="nc bnc" id="L975" title="All 2 branches missed.">        if (aero instanceof Jumpship) {</span>
<span class="nc" id="L976">            Jumpship js = (Jumpship) aero;</span>
            //Grav Decks
<span class="nc" id="L978">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L979">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L980">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L981">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.gravDecks&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L983">            gravDeckCrit = new CheckCritPanel(js.getTotalGravDeck(), js.getTotalDamagedGravDeck());</span>
<span class="nc" id="L984">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L985">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L986">            panSystem.add(gravDeckCrit, gridBagConstraints);</span>
            
            //Docking Collars
            JSpinner collarCrit;
<span class="nc" id="L990">            Vector&lt;DockingCollar&gt; collars = aero.getDockingCollars();</span>
<span class="nc" id="L991">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L992">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L993">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L994">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.dockingCollars&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
            
<span class="nc" id="L997">            int damagedCollars = 0;</span>
<span class="nc bnc" id="L998" title="All 2 branches missed.">            for (DockingCollar nextDC : aero.getDockingCollars()) {</span>
<span class="nc bnc" id="L999" title="All 2 branches missed.">                if (nextDC.isDamaged()) {</span>
<span class="nc" id="L1000">                    damagedCollars ++;</span>
                }
<span class="nc" id="L1002">            }</span>
<span class="nc" id="L1003">            collarCrit = new JSpinner(new SpinnerNumberModel(collars.size() - damagedCollars, 0, collars.size(), 1.0));</span>
<span class="nc" id="L1004">            collarDamage = collarCrit;</span>
<span class="nc" id="L1005">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1006">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1007">            panSystem.add(collarCrit, gridBagConstraints);</span>
            
            //K-F Drive Integrity
            JSpinner kfDriveCrit;
<span class="nc" id="L1011">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1012">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1013">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1014">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.kfIntegrity&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1016">            kfDriveCrit = new JSpinner(new SpinnerNumberModel(js.getKFIntegrity(), 0, js.getOKFIntegrity(), 1.0));</span>
<span class="nc" id="L1017">            kfDamage = kfDriveCrit;</span>
<span class="nc" id="L1018">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1019">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1020">            panSystem.add(kfDriveCrit, gridBagConstraints);</span>
            
            //K-F Drive Components (Optional)
            //Drive Coil
<span class="nc bnc" id="L1024" title="All 2 branches missed.">            if (entity.getGame().getOptions().booleanOption(OptionsConstants.ADVAERORULES_EXPANDED_KF_DRIVE_DAMAGE)) {</span>
<span class="nc" id="L1025">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1026">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1027">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1028">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.driveCoil&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1030">                int driveCoilHits = 0;</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">                if (js.getKFDriveCoilHit()) {</span>
<span class="nc" id="L1032">                    driveCoilHits = 1;</span>
                }
<span class="nc" id="L1034">                driveCoilCrit = new CheckCritPanel(1, driveCoilHits);</span>
<span class="nc" id="L1035">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1036">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1037">                panSystem.add(driveCoilCrit, gridBagConstraints);</span>
                
                //Charging System
<span class="nc" id="L1040">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1041">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1042">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1043">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.chargingSystem&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1045">                int chargingSystemHits = 0;</span>
<span class="nc bnc" id="L1046" title="All 2 branches missed.">                if (js.getKFChargingSystemHit()) {</span>
<span class="nc" id="L1047">                    chargingSystemHits = 1;</span>
                }
<span class="nc" id="L1049">                chargingSystemCrit = new CheckCritPanel(1, chargingSystemHits);</span>
<span class="nc" id="L1050">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1051">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1052">                panSystem.add(chargingSystemCrit, gridBagConstraints);</span>
                
                //Field Initiator
<span class="nc" id="L1055">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1056">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1057">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1058">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.fieldInitiator&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1060">                int fieldInitiatorHits = 0;</span>
<span class="nc bnc" id="L1061" title="All 2 branches missed.">                if (js.getKFFieldInitiatorHit()) {</span>
<span class="nc" id="L1062">                    fieldInitiatorHits = 1;</span>
                }
<span class="nc" id="L1064">                fieldInitiatorCrit = new CheckCritPanel(1, fieldInitiatorHits);</span>
<span class="nc" id="L1065">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1066">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1067">                panSystem.add(fieldInitiatorCrit, gridBagConstraints);</span>
                
                //Drive Controller
<span class="nc" id="L1070">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1071">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1072">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1073">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.driveController&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1075">                int driveControllerHits = 0;</span>
<span class="nc bnc" id="L1076" title="All 2 branches missed.">                if (js.getKFDriveControllerHit()) {</span>
<span class="nc" id="L1077">                    driveControllerHits = 1;</span>
                }
<span class="nc" id="L1079">                driveControllerCrit = new CheckCritPanel(1, driveControllerHits);</span>
<span class="nc" id="L1080">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1081">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1082">                panSystem.add(driveControllerCrit, gridBagConstraints);</span>
                
                //Helium Tank
<span class="nc" id="L1085">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1086">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1087">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1088">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.heliumTank&quot;)</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1090">                int heliumTankHits = 0;</span>
<span class="nc bnc" id="L1091" title="All 2 branches missed.">                if (js.getKFHeliumTankHit()) {</span>
<span class="nc" id="L1092">                    heliumTankHits = 1;</span>
                }
<span class="nc" id="L1094">                heliumTankCrit = new CheckCritPanel(1, heliumTankHits);</span>
<span class="nc" id="L1095">                gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1096">                gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1097">                panSystem.add(heliumTankCrit, gridBagConstraints);</span>
                
                //LF Battery
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                if (js.hasLF()) {</span>
<span class="nc" id="L1101">                    gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1102">                    gridBagConstraints.gridy++;</span>
<span class="nc" id="L1103">                    gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1104">                    panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.lfBattery&quot;)</span>
                            + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1106">                    int lfBatteryHits = 0;</span>
<span class="nc bnc" id="L1107" title="All 2 branches missed.">                    if (js.getLFBatteryHit()) {</span>
<span class="nc" id="L1108">                        lfBatteryHits = 1;</span>
                    }
<span class="nc" id="L1110">                    lfBatteryCrit = new CheckCritPanel(1, lfBatteryHits);</span>
<span class="nc" id="L1111">                    gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1112">                    gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1113">                    panSystem.add(lfBatteryCrit, gridBagConstraints);</span>
                }
            }
            
            //Jump Sail Integrity
            JSpinner sailCrit;
<span class="nc" id="L1119">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1120">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1121">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1122">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.sailIntegrity&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1124">            sailCrit = new JSpinner(new SpinnerNumberModel(js.getSailIntegrity(), 0, js.getOSailIntegrity(), 1.0));</span>
<span class="nc" id="L1125">            sailDamage = sailCrit;</span>
<span class="nc" id="L1126">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1127">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1128">            panSystem.add(sailCrit, gridBagConstraints);</span>
        }

<span class="nc bnc" id="L1131" title="All 2 branches missed.">        if (aero instanceof Dropship) {</span>
<span class="nc" id="L1132">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1133">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1134">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1135">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.dropshipCollar&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1137">            int collarHits = 0;</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">            if (((Dropship) aero).isDockCollarDamaged()) {</span>
<span class="nc" id="L1139">                collarHits = 1;</span>
            }
<span class="nc" id="L1141">            dockCollarCrit = new CheckCritPanel(1, collarHits);</span>
<span class="nc" id="L1142">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1143">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1144">            panSystem.add(dockCollarCrit, gridBagConstraints);</span>
            
<span class="nc" id="L1146">            gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1147">            gridBagConstraints.gridy++;</span>
<span class="nc" id="L1148">            gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1149">            panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(&quot;UnitEditorDialog.kfBoom&quot;)</span>
                    + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
<span class="nc" id="L1151">            int kfboomHits = 0;</span>
<span class="nc bnc" id="L1152" title="All 2 branches missed.">            if (((Dropship) aero).isKFBoomDamaged()) {</span>
<span class="nc" id="L1153">            	kfboomHits = 1;</span>
            }
<span class="nc" id="L1155">            kfboomCrit = new CheckCritPanel(1, kfboomHits);</span>
<span class="nc" id="L1156">            gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1157">            gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1158">            panSystem.add(kfboomCrit, gridBagConstraints);</span>
        }
        
<span class="nc bnc" id="L1161" title="All 4 branches missed.">        if ((aero instanceof SmallCraft) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L1162">        	int b = 0;</span>
        	JSpinner bayCrit;
<span class="nc" id="L1164">        	Vector&lt;Bay&gt; bays = aero.getTransportBays();</span>
<span class="nc" id="L1165">        	bayDamage = new JSpinner[bays.size()];</span>
<span class="nc" id="L1166">        	bayDoorCrit = new CheckCritPanel [bays.size()];</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">        	for (Bay nextbay : bays) {</span>
<span class="nc" id="L1168">        		gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1169">        		gridBagConstraints.gridy++;</span>
<span class="nc" id="L1170">        		gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1171">        		panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L1172">        		        String.format(Messages.getString(&quot;UnitEditorDialog.bayCrit&quot;), nextbay.getType(), nextbay.getBayNumber())</span>
        		        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
    		
<span class="nc" id="L1175">        		bayCrit = new JSpinner(new SpinnerNumberModel(nextbay.getCapacity() - nextbay.getBayDamage(),</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">                        0, nextbay.getCapacity(), nextbay.isCargo()? 0.5: 1.0));</span>
<span class="nc" id="L1177">        		bayDamage[b] = bayCrit;</span>
<span class="nc" id="L1178">        		gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1179">        		gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1180">        		panSystem.add(bayCrit, gridBagConstraints);</span>
    		
<span class="nc" id="L1182">                gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L1183">                gridBagConstraints.gridy++;</span>
<span class="nc" id="L1184">                gridBagConstraints.weightx = 0.0;</span>
<span class="nc" id="L1185">                panSystem.add(new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + </span>
<span class="nc" id="L1186">                        String.format(Messages.getString(&quot;UnitEditorDialog.bayDoorCrit&quot;), nextbay.getBayNumber())</span>
                        + &quot;&lt;/b&gt;&lt;br&gt;&lt;/html&gt;&quot;), gridBagConstraints);
    		
<span class="nc" id="L1189">        		CheckCritPanel doorCrit = new CheckCritPanel(nextbay.getDoors(), (nextbay.getDoors() - nextbay.getCurrentDoors()));</span>
<span class="nc" id="L1190">        		bayDoorCrit[b] = doorCrit;</span>
<span class="nc" id="L1191">        		gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L1192">        		gridBagConstraints.weightx = 1.0;</span>
<span class="nc" id="L1193">        		panSystem.add(doorCrit, gridBagConstraints);</span>
<span class="nc" id="L1194">        		b++;</span>
<span class="nc" id="L1195">    		}</span>
    	}
<span class="nc" id="L1197">    }</span>

    private void btnOkayActionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc bnc" id="L1200" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">            if (null != spnInternal[i]) {</span>
<span class="nc" id="L1202">                int internal = (Integer) spnInternal[i].getModel().getValue();</span>
<span class="nc bnc" id="L1203" title="All 2 branches missed.">                if (internal &lt;= 0) {</span>
<span class="nc" id="L1204">                    internal = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc bnc" id="L1206" title="All 4 branches missed.">                if ((entity instanceof Aero) &amp;&amp; (i == 0)) {</span>
<span class="nc" id="L1207">                    ((Aero) entity).setSI(internal);</span>
                } else {
<span class="nc" id="L1209">                    entity.setInternal(internal, i);</span>
                }
<span class="nc bnc" id="L1211" title="All 2 branches missed.">                if (entity.isConventionalInfantry()) {</span>
<span class="nc" id="L1212">                    entity.applyDamage();</span>
                }
            }
<span class="nc bnc" id="L1215" title="All 2 branches missed.">            if (null != spnArmor[i]) {</span>
<span class="nc" id="L1216">                int armor = (Integer) spnArmor[i].getModel().getValue();</span>
<span class="nc bnc" id="L1217" title="All 2 branches missed.">                if (armor &lt;= 0) {</span>
<span class="nc" id="L1218">                    armor = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc" id="L1220">                entity.setArmor(armor, i);</span>
            }
<span class="nc bnc" id="L1222" title="All 4 branches missed.">            if (entity.hasRearArmor(i) &amp;&amp; (null != spnRear[i])) {</span>
<span class="nc" id="L1223">                int rear = (Integer) spnRear[i].getModel().getValue();</span>
<span class="nc bnc" id="L1224" title="All 2 branches missed.">                if (rear &lt;= 0) {</span>
<span class="nc" id="L1225">                    rear = IArmorState.ARMOR_DESTROYED;</span>
                }
<span class="nc" id="L1227">                entity.setArmor(rear, i, true);</span>
            }
        }
<span class="nc bnc" id="L1230" title="All 2 branches missed.">        for (Mounted m : entity.getEquipment()) {</span>
<span class="nc" id="L1231">            int eqNum = entity.getEquipmentNum(m);</span>
<span class="nc" id="L1232">            CheckCritPanel crit = equipCrits.get(eqNum);</span>
<span class="nc bnc" id="L1233" title="All 2 branches missed.">            if (null != crit) {</span>
<span class="nc" id="L1234">                int hits = crit.getHits();</span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">                m.setDestroyed(hits &gt; 0);</span>
<span class="nc bnc" id="L1236" title="All 2 branches missed.">                m.setHit(hits &gt; 0);</span>
<span class="nc" id="L1237">                entity.damageSystem(CriticalSlot.TYPE_EQUIPMENT, eqNum, hits);</span>
            }
<span class="nc" id="L1239">        }</span>

        // now systems
<span class="nc bnc" id="L1242" title="All 2 branches missed.">        if (entity instanceof Mech) {</span>
<span class="nc bnc" id="L1243" title="All 2 branches missed.">            if (null != centerEngineCrit) {</span>
<span class="nc" id="L1244">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_CT,
<span class="nc" id="L1246">                        centerEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1248" title="All 2 branches missed.">            if (null != leftEngineCrit) {</span>
<span class="nc" id="L1249">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_LT,
<span class="nc" id="L1251">                        leftEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1253" title="All 2 branches missed.">            if (null != rightEngineCrit) {</span>
<span class="nc" id="L1254">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                        Mech.SYSTEM_ENGINE, Mech.LOC_RT,
<span class="nc" id="L1256">                        rightEngineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1258" title="All 2 branches missed.">            if (null != gyroCrit) {</span>
<span class="nc" id="L1259">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_GYRO,</span>
<span class="nc" id="L1260">                        gyroCrit.getHits());</span>
            }
<span class="nc bnc" id="L1262" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1263">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1264">                        Mech.SYSTEM_SENSORS, sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1266" title="All 2 branches missed.">            if (null != lifeSupportCrit) {</span>
<span class="nc" id="L1267">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1268">                        Mech.SYSTEM_LIFE_SUPPORT, lifeSupportCrit.getHits());</span>
            }
<span class="nc bnc" id="L1270" title="All 2 branches missed.">            if (null != cockpitCrit) {</span>
<span class="nc" id="L1271">                entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
<span class="nc" id="L1272">                        Mech.SYSTEM_COCKPIT, cockpitCrit.getHits());</span>
            }
<span class="nc bnc" id="L1274" title="All 4 branches missed.">            if (null != lamAvionicsCrit &amp;&amp; !lamAvionicsCrit.isEmpty()) {</span>
<span class="nc bnc" id="L1275" title="All 2 branches missed.">                for (int loc : lamAvionicsCrit.keySet()) {</span>
<span class="nc" id="L1276">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS,</span>
<span class="nc" id="L1277">                            loc, lamAvionicsCrit.get(loc).getHits());</span>
<span class="nc" id="L1278">                }</span>
            }
<span class="nc bnc" id="L1280" title="All 4 branches missed.">            if (null != lamLandingGearCrit &amp;&amp; !lamLandingGearCrit.isEmpty()) {</span>
<span class="nc bnc" id="L1281" title="All 2 branches missed.">                for (int loc : lamLandingGearCrit.keySet()) {</span>
<span class="nc" id="L1282">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR,</span>
<span class="nc" id="L1283">                            loc, lamLandingGearCrit.get(loc).getHits());</span>
<span class="nc" id="L1284">                }</span>
            }
<span class="nc bnc" id="L1286" title="All 2 branches missed.">            for (int i = 0; i &lt; 4; i++) {</span>
<span class="nc bnc" id="L1287" title="All 2 branches missed.">                for (int j = 0; j &lt; 4; j++) {</span>
<span class="nc" id="L1288">                    CheckCritPanel actuatorCrit = actuatorCrits[i][j];</span>
<span class="nc bnc" id="L1289" title="All 2 branches missed.">                    if (null == actuatorCrit) {</span>
<span class="nc" id="L1290">                        continue;</span>
                    }
<span class="nc" id="L1292">                    int loc = i + Mech.LOC_RARM;</span>
<span class="nc" id="L1293">                    int actuator = j + Mech.ACTUATOR_SHOULDER;</span>
<span class="nc bnc" id="L1294" title="All 4 branches missed.">                    if ((loc &gt;= Mech.LOC_RLEG) || (entity instanceof QuadMech)) {</span>
<span class="nc" id="L1295">                        actuator = j + Mech.ACTUATOR_HIP;</span>
                    }
<span class="nc" id="L1297">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM, actuator,</span>
<span class="nc" id="L1298">                            loc, actuatorCrit.getHits());</span>
                }
<span class="nc bnc" id="L1300" title="All 2 branches missed.">                if (entity instanceof QuadVee) {</span>
<span class="nc bnc" id="L1301" title="All 2 branches missed.">                    for (int j = 0; j &lt; 4; j++) {</span>
<span class="nc" id="L1302">                        CheckCritPanel actuatorCrit = actuatorCrits[i][4];</span>
<span class="nc bnc" id="L1303" title="All 2 branches missed.">                        if (null == actuatorCrit) {</span>
<span class="nc" id="L1304">                            continue;</span>
                        }
<span class="nc" id="L1306">                        int loc = i + Mech.LOC_RARM;</span>
<span class="nc" id="L1307">                        int actuator = QuadVee.SYSTEM_CONVERSION_GEAR;</span>
<span class="nc" id="L1308">                        entity.damageSystem(CriticalSlot.TYPE_SYSTEM, actuator,</span>
<span class="nc" id="L1309">                                loc, actuatorCrit.getHits());</span>
                    }
                }
            }
<span class="nc bnc" id="L1313" title="All 2 branches missed.">        } else if (entity instanceof Protomech) {</span>
<span class="nc bnc" id="L1314" title="All 2 branches missed.">            for (int loc = 0; loc &lt; entity.locations(); loc++) {</span>
<span class="nc bnc" id="L1315" title="All 2 branches missed.">                if (null == protoCrits[loc]) {</span>
<span class="nc" id="L1316">                    continue;</span>
                }
<span class="nc bnc" id="L1318" title="All 4 branches missed.">                if ((loc == Protomech.LOC_LARM) || (loc == Protomech.LOC_RARM)) {</span>
<span class="nc" id="L1319">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_ARMCRIT, loc,
<span class="nc" id="L1321">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1323" title="All 2 branches missed.">                if (loc == Protomech.LOC_LEG) {</span>
<span class="nc" id="L1324">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_LEGCRIT, loc,
<span class="nc" id="L1326">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1328" title="All 2 branches missed.">                if (loc == Protomech.LOC_HEAD) {</span>
<span class="nc" id="L1329">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_HEADCRIT, loc,
<span class="nc" id="L1331">                            protoCrits[loc].getHits());</span>
                }
<span class="nc bnc" id="L1333" title="All 2 branches missed.">                if (loc == Protomech.LOC_TORSO) {</span>
<span class="nc" id="L1334">                    entity.damageSystem(CriticalSlot.TYPE_SYSTEM,</span>
                            Protomech.SYSTEM_TORSOCRIT, loc,
<span class="nc" id="L1336">                            protoCrits[loc].getHits());</span>
                }
            }
<span class="nc bnc" id="L1339" title="All 2 branches missed.">        } else if (entity instanceof Tank) {</span>
<span class="nc" id="L1340">            Tank tank = (Tank) entity;</span>
<span class="nc bnc" id="L1341" title="All 2 branches missed.">            if (null != engineCrit) {</span>
<span class="nc bnc" id="L1342" title="All 2 branches missed.">                if (engineCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1343">                    tank.engineHit();</span>
                } else {
<span class="nc" id="L1345">                    tank.engineFix();</span>
                }
            }
<span class="nc bnc" id="L1348" title="All 2 branches missed.">            if (null != turretlockCrit) {</span>
<span class="nc bnc" id="L1349" title="All 2 branches missed.">                if (turretlockCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1350">                    tank.lockTurret(0);</span>
                } else {
<span class="nc" id="L1352">                    tank.unlockTurret();</span>
                }
            }
<span class="nc bnc" id="L1355" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1356">                tank.setSensorHits(sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1358" title="All 2 branches missed.">            if (null != motiveCrit) {</span>
<span class="nc" id="L1359">                tank.resetMovementDamage();</span>
<span class="nc" id="L1360">                tank.addMovementDamage(motiveCrit.getHits());</span>

                // Apply movement damage immediately in case we've decided to immobilize the tank
<span class="nc" id="L1363">                tank.applyMovementDamage();</span>
            }
<span class="nc bnc" id="L1365" title="All 4 branches missed.">            if ((tank instanceof VTOL) &amp;&amp; (null != flightStabilizerCrit)) {</span>
<span class="nc bnc" id="L1366" title="All 2 branches missed.">                if (flightStabilizerCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1367">                    tank.setStabiliserHit(VTOL.LOC_ROTOR);</span>
                } else {
<span class="nc" id="L1369">                    tank.clearStabiliserHit(VTOL.LOC_ROTOR);</span>
                }
            }
<span class="nc bnc" id="L1372" title="All 2 branches missed.">            for (int loc = 0; loc &lt; tank.locations(); loc++) {</span>
<span class="nc" id="L1373">                CheckCritPanel stabCrit = stabilizerCrits[loc];</span>
<span class="nc bnc" id="L1374" title="All 2 branches missed.">                if (null == stabCrit) {</span>
<span class="nc" id="L1375">                    continue;</span>
                }
<span class="nc bnc" id="L1377" title="All 2 branches missed.">                if (stabCrit.getHits() &gt; 0) {</span>
<span class="nc" id="L1378">                    tank.setStabiliserHit(loc);</span>
                } else {
<span class="nc" id="L1380">                    tank.clearStabiliserHit(loc);</span>
                }
            }
<span class="nc bnc" id="L1383" title="All 2 branches missed.">        } else if (entity instanceof Aero) {</span>
<span class="nc" id="L1384">            Aero aero = (Aero) entity;</span>
<span class="nc bnc" id="L1385" title="All 2 branches missed.">            if (null != avionicsCrit) {</span>
<span class="nc" id="L1386">                aero.setAvionicsHits(avionicsCrit.getHits());</span>
            }
<span class="nc bnc" id="L1388" title="All 2 branches missed.">            if (null != fcsCrit) {</span>
<span class="nc" id="L1389">                aero.setFCSHits(fcsCrit.getHits());</span>
            }
<span class="nc bnc" id="L1391" title="All 2 branches missed.">            if (null != cicCrit) {</span>
<span class="nc" id="L1392">                aero.setCICHits(cicCrit.getHits());</span>
            }
<span class="nc bnc" id="L1394" title="All 2 branches missed.">            if (null != engineCrit) {</span>
<span class="nc" id="L1395">                aero.setEngineHits(engineCrit.getHits());</span>
            }
<span class="nc bnc" id="L1397" title="All 2 branches missed.">            if (null != sensorCrit) {</span>
<span class="nc" id="L1398">                aero.setSensorHits(sensorCrit.getHits());</span>
            }
<span class="nc bnc" id="L1400" title="All 2 branches missed.">            if (null != gearCrit) {</span>
<span class="nc bnc" id="L1401" title="All 2 branches missed.">                aero.setGearHit(gearCrit.getHits() &gt; 0);</span>
            }
<span class="nc bnc" id="L1403" title="All 2 branches missed.">            if (null != lifeSupportCrit) {</span>
<span class="nc bnc" id="L1404" title="All 2 branches missed.">                aero.setLifeSupport(lifeSupportCrit.getHits() == 0);</span>
            }
<span class="nc bnc" id="L1406" title="All 2 branches missed.">            if (null != leftThrusterCrit) {</span>
<span class="nc" id="L1407">                aero.setLeftThrustHits(leftThrusterCrit.getHits());</span>
            }
<span class="nc bnc" id="L1409" title="All 2 branches missed.">            if (null != rightThrusterCrit) {</span>
<span class="nc" id="L1410">                aero.setRightThrustHits(rightThrusterCrit.getHits());</span>
            }
<span class="nc bnc" id="L1412" title="All 4 branches missed.">            if ((null != dockCollarCrit) &amp;&amp; (aero instanceof Dropship)) {</span>
<span class="nc" id="L1413">                ((Dropship) aero)</span>
<span class="nc bnc" id="L1414" title="All 2 branches missed.">                        .setDamageDockCollar(dockCollarCrit.getHits() &gt; 0);</span>
            }
<span class="nc bnc" id="L1416" title="All 4 branches missed.">            if ((null != kfboomCrit) &amp;&amp; (aero instanceof Dropship)) {</span>
<span class="nc" id="L1417">            	((Dropship) aero)</span>
<span class="nc bnc" id="L1418" title="All 2 branches missed.">            			.setDamageKFBoom(kfboomCrit.getHits() &gt; 0);</span>
            }
            // cargo bays and bay doors
<span class="nc bnc" id="L1421" title="All 4 branches missed.">            if ((aero instanceof Dropship) || (aero instanceof Jumpship)) {</span>
<span class="nc" id="L1422">            	int b = 0;</span>
<span class="nc bnc" id="L1423" title="All 2 branches missed.">            	for (Bay bay : aero.getTransportBays()) {</span>
<span class="nc" id="L1424">            		JSpinner bayCrit = bayDamage[b];</span>
<span class="nc bnc" id="L1425" title="All 2 branches missed.">            		if (null == bayCrit) {</span>
<span class="nc" id="L1426">            			continue;</span>
            		}
<span class="nc" id="L1428">            		bay.setBayDamage(bay.getCapacity() - (Double) bayCrit.getModel().getValue());</span>
<span class="nc" id="L1429">            		CheckCritPanel doorCrit = bayDoorCrit[b];</span>
<span class="nc bnc" id="L1430" title="All 2 branches missed.">            		if (null == doorCrit) {</span>
<span class="nc" id="L1431">            			continue;</span>
            		}
<span class="nc bnc" id="L1433" title="All 4 branches missed.">            		if ((bay.getCurrentDoors() &gt; 0) &amp;&amp; (doorCrit.getHits() &gt; 0)) {</span>
<span class="nc" id="L1434">            			bay.setCurrentDoors(bay.getDoors() - doorCrit.getHits());</span>

<span class="nc bnc" id="L1436" title="All 2 branches missed.">            		} else if (doorCrit.getHits() == 0) {</span>
<span class="nc" id="L1437">            			bay.setCurrentDoors(bay.getDoors());</span>
            		}
        			// for ASF and SC bays, we have to update recovery slots as doors are changed
<span class="nc bnc" id="L1440" title="All 2 branches missed.">        			if (bay instanceof ASFBay) {</span>
<span class="nc" id="L1441">        				ASFBay a = (ASFBay) bay;</span>
<span class="nc" id="L1442">        				a.initializeRecoverySlots();        				</span>
        			} 
<span class="nc bnc" id="L1444" title="All 2 branches missed.">        			if (bay instanceof SmallCraftBay) {</span>
<span class="nc" id="L1445">    					SmallCraftBay s = (SmallCraftBay) bay;</span>
<span class="nc" id="L1446">    					s.initializeRecoverySlots();    					</span>
        			}
<span class="nc" id="L1448">            	b++;</span>
<span class="nc" id="L1449">            	}</span>
            }
            // Jumpship Docking Collars, KF Drive, Sail and Grav Decks
<span class="nc bnc" id="L1452" title="All 2 branches missed.">            if (aero instanceof Jumpship) {</span>
<span class="nc" id="L1453">                Jumpship js = (Jumpship) aero;</span>
<span class="nc" id="L1454">                JSpinner collarCrit = collarDamage;</span>
<span class="nc" id="L1455">                CheckCritPanel deckCrit = gravDeckCrit;</span>
<span class="nc" id="L1456">                double damagedCollars = 0.0;</span>
<span class="nc" id="L1457">                int damagedDecks = 0;</span>
<span class="nc bnc" id="L1458" title="All 2 branches missed.">                if (null != collarCrit) {</span>
<span class="nc" id="L1459">                    damagedCollars = (aero.getDockingCollars().size() - (double) collarCrit.getModel().getValue());</span>
                }
                //First, reset damaged collars to undamaged. Otherwise you get weirdness when running this dialogue multiple times
<span class="nc bnc" id="L1462" title="All 2 branches missed.">                for (DockingCollar collar : aero.getDockingCollars()) {</span>
<span class="nc" id="L1463">                    collar.setDamaged(false);</span>
<span class="nc" id="L1464">                }</span>
                //Otherwise, run through the list and damage one until the spinner value is satisfied
<span class="nc bnc" id="L1466" title="All 2 branches missed.">                for (DockingCollar collar : aero.getDockingCollars()) {</span>
<span class="nc bnc" id="L1467" title="All 2 branches missed.">                    if (damagedCollars &lt;= 0) {</span>
<span class="nc" id="L1468">                        break;</span>
                    }
<span class="nc" id="L1470">                    collar.setDamaged(true);</span>
<span class="nc" id="L1471">                    damagedCollars --;</span>
<span class="nc" id="L1472">                }</span>
<span class="nc bnc" id="L1473" title="All 2 branches missed.">                if (null != deckCrit) {</span>
<span class="nc" id="L1474">                    damagedDecks = deckCrit.getHits();</span>
                }
                //reset all grav decks to undamaged
<span class="nc bnc" id="L1477" title="All 2 branches missed.">                for (int i = 0; i &lt; js.getTotalGravDeck(); i++) {</span>
<span class="nc" id="L1478">                    js.setGravDeckDamageFlag(i, 0);</span>
                }
<span class="nc bnc" id="L1480" title="All 2 branches missed.">                if (damagedDecks &gt; 0) {</span>
                    //loop through the grav decks from #1 and damage them
<span class="nc bnc" id="L1482" title="All 2 branches missed.">                    for (int i = 0; i &lt; damagedDecks; i++) {</span>
<span class="nc" id="L1483">                        js.setGravDeckDamageFlag(i, 1);</span>
                    }
                }
                //KF Drive and Sail
<span class="nc bnc" id="L1487" title="All 2 branches missed.">                if (null != kfDamage) {</span>
<span class="nc" id="L1488">                    double kfIntegrity = (double) kfDamage.getModel().getValue();</span>
<span class="nc" id="L1489">                    js.setKFIntegrity((int) kfIntegrity);</span>
                }
<span class="nc bnc" id="L1491" title="All 2 branches missed.">                if (null != chargingSystemCrit) {</span>
<span class="nc bnc" id="L1492" title="All 2 branches missed.">                    js.setKFChargingSystemHit(chargingSystemCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1494" title="All 2 branches missed.">                if (null != driveCoilCrit) {</span>
<span class="nc bnc" id="L1495" title="All 2 branches missed.">                    js.setKFDriveCoilHit(driveCoilCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1497" title="All 2 branches missed.">                if (null != driveControllerCrit) {</span>
<span class="nc bnc" id="L1498" title="All 2 branches missed.">                    js.setKFDriveControllerHit(driveControllerCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1500" title="All 2 branches missed.">                if (null != fieldInitiatorCrit) {</span>
<span class="nc bnc" id="L1501" title="All 2 branches missed.">                    js.setKFFieldInitiatorHit(fieldInitiatorCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1503" title="All 2 branches missed.">                if (null != heliumTankCrit) {</span>
<span class="nc bnc" id="L1504" title="All 2 branches missed.">                    js.setKFHeliumTankHit(heliumTankCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1506" title="All 2 branches missed.">                if (null != lfBatteryCrit) {</span>
<span class="nc bnc" id="L1507" title="All 2 branches missed.">                    js.setLFBatteryHit(lfBatteryCrit.getHits() &gt; 0);</span>
                }
<span class="nc bnc" id="L1509" title="All 2 branches missed.">                if (null != sailDamage) {</span>
<span class="nc" id="L1510">                    double sailIntegrity = (double) sailDamage.getModel().getValue();</span>
<span class="nc" id="L1511">                    js.setSailIntegrity((int) sailIntegrity);</span>
                }
            }
        }

<span class="nc" id="L1516">    }</span>

    private class CheckCritPanel extends JPanel {

        /**
         *
         */
        private static final long serialVersionUID = 8662728291188274362L;

<span class="nc" id="L1525">        private ArrayList&lt;JCheckBox&gt; checks = new ArrayList&lt;JCheckBox&gt;();</span>

<span class="nc" id="L1527">        public CheckCritPanel(int crits, int current) {</span>
<span class="nc" id="L1528">            setLayout(new BoxLayout(this, BoxLayout.LINE_AXIS));</span>
<span class="nc bnc" id="L1529" title="All 2 branches missed.">            for (int i = 0; i &lt; crits; i++) {</span>
<span class="nc" id="L1530">                JCheckBox check = new JCheckBox(&quot;&quot;);</span>
<span class="nc" id="L1531">                check.setActionCommand(Integer.toString(i));</span>
<span class="nc" id="L1532">                check.addActionListener(new ActionListener() {</span>
                    public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L1534">                        checkBoxes(evt);</span>
<span class="nc" id="L1535">                    }</span>
                });
<span class="nc" id="L1537">                checks.add(check);</span>
<span class="nc" id="L1538">                add(check);</span>
            }

<span class="nc bnc" id="L1541" title="All 2 branches missed.">            if (current &gt; 0) {</span>
<span class="nc bnc" id="L1542" title="All 2 branches missed.">                for (int i = 0; i &lt; current; i++) {</span>
<span class="nc" id="L1543">                    checks.get(i).setSelected(true);</span>
                }
            }
<span class="nc" id="L1546">        }</span>

        public int getHits() {
<span class="nc" id="L1549">            int hits = 0;</span>
<span class="nc bnc" id="L1550" title="All 2 branches missed.">            for (JCheckBox check : checks) {</span>
<span class="nc bnc" id="L1551" title="All 2 branches missed.">                if (check.isSelected()) {</span>
<span class="nc" id="L1552">                    hits++;</span>
                }
<span class="nc" id="L1554">            }</span>
<span class="nc" id="L1555">            return hits;</span>
        }

        private void checkBoxes(ActionEvent evt) {
<span class="nc" id="L1559">            int hits = Integer.parseInt(evt.getActionCommand());</span>
<span class="nc" id="L1560">            boolean selected = checks.get(hits).isSelected();</span>
<span class="nc bnc" id="L1561" title="All 2 branches missed.">            if (selected) {</span>
                // check all those up to this one
<span class="nc bnc" id="L1563" title="All 2 branches missed.">                for (int i = 0; i &lt; hits; i++) {</span>
<span class="nc" id="L1564">                    checks.get(i).setSelected(true);</span>
                }
<span class="nc bnc" id="L1566" title="All 2 branches missed.">            } else if (hits &lt; checks.size()) {</span>
                // deselect any above this one
<span class="nc bnc" id="L1568" title="All 2 branches missed.">                for (int i = hits; i &lt; checks.size(); i++) {</span>
<span class="nc" id="L1569">                    checks.get(i).setSelected(false);</span>
                }
            }

<span class="nc" id="L1573">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>