<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WeaponPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing.unitDisplay</a> &gt; <span class="el_source">WeaponPanel.java</span></div><h1>WeaponPanel.java</h1><pre class="source lang-java linenums">package megamek.client.ui.swing.unitDisplay;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Image;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyListener;
import java.awt.event.MouseEvent;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;
import java.util.Vector;

import javax.swing.AbstractListModel;
import javax.swing.DefaultComboBoxModel;
import javax.swing.DefaultListModel;
import javax.swing.JComboBox;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.event.MouseInputAdapter;

import megamek.client.event.MechDisplayEvent;
import megamek.client.ui.GBC;
import megamek.client.ui.Messages;
import megamek.client.ui.swing.ClientGUI;
import megamek.client.ui.swing.FiringDisplay;
import megamek.client.ui.swing.MovementDisplay;
import megamek.client.ui.swing.TargetingPhaseDisplay;
import megamek.client.ui.swing.widget.BackGroundDrawer;
import megamek.client.ui.swing.widget.PMUtil;
import megamek.client.ui.swing.widget.PicMap;
import megamek.client.ui.swing.widget.SkinXMLHandler;
import megamek.client.ui.swing.widget.UnitDisplaySkinSpecification;
import megamek.common.Aero;
import megamek.common.AmmoType;
import megamek.common.Compute;
import megamek.common.Configuration;
import megamek.common.Coords;
import megamek.common.Entity;
import megamek.common.FighterSquadron;
import megamek.common.IGame;
import megamek.common.IHex;
import megamek.common.ILocationExposureStatus;
import megamek.common.Infantry;
import megamek.common.Jumpship;
import megamek.common.LandAirMech;
import megamek.common.Mech;
import megamek.common.Mounted;
import megamek.common.RangeType;
import megamek.common.SmallCraft;
import megamek.common.Targetable;
import megamek.common.Terrains;
import megamek.common.WeaponComparatorArc;
import megamek.common.WeaponComparatorCustom;
import megamek.common.WeaponComparatorDamage;
import megamek.common.WeaponComparatorNum;
import megamek.common.WeaponComparatorRange;
import megamek.common.WeaponType;
import megamek.common.options.OptionsConstants;
import megamek.common.util.fileUtils.MegaMekFile;
import megamek.common.weapons.bayweapons.BayWeapon;
import megamek.common.weapons.gaussrifles.HAGWeapon;
import megamek.common.weapons.infantry.InfantryWeapon;

/**
 * This class contains the all the gizmos for firing the mech's weapons.
 */
public class WeaponPanel extends PicMap implements ListSelectionListener,
        ActionListener {
    
    /**
     * Mouse adaptor for the weapon list.  Supports rearranging the weapons
     * to define a custom ordering.
     *
     * @author arlith
     *
     */
<span class="nc" id="L91">    private class WeaponListMouseAdapter extends MouseInputAdapter {</span>

<span class="nc" id="L93">        private boolean mouseDragging = false;</span>
        private int dragSourceIndex;

        @Override
        public void mousePressed(MouseEvent e) {
<span class="nc bnc" id="L98" title="All 2 branches missed.">            if (SwingUtilities.isLeftMouseButton(e)) {</span>
<span class="nc" id="L99">                Object src = e.getSource();</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">                if (src instanceof JList) {</span>
<span class="nc" id="L101">                    dragSourceIndex = ((JList&lt;?&gt;) src).getSelectedIndex();</span>
<span class="nc" id="L102">                    mouseDragging = true;</span>
                }
            }
<span class="nc" id="L105">        }</span>

        @Override
        public void mouseReleased(MouseEvent e) {
<span class="nc" id="L109">            mouseDragging = false;</span>
<span class="nc" id="L110">        }</span>

        @Override
        public void mouseDragged(MouseEvent e) {
<span class="nc" id="L114">            removeListeners();</span>
            
<span class="nc" id="L116">            Object src = e.getSource();</span>
            // Check to see if we are in a state we care about
<span class="nc bnc" id="L118" title="All 4 branches missed.">            if (!mouseDragging || !(src instanceof JList)) {</span>
<span class="nc" id="L119">                return;</span>
            }
<span class="nc" id="L121">            JList&lt;?&gt; srcList = (JList&lt;?&gt;) src;</span>
<span class="nc" id="L122">            WeaponListModel srcModel = (WeaponListModel) srcList.getModel();</span>
<span class="nc" id="L123">            int currentIndex = srcList.locationToIndex(e.getPoint());</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">            if (currentIndex != dragSourceIndex) {</span>
<span class="nc" id="L125">                int dragTargetIndex = srcList.getSelectedIndex();</span>
<span class="nc" id="L126">                Mounted weap1 = srcModel.getWeaponAt(dragSourceIndex);</span>
<span class="nc" id="L127">                srcModel.swapIdx(dragSourceIndex, dragTargetIndex);</span>
<span class="nc" id="L128">                dragSourceIndex = currentIndex;</span>
<span class="nc" id="L129">                Entity ent = weap1.getEntity();</span>
                // Is the sort order custom?
<span class="nc" id="L131">                int customId = Entity.WeaponSortOrder.CUSTOM.ordinal();</span>
                // Update weap sort order drop down
<span class="nc bnc" id="L133" title="All 2 branches missed.">                if (weapSortOrder.getSelectedIndex() != customId) {</span>
                    // Set the order to custom
<span class="nc" id="L135">                    ent.setWeaponSortOrder(Entity.WeaponSortOrder.CUSTOM);</span>
<span class="nc" id="L136">                    weapSortOrder.setSelectedIndex(customId);</span>
                }
                // Update custom order
<span class="nc bnc" id="L139" title="All 2 branches missed.">                for (int i = 0; i &lt; srcModel.getSize(); i++) {</span>
<span class="nc" id="L140">                    Mounted m = srcModel.getWeaponAt(i);</span>
<span class="nc" id="L141">                    ent.setCustomWeaponOrder(m, i);</span>
                }
<span class="nc bnc" id="L143" title="All 2 branches missed.">                if (unitDisplay.getClientGUI() != null) {</span>
<span class="nc" id="L144">                    unitDisplay.getClientGUI().getMenuBar()</span>
<span class="nc" id="L145">                            .updateSaveWeaponOrderMenuItem();</span>
                }
            }
<span class="nc" id="L148">            addListeners();</span>
<span class="nc" id="L149">        }</span>
    }
    
    /**
     * ListModel implementation that supports keeping track of a list of Mounted
     * instantiations, how to display them in the JList, and an ability to sort
     * the Mounteds given WeaponComparators.
     *
     * @author arlith
     *
     */
    class WeaponListModel extends AbstractListModel&lt;String&gt; {

        /**
         *
         */
        private static final long serialVersionUID = 6312003196674512339L;

        /**
         * A collection of Mounted instantiations.
         */
        private ArrayList&lt;Mounted&gt; weapons;

        /**
         * The Entity that owns the collection of Mounteds.
         */
        private Entity en;

<span class="nc" id="L177">        WeaponListModel(Entity e) {</span>
<span class="nc" id="L178">            en = e;</span>
<span class="nc" id="L179">            weapons = new ArrayList&lt;Mounted&gt;();</span>
<span class="nc" id="L180">        }</span>

        /**
         * Add a new weapon to the list.
         *
         * @param w
         */
        public void addWeapon(Mounted w) {
<span class="nc" id="L188">            weapons.add(w);</span>
<span class="nc" id="L189">            fireIntervalAdded(this,weapons.size()-1, weapons.size()-1);</span>
<span class="nc" id="L190">        }</span>

        /**
         * Given the equipment (weapon) id, return the index in the (possibly
         * sorted) list of Mounteds.
         *
         * @param weaponId
         * @return
         */
        public int getIndex(int weaponId) {
<span class="nc" id="L200">            Mounted mount = en.getEquipment(weaponId);</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">            for (int i = 0; i &lt; weapons.size(); i++) {</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                if (weapons.get(i).equals(mount)) {</span>
<span class="nc" id="L203">                    return i;</span>
                }
            }
<span class="nc" id="L206">            return -1;</span>
        }

        public void removeAllElements() {
<span class="nc" id="L210">            int numWeapons = weapons.size() - 1;</span>
<span class="nc" id="L211">            weapons.clear();</span>
<span class="nc" id="L212">            fireIntervalRemoved(this, 0, numWeapons);</span>
<span class="nc" id="L213">        }</span>

        /**
         * Swap the Mounteds at the two specified index values.
         *
         * @param idx1
         * @param idx2
         */
        public void swapIdx(int idx1, int idx2) {
            // Bounds checking
<span class="nc bnc" id="L223" title="All 8 branches missed.">            if ((idx1 &gt;= weapons.size()) || (idx2 &gt;= weapons.size())</span>
                    || (idx1 &lt; 0) || (idx2 &lt; 0)) {
<span class="nc" id="L225">                return;</span>
            }
<span class="nc" id="L227">            Mounted m1 = weapons.get(idx1);</span>
<span class="nc" id="L228">            weapons.set(idx1, weapons.get(idx2));</span>
<span class="nc" id="L229">            weapons.set(idx2, m1);</span>
<span class="nc" id="L230">            fireContentsChanged(this, idx1, idx1);</span>
<span class="nc" id="L231">            fireContentsChanged(this, idx2, idx2);</span>
<span class="nc" id="L232">        }</span>

        public Mounted getWeaponAt(int index) {
<span class="nc" id="L235">            return weapons.get(index);</span>
        }

        /**
         * Given an index into the (possibly sorted) list of Mounted, return a
         * text description.  This consists of the Mounted's description, as
         * well as additional information like location, whether the Mounted is
         * shot/jammed/destroyed, etc.  This is what the JList will display.
         */
        @Override
        public String getElementAt(int index) {
<span class="nc" id="L246">            final Mounted mounted = weapons.get(index);</span>
<span class="nc" id="L247">            final WeaponType wtype = (WeaponType) mounted.getType();</span>
<span class="nc" id="L248">            IGame game = null;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">            if (unitDisplay.getClientGUI() != null) {</span>
<span class="nc" id="L250">                game = unitDisplay.getClientGUI().getClient().getGame();</span>
            }

<span class="nc" id="L253">            StringBuilder wn = new StringBuilder(mounted.getDesc());</span>
<span class="nc" id="L254">            wn.append(&quot; [&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L255">            wn.append(en.getLocationAbbr(mounted.getLocation()));</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">            if (mounted.isSplit()) {</span>
<span class="nc" id="L257">                wn.append('/');</span>
<span class="nc" id="L258">                wn.append(en.getLocationAbbr(mounted.getSecondLocation()));</span>
            }
<span class="nc" id="L260">            wn.append(']');</span>
            // determine shots left &amp; total shots left
<span class="nc bnc" id="L262" title="All 2 branches missed.">            if ((wtype.getAmmoType() != AmmoType.T_NA)</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                    &amp;&amp; (!wtype.hasFlag(WeaponType.F_ONESHOT)</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                            || wtype.hasFlag(WeaponType.F_BA_INDIVIDUAL))</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                    &amp;&amp; (wtype.getAmmoType() != AmmoType.T_INFANTRY)) {</span>
<span class="nc" id="L266">                int shotsLeft = 0;</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                if ((mounted.getLinked() != null)</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">                    &amp;&amp; !mounted.getLinked().isDumping()) {</span>
<span class="nc" id="L269">                    shotsLeft = mounted.getLinked().getUsableShotsLeft();</span>
                }

<span class="nc" id="L272">                int totalShotsLeft = en.getTotalMunitionsOfType(mounted);</span>

<span class="nc" id="L274">                wn.append(&quot; (&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L275">                wn.append(shotsLeft);</span>
<span class="nc" id="L276">                wn.append('/'); //$NON-NLS-1$</span>
<span class="nc" id="L277">                wn.append(totalShotsLeft);</span>
<span class="nc" id="L278">                wn.append(')'); //$NON-NLS-1$</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">            } else if (wtype.hasFlag(WeaponType.F_DOUBLE_ONESHOT)</span>
<span class="nc bnc" id="L280" title="All 4 branches missed.">                    || (en.isSupportVehicle() &amp;&amp; (wtype.getAmmoType() == AmmoType.T_INFANTRY))) {</span>
<span class="nc" id="L281">                int shotsLeft = 0;</span>
<span class="nc" id="L282">                int totalShots = 0;</span>
<span class="nc" id="L283">                long munition = ((AmmoType) mounted.getLinked().getType()).getMunitionType();</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">                for (Mounted current = mounted.getLinked(); current != null; current = current.getLinked()) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">                    if (((AmmoType) current.getType()).getMunitionType() == munition) {</span>
<span class="nc" id="L286">                        shotsLeft += current.getUsableShotsLeft();</span>
<span class="nc" id="L287">                        totalShots += current.getOriginalShots();</span>
                    }
                }
<span class="nc" id="L290">                wn.append(&quot; (&quot;).append(shotsLeft) //$NON-NLS-1$</span>
<span class="nc" id="L291">                    .append(&quot;/&quot;).append(totalShots).append(&quot;)&quot;); //$NON-NLS-1$ //$NON-NLS-2$</span>
            }

            // MG rapidfire
<span class="nc bnc" id="L295" title="All 2 branches missed.">            if (mounted.isRapidfire()) {</span>
<span class="nc" id="L296">                wn.append(Messages.getString(&quot;MechDisplay.rapidFire&quot;)); //$NON-NLS-1$</span>
            }

            // Hotloaded Missile Launchers
<span class="nc bnc" id="L300" title="All 2 branches missed.">            if (mounted.isHotLoaded()) {</span>
<span class="nc" id="L301">                wn.append(Messages.getString(&quot;MechDisplay.isHotLoaded&quot;)); //$NON-NLS-1$</span>
            }

            // Fire Mode - lots of things have variable modes
<span class="nc bnc" id="L305" title="All 2 branches missed.">            if (wtype.hasModes()) {</span>
<span class="nc" id="L306">                wn.append(' ');</span>
                
<span class="nc" id="L308">                wn.append(mounted.curMode().getDisplayableName());</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                if (!mounted.pendingMode().equals(&quot;None&quot;)) {</span>
<span class="nc" id="L310">                    wn.append(&quot; (next turn, &quot;);</span>
<span class="nc" id="L311">                    wn.append(mounted.pendingMode().getDisplayableName());</span>
<span class="nc" id="L312">                    wn.append(')');</span>
                }
            }
<span class="nc bnc" id="L315" title="All 2 branches missed.">            if ((game != null)</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                    &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_CALLED_SHOTS)) { //$NON-NLS-1$</span>
<span class="nc" id="L317">                wn.append(' ');</span>
<span class="nc" id="L318">                wn.append(mounted.getCalledShot().getDisplayableName());</span>
            }
<span class="nc" id="L320">            return wn.toString();</span>
        }

        /**
         * Returns the number of Mounteds in the list.
         */
        @Override
        public int getSize() {
<span class="nc" id="L328">            return weapons.size();</span>
        }

        /**
         * Sort the Mounteds, generally using a WeaponComparator.
         *
         * @param comparator
         */
        public void sort(Comparator&lt;Mounted&gt; comparator) {
<span class="nc" id="L337">            Collections.sort(weapons, comparator);</span>
<span class="nc" id="L338">            fireContentsChanged(this, 0, weapons.size() - 1);</span>
<span class="nc" id="L339">        }</span>

    }
    
    
    /**
     * 
     */
    private final UnitDisplay unitDisplay;
    
    /**
     *
     */
    private static final long serialVersionUID = -5728839963281503332L;
    private JComboBox&lt;String&gt; weapSortOrder;
    public JList&lt;String&gt; weaponList;
    /**
     * Keep track of the previous target, used for certain weapons (like VGLs)
     * that will force a target.  With this, we can restore the previous target
     * after the forced target.
     */
<span class="nc" id="L360">    private Targetable prevTarget = null;</span>
    private JComboBox&lt;String&gt; m_chAmmo;
    public JComboBox&lt;String&gt; m_chBayWeapon;

    private JLabel wSortOrder;
    private JLabel wAmmo;
    private JLabel wBayWeapon;
    private JLabel wNameL;
    private JLabel wHeatL;
    private JLabel wArcHeatL;
    private JLabel wDamL;
    private JLabel wMinL;
    private JLabel wShortL;
    private JLabel wMedL;
    private JLabel wLongL;
    private JLabel wExtL;
    private JLabel wAVL;
    private JLabel wNameR;
    private JLabel wHeatR;
    private JLabel wArcHeatR;
    private JLabel wDamR;
    private JLabel wMinR;
    private JLabel wShortR;
    private JLabel wMedR;
    private JLabel wLongR;
    private JLabel wExtR;
    private JLabel wShortAVR;
    private JLabel wMedAVR;
    private JLabel wLongAVR;
    private JLabel wExtAVR;
    private JLabel currentHeatBuildupL;
    private JLabel currentHeatBuildupR;

    private JLabel wTargetL;
    private JLabel wRangeL;
    private JLabel wToHitL;
    public JLabel wTargetR;
    public JLabel wRangeR;
    public JLabel wToHitR;

    private JLabel wDamageTrooperL;
    private JLabel wDamageTrooperR;
    private JLabel wInfantryRange0L;
    private JLabel wInfantryRange0R;
    private JLabel wInfantryRange1L;
    private JLabel wInfantryRange1R;
    private JLabel wInfantryRange2L;
    private JLabel wInfantryRange2R;
    private JLabel wInfantryRange3L;
    private JLabel wInfantryRange3R;
    private JLabel wInfantryRange4L;
    private JLabel wInfantryRange4R;
    private JLabel wInfantryRange5L;
    private JLabel wInfantryRange5R;

    public JTextArea toHitText;

    // I need to keep a pointer to the weapon list of the
    // currently selected mech.
    private ArrayList&lt;Mounted&gt; vAmmo;
    private Entity entity;

<span class="nc" id="L422">    private int minTopMargin = 8;</span>
<span class="nc" id="L423">    private int minLeftMargin = 8;</span>

<span class="nc" id="L425">    WeaponPanel(UnitDisplay unitDisplay) {</span>

<span class="nc" id="L427">        this.unitDisplay = unitDisplay;</span>
<span class="nc" id="L428">        setLayout(new GridBagLayout());</span>

<span class="nc" id="L430">        int gridy = 0;</span>
<span class="nc" id="L431">        wSortOrder = new JLabel(</span>
<span class="nc" id="L432">                Messages.getString(&quot;MechDisplay.WeaponSortOrder.label&quot;),</span>
                SwingConstants.LEFT);
<span class="nc" id="L434">        wSortOrder.setOpaque(false);</span>
<span class="nc" id="L435">        wSortOrder.setForeground(Color.WHITE);</span>
<span class="nc" id="L436">        add(wSortOrder, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L437">               .insets(15, 9, 1, 1).gridy(gridy).gridx(0));</span>
<span class="nc" id="L438">        weapSortOrder = new JComboBox&lt;String&gt;();</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">        for (Entity.WeaponSortOrder s : Entity.WeaponSortOrder.values()) {</span>
<span class="nc" id="L440">            String entry = &quot;MechDisplay.WeaponSortOrder.&quot; + s.i18nEntry;</span>
<span class="nc" id="L441">            weapSortOrder.addItem(Messages.getString(entry));</span>
        }
<span class="nc" id="L443">        add(weapSortOrder,</span>
<span class="nc" id="L444">                GBC.eol().insets(15, 9, 15, 1)</span>
<span class="nc" id="L445">                   .fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L446">                   .anchor(GridBagConstraints.CENTER).gridy(gridy)</span>
<span class="nc" id="L447">                   .gridx(1));</span>
<span class="nc" id="L448">        gridy++;</span>

        // weapon list
<span class="nc" id="L451">        weaponList = new JList&lt;String&gt;(new DefaultListModel&lt;String&gt;());</span>
<span class="nc" id="L452">        WeaponListMouseAdapter mouseAdapter = new WeaponListMouseAdapter();</span>
<span class="nc" id="L453">        weaponList.addMouseListener(mouseAdapter);</span>
<span class="nc" id="L454">        weaponList.addMouseMotionListener(mouseAdapter);</span>
<span class="nc" id="L455">        JScrollPane tWeaponScroll = new JScrollPane(weaponList);</span>
<span class="nc" id="L456">        tWeaponScroll.setMinimumSize(new Dimension(200, 100));</span>
<span class="nc" id="L457">        tWeaponScroll.setPreferredSize(new Dimension(200, 100));</span>
<span class="nc" id="L458">        add(tWeaponScroll,</span>
<span class="nc" id="L459">            GBC.eol().insets(15, 9, 15, 9)</span>
<span class="nc" id="L460">               .fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L461">               .anchor(GridBagConstraints.CENTER).gridy(gridy)</span>
<span class="nc" id="L462">               .gridx(0));</span>
<span class="nc" id="L463">        gridy++;</span>
<span class="nc" id="L464">        weaponList.resetKeyboardActions();</span>
<span class="nc bnc" id="L465" title="All 2 branches missed.">        for (KeyListener key : weaponList.getKeyListeners()) {</span>
<span class="nc" id="L466">            weaponList.removeKeyListener(key);</span>
        }

        // adding Ammo choice + label

<span class="nc" id="L471">        wAmmo = new JLabel(</span>
<span class="nc" id="L472">                Messages.getString(&quot;MechDisplay.Ammo&quot;), SwingConstants.LEFT); //$NON-NLS-1$</span>
<span class="nc" id="L473">        wAmmo.setOpaque(false);</span>
<span class="nc" id="L474">        wAmmo.setForeground(Color.WHITE);</span>
<span class="nc" id="L475">        m_chAmmo = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L477">        wBayWeapon = new JLabel(</span>
<span class="nc" id="L478">                Messages.getString(&quot;MechDisplay.Weapon&quot;), SwingConstants.LEFT); //$NON-NLS-1$</span>
<span class="nc" id="L479">        wBayWeapon.setOpaque(false);</span>
<span class="nc" id="L480">        wBayWeapon.setForeground(Color.WHITE);</span>
<span class="nc" id="L481">        m_chBayWeapon = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L483">        add(wBayWeapon, GBC.std().insets(15, 1, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L485">        add(m_chBayWeapon, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L486">                              .insets(1, 1, 15, 1).gridy(gridy).gridx(1));</span>
<span class="nc" id="L487">        gridy++;</span>
<span class="nc" id="L488">        add(wAmmo, GBC.std().insets(15, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L490">        add(m_chAmmo,</span>
<span class="nc" id="L491">            GBC.eol().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L492">               .insets(1, 9, 15, 1).gridy(gridy).gridx(1));</span>
<span class="nc" id="L493">        gridy++;</span>
        // Adding Heat Buildup

<span class="nc" id="L496">        currentHeatBuildupL = new JLabel(</span>
<span class="nc" id="L497">                Messages.getString(&quot;MechDisplay.HeatBuildup&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L498">        currentHeatBuildupL.setOpaque(false);</span>
<span class="nc" id="L499">        currentHeatBuildupL.setForeground(Color.WHITE);</span>
<span class="nc" id="L500">        currentHeatBuildupR = new JLabel(&quot;--&quot;, SwingConstants.LEFT); //$NON-NLS-1$</span>
<span class="nc" id="L501">        currentHeatBuildupR.setOpaque(false);</span>
<span class="nc" id="L502">        currentHeatBuildupR.setForeground(Color.WHITE);</span>

<span class="nc" id="L504">        add(currentHeatBuildupL,</span>
<span class="nc" id="L505">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L506">               .anchor(GridBagConstraints.EAST).insets(9, 1, 1, 9)</span>
<span class="nc" id="L507">               .gridy(gridy).gridx(0));</span>

<span class="nc" id="L509">        add(currentHeatBuildupR,</span>
<span class="nc" id="L510">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L511">               .insets(1, 1, 9, 9).gridy(gridy).gridx(1));</span>
<span class="nc" id="L512">        gridy++;</span>

        // Adding weapon display labels
<span class="nc" id="L515">        wNameL = new JLabel(</span>
<span class="nc" id="L516">                Messages.getString(&quot;MechDisplay.Name&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L517">        wNameL.setOpaque(false);</span>
<span class="nc" id="L518">        wNameL.setForeground(Color.WHITE);</span>
<span class="nc" id="L519">        wHeatL = new JLabel(</span>
<span class="nc" id="L520">                Messages.getString(&quot;MechDisplay.Heat&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L521">        wHeatL.setOpaque(false);</span>
<span class="nc" id="L522">        wHeatL.setForeground(Color.WHITE);</span>
<span class="nc" id="L523">        wDamL = new JLabel(</span>
<span class="nc" id="L524">                Messages.getString(&quot;MechDisplay.Damage&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L525">        wDamL.setOpaque(false);</span>
<span class="nc" id="L526">        wDamL.setForeground(Color.WHITE);</span>
<span class="nc" id="L527">        wArcHeatL = new JLabel(</span>
<span class="nc" id="L528">                Messages.getString(&quot;MechDisplay.ArcHeat&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L529">        wArcHeatL.setOpaque(false);</span>
<span class="nc" id="L530">        wArcHeatL.setForeground(Color.WHITE);</span>
<span class="nc" id="L531">        wNameR = new JLabel(&quot;&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L532">        wNameR.setOpaque(false);</span>
<span class="nc" id="L533">        wNameR.setForeground(Color.WHITE);</span>
<span class="nc" id="L534">        wHeatR = new JLabel(&quot;--&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L535">        wHeatR.setOpaque(false);</span>
<span class="nc" id="L536">        wHeatR.setForeground(Color.WHITE);</span>
<span class="nc" id="L537">        wDamR = new JLabel(&quot;--&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L538">        wDamR.setOpaque(false);</span>
<span class="nc" id="L539">        wDamR.setForeground(Color.WHITE);</span>
<span class="nc" id="L540">        wArcHeatR = new JLabel(&quot;--&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L541">        wArcHeatR.setOpaque(false);</span>
<span class="nc" id="L542">        wArcHeatR.setForeground(Color.WHITE);</span>

<span class="nc" id="L544">        wDamageTrooperL = new JLabel(</span>
<span class="nc" id="L545">                Messages.getString(&quot;MechDisplay.DamageTrooper&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L546">        wDamageTrooperL.setOpaque(false);</span>
<span class="nc" id="L547">        wDamageTrooperL.setForeground(Color.WHITE);</span>
<span class="nc" id="L548">        wDamageTrooperR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L549">        wDamageTrooperR.setOpaque(false);</span>
<span class="nc" id="L550">        wDamageTrooperR.setForeground(Color.WHITE);</span>

<span class="nc" id="L552">        add(wNameL,</span>
<span class="nc" id="L553">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L554">               .insets(1, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L556">        add(wHeatL,</span>
<span class="nc" id="L557">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L558">               .insets(1, 9, 1, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L560">        add(wDamL,</span>
<span class="nc" id="L561">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L562">               .insets(1, 9, 1, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L564">        add(wArcHeatL, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L565">                          .insets(1, 9, 1, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L567">        add(wDamageTrooperL, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L568">                                .insets(1, 9, 1, 1).gridy(gridy).gridx(3));</span>
<span class="nc" id="L569">        gridy++;</span>
<span class="nc" id="L570">        add(wNameR,</span>
<span class="nc" id="L571">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L572">               .insets(1, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L574">        add(wHeatR,</span>
<span class="nc" id="L575">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L576">               .insets(1, 9, 1, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L578">        add(wDamR,</span>
<span class="nc" id="L579">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L580">               .insets(1, 9, 1, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L582">        add(wArcHeatR, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L583">                          .insets(1, 9, 1, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L585">        add(wDamageTrooperR, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L586">                                .insets(1, 9, 1, 1).gridy(gridy).gridx(3));</span>
<span class="nc" id="L587">        gridy++;</span>
        // Adding range labels
<span class="nc" id="L589">        wMinL = new JLabel(</span>
<span class="nc" id="L590">                Messages.getString(&quot;MechDisplay.Min&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L591">        wMinL.setOpaque(false);</span>
<span class="nc" id="L592">        wMinL.setForeground(Color.WHITE);</span>
<span class="nc" id="L593">        wShortL = new JLabel(</span>
<span class="nc" id="L594">                Messages.getString(&quot;MechDisplay.Short&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L595">        wShortL.setOpaque(false);</span>
<span class="nc" id="L596">        wShortL.setForeground(Color.WHITE);</span>
<span class="nc" id="L597">        wMedL = new JLabel(</span>
<span class="nc" id="L598">                Messages.getString(&quot;MechDisplay.Med&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L599">        wMedL.setOpaque(false);</span>
<span class="nc" id="L600">        wMedL.setForeground(Color.WHITE);</span>
<span class="nc" id="L601">        wLongL = new JLabel(</span>
<span class="nc" id="L602">                Messages.getString(&quot;MechDisplay.Long&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L603">        wLongL.setOpaque(false);</span>
<span class="nc" id="L604">        wLongL.setForeground(Color.WHITE);</span>
<span class="nc" id="L605">        wExtL = new JLabel(</span>
<span class="nc" id="L606">                Messages.getString(&quot;MechDisplay.Ext&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L607">        wExtL.setOpaque(false);</span>
<span class="nc" id="L608">        wExtL.setForeground(Color.WHITE);</span>
<span class="nc" id="L609">        wMinR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L610">        wMinR.setOpaque(false);</span>
<span class="nc" id="L611">        wMinR.setForeground(Color.WHITE);</span>
<span class="nc" id="L612">        wShortR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L613">        wShortR.setOpaque(false);</span>
<span class="nc" id="L614">        wShortR.setForeground(Color.WHITE);</span>
<span class="nc" id="L615">        wMedR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L616">        wMedR.setOpaque(false);</span>
<span class="nc" id="L617">        wMedR.setForeground(Color.WHITE);</span>
<span class="nc" id="L618">        wLongR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L619">        wLongR.setOpaque(false);</span>
<span class="nc" id="L620">        wLongR.setForeground(Color.WHITE);</span>
<span class="nc" id="L621">        wExtR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L622">        wExtR.setOpaque(false);</span>
<span class="nc" id="L623">        wExtR.setForeground(Color.WHITE);</span>
<span class="nc" id="L624">        wAVL = new JLabel(</span>
<span class="nc" id="L625">                Messages.getString(&quot;MechDisplay.AV&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L626">        wAVL.setOpaque(false);</span>
<span class="nc" id="L627">        wAVL.setForeground(Color.WHITE);</span>
<span class="nc" id="L628">        wShortAVR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L629">        wShortAVR.setOpaque(false);</span>
<span class="nc" id="L630">        wShortAVR.setForeground(Color.WHITE);</span>
<span class="nc" id="L631">        wMedAVR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L632">        wMedAVR.setOpaque(false);</span>
<span class="nc" id="L633">        wMedAVR.setForeground(Color.WHITE);</span>
<span class="nc" id="L634">        wLongAVR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L635">        wLongAVR.setOpaque(false);</span>
<span class="nc" id="L636">        wLongAVR.setForeground(Color.WHITE);</span>
<span class="nc" id="L637">        wExtAVR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L638">        wExtAVR.setOpaque(false);</span>
<span class="nc" id="L639">        wExtAVR.setForeground(Color.WHITE);</span>

<span class="nc" id="L641">        wInfantryRange0L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L642">        wInfantryRange0L.setOpaque(false);</span>
<span class="nc" id="L643">        wInfantryRange0L.setForeground(Color.WHITE);</span>
<span class="nc" id="L644">        wInfantryRange0R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L645">        wInfantryRange0R.setOpaque(false);</span>
<span class="nc" id="L646">        wInfantryRange0R.setForeground(Color.WHITE);</span>
<span class="nc" id="L647">        wInfantryRange1L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L648">        wInfantryRange1L.setOpaque(false);</span>
<span class="nc" id="L649">        wInfantryRange1L.setForeground(Color.WHITE);</span>
<span class="nc" id="L650">        wInfantryRange1R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L651">        wInfantryRange1R.setOpaque(false);</span>
<span class="nc" id="L652">        wInfantryRange1R.setForeground(Color.WHITE);</span>
<span class="nc" id="L653">        wInfantryRange2L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L654">        wInfantryRange2L.setOpaque(false);</span>
<span class="nc" id="L655">        wInfantryRange2L.setForeground(Color.WHITE);</span>
<span class="nc" id="L656">        wInfantryRange2R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L657">        wInfantryRange2R.setOpaque(false);</span>
<span class="nc" id="L658">        wInfantryRange2R.setForeground(Color.WHITE);</span>
<span class="nc" id="L659">        wInfantryRange3L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L660">        wInfantryRange3L.setOpaque(false);</span>
<span class="nc" id="L661">        wInfantryRange3L.setForeground(Color.WHITE);</span>
<span class="nc" id="L662">        wInfantryRange3R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L663">        wInfantryRange3R.setOpaque(false);</span>
<span class="nc" id="L664">        wInfantryRange3R.setForeground(Color.WHITE);</span>
<span class="nc" id="L665">        wInfantryRange4L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L666">        wInfantryRange4L.setOpaque(false);</span>
<span class="nc" id="L667">        wInfantryRange4L.setForeground(Color.WHITE);</span>
<span class="nc" id="L668">        wInfantryRange4R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L669">        wInfantryRange4R.setOpaque(false);</span>
<span class="nc" id="L670">        wInfantryRange4R.setForeground(Color.WHITE);</span>
<span class="nc" id="L671">        wInfantryRange5L = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L672">        wInfantryRange5L.setOpaque(false);</span>
<span class="nc" id="L673">        wInfantryRange5L.setForeground(Color.WHITE);</span>
<span class="nc" id="L674">        wInfantryRange5R = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L675">        wInfantryRange5R.setOpaque(false);</span>
<span class="nc" id="L676">        wInfantryRange5R.setForeground(Color.WHITE);</span>

<span class="nc" id="L678">        add(wMinL,</span>
<span class="nc" id="L679">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L680">               .insets(1, 9, 9, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L682">        add(wShortL,</span>
<span class="nc" id="L683">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L684">               .insets(1, 9, 9, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L686">        add(wMedL,</span>
<span class="nc" id="L687">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L688">               .insets(1, 9, 9, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L690">        add(wLongL,</span>
<span class="nc" id="L691">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L692">               .insets(1, 9, 9, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L694">        add(wExtL,</span>
<span class="nc" id="L695">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L696">               .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L698">        add(wInfantryRange0L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L699">                .insets(1, 9, 9, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L701">        add(wInfantryRange1L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L702">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L704">        add(wInfantryRange2L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L705">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L707">        add(wInfantryRange3L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L708">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L710">        add(wInfantryRange4L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L711">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L713">        add(wInfantryRange5L, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L714">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L716">        gridy++;</span>
        // ----------------

<span class="nc" id="L719">        add(wMinR,</span>
<span class="nc" id="L720">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L721">               .insets(1, 9, 9, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L723">        add(wShortR,</span>
<span class="nc" id="L724">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L725">               .insets(1, 9, 9, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L727">        add(wMedR,</span>
<span class="nc" id="L728">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L729">               .insets(1, 9, 9, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L731">        add(wLongR,</span>
<span class="nc" id="L732">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L733">               .insets(1, 9, 9, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L735">        add(wExtR,</span>
<span class="nc" id="L736">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L737">               .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L739">        add(wInfantryRange0R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L740">                .insets(1, 9, 9, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L742">        add(wInfantryRange1R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L743">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L745">        add(wInfantryRange2R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L746">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L748">        add(wInfantryRange3R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L749">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L751">        add(wInfantryRange4R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L752">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L754">        add(wInfantryRange5R, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L755">                            .insets(1, 9, 9, 1).gridy(gridy).gridx(5));</span>

<span class="nc" id="L757">        gridy++;</span>
        // ----------------
<span class="nc" id="L759">        add(wAVL,</span>
<span class="nc" id="L760">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L761">               .insets(1, 9, 9, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L763">        add(wShortAVR, GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L764">                          .insets(1, 9, 9, 1).gridy(gridy).gridx(1));</span>

<span class="nc" id="L766">        add(wMedAVR,</span>
<span class="nc" id="L767">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L768">               .insets(1, 9, 9, 1).gridy(gridy).gridx(2));</span>

<span class="nc" id="L770">        add(wLongAVR,</span>
<span class="nc" id="L771">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L772">               .insets(1, 9, 9, 1).gridy(gridy).gridx(3));</span>

<span class="nc" id="L774">        add(wExtAVR,</span>
<span class="nc" id="L775">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L776">               .insets(1, 9, 9, 1).gridy(gridy).gridx(4));</span>

<span class="nc" id="L778">        gridy++;</span>



        // target panel
<span class="nc" id="L783">        wTargetL = new JLabel(</span>
<span class="nc" id="L784">                Messages.getString(&quot;MechDisplay.Target&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L785">        wTargetL.setOpaque(false);</span>
<span class="nc" id="L786">        wTargetL.setForeground(Color.WHITE);</span>
<span class="nc" id="L787">        wRangeL = new JLabel(</span>
<span class="nc" id="L788">                Messages.getString(&quot;MechDisplay.Range&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L789">        wRangeL.setOpaque(false);</span>
<span class="nc" id="L790">        wRangeL.setForeground(Color.WHITE);</span>
<span class="nc" id="L791">        wToHitL = new JLabel(</span>
<span class="nc" id="L792">                Messages.getString(&quot;MechDisplay.ToHit&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L793">        wToHitL.setOpaque(false);</span>
<span class="nc" id="L794">        wToHitL.setForeground(Color.WHITE);</span>

<span class="nc" id="L796">        wTargetR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L797">        wTargetR.setOpaque(false);</span>
<span class="nc" id="L798">        wTargetR.setForeground(Color.WHITE);</span>
<span class="nc" id="L799">        wRangeR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L800">        wRangeR.setOpaque(false);</span>
<span class="nc" id="L801">        wRangeR.setForeground(Color.WHITE);</span>
<span class="nc" id="L802">        wToHitR = new JLabel(&quot;---&quot;, SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L803">        wToHitR.setOpaque(false);</span>
<span class="nc" id="L804">        wToHitR.setForeground(Color.WHITE);</span>

<span class="nc" id="L806">        add(wTargetL,</span>
<span class="nc" id="L807">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L808">               .insets(1, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L810">        add(wTargetR,</span>
<span class="nc" id="L811">            GBC.eol().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L812">               .insets(1, 9, 1, 1).gridy(gridy).gridx(1));</span>
<span class="nc" id="L813">        gridy++;</span>

<span class="nc" id="L815">        add(wRangeL,</span>
<span class="nc" id="L816">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L817">               .insets(1, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L819">        add(wRangeR,</span>
<span class="nc" id="L820">            GBC.eol().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L821">               .insets(1, 9, 1, 1).gridy(gridy).gridx(1));</span>
<span class="nc" id="L822">        gridy++;</span>

<span class="nc" id="L824">        add(wToHitL,</span>
<span class="nc" id="L825">            GBC.std().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L826">               .insets(1, 9, 1, 1).gridy(gridy).gridx(0));</span>

<span class="nc" id="L828">        add(wToHitR,</span>
<span class="nc" id="L829">            GBC.eol().fill(GridBagConstraints.HORIZONTAL)</span>
<span class="nc" id="L830">               .insets(1, 9, 1, 1).gridy(gridy).gridx(1));</span>
<span class="nc" id="L831">        gridy++;</span>

        // to-hit text
<span class="nc" id="L834">        toHitText = new JTextArea(&quot;&quot;, 2, 20); //$NON-NLS-1$</span>
<span class="nc" id="L835">        toHitText.setEditable(false);</span>
<span class="nc" id="L836">        toHitText.setLineWrap(true);</span>
<span class="nc" id="L837">        toHitText.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 10)); //$NON-NLS-1$</span>
<span class="nc" id="L838">        add(toHitText,</span>
<span class="nc" id="L839">            GBC.eol().fill(GridBagConstraints.BOTH)</span>
<span class="nc" id="L840">               .insets(15, 9, 15, 9).gridy(gridy).gridx(0)</span>
<span class="nc" id="L841">               .gridheight(2));</span>
<span class="nc" id="L842">        gridy++;</span>

<span class="nc" id="L844">        addListeners();</span>
        
<span class="nc" id="L846">        setBackGround();</span>
<span class="nc" id="L847">        onResize();</span>
<span class="nc" id="L848">    }</span>

    @Override
    public void onResize() {
<span class="nc" id="L852">        int w = getSize().width;</span>
<span class="nc" id="L853">        Rectangle r = getContentBounds();</span>
<span class="nc bnc" id="L854" title="All 2 branches missed.">        if (r == null) {</span>
<span class="nc" id="L855">            return;</span>
        }
<span class="nc" id="L857">        int dx = Math.round(((w - r.width) / 2));</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">        if (dx &lt; minLeftMargin) {</span>
<span class="nc" id="L859">            dx = minLeftMargin;</span>
        }
<span class="nc" id="L861">        int dy = minTopMargin;</span>
<span class="nc" id="L862">        setContentMargins(dx, dy, dx, dy);</span>
<span class="nc" id="L863">    }</span>

    private void setBackGround() {
        UnitDisplaySkinSpecification udSpec = SkinXMLHandler
<span class="nc" id="L867">                .getUnitDisplaySkin();</span>

<span class="nc" id="L869">        Image tile = getToolkit()</span>
<span class="nc" id="L870">                .getImage(</span>
<span class="nc" id="L871">                        new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L872">                                .getBackgroundTile()).toString());</span>
<span class="nc" id="L873">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L874">        int b = BackGroundDrawer.TILING_BOTH;</span>
<span class="nc" id="L875">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L877">        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_TOP;</span>
<span class="nc" id="L878">        tile = getToolkit().getImage(</span>
<span class="nc" id="L879">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getTopLine())</span>
<span class="nc" id="L880">                        .toString());</span>
<span class="nc" id="L881">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L882">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L884">        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_BOTTOM;</span>
<span class="nc" id="L885">        tile = getToolkit().getImage(</span>
<span class="nc" id="L886">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getBottomLine())</span>
<span class="nc" id="L887">                        .toString());</span>
<span class="nc" id="L888">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L889">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L891">        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_LEFT;</span>
<span class="nc" id="L892">        tile = getToolkit().getImage(</span>
<span class="nc" id="L893">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getLeftLine())</span>
<span class="nc" id="L894">                        .toString());</span>
<span class="nc" id="L895">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L896">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L898">        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_RIGHT;</span>
<span class="nc" id="L899">        tile = getToolkit().getImage(</span>
<span class="nc" id="L900">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getRightLine())</span>
<span class="nc" id="L901">                        .toString());</span>
<span class="nc" id="L902">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L903">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L905">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</span>
                | BackGroundDrawer.HALIGN_LEFT;
<span class="nc" id="L907">        tile = getToolkit()</span>
<span class="nc" id="L908">                .getImage(</span>
<span class="nc" id="L909">                        new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L910">                                .getTopLeftCorner()).toString());</span>
<span class="nc" id="L911">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L912">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L914">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</span>
                | BackGroundDrawer.HALIGN_LEFT;
<span class="nc" id="L916">        tile = getToolkit().getImage(</span>
<span class="nc" id="L917">                new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L918">                        .getBottomLeftCorner()).toString());</span>
<span class="nc" id="L919">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L920">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L922">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</span>
                | BackGroundDrawer.HALIGN_RIGHT;
<span class="nc" id="L924">        tile = getToolkit()</span>
<span class="nc" id="L925">                .getImage(</span>
<span class="nc" id="L926">                        new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L927">                                .getTopRightCorner()).toString());</span>
<span class="nc" id="L928">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L929">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L931">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</span>
                | BackGroundDrawer.HALIGN_RIGHT;
<span class="nc" id="L933">        tile = getToolkit().getImage(</span>
<span class="nc" id="L934">                new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L935">                        .getBottomRightCorner()).toString());</span>
<span class="nc" id="L936">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L937">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L939">    }</span>

    /**
     * updates fields for the specified mech
     * &lt;p/&gt;
     * fix the ammo when it's added
     */
    public void displayMech(Entity en) {
<span class="nc" id="L947">        removeListeners();</span>
        
        // Grab a copy of the game.
<span class="nc" id="L950">        IGame game = null;</span>

<span class="nc bnc" id="L952" title="All 2 branches missed.">        if (unitDisplay.getClientGUI() != null) {</span>
<span class="nc" id="L953">            game = unitDisplay.getClientGUI().getClient().getGame();</span>
        }

        // update pointer to weapons
<span class="nc" id="L957">        entity = en;</span>

        // Check Game Options for max external heat
<span class="nc bnc" id="L960" title="All 2 branches missed.">        int max_ext_heat = game != null ? game.getOptions().intOption(OptionsConstants.ADVCOMBAT_MAX_EXTERNAL_HEAT) : 15;</span>
<span class="nc bnc" id="L961" title="All 2 branches missed.">        if (max_ext_heat &lt; 0) {</span>
<span class="nc" id="L962">            max_ext_heat = 15; // Standard value specified in TW p.159</span>
        }

<span class="nc" id="L965">        int currentHeatBuildup = (en.heat // heat from last round                </span>
<span class="nc" id="L966">                + en.getEngineCritHeat() // heat engine crits will add</span>
<span class="nc" id="L967">                + Math.min(max_ext_heat, en.heatFromExternal) // heat from external sources</span>
                + en.heatBuildup) // heat we're building up this round
<span class="nc" id="L969">                - Math.min(9, en.coolFromExternal); // cooling from external</span>
        // sources
<span class="nc bnc" id="L971" title="All 2 branches missed.">        if (en instanceof Mech) {</span>
<span class="nc bnc" id="L972" title="All 2 branches missed.">            if (en.infernos.isStillBurning()) { // hit with inferno ammo</span>
<span class="nc" id="L973">                currentHeatBuildup += en.infernos.getHeat();</span>
            }
<span class="nc bnc" id="L975" title="All 2 branches missed.">            if (!((Mech) en).hasLaserHeatSinks()) {</span>
                // extreme temperatures.
<span class="nc bnc" id="L977" title="All 4 branches missed.">                if ((game != null) &amp;&amp; (game.getPlanetaryConditions().getTemperature() &gt; 0)) {</span>
<span class="nc" id="L978">                    int buildup = game.getPlanetaryConditions()</span>
<span class="nc" id="L979">                                      .getTemperatureDifference(50, -30);</span>
<span class="nc bnc" id="L980" title="All 2 branches missed.">                    if (((Mech) en).hasIntactHeatDissipatingArmor()) {</span>
<span class="nc" id="L981">                        buildup /= 2;</span>
                    }
<span class="nc" id="L983">                    currentHeatBuildup += buildup;</span>
<span class="nc bnc" id="L984" title="All 2 branches missed.">                } else if (game != null) {</span>
<span class="nc" id="L985">                    currentHeatBuildup -= game.getPlanetaryConditions()</span>
<span class="nc" id="L986">                                              .getTemperatureDifference(50, -30);</span>
                }
            }
        }
<span class="nc" id="L990">        Coords position = entity.getPosition();</span>
<span class="nc bnc" id="L991" title="All 4 branches missed.">        if (!en.isOffBoard() &amp;&amp; (position != null)) {</span>
<span class="nc" id="L992">            IHex hex = game.getBoard().getHex(position);</span>
<span class="nc bnc" id="L993" title="All 2 branches missed.">            if (hex.containsTerrain(Terrains.FIRE)</span>
<span class="nc bnc" id="L994" title="All 2 branches missed.">                &amp;&amp; (hex.getFireTurn() &gt; 0)) {</span>
                // standing in fire
<span class="nc bnc" id="L996" title="All 2 branches missed.">                if ((en instanceof Mech)</span>
<span class="nc bnc" id="L997" title="All 2 branches missed.">                    &amp;&amp; ((Mech) en).hasIntactHeatDissipatingArmor()) {</span>
<span class="nc" id="L998">                    currentHeatBuildup += 2;</span>
                } else {
<span class="nc" id="L1000">                    currentHeatBuildup += 5;</span>
                }
            }
<span class="nc bnc" id="L1003" title="All 2 branches missed.">            if (hex.terrainLevel(Terrains.MAGMA) == 1) {</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                if ((en instanceof Mech)</span>
<span class="nc bnc" id="L1005" title="All 2 branches missed.">                    &amp;&amp; ((Mech) en).hasIntactHeatDissipatingArmor()) {</span>
<span class="nc" id="L1006">                    currentHeatBuildup += 2;</span>
                } else {
<span class="nc" id="L1008">                    currentHeatBuildup += 5;</span>
                }
<span class="nc bnc" id="L1010" title="All 2 branches missed.">            } else if (hex.terrainLevel(Terrains.MAGMA) == 2) {</span>
<span class="nc bnc" id="L1011" title="All 2 branches missed.">                if ((en instanceof Mech)</span>
<span class="nc bnc" id="L1012" title="All 2 branches missed.">                    &amp;&amp; ((Mech) en).hasIntactHeatDissipatingArmor()) {</span>
<span class="nc" id="L1013">                    currentHeatBuildup += 5;</span>
                } else {
<span class="nc" id="L1015">                    currentHeatBuildup += 10;</span>
                }
            }
        }
<span class="nc bnc" id="L1019" title="All 6 branches missed.">        if ((((en instanceof Mech) || (en instanceof Aero)) &amp;&amp; en.isStealthActive())</span>
<span class="nc bnc" id="L1020" title="All 4 branches missed.">            || en.isNullSigActive() || en.isVoidSigActive()) {</span>
<span class="nc" id="L1021">            currentHeatBuildup += 10; // active stealth/null sig/void sig</span>
            // heat
        }

<span class="nc bnc" id="L1025" title="All 4 branches missed.">        if ((en instanceof Mech) &amp;&amp; en.isChameleonShieldOn()) {</span>
<span class="nc" id="L1026">            currentHeatBuildup += 6;</span>
        }

<span class="nc bnc" id="L1029" title="All 6 branches missed.">        if (((en instanceof Mech) || (en instanceof Aero)) &amp;&amp; en.hasActiveNovaCEWS()) {</span>
<span class="nc" id="L1030">            currentHeatBuildup += 2;</span>
        }

        // update weapon list
<span class="nc" id="L1034">        weaponList.setModel(new WeaponListModel(en));</span>
<span class="nc" id="L1035">        ((DefaultComboBoxModel&lt;String&gt;) m_chAmmo.getModel()).removeAllElements();</span>

<span class="nc" id="L1037">        m_chAmmo.setEnabled(false);</span>
<span class="nc" id="L1038">        m_chBayWeapon.removeAllItems();</span>
<span class="nc" id="L1039">        m_chBayWeapon.setEnabled(false);</span>

        // on large craft we may need to take account of firing arcs
<span class="nc" id="L1042">        boolean[] usedFrontArc = new boolean[entity.locations()];</span>
<span class="nc" id="L1043">        boolean[] usedRearArc = new boolean[entity.locations()];</span>
<span class="nc bnc" id="L1044" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.locations(); i++) {</span>
<span class="nc" id="L1045">            usedFrontArc[i] = false;</span>
<span class="nc" id="L1046">            usedRearArc[i] = false;</span>
        }

<span class="nc" id="L1049">        boolean hasFiredWeapons = false;</span>
<span class="nc bnc" id="L1050" title="All 2 branches missed.">        for (int i = 0; i &lt; entity.getWeaponList().size(); i++) {</span>
<span class="nc" id="L1051">            Mounted mounted = entity.getWeaponList().get(i);</span>

            // Don't add bomb weapons for LAMs in mech mode except RL and TAG.
<span class="nc bnc" id="L1054" title="All 2 branches missed.">            if ((entity instanceof LandAirMech)</span>
<span class="nc bnc" id="L1055" title="All 2 branches missed.">                    &amp;&amp; (entity.getConversionMode() == LandAirMech.CONV_MODE_MECH)</span>
<span class="nc bnc" id="L1056" title="All 2 branches missed.">                    &amp;&amp; mounted.getType().hasFlag(WeaponType.F_BOMB_WEAPON)</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                    &amp;&amp; ((WeaponType)mounted.getType()).getAmmoType() != AmmoType.T_RL_BOMB</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">                    &amp;&amp; !mounted.getType().hasFlag(WeaponType.F_TAG)) {</span>
<span class="nc" id="L1059">                continue;</span>
            }
            
<span class="nc" id="L1062">            ((WeaponListModel) weaponList.getModel()).addWeapon(mounted);</span>
<span class="nc bnc" id="L1063" title="All 2 branches missed.">            if (mounted.isUsedThisRound()</span>
<span class="nc bnc" id="L1064" title="All 2 branches missed.">                &amp;&amp; (game.getPhase() == mounted.usedInPhase())</span>
<span class="nc bnc" id="L1065" title="All 2 branches missed.">                &amp;&amp; (game.getPhase() == IGame.Phase.PHASE_FIRING)) {</span>
<span class="nc" id="L1066">                hasFiredWeapons = true;</span>
                // add heat from weapons fire to heat tracker
<span class="nc bnc" id="L1068" title="All 2 branches missed.">                if (entity.usesWeaponBays()) {</span>
                    // if using bay heat option then don't add total arc
<span class="nc bnc" id="L1070" title="All 2 branches missed.">                    if (game.getOptions().booleanOption(OptionsConstants.ADVAERORULES_HEAT_BY_BAY)) {</span>
<span class="nc bnc" id="L1071" title="All 2 branches missed.">                        for (int wId : mounted.getBayWeapons()) {</span>
<span class="nc" id="L1072">                            currentHeatBuildup += entity.getEquipment(wId)</span>
<span class="nc" id="L1073">                                                        .getCurrentHeat();</span>
<span class="nc" id="L1074">                        }</span>
                    } else {
                        // check whether arc has fired
<span class="nc" id="L1077">                        int loc = mounted.getLocation();</span>
<span class="nc" id="L1078">                        boolean rearMount = mounted.isRearMounted();</span>
<span class="nc bnc" id="L1079" title="All 2 branches missed.">                        if (!rearMount) {</span>
<span class="nc bnc" id="L1080" title="All 2 branches missed.">                            if (!usedFrontArc[loc]) {</span>
<span class="nc" id="L1081">                                currentHeatBuildup += entity.getHeatInArc(</span>
                                        loc, rearMount);
<span class="nc" id="L1083">                                usedFrontArc[loc] = true;</span>
                            }
                        } else {
<span class="nc bnc" id="L1086" title="All 2 branches missed.">                            if (!usedRearArc[loc]) {</span>
<span class="nc" id="L1087">                                currentHeatBuildup += entity.getHeatInArc(</span>
                                        loc, rearMount);
<span class="nc" id="L1089">                                usedRearArc[loc] = true;</span>
                            }
                        }
<span class="nc" id="L1092">                    }</span>
                } else {
<span class="nc bnc" id="L1094" title="All 2 branches missed.">                    if (!mounted.isBombMounted()) {</span>
<span class="nc" id="L1095">                        currentHeatBuildup += mounted.getCurrentHeat();</span>
                    }
                }
            }
        }
<span class="nc" id="L1100">        weapSortOrder.setSelectedIndex(entity.getWeaponSortOrder().ordinal());</span>
<span class="nc" id="L1101">        setWeaponComparator(weapSortOrder.getSelectedIndex());</span>

<span class="nc bnc" id="L1103" title="All 4 branches missed.">        if (en.hasDamagedRHS() &amp;&amp; hasFiredWeapons) {</span>
<span class="nc" id="L1104">            currentHeatBuildup++;</span>
        }

        // This code block copied from the MovementPanel class,
        // bad coding practice (duplicate code).
        int heatCap;
<span class="nc bnc" id="L1110" title="All 2 branches missed.">        if (en instanceof Mech) {</span>
<span class="nc" id="L1111">            heatCap = ((Mech) en).getHeatCapacity(true, false);</span>
<span class="nc bnc" id="L1112" title="All 2 branches missed.">        } else if (en instanceof Aero) {</span>
<span class="nc" id="L1113">            heatCap = en.getHeatCapacity(false);</span>
        } else {
<span class="nc" id="L1115">            heatCap = en.getHeatCapacity();</span>
        }
<span class="nc" id="L1117">        int heatCapWater = en.getHeatCapacityWithWater();</span>
<span class="nc bnc" id="L1118" title="All 2 branches missed.">        if (en.getCoolantFailureAmount() &gt; 0) {</span>
<span class="nc" id="L1119">            heatCap -= en.getCoolantFailureAmount();</span>
<span class="nc" id="L1120">            heatCapWater -= en.getCoolantFailureAmount();</span>
        }
<span class="nc bnc" id="L1122" title="All 2 branches missed.">        if (en.hasActivatedRadicalHS()) {</span>
<span class="nc bnc" id="L1123" title="All 2 branches missed.">            if (en instanceof Mech) {</span>
<span class="nc" id="L1124">                heatCap += ((Mech) en).getActiveSinks();</span>
<span class="nc" id="L1125">                heatCapWater += ((Mech) en).getActiveSinks();</span>
<span class="nc bnc" id="L1126" title="All 2 branches missed.">            } else if (en instanceof Aero) {</span>
<span class="nc" id="L1127">                heatCap += ((Aero) en).getHeatSinks();</span>
<span class="nc" id="L1128">                heatCapWater += ((Aero) en).getHeatSinks();</span>
            }
        }
<span class="nc" id="L1131">        String heatCapacityStr = Integer.toString(heatCap);</span>

<span class="nc bnc" id="L1133" title="All 2 branches missed.">        if (heatCap &lt; heatCapWater) {</span>
<span class="nc" id="L1134">            heatCapacityStr = heatCap + &quot; [&quot; + heatCapWater + ']'; //$NON-NLS-1$</span>
        }
        // end duplicate block

        // check for negative values due to extreme temp
<span class="nc bnc" id="L1139" title="All 2 branches missed.">        if (currentHeatBuildup &lt; 0) {</span>
<span class="nc" id="L1140">            currentHeatBuildup = 0;</span>
        }

<span class="nc" id="L1143">        String heatText = Integer.toString(currentHeatBuildup);</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">        if (currentHeatBuildup &gt; en.getHeatCapacityWithWater()) {</span>
<span class="nc" id="L1145">            heatText += &quot;*&quot;; // overheat indication //$NON-NLS-1$</span>
        }

<span class="nc" id="L1148">        currentHeatBuildupR.setText(heatText + &quot; (&quot; + heatCapacityStr + ')'); //$NON-NLS-1$</span>

        // change what is visible based on type
<span class="nc bnc" id="L1151" title="All 2 branches missed.">        if (entity.usesWeaponBays()) {</span>
<span class="nc" id="L1152">            wArcHeatL.setVisible(true);</span>
<span class="nc" id="L1153">            wArcHeatR.setVisible(true);</span>
<span class="nc" id="L1154">            m_chBayWeapon.setVisible(true);</span>
<span class="nc" id="L1155">            wBayWeapon.setVisible(true);</span>
        } else {
<span class="nc" id="L1157">            wArcHeatL.setVisible(false);</span>
<span class="nc" id="L1158">            wArcHeatR.setVisible(false);</span>
<span class="nc" id="L1159">            m_chBayWeapon.setVisible(false);</span>
<span class="nc" id="L1160">            wBayWeapon.setVisible(false);</span>
        }

<span class="nc" id="L1163">        wDamageTrooperL.setVisible(false);</span>
<span class="nc" id="L1164">        wDamageTrooperR.setVisible(false);</span>
<span class="nc" id="L1165">        wInfantryRange0L.setVisible(false);</span>
<span class="nc" id="L1166">        wInfantryRange0R.setVisible(false);</span>
<span class="nc" id="L1167">        wInfantryRange1L.setVisible(false);</span>
<span class="nc" id="L1168">        wInfantryRange1R.setVisible(false);</span>
<span class="nc" id="L1169">        wInfantryRange2L.setVisible(false);</span>
<span class="nc" id="L1170">        wInfantryRange2R.setVisible(false);</span>
<span class="nc" id="L1171">        wInfantryRange3L.setVisible(false);</span>
<span class="nc" id="L1172">        wInfantryRange3R.setVisible(false);</span>
<span class="nc" id="L1173">        wInfantryRange4L.setVisible(false);</span>
<span class="nc" id="L1174">        wInfantryRange4R.setVisible(false);</span>
<span class="nc" id="L1175">        wInfantryRange5L.setVisible(false);</span>
<span class="nc" id="L1176">        wInfantryRange5R.setVisible(false);</span>

<span class="nc bnc" id="L1178" title="All 6 branches missed.">        if (entity.isAero() &amp;&amp; (entity.isAirborne() || entity.usesWeaponBays())) {</span>
<span class="nc" id="L1179">            wAVL.setVisible(true);</span>
<span class="nc" id="L1180">            wShortAVR.setVisible(true);</span>
<span class="nc" id="L1181">            wMedAVR.setVisible(true);</span>
<span class="nc" id="L1182">            wLongAVR.setVisible(true);</span>
<span class="nc" id="L1183">            wExtAVR.setVisible(true);</span>
<span class="nc" id="L1184">            wMinL.setVisible(false);</span>
<span class="nc" id="L1185">            wMinR.setVisible(false);</span>
        } else {
<span class="nc" id="L1187">            wAVL.setVisible(false);</span>
<span class="nc" id="L1188">            wShortAVR.setVisible(false);</span>
<span class="nc" id="L1189">            wMedAVR.setVisible(false);</span>
<span class="nc" id="L1190">            wLongAVR.setVisible(false);</span>
<span class="nc" id="L1191">            wExtAVR.setVisible(false);</span>
<span class="nc" id="L1192">            wMinL.setVisible(true);</span>
<span class="nc" id="L1193">            wMinR.setVisible(true);</span>
        }

        // If MaxTech range rules are in play, display the extreme range.
<span class="nc bnc" id="L1197" title="All 4 branches missed.">        if (((game != null) &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_RANGE))</span>
<span class="nc bnc" id="L1198" title="All 6 branches missed.">                || (entity.isAero() &amp;&amp; (entity.isAirborne() || entity.usesWeaponBays()))) { // $NON-NLS-1$</span>
<span class="nc" id="L1199">            wExtL.setVisible(true);</span>
<span class="nc" id="L1200">            wExtR.setVisible(true);</span>
        } else {
<span class="nc" id="L1202">            wExtL.setVisible(false);</span>
<span class="nc" id="L1203">            wExtR.setVisible(false);</span>
        }
<span class="nc" id="L1205">        onResize();</span>
<span class="nc" id="L1206">        addListeners();</span>
<span class="nc" id="L1207">    }</span>

    public int getSelectedEntityId() {
<span class="nc" id="L1210">        return entity.getId();</span>
    }

    /**
     * Selects the weapon with the specified weapon ID.
     */
    public void selectWeapon(int wn) {
<span class="nc bnc" id="L1217" title="All 2 branches missed.">        if (wn == -1) {</span>
<span class="nc" id="L1218">            weaponList.setSelectedIndex(-1);</span>
<span class="nc" id="L1219">            return;</span>
        }
<span class="nc" id="L1221">        int index = ((WeaponListModel)weaponList.getModel()).getIndex(wn);</span>
<span class="nc bnc" id="L1222" title="All 2 branches missed.">        if (index == -1) {</span>
<span class="nc" id="L1223">            weaponList.setSelectedIndex(-1);</span>
<span class="nc" id="L1224">            return;</span>
        }
<span class="nc" id="L1226">        weaponList.setSelectedIndex(index);</span>
<span class="nc" id="L1227">        weaponList.ensureIndexIsVisible(index);</span>
<span class="nc" id="L1228">        displaySelected();</span>
<span class="nc" id="L1229">        weaponList.repaint();</span>
<span class="nc" id="L1230">    }</span>

    /**
     * Returns the Mounted for the selected weapon in the weapon list.
     * @return
     */
    public Mounted getSelectedWeapon() {
<span class="nc" id="L1237">        int selected = weaponList.getSelectedIndex();</span>
<span class="nc bnc" id="L1238" title="All 2 branches missed.">        if (selected == -1) {</span>
<span class="nc" id="L1239">            return null;</span>
        }
<span class="nc" id="L1241">        return ((WeaponListModel) weaponList.getModel())</span>
<span class="nc" id="L1242">                .getWeaponAt(selected);</span>
    }

    /**
     * Returns the equipment ID number for the weapon currently selected
     */
    public int getSelectedWeaponNum() {
<span class="nc" id="L1249">        int selected = weaponList.getSelectedIndex();</span>
<span class="nc bnc" id="L1250" title="All 2 branches missed.">        if (selected == -1) {</span>
<span class="nc" id="L1251">            return -1;</span>
        }
<span class="nc" id="L1253">        return entity.getEquipmentNum(((WeaponListModel) weaponList</span>
<span class="nc" id="L1254">                .getModel()).getWeaponAt(selected));</span>
    }

    /**
     * Selects the first valid weapon in the weapon list.
     * @return The weapon id of the weapon selected
     */
    public int selectFirstWeapon() {
        // Entity has no weapons, return -1;
<span class="nc bnc" id="L1263" title="All 2 branches missed.">        if (entity.getWeaponList().size() == 0</span>
<span class="nc bnc" id="L1264" title="All 2 branches missed.">                || (entity.usesWeaponBays() </span>
<span class="nc bnc" id="L1265" title="All 2 branches missed.">                        &amp;&amp; entity.getWeaponBayList().size() == 0)) {</span>
<span class="nc" id="L1266">            return -1;</span>
        }
<span class="nc" id="L1268">        WeaponListModel weapList = (WeaponListModel)weaponList.getModel();</span>
<span class="nc bnc" id="L1269" title="All 2 branches missed.">        for (int i = 0; i &lt; weaponList.getModel().getSize(); i++) {</span>
<span class="nc" id="L1270">            Mounted selectedWeap = weapList.getWeaponAt(i);</span>
<span class="nc bnc" id="L1271" title="All 2 branches missed.">            if (entity.isWeaponValidForPhase(selectedWeap)) {</span>
<span class="nc" id="L1272">                weaponList.setSelectedIndex(i);</span>
<span class="nc" id="L1273">                weaponList.ensureIndexIsVisible(i);</span>
<span class="nc" id="L1274">                return entity.getEquipmentNum(selectedWeap);</span>
            }
        }
        // Found no valid weapon
<span class="nc" id="L1278">        weaponList.setSelectedIndex(-1);</span>
<span class="nc" id="L1279">        return -1;</span>
    }

    public int getNextWeaponListIdx() {
<span class="nc" id="L1283">        int selected = weaponList.getSelectedIndex();</span>
        // In case nothing was selected
<span class="nc bnc" id="L1285" title="All 2 branches missed.">        if (selected == -1) {</span>
<span class="nc" id="L1286">            selected = weaponList.getModel().getSize() - 1;</span>
        }
        Mounted selectedWeap;
<span class="nc" id="L1289">        int initialSelection = selected;</span>
        
<span class="nc" id="L1291">        boolean hasLooped = false;</span>
        do {
<span class="nc" id="L1293">            selected++;</span>
<span class="nc bnc" id="L1294" title="All 2 branches missed.">            if (selected &gt;= weaponList.getModel().getSize()) {</span>
<span class="nc" id="L1295">                selected = 0;</span>
            }
<span class="nc bnc" id="L1297" title="All 2 branches missed.">            if (selected == initialSelection) {</span>
<span class="nc" id="L1298">                hasLooped = true;</span>
            }
<span class="nc" id="L1300">            selectedWeap = ((WeaponListModel) weaponList.getModel())</span>
<span class="nc" id="L1301">                    .getWeaponAt(selected);</span>
<span class="nc bnc" id="L1302" title="All 4 branches missed.">        } while (!hasLooped &amp;&amp; !entity.isWeaponValidForPhase(selectedWeap));</span>

<span class="nc bnc" id="L1304" title="All 6 branches missed.">        if ((selected &gt;= 0) &amp;&amp; (selected &lt; entity.getWeaponList().size())</span>
                &amp;&amp; !hasLooped) {
<span class="nc" id="L1306">            return selected;</span>
        } else {
<span class="nc" id="L1308">            return -1;</span>
        } 
    }
    
    public int getPrevWeaponListIdx() {
<span class="nc" id="L1313">        int selected = weaponList.getSelectedIndex();</span>
        // In case nothing was selected
<span class="nc bnc" id="L1315" title="All 2 branches missed.">        if (selected == -1) {</span>
<span class="nc" id="L1316">            selected = 0;</span>
        }
        Mounted selectedWeap;
<span class="nc" id="L1319">        int initialSelection = selected;</span>
<span class="nc" id="L1320">        boolean hasLooped = false;</span>
        do {
<span class="nc" id="L1322">            selected--;</span>
<span class="nc bnc" id="L1323" title="All 2 branches missed.">            if (selected &lt; 0) {</span>
<span class="nc" id="L1324">                selected = weaponList.getModel().getSize() - 1;</span>
            }
<span class="nc bnc" id="L1326" title="All 2 branches missed.">            if (selected == initialSelection) {</span>
<span class="nc" id="L1327">                hasLooped = true;</span>
            }
<span class="nc" id="L1329">            selectedWeap = ((WeaponListModel) weaponList.getModel())</span>
<span class="nc" id="L1330">                    .getWeaponAt(selected);</span>
<span class="nc bnc" id="L1331" title="All 4 branches missed.">        } while (!hasLooped &amp;&amp; !entity.isWeaponValidForPhase(selectedWeap));</span>

<span class="nc bnc" id="L1333" title="All 6 branches missed.">        if ((selected &gt;= 0) &amp;&amp; (selected &lt; entity.getWeaponList().size())</span>
                &amp;&amp; !hasLooped) {
<span class="nc" id="L1335">            return selected;</span>
        } else {
<span class="nc" id="L1337">            return -1;</span>
        }
    }
    
    public int getNextWeaponNum() {
<span class="nc" id="L1342">        int selected = getNextWeaponListIdx();</span>
<span class="nc bnc" id="L1343" title="All 4 branches missed.">        if ((selected &gt;= 0) &amp;&amp; (selected &lt; entity.getWeaponList().size())) {</span>
<span class="nc" id="L1344">            return entity.getEquipmentNum(((WeaponListModel) weaponList</span>
<span class="nc" id="L1345">                    .getModel()).getWeaponAt(selected));</span>
        } else {
<span class="nc" id="L1347">            return -1;</span>
        }
    }
    
    /**
     * Selects the next valid weapon in the weapon list.
     *
     * @return The weaponId for the selected weapon
     */
    public int selectNextWeapon() {
<span class="nc" id="L1357">        int selected = getNextWeaponListIdx();</span>
<span class="nc" id="L1358">        weaponList.setSelectedIndex(selected);</span>
<span class="nc" id="L1359">        weaponList.ensureIndexIsVisible(selected);</span>
<span class="nc bnc" id="L1360" title="All 4 branches missed.">        if ((selected &gt;= 0) &amp;&amp; (selected &lt; entity.getWeaponList().size())) {</span>
<span class="nc" id="L1361">            return entity.getEquipmentNum(((WeaponListModel) weaponList</span>
<span class="nc" id="L1362">                    .getModel()).getWeaponAt(selected));</span>
        } else {
<span class="nc" id="L1364">            return -1;</span>
        }
    }

    /**
     * Selects the prevous valid weapon in the weapon list.
     *
     * @return The weaponId for the selected weapon
     */
    public int selectPrevWeapon() {
<span class="nc" id="L1374">        int selected = getPrevWeaponListIdx();</span>
<span class="nc" id="L1375">        weaponList.setSelectedIndex(selected);</span>
<span class="nc" id="L1376">        weaponList.ensureIndexIsVisible(selected);</span>
<span class="nc bnc" id="L1377" title="All 4 branches missed.">        if ((selected &gt;= 0) &amp;&amp; (selected &lt; entity.getWeaponList().size())) {</span>
<span class="nc" id="L1378">            return entity.getEquipmentNum(((WeaponListModel) weaponList</span>
<span class="nc" id="L1379">                    .getModel()).getWeaponAt(selected));</span>
        } else {
<span class="nc" id="L1381">            return -1;</span>
        }
    }


    /**
     * displays the selected item from the list in the weapon display panel.
     */
    private void displaySelected() {
<span class="nc" id="L1390">        removeListeners();</span>
        // short circuit if not selected
<span class="nc bnc" id="L1392" title="All 2 branches missed.">        if (weaponList.getSelectedIndex() == -1) {</span>
<span class="nc" id="L1393">            ((DefaultComboBoxModel&lt;String&gt;) m_chAmmo.getModel())</span>
<span class="nc" id="L1394">                    .removeAllElements();</span>
<span class="nc" id="L1395">            m_chAmmo.setEnabled(false);</span>
<span class="nc" id="L1396">            m_chBayWeapon.removeAllItems();</span>
<span class="nc" id="L1397">            m_chBayWeapon.setEnabled(false);</span>
<span class="nc" id="L1398">            wNameR.setText(&quot;&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1399">            wHeatR.setText(&quot;--&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1400">            wArcHeatR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1401">            wDamR.setText(&quot;--&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1402">            wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1403">            wShortR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1404">            wMedR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1405">            wLongR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L1406">            wExtR.setText(&quot;---&quot;); //$NON-NLS-1$</span>

<span class="nc" id="L1408">            wDamageTrooperL.setVisible(false);</span>
<span class="nc" id="L1409">            wDamageTrooperR.setVisible(false);</span>
<span class="nc" id="L1410">            wInfantryRange0L.setVisible(false);</span>
<span class="nc" id="L1411">            wInfantryRange0R.setVisible(false);</span>
<span class="nc" id="L1412">            wInfantryRange1L.setVisible(false);</span>
<span class="nc" id="L1413">            wInfantryRange1R.setVisible(false);</span>
<span class="nc" id="L1414">            wInfantryRange2L.setVisible(false);</span>
<span class="nc" id="L1415">            wInfantryRange2R.setVisible(false);</span>
<span class="nc" id="L1416">            wInfantryRange3L.setVisible(false);</span>
<span class="nc" id="L1417">            wInfantryRange3R.setVisible(false);</span>
<span class="nc" id="L1418">            wInfantryRange4L.setVisible(false);</span>
<span class="nc" id="L1419">            wInfantryRange4R.setVisible(false);</span>
<span class="nc" id="L1420">            wInfantryRange5L.setVisible(false);</span>
<span class="nc" id="L1421">            wInfantryRange5R.setVisible(false);</span>

<span class="nc" id="L1423">            return;</span>
        }

<span class="nc" id="L1426">        Mounted mounted = ((WeaponListModel) weaponList.getModel())</span>
<span class="nc" id="L1427">                .getWeaponAt(weaponList.getSelectedIndex());</span>
<span class="nc" id="L1428">        WeaponType wtype = (WeaponType) mounted.getType();</span>
        // The rules are a bit sparse on airborne (dropping) ground units, but it seems they should
        // still attack like ground units.
<span class="nc bnc" id="L1431" title="All 6 branches missed.">        boolean aerospaceAttack = entity.isAero() &amp;&amp; (entity.isAirborne() || entity.usesWeaponBays());</span>
        // update weapon display
<span class="nc" id="L1433">        wNameR.setText(mounted.getDesc());</span>
<span class="nc" id="L1434">        wHeatR.setText(Integer.toString(mounted.getCurrentHeat()));</span>

<span class="nc" id="L1436">        wArcHeatR.setText(Integer.toString(entity.getHeatInArc(</span>
<span class="nc" id="L1437">                mounted.getLocation(), mounted.isRearMounted())));</span>

<span class="nc bnc" id="L1439" title="All 4 branches missed.">        if ((wtype instanceof InfantryWeapon) &amp;&amp; !wtype.hasFlag(WeaponType.F_TAG)) {</span>
<span class="nc" id="L1440">            wDamageTrooperL.setVisible(true);</span>
<span class="nc" id="L1441">            wDamageTrooperR.setVisible(true);</span>
<span class="nc" id="L1442">            InfantryWeapon inftype = (InfantryWeapon) wtype;</span>
<span class="nc bnc" id="L1443" title="All 2 branches missed.">            if (entity.isConventionalInfantry()) {</span>
<span class="nc" id="L1444">                wDamageTrooperR.setText(Double.toString((double) Math.round(</span>
<span class="nc" id="L1445">                        ((Infantry) entity).getDamagePerTrooper() * 1000) / 1000));</span>
            } else {
<span class="nc" id="L1447">                wDamageTrooperR.setText(Double.toString(inftype.getInfantryDamage()));</span>
            }
            // what a nightmare to set up all the range info for infantry weapons
<span class="nc" id="L1450">            wMinL.setVisible(false);</span>
<span class="nc" id="L1451">            wShortL.setVisible(false);</span>
<span class="nc" id="L1452">            wMedL.setVisible(false);</span>
<span class="nc" id="L1453">            wLongL.setVisible(false);</span>
<span class="nc" id="L1454">            wExtL.setVisible(false);</span>
<span class="nc" id="L1455">            wMinR.setVisible(false);</span>
<span class="nc" id="L1456">            wShortR.setVisible(false);</span>
<span class="nc" id="L1457">            wMedR.setVisible(false);</span>
<span class="nc" id="L1458">            wLongR.setVisible(false);</span>
<span class="nc" id="L1459">            wExtR.setVisible(false);</span>
<span class="nc" id="L1460">            wInfantryRange0L.setVisible(false);</span>
<span class="nc" id="L1461">            wInfantryRange0R.setVisible(false);</span>
<span class="nc" id="L1462">            wInfantryRange1L.setVisible(false);</span>
<span class="nc" id="L1463">            wInfantryRange1R.setVisible(false);</span>
<span class="nc" id="L1464">            wInfantryRange2L.setVisible(false);</span>
<span class="nc" id="L1465">            wInfantryRange2R.setVisible(false);</span>
<span class="nc" id="L1466">            wInfantryRange3L.setVisible(false);</span>
<span class="nc" id="L1467">            wInfantryRange3R.setVisible(false);</span>
<span class="nc" id="L1468">            wInfantryRange4L.setVisible(false);</span>
<span class="nc" id="L1469">            wInfantryRange4R.setVisible(false);</span>
<span class="nc" id="L1470">            wInfantryRange5L.setVisible(false);</span>
<span class="nc" id="L1471">            wInfantryRange5R.setVisible(false);</span>
<span class="nc" id="L1472">            int zeromods = 0;</span>
<span class="nc bnc" id="L1473" title="All 2 branches missed.">            if (inftype.hasFlag(WeaponType.F_INF_POINT_BLANK)) {</span>
<span class="nc" id="L1474">                zeromods++;</span>
            }

<span class="nc bnc" id="L1477" title="All 2 branches missed.">            if (inftype.hasFlag(WeaponType.F_INF_ENCUMBER)</span>
<span class="nc bnc" id="L1478" title="All 2 branches missed.">                || (inftype.getCrew() &gt; 1)) {</span>
<span class="nc" id="L1479">                zeromods++;</span>
            }

<span class="nc bnc" id="L1482" title="All 2 branches missed.">            if (inftype.hasFlag(WeaponType.F_INF_BURST)) {</span>
<span class="nc" id="L1483">                zeromods--;</span>
            }
            
<span class="nc" id="L1486">            int range = inftype.getInfantryRange();</span>
<span class="nc bnc" id="L1487" title="All 2 branches missed.">            if (entity.getLocationStatus(mounted.getLocation()) == ILocationExposureStatus.WET) {</span>
<span class="nc" id="L1488">            	range /= 2;</span>
            }
<span class="nc bnc" id="L1490" title="All 9 branches missed.">            switch (range) {</span>
                case 0:
<span class="nc" id="L1492">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1493">                    wInfantryRange0R.setText(&quot;+&quot; + zeromods);</span>
<span class="nc" id="L1494">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1495">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1496">                    break;</span>
                case 1:
<span class="nc" id="L1498">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1499">                    wInfantryRange0R</span>
<span class="nc" id="L1500">                            .setText(Integer.toString(zeromods - 2));</span>
<span class="nc" id="L1501">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1502">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1503">                    wInfantryRange1L.setText(&quot;1&quot;);</span>
<span class="nc" id="L1504">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1505">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1506">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1507">                    wInfantryRange2L.setText(&quot;2&quot;);</span>
<span class="nc" id="L1508">                    wInfantryRange2R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1509">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1510">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1511">                    wInfantryRange3L.setText(&quot;3&quot;);</span>
<span class="nc" id="L1512">                    wInfantryRange3R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1513">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1514">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1515">                    break;</span>
                case 2:
<span class="nc" id="L1517">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1518">                    wInfantryRange0R</span>
<span class="nc" id="L1519">                            .setText(Integer.toString(zeromods - 2));</span>
<span class="nc" id="L1520">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1521">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1522">                    wInfantryRange1L.setText(&quot;1-2&quot;);</span>
<span class="nc" id="L1523">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1524">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1525">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1526">                    wInfantryRange2L.setText(&quot;3-4&quot;);</span>
<span class="nc" id="L1527">                    wInfantryRange2R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1528">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1529">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1530">                    wInfantryRange3L.setText(&quot;5-6&quot;);</span>
<span class="nc" id="L1531">                    wInfantryRange3R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1532">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1533">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1534">                    break;</span>
                case 3:
<span class="nc" id="L1536">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1537">                    wInfantryRange0R</span>
<span class="nc" id="L1538">                            .setText(Integer.toString(zeromods - 2));</span>
<span class="nc" id="L1539">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1540">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1541">                    wInfantryRange1L.setText(&quot;1-3&quot;);</span>
<span class="nc" id="L1542">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1543">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1544">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1545">                    wInfantryRange2L.setText(&quot;4-6&quot;);</span>
<span class="nc" id="L1546">                    wInfantryRange2R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1547">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1548">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1549">                    wInfantryRange3L.setText(&quot;7-9&quot;);</span>
<span class="nc" id="L1550">                    wInfantryRange3R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1551">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1552">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1553">                    break;</span>
                case 4:
<span class="nc" id="L1555">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1556">                    wInfantryRange0R</span>
<span class="nc" id="L1557">                            .setText(Integer.toString(zeromods - 2));</span>
<span class="nc" id="L1558">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1559">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1560">                    wInfantryRange1L.setText(&quot;1-4&quot;);</span>
<span class="nc" id="L1561">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1562">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1563">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1564">                    wInfantryRange2L.setText(&quot;5-6&quot;);</span>
<span class="nc" id="L1565">                    wInfantryRange2R.setText(&quot;+1&quot;);</span>
<span class="nc" id="L1566">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1567">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1568">                    wInfantryRange3L.setText(&quot;7-8&quot;);</span>
<span class="nc" id="L1569">                    wInfantryRange3R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1570">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1571">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1572">                    wInfantryRange4L.setText(&quot;9-10&quot;);</span>
<span class="nc" id="L1573">                    wInfantryRange4R.setText(&quot;+3&quot;);</span>
<span class="nc" id="L1574">                    wInfantryRange4L.setVisible(true);</span>
<span class="nc" id="L1575">                    wInfantryRange4R.setVisible(true);</span>
<span class="nc" id="L1576">                    wInfantryRange5L.setText(&quot;11-12&quot;);</span>
<span class="nc" id="L1577">                    wInfantryRange5R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1578">                    wInfantryRange5L.setVisible(true);</span>
<span class="nc" id="L1579">                    wInfantryRange5R.setVisible(true);</span>
<span class="nc" id="L1580">                    break;</span>
                case 5:
<span class="nc" id="L1582">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1583">                    wInfantryRange0R</span>
<span class="nc" id="L1584">                            .setText(Integer.toString(zeromods - 1));</span>
<span class="nc" id="L1585">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1586">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1587">                    wInfantryRange1L.setText(&quot;1-5&quot;);</span>
<span class="nc" id="L1588">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1589">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1590">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1591">                    wInfantryRange2L.setText(&quot;6-7&quot;);</span>
<span class="nc" id="L1592">                    wInfantryRange2R.setText(&quot;+1&quot;);</span>
<span class="nc" id="L1593">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1594">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1595">                    wInfantryRange3L.setText(&quot;8-10&quot;);</span>
<span class="nc" id="L1596">                    wInfantryRange3R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1597">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1598">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1599">                    wInfantryRange4L.setText(&quot;11-12&quot;);</span>
<span class="nc" id="L1600">                    wInfantryRange4R.setText(&quot;+3&quot;);</span>
<span class="nc" id="L1601">                    wInfantryRange4L.setVisible(true);</span>
<span class="nc" id="L1602">                    wInfantryRange4R.setVisible(true);</span>
<span class="nc" id="L1603">                    wInfantryRange5L.setText(&quot;13-15&quot;);</span>
<span class="nc" id="L1604">                    wInfantryRange5R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1605">                    wInfantryRange5L.setVisible(true);</span>
<span class="nc" id="L1606">                    wInfantryRange5R.setVisible(true);</span>
<span class="nc" id="L1607">                    break;</span>
                case 6:
<span class="nc" id="L1609">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1610">                    wInfantryRange0R</span>
<span class="nc" id="L1611">                            .setText(Integer.toString(zeromods - 1));</span>
<span class="nc" id="L1612">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1613">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1614">                    wInfantryRange1L.setText(&quot;1-6&quot;);</span>
<span class="nc" id="L1615">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1616">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1617">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1618">                    wInfantryRange2L.setText(&quot;7-9&quot;);</span>
<span class="nc" id="L1619">                    wInfantryRange2R.setText(&quot;+1&quot;);</span>
<span class="nc" id="L1620">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1621">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1622">                    wInfantryRange3L.setText(&quot;10-12&quot;);</span>
<span class="nc" id="L1623">                    wInfantryRange3R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1624">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1625">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1626">                    wInfantryRange4L.setText(&quot;13-15&quot;);</span>
<span class="nc" id="L1627">                    wInfantryRange4R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1628">                    wInfantryRange4L.setVisible(true);</span>
<span class="nc" id="L1629">                    wInfantryRange4R.setVisible(true);</span>
<span class="nc" id="L1630">                    wInfantryRange5L.setText(&quot;16-18&quot;);</span>
<span class="nc" id="L1631">                    wInfantryRange5R.setText(&quot;+5&quot;);</span>
<span class="nc" id="L1632">                    wInfantryRange5L.setVisible(true);</span>
<span class="nc" id="L1633">                    wInfantryRange5R.setVisible(true);</span>
<span class="nc" id="L1634">                    break;</span>
                case 7:
<span class="nc" id="L1636">                    wInfantryRange0L.setText(&quot;0&quot;);</span>
<span class="nc" id="L1637">                    wInfantryRange0R</span>
<span class="nc" id="L1638">                            .setText(Integer.toString(zeromods - 1));</span>
<span class="nc" id="L1639">                    wInfantryRange0L.setVisible(true);</span>
<span class="nc" id="L1640">                    wInfantryRange0R.setVisible(true);</span>
<span class="nc" id="L1641">                    wInfantryRange1L.setText(&quot;1-7&quot;);</span>
<span class="nc" id="L1642">                    wInfantryRange1R.setText(&quot;+0&quot;);</span>
<span class="nc" id="L1643">                    wInfantryRange1L.setVisible(true);</span>
<span class="nc" id="L1644">                    wInfantryRange1R.setVisible(true);</span>
<span class="nc" id="L1645">                    wInfantryRange2L.setText(&quot;8-10&quot;);</span>
<span class="nc" id="L1646">                    wInfantryRange2R.setText(&quot;+1&quot;);</span>
<span class="nc" id="L1647">                    wInfantryRange2L.setVisible(true);</span>
<span class="nc" id="L1648">                    wInfantryRange2R.setVisible(true);</span>
<span class="nc" id="L1649">                    wInfantryRange3L.setText(&quot;11-14&quot;);</span>
<span class="nc" id="L1650">                    wInfantryRange3R.setText(&quot;+2&quot;);</span>
<span class="nc" id="L1651">                    wInfantryRange3L.setVisible(true);</span>
<span class="nc" id="L1652">                    wInfantryRange3R.setVisible(true);</span>
<span class="nc" id="L1653">                    wInfantryRange4L.setText(&quot;15-17&quot;);</span>
<span class="nc" id="L1654">                    wInfantryRange4R.setText(&quot;+4&quot;);</span>
<span class="nc" id="L1655">                    wInfantryRange4L.setVisible(true);</span>
<span class="nc" id="L1656">                    wInfantryRange4R.setVisible(true);</span>
<span class="nc" id="L1657">                    wInfantryRange5L.setText(&quot;18-21&quot;);</span>
<span class="nc" id="L1658">                    wInfantryRange5R.setText(&quot;+6&quot;);</span>
<span class="nc" id="L1659">                    wInfantryRange5L.setVisible(true);</span>
<span class="nc" id="L1660">                    wInfantryRange5R.setVisible(true);</span>
                    break;
            }
<span class="nc" id="L1663">        } else {</span>
<span class="nc" id="L1664">            wDamageTrooperL.setVisible(false);</span>
<span class="nc" id="L1665">            wDamageTrooperR.setVisible(false);</span>
<span class="nc" id="L1666">            wInfantryRange0L.setVisible(false);</span>
<span class="nc" id="L1667">            wInfantryRange0R.setVisible(false);</span>
<span class="nc" id="L1668">            wInfantryRange1L.setVisible(false);</span>
<span class="nc" id="L1669">            wInfantryRange1R.setVisible(false);</span>
<span class="nc" id="L1670">            wInfantryRange2L.setVisible(false);</span>
<span class="nc" id="L1671">            wInfantryRange2R.setVisible(false);</span>
<span class="nc" id="L1672">            wInfantryRange3L.setVisible(false);</span>
<span class="nc" id="L1673">            wInfantryRange3R.setVisible(false);</span>
<span class="nc" id="L1674">            wInfantryRange4L.setVisible(false);</span>
<span class="nc" id="L1675">            wInfantryRange4R.setVisible(false);</span>
<span class="nc" id="L1676">            wInfantryRange5L.setVisible(false);</span>
<span class="nc" id="L1677">            wInfantryRange5R.setVisible(false);</span>
<span class="nc" id="L1678">            wShortL.setVisible(true);</span>
<span class="nc" id="L1679">            wMedL.setVisible(true);</span>
<span class="nc" id="L1680">            wLongL.setVisible(true);</span>

<span class="nc" id="L1682">            wMinR.setVisible(true);</span>
<span class="nc" id="L1683">            wShortR.setVisible(true);</span>
<span class="nc" id="L1684">            wMedR.setVisible(true);</span>
<span class="nc" id="L1685">            wLongR.setVisible(true);</span>

<span class="nc bnc" id="L1687" title="All 2 branches missed.">            if (!aerospaceAttack) {</span>
<span class="nc" id="L1688">                wMinL.setVisible(true);</span>
<span class="nc" id="L1689">                wMinR.setVisible(true);</span>
            }
<span class="nc bnc" id="L1691" title="All 2 branches missed.">            if (((entity.getGame() != null)</span>
<span class="nc bnc" id="L1692" title="All 4 branches missed.">                    &amp;&amp; entity.getGame().getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_RANGE))</span>
                    || aerospaceAttack) {
<span class="nc" id="L1694">                wExtL.setVisible(true);</span>
<span class="nc" id="L1695">                wExtR.setVisible(true);</span>
            }
        }

<span class="nc bnc" id="L1699" title="All 2 branches missed.">        if (wtype.getDamage() == WeaponType.DAMAGE_BY_CLUSTERTABLE) {</span>
<span class="nc bnc" id="L1700" title="All 2 branches missed.">            if (wtype instanceof HAGWeapon) {</span>
<span class="nc" id="L1701">                wDamR.setText(Messages.getString(&quot;MechDisplay.Variable&quot;)); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L1703">                wDamR.setText(Messages.getString(&quot;MechDisplay.Missile&quot;)); //$NON-NLS-1$</span>
            }
<span class="nc bnc" id="L1705" title="All 2 branches missed.">        } else if (wtype.getDamage() == WeaponType.DAMAGE_VARIABLE) {</span>
<span class="nc" id="L1706">            wDamR.setText(Messages.getString(&quot;MechDisplay.Variable&quot;)); //$NON-NLS-1$</span>
<span class="nc bnc" id="L1707" title="All 2 branches missed.">        } else if (wtype.getDamage() == WeaponType.DAMAGE_SPECIAL) {</span>
<span class="nc" id="L1708">            wDamR.setText(Messages.getString(&quot;MechDisplay.Special&quot;)); //$NON-NLS-1$</span>
<span class="nc bnc" id="L1709" title="All 2 branches missed.">        } else if (wtype.getDamage() == WeaponType.DAMAGE_ARTILLERY) {</span>
<span class="nc" id="L1710">            StringBuffer damage = new StringBuffer();</span>
<span class="nc" id="L1711">            int artyDamage = wtype.getRackSize();</span>
<span class="nc" id="L1712">            damage.append(Integer.toString(artyDamage));</span>
<span class="nc" id="L1713">            artyDamage -= 10;</span>
<span class="nc bnc" id="L1714" title="All 2 branches missed.">            while (artyDamage &gt; 0) {</span>
<span class="nc" id="L1715">                damage.append('/').append(Integer.toString(artyDamage));</span>
<span class="nc" id="L1716">                artyDamage -= 10;</span>
            }
<span class="nc" id="L1718">            wDamR.setText(damage.toString());</span>
<span class="nc bnc" id="L1719" title="All 2 branches missed.">        } else if (wtype.hasFlag(WeaponType.F_ENERGY)</span>
<span class="nc bnc" id="L1720" title="All 2 branches missed.">                   &amp;&amp; wtype.hasModes()</span>
<span class="nc bnc" id="L1721" title="All 4 branches missed.">                   &amp;&amp; (unitDisplay.getClientGUI() != null) &amp;&amp; unitDisplay.getClientGUI().getClient().getGame().getOptions().booleanOption(</span>
                OptionsConstants.ADVCOMBAT_TACOPS_ENERGY_WEAPONS)) {
<span class="nc bnc" id="L1723" title="All 2 branches missed.">            if (mounted.hasChargedCapacitor() != 0) {</span>
<span class="nc bnc" id="L1724" title="All 2 branches missed.">                if (mounted.hasChargedCapacitor() == 1) {</span>
<span class="nc" id="L1725">                    wDamR.setText(Integer.toString(Compute.dialDownDamage(</span>
                            mounted, wtype) + 5));
                }
<span class="nc bnc" id="L1728" title="All 2 branches missed.">                if (mounted.hasChargedCapacitor() == 2) {</span>
<span class="nc" id="L1729">                    wDamR.setText(Integer.toString(Compute.dialDownDamage(</span>
                            mounted, wtype) + 10));
                }
            } else {
<span class="nc" id="L1733">                wDamR.setText(Integer.toString(Compute.dialDownDamage(</span>
                        mounted, wtype)));
            }
        } else {
<span class="nc" id="L1737">            wDamR.setText(Integer.toString(wtype.getDamage()));</span>
        }

        // update range
<span class="nc" id="L1741">        int shortR = wtype.getShortRange();</span>
<span class="nc" id="L1742">        int mediumR = wtype.getMediumRange();</span>
<span class="nc" id="L1743">        int longR = wtype.getLongRange();</span>
<span class="nc" id="L1744">        int extremeR = wtype.getExtremeRange();</span>
<span class="nc bnc" id="L1745" title="All 2 branches missed.">        if (mounted.isInBearingsOnlyMode()) {</span>
<span class="nc" id="L1746">            extremeR = RangeType.RANGE_BEARINGS_ONLY_OUT;</span>
        }
<span class="nc bnc" id="L1748" title="All 4 branches missed.">        if ((entity.getLocationStatus(mounted.getLocation()) == ILocationExposureStatus.WET)</span>
            || (longR == 0)) {
<span class="nc" id="L1750">            shortR = wtype.getWShortRange();</span>
<span class="nc" id="L1751">            mediumR = wtype.getWMediumRange();</span>
<span class="nc" id="L1752">            longR = wtype.getWLongRange();</span>
<span class="nc" id="L1753">            extremeR = wtype.getWExtremeRange();</span>
<span class="nc bnc" id="L1754" title="All 2 branches missed.">        } else if (wtype.hasFlag(WeaponType.F_PDBAY)) {</span>
        //Point Defense bays have a variable range, depending on the mode they're in
<span class="nc bnc" id="L1756" title="All 4 branches missed.">            if (wtype.hasModes() &amp;&amp; mounted.curMode().equals(&quot;Point Defense&quot;)) {</span>
<span class="nc" id="L1757">                shortR = 1;</span>
<span class="nc" id="L1758">                wShortR.setText(&quot;1&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L1760">                shortR = 6;</span>
<span class="nc" id="L1761">                wShortR.setText(&quot;1-6&quot;); //$NON-NLS-1$</span>
            }
        }
        // We need to adjust the ranges for Centurion Weapon Systems: it's
        //  default range is 6/12/18 but that's only for units that are
        //  susceptible to CWS, for those that aren't the ranges are 1/2/3
<span class="nc bnc" id="L1767" title="All 2 branches missed.">        if (wtype.hasFlag(WeaponType.F_CWS)) {</span>
<span class="nc" id="L1768">            Entity target = null;</span>
<span class="nc bnc" id="L1769" title="All 2 branches missed.">            if ((unitDisplay.getClientGUI() != null)</span>
<span class="nc bnc" id="L1770" title="All 2 branches missed.">                &amp;&amp; (unitDisplay.getClientGUI().getCurrentPanel() instanceof FiringDisplay)) {</span>
<span class="nc" id="L1771">                Targetable t =</span>
<span class="nc" id="L1772">                        ((FiringDisplay) unitDisplay.getClientGUI().getCurrentPanel()).getTarget();</span>
<span class="nc bnc" id="L1773" title="All 2 branches missed.">                if (t instanceof Entity) {</span>
<span class="nc" id="L1774">                    target = (Entity) t;</span>
                }
            }
<span class="nc bnc" id="L1777" title="All 4 branches missed.">            if ((target == null) || !target.hasQuirk(&quot;susceptible_cws&quot;)) {</span>
<span class="nc" id="L1778">                shortR = 1;</span>
<span class="nc" id="L1779">                mediumR = 2;</span>
<span class="nc" id="L1780">                longR = 3;</span>
<span class="nc" id="L1781">                extremeR = 4;</span>
            }
        }
<span class="nc bnc" id="L1784" title="All 2 branches missed.">        if (wtype.getMinimumRange() &gt; 0) {</span>
<span class="nc" id="L1785">            wMinR.setText(Integer.toString(wtype.getMinimumRange()));</span>
        } else {
<span class="nc" id="L1787">            wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L1789" title="All 2 branches missed.">        if (shortR &gt; 1) {</span>
<span class="nc" id="L1790">            wShortR.setText(&quot;1 - &quot; + shortR); //$NON-NLS-1$</span>
        } else {
<span class="nc" id="L1792">            wShortR.setText(&quot;&quot; + shortR); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L1794" title="All 2 branches missed.">        if ((mediumR - shortR) &gt; 1) {</span>
<span class="nc" id="L1795">            wMedR.setText(shortR + 1 + &quot; - &quot; + mediumR); //$NON-NLS-1$</span>
        } else {
<span class="nc" id="L1797">            wMedR.setText(&quot;&quot; + mediumR); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L1799" title="All 2 branches missed.">        if ((longR - mediumR) &gt; 1) {</span>
<span class="nc" id="L1800">            wLongR.setText(mediumR + 1 + &quot; - &quot; + longR); //$NON-NLS-1$</span>
        } else {
<span class="nc" id="L1802">            wLongR.setText(&quot;&quot; + longR); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L1804" title="All 2 branches missed.">        if ((extremeR - longR) &gt; 1) {</span>
<span class="nc" id="L1805">            wExtR.setText(longR + 1 + &quot; - &quot; + extremeR); //$NON-NLS-1$</span>
        } else {
<span class="nc" id="L1807">            wExtR.setText(&quot;&quot; + extremeR); //$NON-NLS-1$</span>
        }

        // Update the range display to account for the weapon's loaded ammo.
<span class="nc bnc" id="L1811" title="All 2 branches missed.">        if (mounted.getLinked() != null) {</span>
<span class="nc" id="L1812">            updateRangeDisplayForAmmo(mounted.getLinked());</span>
        }

<span class="nc bnc" id="L1815" title="All 2 branches missed.">        if (aerospaceAttack) {</span>
            // change damage report to a statement of standard or capital
<span class="nc bnc" id="L1817" title="All 2 branches missed.">            if (wtype.isCapital()) {</span>
<span class="nc" id="L1818">                wDamR.setText(Messages.getString(&quot;MechDisplay.CapitalD&quot;)); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L1820">                wDamR.setText(Messages.getString(&quot;MechDisplay.StandardD&quot;)); //$NON-NLS-1$</span>
            }

            // if this is a weapons bay, then I need to compile it to get
            // accurate results
<span class="nc bnc" id="L1825" title="All 2 branches missed.">            if (wtype instanceof BayWeapon) {</span>
<span class="nc" id="L1826">                compileWeaponBay(mounted, wtype.isCapital());</span>
            } else {
                // otherwise I need to replace range display with standard
                // ranges and attack values
<span class="nc" id="L1830">                updateAttackValues(mounted, mounted.getLinked());</span>
            }

        }

        // update weapon bay selector
<span class="nc" id="L1836">        int chosen = m_chBayWeapon.getSelectedIndex();</span>
<span class="nc" id="L1837">        m_chBayWeapon.removeAllItems();</span>
<span class="nc bnc" id="L1838" title="All 4 branches missed.">        if (!(wtype instanceof BayWeapon) || !entity.usesWeaponBays()) {</span>
<span class="nc" id="L1839">            m_chBayWeapon.setEnabled(false);</span>
        } else {
<span class="nc" id="L1841">            m_chBayWeapon.setEnabled(true);</span>
<span class="nc bnc" id="L1842" title="All 2 branches missed.">            for (int wId : mounted.getBayWeapons()) {</span>
<span class="nc" id="L1843">                Mounted curWeapon = entity.getEquipment(wId);</span>
<span class="nc bnc" id="L1844" title="All 2 branches missed.">                if (null == curWeapon) {</span>
<span class="nc" id="L1845">                    continue;</span>
                }

<span class="nc" id="L1848">                m_chBayWeapon.addItem(formatBayWeapon(curWeapon));</span>
<span class="nc" id="L1849">            }</span>

<span class="nc bnc" id="L1851" title="All 4 branches missed.">            if (chosen == -1 || chosen &gt;= m_chBayWeapon.getItemCount()) {</span>
<span class="nc" id="L1852">                m_chBayWeapon.setSelectedIndex(0);</span>
            } else {
<span class="nc" id="L1854">                m_chBayWeapon.setSelectedIndex(chosen);</span>
            }
        }

        // update ammo selector
<span class="nc" id="L1859">        ((DefaultComboBoxModel&lt;String&gt;) m_chAmmo.getModel()).removeAllElements();</span>
<span class="nc" id="L1860">        Mounted oldmount = mounted;</span>
<span class="nc bnc" id="L1861" title="All 2 branches missed.">        if (wtype instanceof BayWeapon) {</span>
<span class="nc" id="L1862">            int n = m_chBayWeapon.getSelectedIndex();</span>
<span class="nc bnc" id="L1863" title="All 2 branches missed.">            if (n == -1) {</span>
<span class="nc" id="L1864">                n = 0;</span>
            }
<span class="nc" id="L1866">            mounted = entity.getEquipment(mounted.getBayWeapons()</span>
<span class="nc" id="L1867">                                                 .elementAt(n));</span>
<span class="nc" id="L1868">            wtype = (WeaponType) mounted.getType();</span>
        }
        
<span class="nc bnc" id="L1871" title="All 2 branches missed.">        if (wtype.getAmmoType() == AmmoType.T_NA) {</span>
<span class="nc" id="L1872">            m_chAmmo.setEnabled(false);</span>
<span class="nc bnc" id="L1873" title="All 2 branches missed.">        } else if (wtype.hasFlag(WeaponType.F_DOUBLE_ONESHOT)</span>
<span class="nc bnc" id="L1874" title="All 4 branches missed.">                || (entity.isSupportVehicle() &amp;&amp; (wtype.getAmmoType() == AmmoType.T_INFANTRY))) {</span>
<span class="nc" id="L1875">            int count = 0;</span>
<span class="nc" id="L1876">            vAmmo = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L1877" title="All 2 branches missed.">            for (Mounted current = mounted.getLinked(); current != null; current = current.getLinked()) {</span>
<span class="nc bnc" id="L1878" title="All 2 branches missed.">                if (current.getUsableShotsLeft() &gt; 0) {</span>
<span class="nc" id="L1879">                    vAmmo.add(current);</span>
<span class="nc" id="L1880">                    m_chAmmo.addItem(formatAmmo(current));</span>
<span class="nc" id="L1881">                    count++;</span>
                }
            }
            // If there is no remaining ammo, show the last one linked and disable
<span class="nc bnc" id="L1885" title="All 2 branches missed.">            if (count == 0) {</span>
<span class="nc" id="L1886">                m_chAmmo.addItem(formatAmmo(mounted.getLinked()));</span>
            }
<span class="nc" id="L1888">            m_chAmmo.setSelectedIndex(0);</span>
<span class="nc bnc" id="L1889" title="All 2 branches missed.">            m_chAmmo.setEnabled(count &gt; 0);</span>

        // this is the situation where there's some kind of ammo but it's not changeable
<span class="nc bnc" id="L1892" title="All 2 branches missed.">        } else if (wtype.hasFlag(WeaponType.F_ONESHOT)) {</span>
<span class="nc" id="L1893">            m_chAmmo.setEnabled(false);</span>
<span class="nc" id="L1894">            Mounted mountedAmmo = mounted.getLinked();</span>
<span class="nc bnc" id="L1895" title="All 2 branches missed.">            if (mountedAmmo != null) {</span>
<span class="nc" id="L1896">                m_chAmmo.addItem(formatAmmo(mountedAmmo));</span>
            }
<span class="nc" id="L1898">        } else {</span>
<span class="nc" id="L1899">            m_chAmmo.setEnabled(true);</span>
<span class="nc" id="L1900">            vAmmo = new ArrayList&lt;Mounted&gt;();</span>
<span class="nc" id="L1901">            int nCur = -1;</span>
<span class="nc" id="L1902">            int i = 0;</span>
            //Ammo sharing between adjacent trailers
<span class="nc" id="L1904">            List&lt;Mounted&gt; fullAmmoList = new ArrayList&lt;Mounted&gt;(entity.getAmmo());</span>
<span class="nc bnc" id="L1905" title="All 2 branches missed.">            if (entity.getTowedBy() != Entity.NONE) {</span>
<span class="nc" id="L1906">                Entity ahead = entity.getGame().getEntity(entity.getTowedBy());</span>
<span class="nc" id="L1907">                fullAmmoList.addAll(ahead.getAmmo());</span>
            }
<span class="nc bnc" id="L1909" title="All 2 branches missed.">            if (entity.getTowing() != Entity.NONE) {</span>
<span class="nc" id="L1910">                Entity behind = entity.getGame().getEntity(entity.getTowing());</span>
<span class="nc" id="L1911">                fullAmmoList.addAll(behind.getAmmo());</span>
            }
<span class="nc bnc" id="L1913" title="All 2 branches missed.">            for (Mounted mountedAmmo : fullAmmoList) {</span>
<span class="nc" id="L1914">                AmmoType atype = (AmmoType) mountedAmmo.getType();</span>
                // for all aero units other than fighters,
                // ammo must be located in the same place to be usable
<span class="nc" id="L1917">                boolean same = true;</span>
<span class="nc bnc" id="L1918" title="All 4 branches missed.">                if ((entity instanceof SmallCraft)</span>
                    || (entity instanceof Jumpship)) {
<span class="nc" id="L1920">                    same = (mounted.getLocation() == mountedAmmo</span>
<span class="nc bnc" id="L1921" title="All 2 branches missed.">                            .getLocation());</span>
                }

<span class="nc" id="L1924">                boolean rightBay = true;</span>
<span class="nc bnc" id="L1925" title="All 4 branches missed.">                if (entity.usesWeaponBays() &amp;&amp; !(entity instanceof FighterSquadron)) {</span>
<span class="nc" id="L1926">                    rightBay = oldmount.ammoInBay(entity.getEquipmentNum(mountedAmmo));</span>
                }
                
                // covers the situation where a weapon using non-caseless ammo should 
                // not be able to switch to caseless on the fly and vice versa
<span class="nc" id="L1931">                boolean canSwitchToAmmo = AmmoType.canSwitchToAmmo(mounted, atype);</span>

<span class="nc bnc" id="L1933" title="All 8 branches missed.">                if (mountedAmmo.isAmmoUsable() &amp;&amp; same &amp;&amp; rightBay &amp;&amp; canSwitchToAmmo</span>
<span class="nc bnc" id="L1934" title="All 2 branches missed.">                    &amp;&amp; (atype.getAmmoType() == wtype.getAmmoType())</span>
<span class="nc bnc" id="L1935" title="All 2 branches missed.">                    &amp;&amp; (atype.getRackSize() == wtype.getRackSize())) {</span>

<span class="nc" id="L1937">                    vAmmo.add(mountedAmmo);</span>
<span class="nc" id="L1938">                    m_chAmmo.addItem(formatAmmo(mountedAmmo));</span>
<span class="nc bnc" id="L1939" title="All 2 branches missed.">                    if ((mounted.getLinked() != null) &amp;&amp;</span>
<span class="nc bnc" id="L1940" title="All 2 branches missed.">                        mounted.getLinked().equals(mountedAmmo)) {</span>
<span class="nc" id="L1941">                        nCur = i;</span>
                    }
<span class="nc" id="L1943">                    i++;</span>
                }
<span class="nc" id="L1945">            }</span>
<span class="nc bnc" id="L1946" title="All 2 branches missed.">            if (nCur != -1) {</span>
<span class="nc" id="L1947">                m_chAmmo.setSelectedIndex(nCur);</span>
            }
        }

        // send event to other parts of the UI which care
<span class="nc bnc" id="L1952" title="All 2 branches missed.">        if (oldmount.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L1953">            setFieldofFire(oldmount);</span>
        } else {
<span class="nc" id="L1955">            setFieldofFire(mounted);</span>
        }
<span class="nc" id="L1957">        unitDisplay.processMechDisplayEvent(new MechDisplayEvent(this, entity, mounted));</span>
<span class="nc" id="L1958">        onResize();</span>
<span class="nc" id="L1959">        addListeners();</span>
<span class="nc" id="L1960">    }</span>
    
    // this gathers all the range data 
    // it is a boiled down version of displaySelected,
    // updateAttackValues, updateRangeDisplayforAmmo
    private void setFieldofFire(Mounted mounted) {
        // No field of fire without ClientGUI
<span class="nc bnc" id="L1967" title="All 2 branches missed.">        if (unitDisplay.getClientGUI() == null) </span>
<span class="nc" id="L1968">            return;</span>
        
<span class="nc" id="L1970">        ClientGUI gui = unitDisplay.getClientGUI();</span>

<span class="nc" id="L1972">        WeaponType wtype = (WeaponType) mounted.getType();</span>
<span class="nc" id="L1973">        int[][] ranges = new int[2][5];</span>
<span class="nc" id="L1974">        ranges[0] = wtype.getRanges(mounted);</span>

<span class="nc" id="L1976">        AmmoType atype = null;</span>
<span class="nc bnc" id="L1977" title="All 2 branches missed.">        if (mounted.getLinked() != null) </span>
<span class="nc" id="L1978">            atype = (AmmoType) mounted.getLinked().getType();</span>

        // gather underwater ranges
<span class="nc" id="L1981">        ranges[1] = wtype.getWRanges();</span>
<span class="nc bnc" id="L1982" title="All 2 branches missed.">        if (atype != null) {</span>
<span class="nc bnc" id="L1983" title="All 2 branches missed.">            if ((wtype.getAmmoType() == AmmoType.T_SRM)</span>
<span class="nc bnc" id="L1984" title="All 2 branches missed.">                    || (wtype.getAmmoType() == AmmoType.T_SRM_IMP)</span>
<span class="nc bnc" id="L1985" title="All 2 branches missed.">                    || (wtype.getAmmoType() == AmmoType.T_MRM)</span>
<span class="nc bnc" id="L1986" title="All 2 branches missed.">                    || (wtype.getAmmoType() == AmmoType.T_LRM)</span>
<span class="nc bnc" id="L1987" title="All 2 branches missed.">                    || (wtype.getAmmoType() == AmmoType.T_LRM_IMP)</span>
<span class="nc bnc" id="L1988" title="All 2 branches missed.">                    || (wtype.getAmmoType() == AmmoType.T_MML)) {</span>
<span class="nc bnc" id="L1989" title="All 2 branches missed.">                if (atype.getMunitionType() == AmmoType.M_TORPEDO) {</span>
<span class="nc" id="L1990">                    ranges[1] = wtype.getRanges(mounted);</span>
<span class="nc bnc" id="L1991" title="All 2 branches missed.">                } else if (atype.getMunitionType() == AmmoType.M_MULTI_PURPOSE) {</span>
<span class="nc" id="L1992">                    ranges[1] = wtype.getRanges(mounted);</span>
                }
            }
        }

        // Infantry range types 4+ are simplified to 
        // the usual range types as displaying 5 range circles
        // would be visual overkill (and besides this makes
        // things easier)
<span class="nc bnc" id="L2001" title="All 2 branches missed.">        if (wtype instanceof InfantryWeapon) {</span>
<span class="nc" id="L2002">            InfantryWeapon inftype = (InfantryWeapon) wtype;</span>
<span class="nc" id="L2003">            int iR = inftype.getInfantryRange();</span>
<span class="nc" id="L2004">            ranges[0] = </span>
                    new int[] { 0, iR, iR * 2, iR * 3, 0 };
<span class="nc" id="L2006">            ranges[1] =</span>
            		new int[] { 0, iR / 2, (iR / 2) * 2, (iR / 2) * 3, 0 }; 
        }

        // Artillery gets fixed ranges, 100 as an arbitrary
        // large range for the targeting phase and
        // 6 to 17 in the other phases as it will be
        // direct fire then
<span class="nc bnc" id="L2014" title="All 2 branches missed.">        if (wtype.hasFlag(WeaponType.F_ARTILLERY)) {</span>
<span class="nc bnc" id="L2015" title="All 2 branches missed.">            if (gui.getCurrentPanel() instanceof TargetingPhaseDisplay) {</span>
<span class="nc" id="L2016">                ranges[0] = new int[] { 0, 0, 0, 100, 0 };  </span>
<span class="nc" id="L2017">                ranges[1] = new int[] { 0, 0, 0, 0, 0 };</span>
            } else {
<span class="nc" id="L2019">                ranges[0] = new int[] { 6, 0, 0, 17, 0 };  </span>
<span class="nc" id="L2020">                ranges[1] = new int[] { 0, 0, 0, 0, 0 };</span>
            }
        }

        // Override for the various ATM and MML ammos
<span class="nc bnc" id="L2025" title="All 2 branches missed.">        if (atype != null) {</span>
<span class="nc bnc" id="L2026" title="All 2 branches missed.">            if (atype.getAmmoType() == AmmoType.T_ATM) {</span>
<span class="nc bnc" id="L2027" title="All 2 branches missed.">                if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) </span>
<span class="nc" id="L2028">                    ranges[0] = new int[] { 4, 9, 18, 27, 36 }; </span>
<span class="nc bnc" id="L2029" title="All 2 branches missed.">                else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) </span>
<span class="nc" id="L2030">                    ranges[0] = new int[] { 0, 3, 6, 9, 12 };</span>
                else 
<span class="nc" id="L2032">                    ranges[0] = new int[] { 4, 5, 10, 15, 20 };</span>
            } 
<span class="nc bnc" id="L2034" title="All 2 branches missed.">            else if (atype.getAmmoType() == AmmoType.T_MML) {</span>
<span class="nc bnc" id="L2035" title="All 2 branches missed.">                if (atype.hasFlag(AmmoType.F_MML_LRM)) </span>
<span class="nc" id="L2036">                    ranges[0] = new int[] { 6, 7, 14, 21, 28 };</span>
                else 
<span class="nc" id="L2038">                    ranges[0] = new int[] { 0, 3, 6, 9, 12 };</span>
<span class="nc bnc" id="L2039" title="All 2 branches missed.">            } else if (atype.getAmmoType() == AmmoType.T_IATM) {</span>
<span class="nc bnc" id="L2040" title="All 2 branches missed.">                if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) </span>
<span class="nc" id="L2041">                    ranges[0] = new int[] { 4, 9, 18, 27, 36 };</span>
<span class="nc bnc" id="L2042" title="All 2 branches missed.">                else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) </span>
<span class="nc" id="L2043">                    ranges[0] = new int[] { 0, 3, 6, 9, 12 };</span>
<span class="nc bnc" id="L2044" title="All 2 branches missed.">                else if (atype.getMunitionType() == AmmoType.M_IATM_IMP) </span>
<span class="nc" id="L2045">                    ranges[0] = new int[] { 0, 3, 6, 9, 12 };</span>
                else  
<span class="nc" id="L2047">                    ranges[0] = new int[] { 4, 5, 10, 15, 20 };</span>
            }
        }

        // No minimum range for hotload
<span class="nc bnc" id="L2052" title="All 4 branches missed.">        if ((mounted.getLinked() != null) &amp;&amp; mounted.getLinked().isHotLoaded()) {</span>
<span class="nc" id="L2053">            ranges[0][0] = 0;</span>
        }

        // Aero
<span class="nc bnc" id="L2057" title="All 2 branches missed.">        if (entity.isAirborne()) {</span>

            // prepare fresh ranges, no underwater
<span class="nc" id="L2060">            ranges[0] = new int[] { 0, 0, 0, 0, 0 };  </span>
<span class="nc" id="L2061">            ranges[1] = new int[] { 0, 0, 0, 0, 0 };</span>
<span class="nc" id="L2062">            int maxr = WeaponType.RANGE_SHORT;</span>
            
            // In the WeaponPanel, when the weapon is out of ammo
            // or otherwise nonfunctional, SHORT range will be listed;
            // the field of fire is instead disabled
            // Here as well as in WeaponPanel, choosing a specific ammo
            // only works for the current player's units
<span class="nc bnc" id="L2069" title="All 4 branches missed.">            if (!mounted.isBreached() &amp;&amp; !mounted.isMissing() </span>
<span class="nc bnc" id="L2070" title="All 4 branches missed.">                    &amp;&amp; !mounted.isDestroyed() &amp;&amp; !mounted.isJammed() </span>
<span class="nc bnc" id="L2071" title="All 2 branches missed.">                    &amp;&amp; ((mounted.getLinked() == null) </span>
<span class="nc bnc" id="L2072" title="All 2 branches missed.">                            || (mounted.getLinked().getUsableShotsLeft() &gt; 0))) {</span>
<span class="nc" id="L2073">                maxr = wtype.getMaxRange(mounted);</span>

<span class="nc bnc" id="L2075" title="All 2 branches missed.">                if (atype != null) {</span>
<span class="nc bnc" id="L2076" title="All 2 branches missed.">                    if (atype.getAmmoType() == AmmoType.T_ATM) {</span>
<span class="nc bnc" id="L2077" title="All 2 branches missed.">                        if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) {</span>
<span class="nc" id="L2078">                            maxr = WeaponType.RANGE_EXT;</span>
<span class="nc bnc" id="L2079" title="All 2 branches missed.">                        } else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) {</span>
<span class="nc" id="L2080">                            maxr = WeaponType.RANGE_SHORT;</span>
                        }
<span class="nc bnc" id="L2082" title="All 2 branches missed.">                    } else if (atype.getAmmoType() == AmmoType.T_MML) {</span>
<span class="nc bnc" id="L2083" title="All 2 branches missed.">                        if (!atype.hasFlag(AmmoType.F_MML_LRM)) {</span>
<span class="nc" id="L2084">                            maxr = WeaponType.RANGE_SHORT; </span>
                        }
                    } 
                }

                // set the standard ranges, depending on capital or no
                //boolean isCap = wtype.isCapital();
<span class="nc bnc" id="L2091" title="All 2 branches missed.">                int rangeMultiplier = wtype.isCapital() ? 2 : 1;</span>
<span class="nc" id="L2092">                final IGame game = unitDisplay.getClientGUI().getClient().getGame();</span>
<span class="nc bnc" id="L2093" title="All 2 branches missed.">                if (game.getBoard().onGround()) {</span>
<span class="nc" id="L2094">                    rangeMultiplier *= 8;</span>
                }
                
<span class="nc bnc" id="L2097" title="All 2 branches missed.">                for(int rangeIndex = RangeType.RANGE_MINIMUM; rangeIndex &lt;= RangeType.RANGE_EXTREME; rangeIndex++) {</span>
<span class="nc bnc" id="L2098" title="All 2 branches missed.">                    if(maxr &gt;= rangeIndex) {</span>
<span class="nc" id="L2099">                        ranges[0][rangeIndex] = WeaponType.AIRBORNE_WEAPON_RANGES[rangeIndex] * rangeMultiplier;</span>
                    }
                }
            }
        }
        
        // pass all this to the Displays
<span class="nc" id="L2106">        int arc = entity.getWeaponArc(entity.getEquipmentNum(mounted));</span>
<span class="nc" id="L2107">        int loc = mounted.getLocation();</span>
        
<span class="nc bnc" id="L2109" title="All 2 branches missed.">        if (gui.getCurrentPanel() instanceof FiringDisplay) {</span>
            // twisting
<span class="nc" id="L2111">            int facing = entity.getFacing();</span>
<span class="nc bnc" id="L2112" title="All 2 branches missed.">            if (entity.isSecondaryArcWeapon(entity.getEquipmentNum(mounted))) </span>
<span class="nc" id="L2113">                facing = entity.getSecondaryFacing();</span>
<span class="nc" id="L2114">            ((FiringDisplay) gui.getCurrentPanel()).FieldofFire(entity, ranges, arc, loc, facing);</span>
<span class="nc bnc" id="L2115" title="All 2 branches missed.">        } else if (gui.getCurrentPanel() instanceof TargetingPhaseDisplay) {</span>
            // twisting
<span class="nc" id="L2117">            int facing = entity.getFacing();</span>
<span class="nc bnc" id="L2118" title="All 2 branches missed.">            if (entity.isSecondaryArcWeapon(entity.getEquipmentNum(mounted))) </span>
<span class="nc" id="L2119">                facing = entity.getSecondaryFacing();</span>
<span class="nc" id="L2120">            ((TargetingPhaseDisplay) gui.getCurrentPanel()).FieldofFire(entity, ranges, arc, loc, facing);</span>
<span class="nc bnc" id="L2121" title="All 2 branches missed.">        } else if (gui.getCurrentPanel() instanceof MovementDisplay) {</span>
            // no twisting here
<span class="nc" id="L2123">            ((MovementDisplay)gui.getCurrentPanel()).FieldofFire(entity, ranges, arc, loc);</span>
        }
<span class="nc" id="L2125">    }</span>

    private String formatAmmo(Mounted m) {
<span class="nc" id="L2128">        StringBuffer sb = new StringBuffer(64);</span>
<span class="nc" id="L2129">        int ammoIndex = m.getDesc().indexOf(</span>
<span class="nc" id="L2130">                Messages.getString(&quot;MechDisplay.0&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L2131">        int loc = m.getLocation();</span>
<span class="nc bnc" id="L2132" title="All 2 branches missed.">        if (!m.getEntity().equals(entity)) {</span>
<span class="nc" id="L2133">            sb.append(&quot;[TR] &quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2134" title="All 2 branches missed.">        } else if (loc != Entity.LOC_NONE) {</span>
<span class="nc" id="L2135">            sb.append('[').append(entity.getLocationAbbr(loc)).append(&quot;] &quot;); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L2137" title="All 2 branches missed.">        if (ammoIndex == -1) {</span>
<span class="nc" id="L2138">            sb.append(m.getDesc());</span>
        } else {
<span class="nc" id="L2140">            sb.append(m.getDesc().substring(0, ammoIndex));</span>
<span class="nc" id="L2141">            sb.append(m.getDesc().substring(ammoIndex + 4));</span>
        }
<span class="nc bnc" id="L2143" title="All 2 branches missed.">        if (m.isHotLoaded()) {</span>
<span class="nc" id="L2144">            sb.append(Messages.getString(&quot;MechDisplay.isHotLoaded&quot;));</span>
        }
<span class="nc" id="L2146">        return sb.toString();</span>
    }

    private String formatBayWeapon(Mounted m) {
<span class="nc" id="L2150">        StringBuffer sb = new StringBuffer(64);</span>
<span class="nc" id="L2151">        sb.append(m.getDesc());</span>
<span class="nc" id="L2152">        return sb.toString();</span>
    }

    /**
     * Update the range display for the selected ammo.
     *
     * @param mAmmo - the &lt;code&gt;AmmoType&lt;/code&gt; of the weapon's loaded ammo.
     */
    private void updateRangeDisplayForAmmo(Mounted mAmmo) {
<span class="nc bnc" id="L2161" title="All 2 branches missed.">        if (!(mAmmo.getType() instanceof AmmoType)) {</span>
<span class="nc" id="L2162">            return;</span>
        }
<span class="nc" id="L2164">        AmmoType atype = (AmmoType) mAmmo.getType();</span>
        // Only override the display for the various ATM and MML ammos
<span class="nc bnc" id="L2166" title="All 2 branches missed.">        if (atype.getAmmoType() == AmmoType.T_ATM) {</span>
<span class="nc bnc" id="L2167" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) {</span>
<span class="nc" id="L2168">                wMinR.setText(&quot;4&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2169">                wShortR.setText(&quot;1 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2170">                wMedR.setText(&quot;10 - 18&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2171">                wLongR.setText(&quot;19 - 27&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2172">                wExtR.setText(&quot;28 - 36&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2173" title="All 2 branches missed.">            } else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) {</span>
<span class="nc" id="L2174">                wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2175">                wShortR.setText(&quot;1 - 3&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2176">                wMedR.setText(&quot;4 - 6&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2177">                wLongR.setText(&quot;7 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2178">                wExtR.setText(&quot;10 - 12&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2180">                wMinR.setText(&quot;4&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2181">                wShortR.setText(&quot;1 - 5&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2182">                wMedR.setText(&quot;6 - 10&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2183">                wLongR.setText(&quot;11 - 15&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2184">                wExtR.setText(&quot;16 - 20&quot;); //$NON-NLS-1$</span>
            }
        } // End weapon-is-ATM
<span class="nc bnc" id="L2187" title="All 2 branches missed.">        else if (atype.getAmmoType() == AmmoType.T_MML) {</span>
<span class="nc bnc" id="L2188" title="All 2 branches missed.">            if (atype.hasFlag(AmmoType.F_MML_LRM)) {</span>
<span class="nc" id="L2189">                wMinR.setText(&quot;6&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2190">                wShortR.setText(&quot;1 - 7&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2191">                wMedR.setText(&quot;8 - 14&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2192">                wLongR.setText(&quot;15 - 21&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2193">                wExtR.setText(&quot;21 - 28&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2195">                wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2196">                wShortR.setText(&quot;1 - 3&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2197">                wMedR.setText(&quot;4 - 6&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2198">                wLongR.setText(&quot;7 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2199">                wExtR.setText(&quot;10 - 12&quot;); //$NON-NLS-1$</span>
            }
<span class="nc bnc" id="L2201" title="All 2 branches missed.">        } else if (atype.getAmmoType() == AmmoType.T_IATM) {</span>
<span class="nc bnc" id="L2202" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) {</span>
<span class="nc" id="L2203">                wMinR.setText(&quot;4&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2204">                wShortR.setText(&quot;1 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2205">                wMedR.setText(&quot;10 - 18&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2206">                wLongR.setText(&quot;19 - 27&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2207">                wExtR.setText(&quot;28 - 36&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2208" title="All 2 branches missed.">            } else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) {</span>
<span class="nc" id="L2209">                wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2210">                wShortR.setText(&quot;1 - 3&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2211">                wMedR.setText(&quot;4 - 6&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2212">                wLongR.setText(&quot;7 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2213">                wExtR.setText(&quot;10 - 12&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2214" title="All 2 branches missed.">            } else if (atype.getMunitionType() == AmmoType.M_IATM_IIW) {</span>
<span class="nc" id="L2215">                wMinR.setText(&quot;4&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2216">                wShortR.setText(&quot;1 - 5&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2217">                wMedR.setText(&quot;6 - 10&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2218">                wLongR.setText(&quot;11 - 15&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2219">                wExtR.setText(&quot;16 - 20&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2220" title="All 2 branches missed.">            } else if (atype.getMunitionType() == AmmoType.M_IATM_IMP) {</span>
<span class="nc" id="L2221">                wMinR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2222">                wShortR.setText(&quot;1 - 3&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2223">                wMedR.setText(&quot;4 - 6&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2224">                wLongR.setText(&quot;7 - 9&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2225">                wExtR.setText(&quot;10 - 12&quot;); //$NON-NLS-1$</span>
            } else /* standard */ {
<span class="nc" id="L2227">                wMinR.setText(&quot;4&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2228">                wShortR.setText(&quot;1 - 5&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2229">                wMedR.setText(&quot;6 - 10&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2230">                wLongR.setText(&quot;11 - 15&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2231">                wExtR.setText(&quot;16 - 20&quot;); //$NON-NLS-1$</span>
            }           
        }

        // Min range 0 for hotload
<span class="nc bnc" id="L2236" title="All 2 branches missed.">        if (mAmmo.isHotLoaded()) {</span>
<span class="nc" id="L2237">            wMinR.setText(&quot;---&quot;);</span>
        }

<span class="nc" id="L2240">        onResize();</span>
<span class="nc" id="L2241">    } // End private void updateRangeDisplayForAmmo( AmmoType )</span>

    private void updateAttackValues(Mounted weapon, Mounted ammo) {
<span class="nc" id="L2244">        WeaponType wtype = (WeaponType) weapon.getType();</span>
        // update Attack Values and change range
<span class="nc" id="L2246">        int avShort = wtype.getRoundShortAV();</span>
<span class="nc" id="L2247">        int avMed = wtype.getRoundMedAV();</span>
<span class="nc" id="L2248">        int avLong = wtype.getRoundLongAV();</span>
<span class="nc" id="L2249">        int avExt = wtype.getRoundExtAV();</span>
<span class="nc" id="L2250">        int maxr = wtype.getMaxRange(weapon);</span>

        // change range and attack values based upon ammo
<span class="nc bnc" id="L2253" title="All 2 branches missed.">        if (null != ammo) {</span>
<span class="nc" id="L2254">            AmmoType atype = (AmmoType) ammo.getType();</span>
<span class="nc" id="L2255">            double[] changes = changeAttackValues(atype, avShort, avMed,</span>
                                                  avLong, avExt, maxr);
<span class="nc" id="L2257">            avShort = (int) changes[0];</span>
<span class="nc" id="L2258">            avMed = (int) changes[1];</span>
<span class="nc" id="L2259">            avLong = (int) changes[2];</span>
<span class="nc" id="L2260">            avExt = (int) changes[3];</span>
<span class="nc" id="L2261">            maxr = (int) changes[4];</span>
        }

<span class="nc bnc" id="L2264" title="All 4 branches missed.">        if (entity.getGame().getOptions().booleanOption(OptionsConstants.ADVAERORULES_AERO_SANITY) &amp;&amp; wtype.isCapital()) {</span>
<span class="nc" id="L2265">            avShort *= 10;</span>
<span class="nc" id="L2266">            avMed *= 10;</span>
<span class="nc" id="L2267">            avLong *= 10;</span>
<span class="nc" id="L2268">            avExt *= 10;</span>
        }

        // set default values in case if statement stops
<span class="nc" id="L2272">        wShortAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2273">        wMedAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2274">        wLongAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2275">        wExtAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2276">        wShortR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2277">        wMedR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2278">        wLongR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2279">        wExtR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
        // every weapon gets at least short range
<span class="nc" id="L2281">        wShortAVR.setText(Integer.toString(avShort));</span>
<span class="nc bnc" id="L2282" title="All 2 branches missed.">        if (wtype.isCapital()) {</span>
<span class="nc" id="L2283">            wShortR.setText(&quot;1-12&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L2284" title="All 2 branches missed.">        } else if (wtype.hasFlag(WeaponType.F_PDBAY)) {</span>
                //Point Defense bays have a variable range too, depending on the mode they're in
<span class="nc bnc" id="L2286" title="All 4 branches missed.">                if (wtype.hasModes() &amp;&amp; weapon.curMode().equals(&quot;Point Defense&quot;)) {</span>
<span class="nc" id="L2287">                    wShortR.setText(&quot;1&quot;); //$NON-NLS-1$</span>
                } else {
<span class="nc" id="L2289">                    wShortR.setText(&quot;1-6&quot;); //$NON-NLS-1$</span>
                }
        } else {
<span class="nc" id="L2292">            wShortR.setText(&quot;1-6&quot;); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L2294" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_SHORT) {</span>
<span class="nc" id="L2295">            wMedAVR.setText(Integer.toString(avMed));</span>
<span class="nc bnc" id="L2296" title="All 2 branches missed.">            if (wtype.isCapital()) {</span>
<span class="nc" id="L2297">                wMedR.setText(&quot;13-24&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2299">                wMedR.setText(&quot;7-12&quot;); //$NON-NLS-1$</span>
            }
        }
<span class="nc bnc" id="L2302" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_MED) {</span>
<span class="nc" id="L2303">            wLongAVR.setText(Integer.toString(avLong));</span>
<span class="nc bnc" id="L2304" title="All 2 branches missed.">            if (wtype.isCapital()) {</span>
<span class="nc" id="L2305">                wLongR.setText(&quot;25-40&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2307">                wLongR.setText(&quot;13-20&quot;); //$NON-NLS-1$</span>
            }
        }
<span class="nc bnc" id="L2310" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_LONG) {</span>
<span class="nc" id="L2311">            wExtAVR.setText(Integer.toString(avExt));</span>
<span class="nc bnc" id="L2312" title="All 2 branches missed.">            if (wtype.isCapital()) {</span>
<span class="nc" id="L2313">                wExtR.setText(&quot;41-50&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2315">                wExtR.setText(&quot;21-25&quot;); //$NON-NLS-1$</span>
            }
        }

<span class="nc" id="L2319">        onResize();</span>
<span class="nc" id="L2320">    }</span>

    private double[] changeAttackValues(AmmoType atype, double avShort,
                                        double avMed, double avLong, double avExt, int maxr) {

<span class="nc bnc" id="L2325" title="All 2 branches missed.">        if (AmmoType.T_ATM == atype.getAmmoType()) {</span>
<span class="nc bnc" id="L2326" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_EXTENDED_RANGE) {</span>
<span class="nc" id="L2327">                maxr = WeaponType.RANGE_EXT;</span>
<span class="nc" id="L2328">                avShort = avShort / 2;</span>
<span class="nc" id="L2329">                avMed = avMed / 2;</span>
<span class="nc" id="L2330">                avLong = avMed;</span>
<span class="nc" id="L2331">                avExt = avMed;</span>
<span class="nc bnc" id="L2332" title="All 2 branches missed.">            } else if (atype.getMunitionType() == AmmoType.M_HIGH_EXPLOSIVE) {</span>
<span class="nc" id="L2333">                maxr = WeaponType.RANGE_SHORT;</span>
<span class="nc" id="L2334">                avShort = avShort + (avShort / 2);</span>
<span class="nc" id="L2335">                avMed = 0;</span>
<span class="nc" id="L2336">                avLong = 0;</span>
<span class="nc" id="L2337">                avExt = 0;</span>
            }
        } // End weapon-is-ATM
<span class="nc bnc" id="L2340" title="All 2 branches missed.">        else if (atype.getAmmoType() == AmmoType.T_MML) {</span>
            // first check for artemis
<span class="nc" id="L2342">            int bonus = 0;</span>
<span class="nc bnc" id="L2343" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_ARTEMIS_CAPABLE) {</span>
<span class="nc" id="L2344">                int rack = atype.getRackSize();</span>
<span class="nc bnc" id="L2345" title="All 2 branches missed.">                if (rack == 5) {</span>
<span class="nc" id="L2346">                    bonus += 1;</span>
<span class="nc bnc" id="L2347" title="All 2 branches missed.">                } else if (rack &gt;= 7) {</span>
<span class="nc" id="L2348">                    bonus += 2;</span>
                }
<span class="nc" id="L2350">                avShort = avShort + bonus;</span>
<span class="nc" id="L2351">                avMed = avMed + bonus;</span>
<span class="nc" id="L2352">                avLong = avLong + bonus;</span>
            }
<span class="nc bnc" id="L2354" title="All 2 branches missed.">            if (!atype.hasFlag(AmmoType.F_MML_LRM)) {</span>
<span class="nc" id="L2355">                maxr = WeaponType.RANGE_SHORT;</span>
<span class="nc" id="L2356">                avShort = avShort * 2;</span>
<span class="nc" id="L2357">                avMed = 0;</span>
<span class="nc" id="L2358">                avLong = 0;</span>
<span class="nc" id="L2359">                avExt = 0;</span>
            }
<span class="nc" id="L2361">        } // end weapon is MML</span>
<span class="nc bnc" id="L2362" title="All 2 branches missed.">        else if ((atype.getAmmoType() == AmmoType.T_LRM) </span>
<span class="nc bnc" id="L2363" title="All 2 branches missed.">                || (atype.getAmmoType() == AmmoType.T_LRM_IMP)</span>
<span class="nc bnc" id="L2364" title="All 2 branches missed.">                || (atype.getAmmoType() == AmmoType.T_SRM)</span>
<span class="nc bnc" id="L2365" title="All 2 branches missed.">                || (atype.getAmmoType() == AmmoType.T_SRM_IMP)) {</span>

<span class="nc bnc" id="L2367" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_ARTEMIS_CAPABLE) {</span>
<span class="nc bnc" id="L2368" title="All 4 branches missed.">                if ((atype.getAmmoType() == AmmoType.T_LRM) || (atype.getAmmoType() == AmmoType.T_LRM_IMP)) {</span>
<span class="nc" id="L2369">                    int bonus = (int) Math.ceil(atype.getRackSize() / 5.0);</span>
<span class="nc" id="L2370">                    avShort = avShort + bonus;</span>
<span class="nc" id="L2371">                    avMed = avMed + bonus;</span>
<span class="nc" id="L2372">                    avLong = avLong + bonus;</span>
                }
<span class="nc bnc" id="L2374" title="All 4 branches missed.">                if ((atype.getAmmoType() == AmmoType.T_SRM) || (atype.getAmmoType() == AmmoType.T_SRM_IMP)) {</span>
<span class="nc" id="L2375">                    avShort = avShort + 2;</span>
                }
            }
<span class="nc bnc" id="L2378" title="All 2 branches missed.">        } else if (atype.getAmmoType() == AmmoType.T_AC_LBX) {</span>
<span class="nc bnc" id="L2379" title="All 2 branches missed.">            if (atype.getMunitionType() == AmmoType.M_CLUSTER) {</span>
<span class="nc" id="L2380">                int newAV = (int) Math.floor(0.6 * atype.getRackSize());</span>
<span class="nc" id="L2381">                avShort = newAV;</span>
<span class="nc bnc" id="L2382" title="All 2 branches missed.">                if (avMed &gt; 0) {</span>
<span class="nc" id="L2383">                    avMed = newAV;</span>
                }
<span class="nc bnc" id="L2385" title="All 2 branches missed.">                if (avLong &gt; 0) {</span>
<span class="nc" id="L2386">                    avLong = newAV;</span>
                }
<span class="nc bnc" id="L2388" title="All 2 branches missed.">                if (avExt &gt; 0) {</span>
<span class="nc" id="L2389">                    avExt = newAV;</span>
                }
<span class="nc" id="L2391">            }</span>
<span class="nc bnc" id="L2392" title="All 2 branches missed.">        } else if (atype.getAmmoType() == AmmoType.T_AR10) {</span>
<span class="nc bnc" id="L2393" title="All 2 branches missed.">            if (atype.hasFlag(AmmoType.F_AR10_KILLER_WHALE)) {</span>
<span class="nc" id="L2394">                avShort = 4;</span>
<span class="nc" id="L2395">                avMed = 4;</span>
<span class="nc" id="L2396">                avLong = 4;</span>
<span class="nc" id="L2397">                avExt = 4;</span>
<span class="nc bnc" id="L2398" title="All 2 branches missed.">            } else if (atype.hasFlag(AmmoType.F_AR10_WHITE_SHARK)) {</span>
<span class="nc" id="L2399">                avShort = 3;</span>
<span class="nc" id="L2400">                avMed = 3;</span>
<span class="nc" id="L2401">                avLong = 3;</span>
<span class="nc" id="L2402">                avExt = 3;</span>
<span class="nc bnc" id="L2403" title="All 2 branches missed.">            } else if (atype.hasFlag(AmmoType.F_SANTA_ANNA)) {</span>
<span class="nc" id="L2404">                avShort = 100;</span>
<span class="nc" id="L2405">                avMed = 100;</span>
<span class="nc" id="L2406">                avLong = 100;</span>
<span class="nc" id="L2407">                avExt = 100;</span>
<span class="nc bnc" id="L2408" title="All 2 branches missed.">            } else if (atype.hasFlag(AmmoType.F_PEACEMAKER)) {</span>
<span class="nc" id="L2409">                avShort = 1000;</span>
<span class="nc" id="L2410">                avMed = 1000;</span>
<span class="nc" id="L2411">                avLong = 1000;</span>
<span class="nc" id="L2412">                avExt = 1000;</span>
            } else {
<span class="nc" id="L2414">                avShort = 2;</span>
<span class="nc" id="L2415">                avMed = 2;</span>
<span class="nc" id="L2416">                avLong = 2;</span>
<span class="nc" id="L2417">                avExt = 2;</span>
            }
<span class="nc bnc" id="L2419" title="All 2 branches missed.">        } else if (atype.getAmmoType() == AmmoType.T_KILLER_WHALE) {</span>
<span class="nc bnc" id="L2420" title="All 2 branches missed.">            if (atype.hasFlag(AmmoType.F_PEACEMAKER)) {</span>
<span class="nc" id="L2421">                avShort = 1000;</span>
<span class="nc" id="L2422">                avMed = 1000;</span>
<span class="nc" id="L2423">                avLong = 1000;</span>
<span class="nc" id="L2424">                avExt = 1000; </span>
            } else {
<span class="nc" id="L2426">                avShort = 4;</span>
<span class="nc" id="L2427">                avMed = 4;</span>
<span class="nc" id="L2428">                avLong = 4;</span>
<span class="nc" id="L2429">                avExt = 4;</span>
            }
<span class="nc bnc" id="L2431" title="All 2 branches missed.">        } else if (atype.getAmmoType() == AmmoType.T_WHITE_SHARK) {</span>
<span class="nc bnc" id="L2432" title="All 2 branches missed.">            if (atype.hasFlag(AmmoType.F_SANTA_ANNA)) {</span>
<span class="nc" id="L2433">                avShort = 100;</span>
<span class="nc" id="L2434">                avMed = 100;</span>
<span class="nc" id="L2435">                avLong = 100;</span>
<span class="nc" id="L2436">                avExt = 100; </span>
            } else {
<span class="nc" id="L2438">                avShort = 3;</span>
<span class="nc" id="L2439">                avMed = 3;</span>
<span class="nc" id="L2440">                avLong = 3;</span>
<span class="nc" id="L2441">                avExt = 3;</span>
            }
        }

<span class="nc" id="L2445">        double[] result = {avShort, avMed, avLong, avExt, maxr};</span>
<span class="nc" id="L2446">        return result;</span>

    }

    private void compileWeaponBay(Mounted weapon, boolean isCapital) {

<span class="nc" id="L2452">        Vector&lt;Integer&gt; bayWeapons = weapon.getBayWeapons();</span>
<span class="nc" id="L2453">        WeaponType wtype = (WeaponType) weapon.getType();</span>

        // set default values in case if statement stops
<span class="nc" id="L2456">        wShortAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2457">        wMedAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2458">        wLongAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2459">        wExtAVR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2460">        wShortR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2461">        wMedR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2462">        wLongR.setText(&quot;---&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L2463">        wExtR.setText(&quot;---&quot;); //$NON-NLS-1$</span>

<span class="nc" id="L2465">        int heat = 0;</span>
<span class="nc" id="L2466">        double avShort = 0;</span>
<span class="nc" id="L2467">        double avMed = 0;</span>
<span class="nc" id="L2468">        double avLong = 0;</span>
<span class="nc" id="L2469">        double avExt = 0;</span>
<span class="nc" id="L2470">        int maxr = WeaponType.RANGE_SHORT;</span>

<span class="nc bnc" id="L2472" title="All 2 branches missed.">        for (int wId : bayWeapons) {</span>
<span class="nc" id="L2473">            Mounted m = entity.getEquipment(wId);</span>
<span class="nc bnc" id="L2474" title="All 2 branches missed.">            if (!m.isBreached()</span>
<span class="nc bnc" id="L2475" title="All 2 branches missed.">                &amp;&amp; !m.isMissing()</span>
<span class="nc bnc" id="L2476" title="All 2 branches missed.">                &amp;&amp; !m.isDestroyed()</span>
<span class="nc bnc" id="L2477" title="All 2 branches missed.">                &amp;&amp; !m.isJammed()</span>
<span class="nc bnc" id="L2478" title="All 2 branches missed.">                &amp;&amp; ((m.getLinked() == null) || (m.getLinked()</span>
<span class="nc bnc" id="L2479" title="All 2 branches missed.">                                                 .getUsableShotsLeft() &gt; 0))) {</span>
<span class="nc" id="L2480">                WeaponType bayWType = ((WeaponType) m.getType());</span>
<span class="nc" id="L2481">                heat = heat + m.getCurrentHeat();</span>
<span class="nc" id="L2482">                double mAVShort = bayWType.getShortAV();</span>
<span class="nc" id="L2483">                double mAVMed = bayWType.getMedAV();</span>
<span class="nc" id="L2484">                double mAVLong = bayWType.getLongAV();</span>
<span class="nc" id="L2485">                double mAVExt = bayWType.getExtAV();</span>
<span class="nc" id="L2486">                int mMaxR = bayWType.getMaxRange(m);</span>

                // deal with any ammo adjustments
<span class="nc bnc" id="L2489" title="All 2 branches missed.">                if (null != m.getLinked()) {</span>
<span class="nc" id="L2490">                    double[] changes = changeAttackValues((AmmoType) m</span>
<span class="nc" id="L2491">                                                                  .getLinked().getType(), mAVShort, mAVMed,</span>
                                                          mAVLong, mAVExt, mMaxR);
<span class="nc" id="L2493">                    mAVShort = changes[0];</span>
<span class="nc" id="L2494">                    mAVMed = changes[1];</span>
<span class="nc" id="L2495">                    mAVLong = changes[2];</span>
<span class="nc" id="L2496">                    mAVExt = changes[3];</span>
<span class="nc" id="L2497">                    mMaxR = (int) changes[4];</span>
                }

<span class="nc" id="L2500">                avShort = avShort + mAVShort;</span>
<span class="nc" id="L2501">                avMed = avMed + mAVMed;</span>
<span class="nc" id="L2502">                avLong = avLong + mAVLong;</span>
<span class="nc" id="L2503">                avExt = avExt + mAVExt;</span>
<span class="nc bnc" id="L2504" title="All 2 branches missed.">                if (mMaxR &gt; maxr) {</span>
<span class="nc" id="L2505">                    maxr = mMaxR;</span>
                }
            }
<span class="nc" id="L2508">        }</span>
        // check for bracketing
<span class="nc" id="L2510">        double mult = 1.0;</span>
<span class="nc bnc" id="L2511" title="All 4 branches missed.">        if (wtype.hasModes() &amp;&amp; weapon.curMode().equals(&quot;Bracket 80%&quot;)) {</span>
<span class="nc" id="L2512">            mult = 0.8;</span>
        }
<span class="nc bnc" id="L2514" title="All 4 branches missed.">        if (wtype.hasModes() &amp;&amp; weapon.curMode().equals(&quot;Bracket 60%&quot;)) {</span>
<span class="nc" id="L2515">            mult = 0.6;</span>
        }
<span class="nc bnc" id="L2517" title="All 4 branches missed.">        if (wtype.hasModes() &amp;&amp; weapon.curMode().equals(&quot;Bracket 40%&quot;)) {</span>
<span class="nc" id="L2518">            mult = 0.4;</span>
        }
<span class="nc" id="L2520">        avShort = mult * avShort;</span>
<span class="nc" id="L2521">        avMed = mult * avMed;</span>
<span class="nc" id="L2522">        avLong = mult * avLong;</span>
<span class="nc" id="L2523">        avExt = mult * avExt;</span>

<span class="nc bnc" id="L2525" title="All 4 branches missed.">        if (entity.getGame().getOptions().booleanOption(OptionsConstants.ADVAERORULES_AERO_SANITY) &amp;&amp; wtype.isCapital()) {</span>
<span class="nc" id="L2526">            avShort *= 10;</span>
<span class="nc" id="L2527">            avMed *= 10;</span>
<span class="nc" id="L2528">            avLong *= 10;</span>
<span class="nc" id="L2529">            avExt *= 10;</span>
        }

<span class="nc" id="L2532">        wHeatR.setText(Integer.toString(heat));</span>
<span class="nc" id="L2533">        wShortAVR.setText(Integer.toString((int) Math.ceil(avShort)));</span>
<span class="nc bnc" id="L2534" title="All 2 branches missed.">        if (isCapital) {</span>
<span class="nc" id="L2535">            wShortR.setText(&quot;1-12&quot;); //$NON-NLS-1$</span>
        } else {
<span class="nc" id="L2537">            wShortR.setText(&quot;1-6&quot;); //$NON-NLS-1$</span>
        }
<span class="nc bnc" id="L2539" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_SHORT) {</span>
<span class="nc" id="L2540">            wMedAVR.setText(Integer.toString((int) Math.ceil(avMed)));</span>
<span class="nc bnc" id="L2541" title="All 2 branches missed.">            if (isCapital) {</span>
<span class="nc" id="L2542">                wMedR.setText(&quot;13-24&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2544">                wMedR.setText(&quot;7-12&quot;); //$NON-NLS-1$</span>
            }
        }
<span class="nc bnc" id="L2547" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_MED) {</span>
<span class="nc" id="L2548">            wLongAVR.setText(Integer.toString((int) Math.ceil(avLong)));</span>
<span class="nc bnc" id="L2549" title="All 2 branches missed.">            if (isCapital) {</span>
<span class="nc" id="L2550">                wLongR.setText(&quot;25-40&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2552">                wLongR.setText(&quot;13-20&quot;); //$NON-NLS-1$</span>
            }
        }
<span class="nc bnc" id="L2555" title="All 2 branches missed.">        if (maxr &gt; WeaponType.RANGE_LONG) {</span>
<span class="nc" id="L2556">            wExtAVR.setText(Integer.toString((int) Math.ceil(avExt)));</span>
<span class="nc bnc" id="L2557" title="All 2 branches missed.">            if (isCapital) {</span>
<span class="nc" id="L2558">                wExtR.setText(&quot;41-50&quot;); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L2560">                wExtR.setText(&quot;21-25&quot;); //$NON-NLS-1$</span>
            }
        }
<span class="nc" id="L2563">        onResize();</span>
<span class="nc" id="L2564">    }</span>

    public void valueChanged(ListSelectionEvent event) {
<span class="nc bnc" id="L2567" title="All 2 branches missed.">        if (event.getValueIsAdjusting()) {</span>
<span class="nc" id="L2568">            return;</span>
        }
<span class="nc bnc" id="L2570" title="All 2 branches missed.">        if (event.getSource().equals(weaponList)) {</span>
<span class="nc" id="L2571">            displaySelected();</span>
            
            // Can't do anything if ClientGUI is null
<span class="nc bnc" id="L2574" title="All 2 branches missed.">            if (unitDisplay.getClientGUI() == null) {</span>
<span class="nc" id="L2575">                return;</span>
            }
            
<span class="nc" id="L2578">            JComponent currPanel = unitDisplay.getClientGUI().getCurrentPanel();</span>
            // When in the Firing Phase, update the targeting information.
<span class="nc bnc" id="L2580" title="All 2 branches missed.">            if (currPanel instanceof FiringDisplay) {</span>
<span class="nc" id="L2581">                FiringDisplay firingDisplay = (FiringDisplay)currPanel;</span>

<span class="nc" id="L2583">                Mounted mounted = null;</span>
<span class="nc" id="L2584">                WeaponListModel weaponModel = (WeaponListModel) weaponList</span>
<span class="nc" id="L2585">                        .getModel();</span>
<span class="nc bnc" id="L2586" title="All 2 branches missed.">                if (weaponList.getSelectedIndex() != -1) {</span>
<span class="nc" id="L2587">                    mounted = weaponModel.getWeaponAt(weaponList</span>
<span class="nc" id="L2588">                            .getSelectedIndex());</span>
                }
<span class="nc" id="L2590">                Mounted prevMounted = null;</span>
<span class="nc bnc" id="L2591" title="All 2 branches missed.">                if ((event.getLastIndex() != -1) </span>
<span class="nc bnc" id="L2592" title="All 2 branches missed.">                        &amp;&amp; (event.getLastIndex() &lt; weaponModel.getSize())) {</span>
<span class="nc" id="L2593">                    prevMounted = weaponModel.getWeaponAt(event.getLastIndex());</span>
                }
                // Some weapons have a specific target, which gets handled
                // in the target method
<span class="nc bnc" id="L2597" title="All 2 branches missed.">                if (mounted != null</span>
<span class="nc bnc" id="L2598" title="All 2 branches missed.">                        &amp;&amp; mounted.getType().hasFlag(WeaponType.F_VGL)) {</span>
                    // Store previous target, if it's a weapon that doesn't 
                    // have a forced target
<span class="nc bnc" id="L2601" title="All 2 branches missed.">                    if ((prevMounted != null)</span>
<span class="nc bnc" id="L2602" title="All 2 branches missed.">                            &amp;&amp; !prevMounted.getType().hasFlag(WeaponType.F_VGL)) {</span>
<span class="nc" id="L2603">                        prevTarget = firingDisplay.getTarget();</span>
                    }                    
<span class="nc" id="L2605">                    firingDisplay.target(null);</span>
                } else {
<span class="nc bnc" id="L2607" title="All 2 branches missed.">                    if (prevTarget != null) {</span>
<span class="nc" id="L2608">                        firingDisplay.target(prevTarget);</span>
<span class="nc" id="L2609">                        unitDisplay.getClientGUI().getBoardView()</span>
<span class="nc" id="L2610">                                .select(prevTarget.getPosition());</span>
<span class="nc" id="L2611">                        prevTarget = null;</span>
                    } else {
<span class="nc" id="L2613">                        firingDisplay.updateTarget();</span>
                    }
                }
<span class="nc bnc" id="L2616" title="All 2 branches missed.">            } else if (currPanel instanceof TargetingPhaseDisplay) {</span>
<span class="nc" id="L2617">                ((TargetingPhaseDisplay) currPanel).updateTarget();</span>
            }
            
            // Tell the &lt;Phase&gt;Display to update the 
            // firing arc info when a weapon has been de-selected
<span class="nc bnc" id="L2622" title="All 2 branches missed.">            if (weaponList.getSelectedIndex() == -1) {</span>
<span class="nc" id="L2623">                unitDisplay.getClientGUI().bv.clearFieldofF();</span>
            }
        }
<span class="nc" id="L2626">        onResize();</span>
<span class="nc" id="L2627">    }</span>

    public void actionPerformed(ActionEvent ev) {
<span class="nc" id="L2630">        ClientGUI clientgui = unitDisplay.getClientGUI();</span>
<span class="nc bnc" id="L2631" title="All 2 branches missed.">        if (ev.getSource().equals(m_chAmmo)</span>
<span class="nc bnc" id="L2632" title="All 4 branches missed.">                &amp;&amp; (m_chAmmo.getSelectedIndex() != -1)</span>
                &amp;&amp; (clientgui != null)) {
            // only change our own units
<span class="nc" id="L2635">            if (!clientgui.getClient().getLocalPlayer()</span>
<span class="nc bnc" id="L2636" title="All 2 branches missed.">                    .equals(entity.getOwner())) {</span>
<span class="nc" id="L2637">                return;</span>
            }
<span class="nc" id="L2639">            int n = weaponList.getSelectedIndex();</span>
<span class="nc bnc" id="L2640" title="All 2 branches missed.">            if (weaponList.getSelectedIndex() == -1) {</span>
<span class="nc" id="L2641">                return;</span>
            }
<span class="nc" id="L2643">            Mounted mWeap = ((WeaponListModel) weaponList.getModel())</span>
<span class="nc" id="L2644">                    .getWeaponAt(n);</span>
<span class="nc" id="L2645">            Mounted oldWeap = mWeap;</span>
<span class="nc" id="L2646">            Mounted oldAmmo = mWeap.getLinked();</span>
<span class="nc" id="L2647">            Mounted mAmmo = vAmmo.get(m_chAmmo.getSelectedIndex());</span>
            // if this is a weapon bay, then this is not what we want
<span class="nc" id="L2649">            boolean isBay = false;</span>
<span class="nc bnc" id="L2650" title="All 2 branches missed.">            if (mWeap.getType() instanceof BayWeapon) {</span>
<span class="nc" id="L2651">                isBay = true;</span>
<span class="nc" id="L2652">                n = m_chBayWeapon.getSelectedIndex();</span>
<span class="nc bnc" id="L2653" title="All 2 branches missed.">                if (n == -1) {</span>
<span class="nc" id="L2654">                    return;</span>
                }
                //
<span class="nc" id="L2657">                Mounted sWeap = entity.getEquipment(mWeap.getBayWeapons()</span>
<span class="nc" id="L2658">                        .elementAt(n));</span>
                // cycle through all weapons of the same type and load with
                // this ammo
<span class="nc bnc" id="L2661" title="All 2 branches missed.">                for (int wid : mWeap.getBayWeapons()) {</span>
<span class="nc" id="L2662">                    Mounted bWeap = entity.getEquipment(wid);</span>
                    // FIXME: Consider new AmmoType::equals / BombType::equals
<span class="nc bnc" id="L2664" title="All 2 branches missed.">                    if (bWeap.getType().equals(sWeap.getType())) {</span>
<span class="nc" id="L2665">                        entity.loadWeapon(bWeap, mAmmo);</span>
                        // Alert the server of the update.
<span class="nc" id="L2667">                        clientgui.getClient().sendAmmoChange(</span>
<span class="nc" id="L2668">                                entity.getId(),</span>
<span class="nc" id="L2669">                                entity.getEquipmentNum(bWeap),</span>
<span class="nc" id="L2670">                                entity.getEquipmentNum(mAmmo));</span>
                    }
<span class="nc" id="L2672">                }</span>
<span class="nc" id="L2673">            } else {</span>
<span class="nc" id="L2674">                entity.loadWeapon(mWeap, mAmmo);</span>
                // Alert the server of the update.
<span class="nc" id="L2676">                clientgui.getClient().sendAmmoChange(entity.getId(),</span>
<span class="nc" id="L2677">                        entity.getEquipmentNum(mWeap),</span>
<span class="nc" id="L2678">                        entity.getEquipmentNum(mAmmo));</span>
            }

            // Refresh for hot load change
<span class="nc bnc" id="L2682" title="All 4 branches missed.">            if ((((oldAmmo == null) || !oldAmmo.isHotLoaded()) &amp;&amp; mAmmo</span>
<span class="nc bnc" id="L2683" title="All 4 branches missed.">                    .isHotLoaded())</span>
<span class="nc bnc" id="L2684" title="All 2 branches missed.">                    || ((oldAmmo != null) &amp;&amp; oldAmmo.isHotLoaded() &amp;&amp; !mAmmo</span>
<span class="nc bnc" id="L2685" title="All 2 branches missed.">                            .isHotLoaded())) {</span>
<span class="nc" id="L2686">                displayMech(entity);</span>
<span class="nc" id="L2687">                weaponList.setSelectedIndex(n);</span>
<span class="nc" id="L2688">                weaponList.ensureIndexIsVisible(n);</span>
<span class="nc" id="L2689">                displaySelected();</span>
            }

            // Update the range display to account for the weapon's loaded
            // ammo.
<span class="nc" id="L2694">            updateRangeDisplayForAmmo(mAmmo);</span>
<span class="nc bnc" id="L2695" title="All 4 branches missed.">            if (entity.isAirborne() || entity.usesWeaponBays()) {</span>
<span class="nc" id="L2696">                WeaponType wtype = (WeaponType) mWeap.getType();</span>
<span class="nc bnc" id="L2697" title="All 2 branches missed.">                if (isBay) {</span>
<span class="nc" id="L2698">                    compileWeaponBay(oldWeap, wtype.isCapital());</span>
                } else {
                    // otherwise I need to replace range display with
                    // standard ranges and attack values
<span class="nc" id="L2702">                    updateAttackValues(mWeap, mAmmo);</span>
                }
            }

            // When in the Firing Phase, update the targeting information.
<span class="nc bnc" id="L2707" title="All 2 branches missed.">            if (clientgui.getCurrentPanel() instanceof FiringDisplay) {</span>
<span class="nc" id="L2708">                ((FiringDisplay) clientgui.getCurrentPanel()).updateTarget();</span>
<span class="nc bnc" id="L2709" title="All 2 branches missed.">            } else if (clientgui.getCurrentPanel() instanceof TargetingPhaseDisplay) {</span>
<span class="nc" id="L2710">                ((TargetingPhaseDisplay) clientgui.getCurrentPanel()).updateTarget();</span>
            }
<span class="nc" id="L2712">            displaySelected();</span>
<span class="nc bnc" id="L2713" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_chBayWeapon)</span>
<span class="nc bnc" id="L2714" title="All 2 branches missed.">                   &amp;&amp; (m_chBayWeapon.getItemCount() &gt; 0)) {</span>
<span class="nc" id="L2715">            int n = weaponList.getSelectedIndex();</span>
<span class="nc bnc" id="L2716" title="All 2 branches missed.">            if (n == -1) {</span>
<span class="nc" id="L2717">                return;</span>
            }
<span class="nc" id="L2719">            displaySelected();</span>
<span class="nc bnc" id="L2720" title="All 2 branches missed.">        } else if (ev.getSource().equals(weapSortOrder)) {</span>
<span class="nc" id="L2721">            setWeaponComparator(weapSortOrder.getSelectedIndex());</span>
        }
<span class="nc" id="L2723">        onResize();</span>
<span class="nc" id="L2724">    }</span>

    void setWeaponComparator(int sortIdx) {
        Comparator&lt;Mounted&gt; weapComparator;
<span class="nc bnc" id="L2728" title="All 2 branches missed.">        if (sortIdx == Entity.WeaponSortOrder.RANGE_LH.ordinal()) {</span>
<span class="nc" id="L2729">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.RANGE_LH);</span>
<span class="nc" id="L2730">            weapComparator = new WeaponComparatorRange(true);</span>
<span class="nc bnc" id="L2731" title="All 2 branches missed.">        } else if (sortIdx == Entity.WeaponSortOrder.RANGE_HL.ordinal()) {</span>
<span class="nc" id="L2732">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.RANGE_HL);</span>
<span class="nc" id="L2733">            weapComparator = new WeaponComparatorRange(false);</span>
<span class="nc bnc" id="L2734" title="All 2 branches missed.">        } else if (sortIdx == Entity.WeaponSortOrder.DAMAGE_LH.ordinal()) {</span>
<span class="nc" id="L2735">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.DAMAGE_LH);</span>
<span class="nc" id="L2736">            weapComparator = new WeaponComparatorDamage(true);</span>
<span class="nc bnc" id="L2737" title="All 2 branches missed.">        } else if (sortIdx == Entity.WeaponSortOrder.DAMAGE_HL.ordinal()) {</span>
<span class="nc" id="L2738">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.DAMAGE_HL);</span>
<span class="nc" id="L2739">            weapComparator = new WeaponComparatorDamage(false);</span>
<span class="nc bnc" id="L2740" title="All 2 branches missed.">        } else if (sortIdx == Entity.WeaponSortOrder.CUSTOM.ordinal()) {</span>
<span class="nc" id="L2741">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.CUSTOM);</span>
<span class="nc" id="L2742">            weapComparator = new WeaponComparatorCustom(entity);</span>
<span class="nc bnc" id="L2743" title="All 2 branches missed.">        } else if (sortIdx == Entity.WeaponSortOrder.ARC.ordinal()) {</span>
<span class="nc" id="L2744">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.ARC);</span>
<span class="nc" id="L2745">            weapComparator = new WeaponComparatorArc(entity);</span>
        } else { // Default
<span class="nc" id="L2747">            entity.setWeaponSortOrder(Entity.WeaponSortOrder.DEFAULT);</span>
<span class="nc" id="L2748">            weapComparator = new WeaponComparatorNum(entity);</span>
        }
<span class="nc bnc" id="L2750" title="All 2 branches missed.">        if (unitDisplay.getClientGUI() != null) {</span>
<span class="nc" id="L2751">            unitDisplay.getClientGUI().getMenuBar()</span>
<span class="nc" id="L2752">                    .updateSaveWeaponOrderMenuItem();</span>
        }
<span class="nc" id="L2754">        ((WeaponListModel)weaponList.getModel()).sort(weapComparator);</span>
<span class="nc" id="L2755">    }</span>
    
    private void addListeners() {
<span class="nc" id="L2758">        weapSortOrder.addActionListener(this);</span>
<span class="nc" id="L2759">        m_chAmmo.addActionListener(this);</span>
<span class="nc" id="L2760">        m_chBayWeapon.addActionListener(this);</span>
        
<span class="nc" id="L2762">        weaponList.addListSelectionListener(this);</span>
<span class="nc" id="L2763">    }</span>
    
    private void removeListeners() {
<span class="nc" id="L2766">        weapSortOrder.removeActionListener(this);</span>
<span class="nc" id="L2767">        m_chAmmo.removeActionListener(this);</span>
<span class="nc" id="L2768">        m_chBayWeapon.removeActionListener(this);</span>
        
<span class="nc" id="L2770">        weaponList.removeListSelectionListener(this);</span>
<span class="nc" id="L2771">    }</span>

    public Targetable getPrevTarget() {
<span class="nc" id="L2774">        return prevTarget;</span>
    }

    public void setPrevTarget(Targetable prevTarget) {
<span class="nc" id="L2778">        this.prevTarget = prevTarget;</span>
<span class="nc" id="L2779">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>