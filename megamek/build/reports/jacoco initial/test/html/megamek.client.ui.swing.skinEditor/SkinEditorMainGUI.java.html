<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SkinEditorMainGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing.skinEditor</a> &gt; <span class="el_source">SkinEditorMainGUI.java</span></div><h1>SkinEditorMainGUI.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2000,2001,2002,2003,2004,2006 Ben Mazur (bmazur@sev.org)
 * Copyright Â© 2015 Nicholas Walczak (walczak@cs.umn.edu)
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License as published by the Free
 * Software Foundation; either version 2 of the License, or (at your option)
 * any later version.
 *
 * This program is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 * for more details.
 */
package megamek.client.ui.swing.skinEditor;

import java.awt.BorderLayout;
import java.awt.CardLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.Frame;
import java.awt.GraphicsConfiguration;
import java.awt.GraphicsDevice;
import java.awt.GraphicsEnvironment;
import java.awt.Image;
import java.awt.Rectangle;
import java.awt.SystemColor;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ComponentEvent;
import java.awt.event.ComponentListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.io.IOException;
import java.util.*;

import javax.swing.ImageIcon;
import javax.swing.JComponent;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextPane;
import javax.swing.ScrollPaneConstants;

import megamek.client.TimerSingleton;
import megamek.client.event.BoardViewEvent;
import megamek.client.event.BoardViewListener;
import megamek.client.ui.IBoardView;
import megamek.client.ui.Messages;
import megamek.client.ui.swing.ChatLounge;
import megamek.client.ui.swing.ChoiceDialog;
import megamek.client.ui.swing.CommonMenuBar;
import megamek.client.ui.swing.ConfirmDialog;
import megamek.client.ui.swing.DeployMinefieldDisplay;
import megamek.client.ui.swing.DeploymentDisplay;
import megamek.client.ui.swing.FiringDisplay;
import megamek.client.ui.swing.GUIPreferences;
import megamek.client.ui.swing.MovementDisplay;
import megamek.client.ui.swing.PhysicalDisplay;
import megamek.client.ui.swing.ReportDisplay;
import megamek.client.ui.swing.SelectArtyAutoHitHexDisplay;
import megamek.client.ui.swing.StatusBarPhaseDisplay;
import megamek.client.ui.swing.TargetingPhaseDisplay;
import megamek.client.ui.swing.UnitLoadingDialog;
import megamek.client.ui.swing.boardview.BoardView1;
import megamek.client.ui.swing.unitDisplay.UnitDisplay;
import megamek.common.Configuration;
import megamek.common.Coords;
import megamek.common.Entity;
import megamek.common.Game;
import megamek.common.IGame;
import megamek.common.IPlayer;
import megamek.common.MechFileParser;
import megamek.common.MechSummary;
import megamek.common.MechSummaryCache;
import megamek.common.icons.Camouflage;
import megamek.common.loaders.EntityLoadingException;
import megamek.common.util.Distractable;
import megamek.common.util.fileUtils.MegaMekFile;

public class SkinEditorMainGUI extends JPanel implements WindowListener, BoardViewListener,
        ActionListener, ComponentListener {
    private static final long serialVersionUID = 5625499617779156289L;

    private static final String FILENAME_ICON_16X16 = &quot;megamek-icon-16x16.png&quot;;
    private static final String FILENAME_ICON_32X32 = &quot;megamek-icon-32x32.png&quot;;
    private static final String FILENAME_ICON_48X48 = &quot;megamek-icon-48x48.png&quot;;
    private static final String FILENAME_ICON_256X256 = &quot;megamek-icon-256x256.png&quot;;

    // a frame, to show stuff in
    private JFrame frame;

    // A menu bar to contain all actions.
    protected CommonMenuBar menuBar;

    private BoardView1 bv;
    private Component bvc;
    private JDialog skinSpecEditorD;
    private SkinSpecEditor skinSpecEditor;

    public JDialog mechW;
    public UnitDisplay unitDisplay;

    protected JComponent curPanel;
    private ChatLounge chatlounge;

    /**
     * Test entity to display in UnitDisplay.
     */
    private Entity testEntity;

    /**
     * Map each phase to the name of the card for the main display area.
     */
<span class="nc" id="L119">    private HashMap&lt;String, String&gt; mainNames = new HashMap&lt;&gt;();</span>

    /**
     * The &lt;code&gt;JPanel&lt;/code&gt; containing the main display area.
     */
<span class="nc" id="L124">    private JPanel panMain = new JPanel();</span>

    /**
     * The &lt;code&gt;CardLayout&lt;/code&gt; of the main display area.
     */
<span class="nc" id="L129">    private CardLayout cardsMain = new CardLayout();</span>

    /**
     * Map each phase to the name of the card for the secondary area.
     */
<span class="nc" id="L134">    private HashMap&lt;String, String&gt; secondaryNames = new HashMap&lt;&gt;();</span>

    /**
     * The &lt;code&gt;JPanel&lt;/code&gt; containing the secondary display area.
     */
<span class="nc" id="L139">    private JPanel panSecondary = new JPanel();</span>

    private StatusBarPhaseDisplay currPhaseDisplay;

    /**
     * The &lt;code&gt;CardLayout&lt;/code&gt; of the secondary display area.
     */
<span class="nc" id="L146">    private CardLayout cardsSecondary = new CardLayout();</span>

    /**
     * Map phase component names to phase component objects.
     */
<span class="nc" id="L151">    HashMap&lt;String, JComponent&gt; phaseComponents = new HashMap&lt;&gt;();</span>

    public SkinEditorMainGUI() {
<span class="nc" id="L154">        super(new BorderLayout());</span>
<span class="nc" id="L155">        this.addComponentListener(this);</span>

<span class="nc" id="L157">        panMain.setLayout(cardsMain);</span>
<span class="nc" id="L158">        panSecondary.setLayout(cardsSecondary);</span>
<span class="nc" id="L159">        JPanel panDisplay = new JPanel(new BorderLayout());</span>
<span class="nc" id="L160">        panDisplay.add(panMain, BorderLayout.CENTER);</span>
<span class="nc" id="L161">        panDisplay.add(panSecondary, BorderLayout.SOUTH);</span>
<span class="nc" id="L162">        add(panDisplay, BorderLayout.CENTER);</span>

<span class="nc" id="L164">        UnitLoadingDialog unitLoadingDialog = new UnitLoadingDialog(frame);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">        if (!MechSummaryCache.getInstance().isInitialized()) {</span>
<span class="nc" id="L166">            unitLoadingDialog.setVisible(true);</span>
        }

        try {
<span class="nc" id="L170">            MechSummary ms = MechSummaryCache.getInstance().getMech(</span>
                    &quot;Archer ARC-2W&quot;);
<span class="nc" id="L172">            testEntity = new MechFileParser(ms.getSourceFile(),</span>
<span class="nc" id="L173">                    ms.getEntryName()).getEntity();</span>
<span class="nc" id="L174">        } catch (EntityLoadingException e) {</span>
<span class="nc" id="L175">            e.printStackTrace();</span>
<span class="nc" id="L176">        }</span>
<span class="nc" id="L177">    }</span>

    public IBoardView getBoardView() {
<span class="nc" id="L180">        return bv;</span>
    }

    /**
     * Initializes a number of things about this frame.
     */
    private void initializeFrame() {
<span class="nc" id="L187">        frame = new JFrame(Messages.getString(&quot;ClientGUI.title&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L188">        frame.setJMenuBar(menuBar);</span>
<span class="nc" id="L189">        Rectangle virtualBounds = getVirtualBounds();</span>
        int x, y, w, h;
<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (GUIPreferences.getInstance().getWindowSizeHeight() != 0) {</span>
<span class="nc" id="L192">            x = GUIPreferences.getInstance().getWindowPosX();</span>
<span class="nc" id="L193">            y = GUIPreferences.getInstance().getWindowPosY();</span>
<span class="nc" id="L194">            w = GUIPreferences.getInstance().getWindowSizeWidth();</span>
<span class="nc" id="L195">            h = GUIPreferences.getInstance().getWindowSizeHeight();</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if ((x &lt; virtualBounds.getMinX())</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                    || ((x + w) &gt; virtualBounds.getMaxX())) {</span>
<span class="nc" id="L198">                x = 0;</span>
            }
<span class="nc bnc" id="L200" title="All 2 branches missed.">            if ((y &lt; virtualBounds.getMinY())</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">                    || ((y + h) &gt; virtualBounds.getMaxY())) {</span>
<span class="nc" id="L202">                y = 0;</span>
            }
<span class="nc bnc" id="L204" title="All 2 branches missed.">            if (w &gt; virtualBounds.getWidth()) {</span>
<span class="nc" id="L205">                w = (int) virtualBounds.getWidth();</span>
            }
<span class="nc bnc" id="L207" title="All 2 branches missed.">            if (h &gt; virtualBounds.getHeight()) {</span>
<span class="nc" id="L208">                h = (int) virtualBounds.getHeight();</span>
            }
<span class="nc" id="L210">            frame.setLocation(x, y);</span>
<span class="nc" id="L211">            frame.setSize(w, h);</span>
        } else {
<span class="nc" id="L213">            frame.setSize(800, 600);</span>
        }
<span class="nc" id="L215">        frame.setMinimumSize(new Dimension(640, 480));</span>
<span class="nc" id="L216">        frame.setBackground(SystemColor.menu);</span>
<span class="nc" id="L217">        frame.setForeground(SystemColor.menuText);</span>
<span class="nc" id="L218">        List&lt;Image&gt; iconList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L219">        iconList.add(frame.getToolkit().getImage(</span>
<span class="nc" id="L220">                new MegaMekFile(Configuration.miscImagesDir(), FILENAME_ICON_16X16)</span>
<span class="nc" id="L221">                        .toString()));</span>
<span class="nc" id="L222">        iconList.add(frame.getToolkit().getImage(</span>
<span class="nc" id="L223">                new MegaMekFile(Configuration.miscImagesDir(), FILENAME_ICON_32X32)</span>
<span class="nc" id="L224">                        .toString()));</span>
<span class="nc" id="L225">        iconList.add(frame.getToolkit().getImage(</span>
<span class="nc" id="L226">                new MegaMekFile(Configuration.miscImagesDir(), FILENAME_ICON_48X48)</span>
<span class="nc" id="L227">                        .toString()));</span>
<span class="nc" id="L228">        iconList.add(frame.getToolkit().getImage(</span>
<span class="nc" id="L229">                new MegaMekFile(Configuration.miscImagesDir(), FILENAME_ICON_256X256)</span>
<span class="nc" id="L230">                        .toString()));</span>
<span class="nc" id="L231">        frame.setIconImages(iconList);</span>

<span class="nc" id="L233">        mechW = new JDialog(frame, Messages.getString(&quot;ClientGUI.MechDisplay&quot;), false);</span>
<span class="nc" id="L234">        x = GUIPreferences.getInstance().getDisplayPosX();</span>
<span class="nc" id="L235">        y = GUIPreferences.getInstance().getDisplayPosY();</span>
<span class="nc" id="L236">        h = GUIPreferences.getInstance().getDisplaySizeHeight();</span>
<span class="nc" id="L237">        w = GUIPreferences.getInstance().getDisplaySizeWidth();</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if ((x + w) &gt; virtualBounds.getWidth()) {</span>
<span class="nc" id="L239">            x = 0;</span>
<span class="nc" id="L240">            w = Math.min(w, (int)virtualBounds.getWidth());</span>
        }
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if ((y + h) &gt; virtualBounds.getHeight()) {</span>
<span class="nc" id="L243">            y = 0;</span>
<span class="nc" id="L244">            h = Math.min(h, (int)virtualBounds.getHeight());</span>
        }
<span class="nc" id="L246">        mechW.setLocation(x, y);</span>
<span class="nc" id="L247">        mechW.setSize(w, h);</span>
<span class="nc" id="L248">        mechW.setResizable(true);</span>
<span class="nc" id="L249">        unitDisplay = new UnitDisplay(null);</span>
<span class="nc" id="L250">        mechW.add(unitDisplay);</span>
<span class="nc" id="L251">        mechW.setVisible(true);</span>
<span class="nc" id="L252">        unitDisplay.displayEntity(testEntity);</span>
<span class="nc" id="L253">    }</span>

    /**
     * Lays out the frame by setting this Client object to take up the full
     * frame display area.
     */
    private void layoutFrame() {
<span class="nc" id="L260">        frame.setTitle(Messages.getString(&quot;MegaMek.SkinEditor.label&quot;) //$NON-NLS-1$</span>
<span class="nc" id="L261">                + Messages.getString(&quot;ClientGUI.clientTitleSuffix&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L262">        frame.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L263">        frame.getContentPane().add(this, BorderLayout.CENTER);</span>
<span class="nc" id="L264">        frame.validate();</span>
<span class="nc" id="L265">    }</span>

    public void updateBorder() {
<span class="nc" id="L268">        phaseComponents.clear();</span>
<span class="nc" id="L269">        panMain.removeAll();</span>
<span class="nc" id="L270">        panSecondary.removeAll();</span>
<span class="nc" id="L271">        mainNames.clear();</span>
<span class="nc" id="L272">        secondaryNames.clear();</span>

        try {
<span class="nc" id="L275">            bv = new BoardView1(new Game(), null, null);</span>
<span class="nc" id="L276">            bv.setPreferredSize(getSize());</span>
<span class="nc" id="L277">            bvc = bv.getComponent();</span>
<span class="nc" id="L278">            bvc.setName(&quot;BoardView&quot;);</span>
<span class="nc" id="L279">        } catch (IOException e) {</span>
<span class="nc" id="L280">            e.printStackTrace();</span>
<span class="nc" id="L281">            doAlertDialog(Messages.getString(&quot;ClientGUI.FatalError.title&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L282">                    Messages.getString(&quot;ClientGUI.FatalError.message&quot;) + e); //$NON-NLS-1$</span>
<span class="nc" id="L283">            die();</span>
<span class="nc" id="L284">        }</span>
<span class="nc" id="L285">        switchPanel(IGame.Phase.PHASE_MOVEMENT);</span>
<span class="nc" id="L286">        frame.validate();</span>

        // This is a horrible hack
        // Essentially, UnitDisplay (I think specifically ArmorPanel), relies
        // upon addNotify being called, so I need to way to set the
        // isDisplayable state to true.  However, if I create a new JDialog, or
        // called JDialog.setVisible(true), focus will get stolen from the
        // Skin Spec Editor, which causes undesirable behavior, particularly
        // with the path JTextFields
<span class="nc" id="L295">        Dimension sz = mechW.getSize();</span>
<span class="nc" id="L296">        mechW.remove(unitDisplay);</span>
        // UnitDisplay has no way to update the skin without being recreated
<span class="nc" id="L298">        unitDisplay = new UnitDisplay(null);</span>
<span class="nc" id="L299">        mechW.add(unitDisplay);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">        if (mechW.isVisible()) {</span>
            // This will cause the isDisplayable state to be true, in effect
            // ensuring addNotify has been called.
<span class="nc" id="L303">            mechW.pack();</span>
        } else {
<span class="nc" id="L305">            mechW.setVisible(true);</span>
        }
        // Packing is going to change the dimensions, so we'll restore old sz
<span class="nc" id="L308">        mechW.setSize(sz);</span>
<span class="nc" id="L309">        unitDisplay.displayEntity(testEntity);</span>
<span class="nc" id="L310">    }</span>

    /**
     * Have the client register itself as a listener wherever it's needed.
     * &lt;p/&gt;
     * According to
     * http://www-106.ibm.com/developerworks/java/library/j-jtp0618.html it is a
     * major bad no-no to perform these registrations before the constructor
     * finishes, so this function has to be called after the &lt;code&gt;Client&lt;/code&gt;
     * is created.
     */
    public void initialize() {
<span class="nc" id="L322">        phaseComponents.clear();</span>
<span class="nc" id="L323">        panMain.removeAll();</span>
<span class="nc" id="L324">        panSecondary.removeAll();</span>
<span class="nc" id="L325">        mainNames.clear();</span>
<span class="nc" id="L326">        secondaryNames.clear();</span>
<span class="nc" id="L327">        menuBar = new CommonMenuBar(null);</span>
<span class="nc" id="L328">        initializeFrame();</span>
        try {
            // Create the board viewer.
<span class="nc" id="L331">            bv = new BoardView1(new Game(), null, null);</span>
<span class="nc" id="L332">            bv.setPreferredSize(getSize());</span>
<span class="nc" id="L333">            bvc = bv.getComponent();</span>
<span class="nc" id="L334">            bvc.setName(&quot;BoardView&quot;);</span>
<span class="nc" id="L335">        } catch (Exception e) {</span>
<span class="nc" id="L336">            e.printStackTrace();</span>
<span class="nc" id="L337">            doAlertDialog(Messages.getString(&quot;ClientGUI.FatalError.title&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L338">                    Messages.getString(&quot;ClientGUI.FatalError.message&quot;) + e); //$NON-NLS-1$</span>
<span class="nc" id="L339">            die();</span>
<span class="nc" id="L340">        }</span>

<span class="nc" id="L342">        layoutFrame();</span>
<span class="nc" id="L343">        menuBar.addActionListener(this);</span>
<span class="nc" id="L344">        frame.addWindowListener(new WindowAdapter() {</span>
            @Override
            public void windowClosing(WindowEvent e) {
<span class="nc" id="L347">                frame.setVisible(false);</span>
<span class="nc" id="L348">                saveSettings();</span>
<span class="nc" id="L349">                die();</span>
<span class="nc" id="L350">            }</span>
        });

<span class="nc" id="L353">        GraphicsDevice gd = GraphicsEnvironment.getLocalGraphicsEnvironment()</span>
<span class="nc" id="L354">                .getDefaultScreenDevice();</span>
        int x;
        int y;
        int h;
        int w;
<span class="nc" id="L359">        skinSpecEditorD = new JDialog(frame,</span>
<span class="nc" id="L360">                Messages.getString(&quot;SkinEditor.SkinEditorDialog.Title&quot;), false); //$NON-NLS-1$</span>
<span class="nc" id="L361">        x = GUIPreferences.getInstance().getDisplayPosX();</span>
<span class="nc" id="L362">        y = GUIPreferences.getInstance().getDisplayPosY();</span>
<span class="nc" id="L363">        h = 480;</span>
<span class="nc" id="L364">        w = 640;</span>
<span class="nc bnc" id="L365" title="All 2 branches missed.">        if ((x + w) &gt; gd.getDisplayMode().getWidth()) {</span>
<span class="nc" id="L366">            x = 0;</span>
<span class="nc" id="L367">            w = Math.min(w, gd.getDisplayMode().getWidth());</span>
        }
<span class="nc bnc" id="L369" title="All 2 branches missed.">        if ((y + h) &gt; gd.getDisplayMode().getHeight()) {</span>
<span class="nc" id="L370">            y = 0;</span>
<span class="nc" id="L371">            h = Math.min(h, gd.getDisplayMode().getHeight());</span>
        }
<span class="nc" id="L373">        skinSpecEditorD.setLocation(x, y);</span>
<span class="nc" id="L374">        skinSpecEditorD.setSize(w, h);</span>
<span class="nc" id="L375">        skinSpecEditorD.setResizable(true);</span>
<span class="nc" id="L376">        skinSpecEditorD.addWindowListener(this);</span>
<span class="nc" id="L377">        skinSpecEditor = new SkinSpecEditor(this);</span>
<span class="nc" id="L378">        skinSpecEditorD.add(skinSpecEditor);</span>
<span class="nc" id="L379">        skinSpecEditorD.setVisible(true);</span>

<span class="nc" id="L381">        x = GUIPreferences.getInstance().getDisplayPosX();</span>
<span class="nc" id="L382">        y = GUIPreferences.getInstance().getDisplayPosY();</span>
<span class="nc" id="L383">        h = GUIPreferences.getInstance().getDisplaySizeHeight();</span>
<span class="nc" id="L384">        w = GUIPreferences.getInstance().getDisplaySizeWidth();</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if ((x + w) &gt; gd.getDisplayMode().getWidth()) {</span>
<span class="nc" id="L386">            x = 0;</span>
<span class="nc" id="L387">            w = Math.min(w, gd.getDisplayMode().getWidth());</span>
        }
<span class="nc bnc" id="L389" title="All 2 branches missed.">        if ((y + h) &gt; gd.getDisplayMode().getHeight()) {</span>
<span class="nc" id="L390">            y = 0;</span>
<span class="nc" id="L391">            h = Math.min(h, gd.getDisplayMode().getHeight());</span>
        }
<span class="nc" id="L393">        frame.pack();</span>
<span class="nc" id="L394">        frame.setVisible(true);</span>
<span class="nc" id="L395">    }</span>

    /**
     * Get the menu bar for this client.
     *
     * @return the &lt;code&gt;CommonMenuBar&lt;/code&gt; of this client.
     */
    public CommonMenuBar getMenuBar() {
<span class="nc" id="L403">        return menuBar;</span>
    }



    /**
     * Implement the &lt;code&gt;ActionListener&lt;/code&gt; interface.
     */
    public void actionPerformed(ActionEvent event) {
<span class="nc" id="L412">    }</span>



    /**
     * Saves the current settings to the cfg file.
     */
    void saveSettings() {
        // save frame location
<span class="nc" id="L421">        GUIPreferences.getInstance().setWindowPosX(frame.getLocation().x);</span>
<span class="nc" id="L422">        GUIPreferences.getInstance().setWindowPosY(frame.getLocation().y);</span>
<span class="nc" id="L423">        GUIPreferences.getInstance().setWindowSizeWidth(frame.getSize().width);</span>
<span class="nc" id="L424">        GUIPreferences.getInstance().setWindowSizeHeight(frame.getSize().height);</span>
<span class="nc" id="L425">    }</span>

    /**
     * Shuts down threads and sockets
     */
    void die() {
        // Tell all the displays to remove themselves as listeners.
<span class="nc" id="L432">        boolean reportHandled = false;</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if (bv != null) {</span>
            //cleanup our timers first
<span class="nc" id="L435">            bv.die();</span>
        }
<span class="nc" id="L437">        Iterator&lt;String&gt; names = phaseComponents.keySet().iterator();</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">        while (names.hasNext()) {</span>
<span class="nc" id="L439">            JComponent component = phaseComponents.get(names.next());</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (component instanceof ReportDisplay) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">                if (reportHandled) {</span>
<span class="nc" id="L442">                    continue;</span>
                }
<span class="nc" id="L444">                reportHandled = true;</span>
            }
<span class="nc bnc" id="L446" title="All 2 branches missed.">            if (component instanceof Distractable) {</span>
<span class="nc" id="L447">                ((Distractable) component).removeAllListeners();</span>
            }
<span class="nc" id="L449">        } // Handle the next component</span>
<span class="nc" id="L450">        frame.removeAll();</span>
<span class="nc" id="L451">        frame.setVisible(false);</span>
        try {
<span class="nc" id="L453">            frame.dispose();</span>
<span class="nc" id="L454">        } catch (Throwable error) {</span>
<span class="nc" id="L455">            error.printStackTrace();</span>
<span class="nc" id="L456">        }</span>

        // This is required because the ChatLounge adds the listener to the
        // MechSummaryCache that must be removed explicitly.
<span class="nc bnc" id="L460" title="All 2 branches missed.">        if (chatlounge != null) {</span>
<span class="nc" id="L461">            chatlounge.die();</span>
        }
<span class="nc" id="L463">        TimerSingleton.getInstance().killTimer();</span>

<span class="nc bnc" id="L465" title="All 2 branches missed.">        if (menuBar != null) {</span>
<span class="nc" id="L466">            menuBar.die();</span>
<span class="nc" id="L467">            menuBar = null;</span>
        }
<span class="nc" id="L469">    }</span>

    public void switchPanel(IGame.Phase phase) {
        // Clear the old panel's listeners.
<span class="nc bnc" id="L473" title="All 2 branches missed.">        if (curPanel instanceof BoardViewListener) {</span>
<span class="nc" id="L474">            bv.removeBoardViewListener((BoardViewListener) curPanel);</span>
        }
<span class="nc bnc" id="L476" title="All 2 branches missed.">        if (curPanel instanceof ActionListener) {</span>
<span class="nc" id="L477">            menuBar.removeActionListener((ActionListener) curPanel);</span>
        }
<span class="nc bnc" id="L479" title="All 2 branches missed.">        if (curPanel instanceof Distractable) {</span>
<span class="nc" id="L480">            ((Distractable) curPanel).setIgnoringEvents(true);</span>
        }

        // Get the new panel.
<span class="nc" id="L484">        String name = String.valueOf(phase);</span>
<span class="nc" id="L485">        curPanel = phaseComponents.get(name);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">        if (curPanel == null) {</span>
<span class="nc" id="L487">            curPanel = initializePanel(phase);</span>
        }

        // Handle phase-specific items.
<span class="nc bnc" id="L491" title="All 4 branches missed.">        switch (phase) {</span>
            case PHASE_LOUNGE:
                // reset old report tabs and images, if any
<span class="nc" id="L494">                ReportDisplay rD = (ReportDisplay) phaseComponents.get(String</span>
<span class="nc" id="L495">                        .valueOf(IGame.Phase.PHASE_INITIATIVE_REPORT));</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                if (rD != null) {</span>
<span class="nc" id="L497">                    rD.resetTabs();</span>
                }
                //ChatLounge cl = (ChatLounge) phaseComponents.get(
                //        String.valueOf(IGame.Phase.PHASE_LOUNGE));
                //cb.setDoneButton(cl.butDone);
                //cl.add(cb.getComponent(), BorderLayout.SOUTH);
<span class="nc" id="L503">                getBoardView().getTilesetManager().reset();</span>
<span class="nc" id="L504">                break;</span>
            case PHASE_DEPLOY_MINEFIELDS:
            case PHASE_DEPLOYMENT:
            case PHASE_TARGETING:
            case PHASE_MOVEMENT:
            case PHASE_OFFBOARD:
            case PHASE_FIRING:
            case PHASE_PHYSICAL:
<span class="nc" id="L512">                break;</span>
            case PHASE_INITIATIVE_REPORT:
            case PHASE_TARGETING_REPORT:
            case PHASE_MOVEMENT_REPORT:
            case PHASE_OFFBOARD_REPORT:
            case PHASE_FIRING_REPORT:
            case PHASE_PHYSICAL_REPORT:
            case PHASE_END_REPORT:
            case PHASE_VICTORY:
<span class="nc" id="L521">                rD = (ReportDisplay) phaseComponents.get(String</span>
<span class="nc" id="L522">                        .valueOf(IGame.Phase.PHASE_INITIATIVE_REPORT));</span>
                //cb.setDoneButton(rD.butDone);
                //rD.add(cb.getComponent(), GBC.eol().fill(
                //        GridBagConstraints.HORIZONTAL));
<span class="nc" id="L526">                break;</span>
            default:
                break;
        }

<span class="nc" id="L531">        cardsMain.show(panMain, mainNames.get(name));</span>
<span class="nc" id="L532">        String secondaryToShow = secondaryNames.get(name);</span>
        // only show the secondary component if there is one to show
<span class="nc bnc" id="L534" title="All 2 branches missed.">        if (secondaryToShow != null) {</span>
<span class="nc" id="L535">            panSecondary.setVisible(true);</span>
<span class="nc" id="L536">            cardsSecondary.show(panSecondary, secondaryNames.get(name));</span>
        } else {
            // otherwise, hide the panel
<span class="nc" id="L539">            panSecondary.setVisible(false);</span>
        }

        // Set the new panel's listeners
<span class="nc bnc" id="L543" title="All 2 branches missed.">        if (curPanel instanceof BoardViewListener) {</span>
<span class="nc" id="L544">            bv.addBoardViewListener((BoardViewListener) curPanel);</span>
        }
<span class="nc bnc" id="L546" title="All 2 branches missed.">        if (curPanel instanceof ActionListener) {</span>
<span class="nc" id="L547">            menuBar.addActionListener((ActionListener) curPanel);</span>
        }
<span class="nc bnc" id="L549" title="All 2 branches missed.">        if (curPanel instanceof Distractable) {</span>
<span class="nc" id="L550">            ((Distractable) curPanel).setIgnoringEvents(false);</span>
        }

        // Make the new panel the focus, if the Client option says so
<span class="nc bnc" id="L554" title="All 2 branches missed.">        if (GUIPreferences.getInstance().getFocus() ) {</span>
<span class="nc" id="L555">            curPanel.requestFocus();</span>
        }
<span class="nc" id="L557">    }</span>

    public void updateButtonPanel(IGame.Phase phase) {
<span class="nc bnc" id="L560" title="All 2 branches missed.">        if ((currPhaseDisplay != null)) {</span>
<span class="nc" id="L561">            currPhaseDisplay.setupButtonPanel();</span>
        }
<span class="nc" id="L563">    }</span>

    private JComponent initializePanel(IGame.Phase phase) {
        // Create the components for this phase.
<span class="nc" id="L567">        String name = String.valueOf(phase);</span>
        JComponent component;
<span class="nc" id="L569">        String secondary = null;</span>
        String main;
<span class="nc bnc" id="L571" title="All 14 branches missed.">        switch (phase) {</span>
            case PHASE_LOUNGE:
<span class="nc" id="L573">                component = new ChatLounge(null);</span>
<span class="nc" id="L574">                chatlounge = (ChatLounge) component;</span>
<span class="nc" id="L575">                main = &quot;ChatLounge&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L576">                component.setName(main);</span>
<span class="nc" id="L577">                panMain.add(component, main);</span>
<span class="nc" id="L578">                break;</span>
            case PHASE_STARTING_SCENARIO:
<span class="nc" id="L580">                component = new JLabel(</span>
<span class="nc" id="L581">                        Messages.getString(&quot;ClientGUI.StartingScenario&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L582">                main = &quot;JLabel-StartingScenario&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L583">                component.setName(main);</span>
<span class="nc" id="L584">                panMain.add(component, main);</span>
<span class="nc" id="L585">                break;</span>
            case PHASE_EXCHANGE:
<span class="nc" id="L587">                component = new JLabel(</span>
<span class="nc" id="L588">                        Messages.getString(&quot;ClientGUI.TransmittingData&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L589">                main = &quot;JLabel-Exchange&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L590">                component.setName(main);</span>
<span class="nc" id="L591">                panMain.add(component, main);</span>
<span class="nc" id="L592">                break;</span>
            case PHASE_SET_ARTYAUTOHITHEXES:
<span class="nc" id="L594">                component = new SelectArtyAutoHitHexDisplay(null);</span>
<span class="nc" id="L595">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L596">                secondary = &quot;SelectArtyAutoHitHexDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L597">                component.setName(secondary);</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L599">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L601">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L602">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L603">                break;</span>
            case PHASE_DEPLOY_MINEFIELDS:
<span class="nc" id="L605">                component = new DeployMinefieldDisplay(null);</span>
<span class="nc" id="L606">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L607">                secondary = &quot;DeployMinefieldDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L608">                component.setName(secondary);</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L610">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L612">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L613">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L614">                break;</span>
            case PHASE_DEPLOYMENT:
<span class="nc" id="L616">                component = new DeploymentDisplay(null);</span>
<span class="nc" id="L617">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L618">                secondary = &quot;DeploymentDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L619">                component.setName(secondary);</span>
<span class="nc bnc" id="L620" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L621">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L623">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L624">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L625">                break;</span>
            case PHASE_TARGETING:
<span class="nc" id="L627">                component = new TargetingPhaseDisplay(null, false);</span>
<span class="nc" id="L628">                ((TargetingPhaseDisplay) component).initializeListeners();</span>
<span class="nc" id="L629">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L630">                secondary = &quot;TargetingPhaseDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L631">                component.setName(secondary);</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L633">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L635">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L636">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L637">                break;</span>
            case PHASE_MOVEMENT:
<span class="nc" id="L639">                component = new MovementDisplay(null);</span>
<span class="nc" id="L640">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L641">                secondary = &quot;MovementDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L642">                component.setName(secondary);</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L644">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L646">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L647">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L648">                break;</span>
            case PHASE_OFFBOARD:
<span class="nc" id="L650">                component = new TargetingPhaseDisplay(null, true);</span>
<span class="nc" id="L651">                ((TargetingPhaseDisplay) component).initializeListeners();</span>
<span class="nc" id="L652">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L653">                secondary = &quot;OffboardDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L654">                component.setName(secondary);</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L656">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L658">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L659">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L660">                break;</span>
            case PHASE_FIRING:
<span class="nc" id="L662">                component = new FiringDisplay(null);</span>
<span class="nc" id="L663">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L664">                secondary = &quot;FiringDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L665">                component.setName(secondary);</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L667">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L669">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L670">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L671">                break;</span>
            case PHASE_PHYSICAL:
<span class="nc" id="L673">                component = new PhysicalDisplay(null);</span>
<span class="nc" id="L674">                main = &quot;BoardView&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L675">                secondary = &quot;PhysicalDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L676">                component.setName(secondary);</span>
<span class="nc bnc" id="L677" title="All 2 branches missed.">                if (!mainNames.containsValue(main)) {</span>
<span class="nc" id="L678">                    panMain.add(bvc, main);</span>
                }
<span class="nc" id="L680">                currPhaseDisplay = (StatusBarPhaseDisplay)(component);</span>
<span class="nc" id="L681">                panSecondary.add(component, secondary);</span>
<span class="nc" id="L682">                break;</span>
            case PHASE_INITIATIVE_REPORT:
<span class="nc" id="L684">                component = new ReportDisplay(null);</span>
<span class="nc" id="L685">                main = &quot;ReportDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L686">                component.setName(main);</span>
<span class="nc" id="L687">                panMain.add(main, component);</span>
<span class="nc" id="L688">                break;</span>
            case PHASE_TARGETING_REPORT:
            case PHASE_MOVEMENT_REPORT:
            case PHASE_OFFBOARD_REPORT:
            case PHASE_FIRING_REPORT:
            case PHASE_PHYSICAL_REPORT:
            case PHASE_END_REPORT:
            case PHASE_VICTORY:
                // Try to reuse the ReportDisplay for other phases...
<span class="nc" id="L697">                component = phaseComponents.get(String</span>
<span class="nc" id="L698">                        .valueOf(IGame.Phase.PHASE_INITIATIVE_REPORT));</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">                if (component == null) {</span>
                    // no ReportDisplay to reuse -- get a new one
<span class="nc" id="L701">                    component = initializePanel(</span>
                            IGame.Phase.PHASE_INITIATIVE_REPORT);
                }
<span class="nc" id="L704">                main = &quot;ReportDisplay&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L705">                break;</span>
            default:
<span class="nc" id="L707">                component = new JLabel(</span>
<span class="nc" id="L708">                        Messages.getString(&quot;ClientGUI.waitingOnTheServer&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L709">                main = &quot;JLabel-Default&quot;; //$NON-NLS-1$</span>
<span class="nc" id="L710">                secondary = main;</span>
<span class="nc" id="L711">                component.setName(main);</span>
<span class="nc" id="L712">                panMain.add(main, component);</span>
        }
<span class="nc" id="L714">        phaseComponents.put(name, component);</span>
<span class="nc" id="L715">        mainNames.put(name, main);</span>
<span class="nc bnc" id="L716" title="All 2 branches missed.">        if (secondary != null) {</span>
<span class="nc" id="L717">            secondaryNames.put(name, secondary);</span>
        }
<span class="nc" id="L719">        return component;</span>
    }

    /**
     * Sets the visibility of the entity display window
     */
    public void setDisplayVisible(boolean visible) {
<span class="nc" id="L726">        skinSpecEditorD.setVisible(visible);</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">        if (visible) {</span>
<span class="nc" id="L728">            frame.requestFocus();</span>
        }
<span class="nc" id="L730">    }</span>



    /**
     * Pops up a dialog box giving the player a series of choices that are not
     * mutually exclusive.
     *
     * @param title
     *            the &lt;code&gt;String&lt;/code&gt; title of the dialog box.
     * @param question
     *            the &lt;code&gt;String&lt;/code&gt; question that has a &quot;Yes&quot; or &quot;No&quot;
     *            answer. The question will be split across multiple line on the
     *            '\n' characters.
     * @param choices
     *            the array of &lt;code&gt;String&lt;/code&gt; choices that the player can
     *            select from.
     * @return The array of the &lt;code&gt;int&lt;/code&gt; indexes of the from the input
     *         array that match the selected choices. If no choices were
     *         available, if the player did not select a choice, or if the
     *         player canceled the choice, a &lt;code&gt;null&lt;/code&gt; value is
     *         returned.
     */
    public int[] doChoiceDialog(String title, String question, String[] choices) {
<span class="nc" id="L754">        ChoiceDialog choice = new ChoiceDialog(frame, title, question, choices);</span>
<span class="nc" id="L755">        choice.setVisible(true);</span>
<span class="nc" id="L756">        return choice.getChoices();</span>
    }

    /**
     * Pops up a dialog box showing an alert
     */
    public void doAlertDialog(String title, String message) {
<span class="nc" id="L763">        JTextPane textArea = new JTextPane();</span>
<span class="nc" id="L764">        ReportDisplay.setupStylesheet(textArea);</span>

<span class="nc" id="L766">        textArea.setEditable(false);</span>
<span class="nc" id="L767">        JScrollPane scrollPane = new JScrollPane(textArea,</span>
                ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED,
                ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<span class="nc" id="L770">        textArea.setText(&quot;&lt;pre&gt;&quot; + message + &quot;&lt;/pre&gt;&quot;);</span>
<span class="nc" id="L771">        scrollPane.setPreferredSize(new Dimension(</span>
<span class="nc" id="L772">                (int) (getSize().getWidth() / 1.5), (int) (getSize()</span>
<span class="nc" id="L773">                        .getHeight() / 1.5)));</span>
<span class="nc" id="L774">        JOptionPane.showMessageDialog(frame, scrollPane, title,</span>
                JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L776">    }</span>

    /**
     * Pops up a dialog box asking a yes/no question
     *
     * @param title
     *            the &lt;code&gt;String&lt;/code&gt; title of the dialog box.
     * @param question
     *            the &lt;code&gt;String&lt;/code&gt; question that has a &quot;Yes&quot; or &quot;No&quot;
     *            answer. The question will be split across multiple line on the
     *            '\n' characters.
     * @return &lt;code&gt;true&lt;/code&gt; if yes
     */
    public boolean doYesNoDialog(String title, String question) {
<span class="nc" id="L790">        ConfirmDialog confirm = new ConfirmDialog(frame, title, question);</span>
<span class="nc" id="L791">        confirm.setVisible(true);</span>
<span class="nc" id="L792">        return confirm.getAnswer();</span>
    }

    /**
     * Pops up a dialog box asking a yes/no question
     * &lt;p/&gt;
     * The player will be given a chance to not show the dialog again.
     *
     * @param title
     *            the &lt;code&gt;String&lt;/code&gt; title of the dialog box.
     * @param question
     *            the &lt;code&gt;String&lt;/code&gt; question that has a &quot;Yes&quot; or &quot;No&quot;
     *            answer. The question will be split across multiple line on the
     *            '\n' characters.
     * @return the &lt;code&gt;ConfirmDialog&lt;/code&gt; containing the player's responses.
     *         The dialog will already have been shown to the player, and is
     *         only being returned so the calling function can see the answer to
     *         the question and the state of the &quot;Show again?&quot; question.
     */
    public ConfirmDialog doYesNoBotherDialog(String title, String question) {
<span class="nc" id="L812">        ConfirmDialog confirm = new ConfirmDialog(frame, title, question, true);</span>
<span class="nc" id="L813">        confirm.setVisible(true);</span>
<span class="nc" id="L814">        return confirm;</span>
    }

    //
    // WindowListener
    //
    @Override
    public void windowActivated(WindowEvent windowEvent) {
        // TODO: this is a kludge to fix a window iconify issue
        // For some reason when I click on the window button, the main UI
        // window doesn't deiconify.  This fix doesn't allow me to iconify the
        // window by clicking the window button, but it's better than the
        // alternative
<span class="nc" id="L827">        frame.setState(Frame.NORMAL);</span>
<span class="nc" id="L828">    }</span>

    @Override
    public void windowClosed(WindowEvent windowEvent) {
        // ignored
<span class="nc" id="L833">    }</span>

    @Override
    public void windowClosing(WindowEvent windowEvent) {
<span class="nc bnc" id="L837" title="All 2 branches missed.">        if (windowEvent.getWindow().equals(skinSpecEditorD)) {</span>
<span class="nc" id="L838">            setDisplayVisible(false);</span>
<span class="nc" id="L839">            die();</span>
        }
<span class="nc" id="L841">    }</span>

    @Override
    public void windowDeactivated(WindowEvent windowEvent) {
        // ignored
<span class="nc" id="L846">    }</span>

    @Override
    public void windowDeiconified(WindowEvent windowEvent) {
        // TODO: this is a kludge to fix a window iconify issue
        // For some reason when I click on the window button, the main UI
        // window doesn't deiconify.  This fix doesn't allow me to iconify the
        // window by clicking the window button, but it's better than the
        // alternative
<span class="nc" id="L855">        frame.setState(Frame.NORMAL);</span>
<span class="nc" id="L856">    }</span>

    public void windowIconified(WindowEvent windowEvent) {
        // ignored
<span class="nc" id="L860">    }</span>

    public void windowOpened(WindowEvent windowEvent) {
        // ignored
<span class="nc" id="L864">    }</span>

    /**
     * @return the frame this client is displayed in
     */
    public JFrame getFrame() {
<span class="nc" id="L870">        return frame;</span>
    }

    public void loadPreviewImage(JLabel bp, Entity entity, IPlayer player) {
<span class="nc" id="L874">        final Camouflage camouflage = entity.getCamouflageOrElse(player.getCamouflage());</span>
<span class="nc" id="L875">        bp.setIcon(new ImageIcon(bv.getTilesetManager().loadPreviewImage(entity, camouflage, bp)));</span>
<span class="nc" id="L876">    }</span>

   
    @Override
    public void hexMoused(BoardViewEvent b) {
<span class="nc bnc" id="L881" title="All 2 branches missed.">        if (b.getType() == BoardViewEvent.BOARD_HEX_POPUP) {</span>
            
        }
<span class="nc" id="L884">    }</span>

    @Override
    public void hexCursor(BoardViewEvent b) {
        // ignored
<span class="nc" id="L889">    }</span>

    @Override
    public void boardHexHighlighted(BoardViewEvent b) {
        // ignored
<span class="nc" id="L894">    }</span>

    @Override
    public void hexSelected(BoardViewEvent b) {
        // ignored
<span class="nc" id="L899">    }</span>

    @Override
    public void firstLOSHex(BoardViewEvent b) {
        // ignored
<span class="nc" id="L904">    }</span>

    public void secondLOSHex(BoardViewEvent b, Coords c) {
        // ignored
<span class="nc" id="L908">    }</span>

    public void finishedMovingUnits(BoardViewEvent b) {
        // ignored
<span class="nc" id="L912">    }</span>

    public void unitSelected(BoardViewEvent b) {
        // ignored
<span class="nc" id="L916">    }</span>

    @Override
    public void componentHidden(ComponentEvent arg0) {
<span class="nc" id="L920">    }</span>

    @Override
    public void componentMoved(ComponentEvent arg0) {
<span class="nc" id="L924">    }</span>

    @Override
    public void componentResized(ComponentEvent arg0) {
<span class="nc" id="L928">        bv.setPreferredSize(getSize());</span>
<span class="nc" id="L929">    }</span>

    @Override
    public void componentShown(ComponentEvent arg0) {
<span class="nc" id="L933">    }</span>

    /**
     * Returns the panel for the current phase. The ClientGUI is split into the
     * main panel (view) at the top, which takes up the majority of the view and
     * the the &quot;current panel&quot; which has different controls based on the phase.
     * 
     * @return
     */
    public JComponent getCurrentPanel() {
<span class="nc" id="L943">        return curPanel;</span>
    }

    /**
     * Returns the 'virtual bounds' of the screen.  That is, the union of the
     * displayable space on all available screen devices.
     *
     * @return
     */
    private Rectangle getVirtualBounds() {
<span class="nc" id="L953">        Rectangle virtualBounds = new Rectangle();</span>
<span class="nc" id="L954">        GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
<span class="nc" id="L955">        GraphicsDevice[] gs = ge.getScreenDevices();</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">        for (GraphicsDevice gd : gs) {</span>
<span class="nc" id="L957">            GraphicsConfiguration[] gc = gd.getConfigurations();</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">            for (GraphicsConfiguration element : gc) {</span>
<span class="nc" id="L959">                virtualBounds = virtualBounds.union(element.getBounds());</span>
            }
        }
<span class="nc" id="L962">        return virtualBounds;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>