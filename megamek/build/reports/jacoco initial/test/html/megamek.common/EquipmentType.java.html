<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EquipmentType.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">EquipmentType.java</span></div><h1>EquipmentType.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2002,2003,2004 Ben Mazur (bmazur@sev.org)
 *
 * This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
 * A PARTICULAR PURPOSE. See the GNU General Public License for more details.
 */

/*
 * EquipmentType.java
 *
 * Created on April 1, 2002, 1:35 PM
 */

package megamek.common;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.math.BigInteger;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Vector;
import java.util.stream.Collectors;

import megamek.common.annotations.Nullable;
import megamek.common.options.GameOptions;
import megamek.common.weapons.autocannons.HVACWeapon;
import megamek.common.weapons.defensivepods.BPodWeapon;
import megamek.common.weapons.defensivepods.MPodWeapon;
import megamek.common.weapons.ppc.PPCWeapon;
import megamek.server.Server;

/**
 * Represents any type of equipment mounted on a mechs, excluding systems and
 * actuators.
 *
 * @author Ben
 * @version
 */
<span class="pc bpc" id="L48" title="1 of 2 branches missed.">public class EquipmentType implements ITechnology {</span>
    public static final double TONNAGE_VARIABLE = Float.MIN_VALUE;
    public static final int CRITICALS_VARIABLE = Integer.MIN_VALUE;
    public static final int BV_VARIABLE = Integer.MIN_VALUE;
    public static final int COST_VARIABLE = Integer.MIN_VALUE;
    /** Default value for support vehicle slot cost. Those that differ from mechs are assigned
     * a value &gt;= 0
     */
    private static final int MECH_SLOT_COST = -1;

    public static final int T_ARMOR_UNKNOWN = -1;
    public static final int T_ARMOR_STANDARD = 0;
    public static final int T_ARMOR_FERRO_FIBROUS = 1;
    public static final int T_ARMOR_REACTIVE = 2;
    public static final int T_ARMOR_REFLECTIVE = 3;
    public static final int T_ARMOR_HARDENED = 4;
    public static final int T_ARMOR_LIGHT_FERRO = 5;
    public static final int T_ARMOR_HEAVY_FERRO = 6;
    public static final int T_ARMOR_PATCHWORK = 7;
    public static final int T_ARMOR_STEALTH = 8;
    public static final int T_ARMOR_FERRO_FIBROUS_PROTO = 9;
    public static final int T_ARMOR_COMMERCIAL = 10;
    public static final int T_ARMOR_LC_FERRO_CARBIDE = 11;  //Large Craft Only
    public static final int T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE = 12; //Large Craft Only
    public static final int T_ARMOR_LC_FERRO_IMP = 13; //Large Craft Only
    public static final int T_ARMOR_INDUSTRIAL = 14;
    public static final int T_ARMOR_HEAVY_INDUSTRIAL = 15;
    public static final int T_ARMOR_FERRO_LAMELLOR = 16;
    public static final int T_ARMOR_PRIMITIVE = 17;
    public static final int T_ARMOR_EDP = 18;
    public static final int T_ARMOR_ALUM = 19;
    public static final int T_ARMOR_HEAVY_ALUM = 20;
    public static final int T_ARMOR_LIGHT_ALUM = 21;
    public static final int T_ARMOR_STEALTH_VEHICLE = 22;
    public static final int T_ARMOR_ANTI_PENETRATIVE_ABLATION = 23;
    public static final int T_ARMOR_HEAT_DISSIPATING = 24;
    public static final int T_ARMOR_IMPACT_RESISTANT = 25;
    public static final int T_ARMOR_BALLISTIC_REINFORCED = 26;
    public static final int T_ARMOR_FERRO_ALUM_PROTO = 27;
    public static final int T_ARMOR_BA_STANDARD = 28;
    public static final int T_ARMOR_BA_STANDARD_PROTOTYPE = 29;
    public static final int T_ARMOR_BA_STANDARD_ADVANCED = 30;
    public static final int T_ARMOR_BA_STEALTH_BASIC = 31;
    public static final int T_ARMOR_BA_STEALTH = 32;
    public static final int T_ARMOR_BA_STEALTH_IMP = 33;
    public static final int T_ARMOR_BA_STEALTH_PROTOTYPE = 34;
    public static final int T_ARMOR_BA_FIRE_RESIST = 35;
    public static final int T_ARMOR_BA_MIMETIC = 36;
    public static final int T_ARMOR_BA_REFLECTIVE = 37;
    public static final int T_ARMOR_BA_REACTIVE = 38;
    public static final int T_ARMOR_PRIMITIVE_FIGHTER = 39;
    public static final int T_ARMOR_PRIMITIVE_AERO = 40;
    public static final int T_ARMOR_AEROSPACE = 41;

    public static final int T_STRUCTURE_UNKNOWN = -1;
    public static final int T_STRUCTURE_STANDARD = 0;
    public static final int T_STRUCTURE_INDUSTRIAL = 1;
    public static final int T_STRUCTURE_ENDO_STEEL = 2;
    public static final int T_STRUCTURE_ENDO_PROTOTYPE = 3;
    public static final int T_STRUCTURE_REINFORCED = 4;
    public static final int T_STRUCTURE_COMPOSITE = 5;
    public static final int T_STRUCTURE_ENDO_COMPOSITE = 6;

<span class="fc" id="L111">    public static final String[] armorNames = { &quot;Standard&quot;, &quot;Ferro-Fibrous&quot;,</span>
            &quot;Reactive&quot;, &quot;Reflective&quot;, &quot;Hardened&quot;, &quot;Light Ferro-Fibrous&quot;,
            &quot;Heavy Ferro-Fibrous&quot;, &quot;Patchwork&quot;, &quot;Stealth&quot;,
            &quot;Ferro-Fibrous Prototype&quot;, &quot;Commercial&quot;, &quot;Ferro-Carbide&quot;,
            &quot;Lamellor Ferro-Carbide&quot;, &quot;Improved Ferro-Aluminum&quot;,
            /* extra space at the end on purpose */ &quot;Industrial &quot;,
            &quot;Heavy Industrial&quot;, &quot;Ferro-Lamellor&quot;, &quot;Primitive&quot;,
            &quot;Electric Discharge ProtoMech&quot;, &quot;Ferro-Aluminum&quot;,
            &quot;Heavy Ferro-Aluminum&quot;, &quot;Light Ferro-Aluminum&quot;,
            &quot;Vehicular Stealth&quot;, &quot;Anti-Penetrative Ablation&quot;,
            &quot;Heat-Dissipating&quot;, &quot;Impact-Resistant&quot;, &quot;Ballistic-Reinforced&quot;,
            &quot;Prototype Ferro-Aluminum&quot;, &quot;BA Standard (Basic)&quot;,
            &quot;BA Standard (Prototype)&quot;, &quot;BA Advanced&quot;, &quot;BA Stealth (Basic)&quot;,
            &quot;BA Stealth (Standard)&quot;, &quot;BA Stealth (Improved)&quot;, &quot;BA Stealth (Prototype)&quot;,
            &quot;BA Fire Resistant&quot;, &quot;BA Mimetic&quot;, &quot;BA Laser Reflective (Reflec/Glazed)&quot;, &quot;BA Reactive (Blazer)&quot;,
            &quot;Primitive Fighter&quot;, &quot;Primitive Aerospace&quot;, &quot;Standard Aerospace&quot;};


<span class="fc" id="L129">    public static final String[] structureNames = { &quot;Standard&quot;, &quot;Industrial&quot;,</span>
            &quot;Endo Steel&quot;, &quot;Endo Steel Prototype&quot;, &quot;Reinforced&quot;, &quot;Composite&quot;,
            &quot;Endo-Composite&quot; };

    // Assume for now that prototype is not more expensive
<span class="fc" id="L134">    public static final double[] structureCosts = { 400, 300, 1600, 4800, 6400,</span>
            1600, 3200 };

    // Assume for now that prototype is not more expensive
<span class="fc" id="L138">    public static final double[] armorCosts = {</span>
            10000, 20000, 30000, 30000, 15000, 15000, 25000, /* patchwork */0, 50000, 60000,
            3000, 75000, 100000, 50000, 5000, 10000, 35000, 5000, 10000, 20000,
            25000, 15000, 50000, 15000, 25000, 20000, 25000, 60000, 10000, 10000,
            12500, 12000, 15000, 20000, 50000, 10000, 15000, 37000, 37000, 5000,
            5000, 10000};

<span class="fc" id="L145">    public static final double[] armorPointMultipliers = {</span>
            1, 1.12, 1, 1, 0.5, 1.06, 1.24, 1, 1, 1.12,
            1.5, 1.52, 1.72, 1.32, 0.67, 1.0, 0.875, 0.67, 1, 1.12,
            1.24, 1.06, 1, 0.75, 0.625, 0.875, 0.75, 1.12, 0.8, 1.6,
            0.64, 0.48, 0.96, 0.96, 1.6, 0.48, 0.8, 0.88, 0.96, 0.67,
            0.66, 1 };

    public static final double POINT_MULTIPLIER_UNKNOWN = 1;
    public static final double POINT_MULTIPLIER_CLAN_FF = 1.2;
    public static final double POINT_ADDITION_CLAN_FF = 0.08;

<span class="fc" id="L156">    protected String name = null;</span>

    // Short name for RS Printing
<span class="fc" id="L159">    protected String shortName = &quot;&quot;;</span>

<span class="fc" id="L161">    protected String internalName = null;</span>

<span class="fc" id="L163">    private Vector&lt;String&gt; namesVector = new Vector&lt;String&gt;();</span>

<span class="fc" id="L165">    protected double tonnage = 0;</span>
<span class="fc" id="L166">    protected int criticals = 0;</span>
<span class="fc" id="L167">    protected int tankslots = 1;</span>
<span class="fc" id="L168">    protected int svslots = MECH_SLOT_COST;</span>

<span class="fc" id="L170">    protected boolean explosive = false;</span>
<span class="fc" id="L171">    protected boolean hittable = true; // if false, reroll critical hits</span>

    /** can the crits for this be spread over locations? */
<span class="fc" id="L174">    protected boolean spreadable = false;</span>
<span class="fc" id="L175">    protected int toHitModifier = 0;</span>

//    protected Map&lt;Integer,Integer&gt; techLevel = new HashMap&lt;&gt;();
    
<span class="fc" id="L179">    protected TechAdvancement techAdvancement = new TechAdvancement();</span>

<span class="fc" id="L181">    protected BigInteger flags = BigInteger.valueOf(0);</span>

<span class="fc" id="L183">    protected long subType = 0;</span>

<span class="fc" id="L185">    protected double bv = 0; // battle value point system</span>
<span class="fc" id="L186">    protected double cost = 0; // The C-Bill cost of the item.</span>

    // For equipment that cannot be pod-mounted on an omni unit
<span class="fc" id="L189">    protected boolean omniFixedOnly = false;</span>

    /**
     * what modes can this equipment be in?
     */
<span class="fc" id="L194">    protected Vector&lt;EquipmentMode&gt; modes = null;</span>

    /**
     * can modes be switched instantly, or at end of turn?
     */
<span class="fc" id="L199">    protected boolean instantModeSwitch = true;</span>
    /**
     * sometimes some modes can be switched at the end of turn and some
     * instantly In that case, the specific end of turn mode names can be added
     * here
     */
<span class="fc" id="L205">    public Vector&lt;String&gt; endTurnModes = new Vector&lt;String&gt;();</span>

    // static list of eq
    protected static Vector&lt;EquipmentType&gt; allTypes;
    protected static Hashtable&lt;String, EquipmentType&gt; lookupHash;
    
    /**
    * Keeps track of page numbers for rules references.
    */
<span class="fc" id="L214">    public String rulesRefs = &quot;&quot;;</span>

    /** Creates new EquipmentType */
<span class="fc" id="L217">    public EquipmentType() {</span>
        // default constructor
<span class="fc" id="L219">    }</span>

    public void setFlags(BigInteger inF) {
<span class="nc" id="L222">        flags = inF;</span>
<span class="nc" id="L223">    }</span>

    public long getSubType() {
<span class="nc" id="L226">        return subType;</span>
    }
    
    public void setSubType(int newFlags) {
<span class="nc" id="L230">        subType = newFlags;</span>
<span class="nc" id="L231">    }</span>

    public void addSubType(int newFlag) {
<span class="nc" id="L234">        subType |= newFlag;</span>
<span class="nc" id="L235">    }</span>

    public boolean hasSubType(long testFlag) {
<span class="nc bnc" id="L238" title="All 2 branches missed.">        return (subType &amp; testFlag) != 0;</span>
    }

    public String getName() {
<span class="fc" id="L242">        return name;</span>
    }

    public String getName(double size) {
<span class="fc" id="L246">        return getName();</span>
    }

    public String getDesc() {
<span class="nc" id="L250">        String result = EquipmentMessages.getString(&quot;EquipmentType.&quot; + name);</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">        if (result != null) {</span>
<span class="nc" id="L252">            return result;</span>
        }
<span class="nc" id="L254">        return name;</span>
    }

    public String getDesc(double size) {
<span class="nc" id="L258">        return getDesc();</span>
    }

    public String getInternalName() {
<span class="fc" id="L262">        return internalName;</span>
    }
    
    public String getRulesRefs() {
<span class="nc" id="L266">        return rulesRefs;</span>
    }

    /**
     * @deprecated The old tech progression system has been replaced by the TechAdvancement class.
     */
    @Deprecated
    public Map&lt;Integer, Integer&gt; getTechLevels() {
<span class="nc" id="L274">        Map&lt;Integer,Integer&gt; techLevel = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">        if (isUnofficial()) {</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            if (techAdvancement.getTechBase() == TECH_BASE_CLAN) {</span>
<span class="nc" id="L277">                techLevel.put(techAdvancement.getIntroductionDate(true), TechConstants.T_CLAN_UNOFFICIAL);</span>
            } else {
<span class="nc" id="L279">                techLevel.put(techAdvancement.getIntroductionDate(true), TechConstants.T_IS_UNOFFICIAL);</span>
            }
<span class="nc" id="L281">            return techLevel;</span>
        }
<span class="nc bnc" id="L283" title="All 2 branches missed.">        if (techAdvancement.getPrototypeDate(true) &gt; 0) {</span>
<span class="nc" id="L284">            techLevel.put(techAdvancement.getPrototypeDate(true), TechConstants.T_CLAN_EXPERIMENTAL);</span>
        }
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (techAdvancement.getPrototypeDate(false) &gt; 0) {</span>
<span class="nc" id="L287">            techLevel.put(techAdvancement.getPrototypeDate(false), TechConstants.T_IS_EXPERIMENTAL);</span>
        }
<span class="nc bnc" id="L289" title="All 2 branches missed.">        if (techAdvancement.getProductionDate(true) &gt; 0) {</span>
<span class="nc" id="L290">            techLevel.put(techAdvancement.getProductionDate(true), TechConstants.T_CLAN_ADVANCED);</span>
        }
<span class="nc bnc" id="L292" title="All 2 branches missed.">        if (techAdvancement.getProductionDate(false) &gt; 0) {</span>
<span class="nc" id="L293">            techLevel.put(techAdvancement.getProductionDate(false), TechConstants.T_IS_ADVANCED);</span>
        }
<span class="nc bnc" id="L295" title="All 2 branches missed.">        if (techAdvancement.getTechBase() == TECH_BASE_ALL</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">                &amp;&amp; techAdvancement.getCommonDate() &gt; 0) {</span>
<span class="nc" id="L297">            techLevel.put(techAdvancement.getCommonDate(true), TechConstants.T_TW_ALL);</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        } else if (techAdvancement.getCommonDate(true) &gt; 0) {</span>
<span class="nc" id="L299">            techLevel.put(techAdvancement.getCommonDate(true), TechConstants.T_CLAN_TW);</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">        } else if (techAdvancement.getCommonDate(false) &gt; 0) {</span>
<span class="nc" id="L301">            techLevel.put(techAdvancement.getCommonDate(false),</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">                    isIntroLevel()? TechConstants.T_INTRO_BOXSET : TechConstants.T_IS_TW_NON_BOX);</span>
        }
<span class="nc" id="L304">        return techLevel;</span>
    }

    public int getTechLevel(int date) {
<span class="fc" id="L308">        return techAdvancement.getTechLevel(date);</span>
    }
    
    public int getTechLevel(int date, boolean clan) {
<span class="nc" id="L312">        return techAdvancement.getTechLevel(date, clan);</span>
    }
    
    public SimpleTechLevel getStaticTechLevel() {
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">        if (null != techAdvancement.getStaticTechLevel()) {</span>
<span class="fc" id="L317">            return techAdvancement.getStaticTechLevel();</span>
        } else {
<span class="nc" id="L319">            return techAdvancement.guessStaticTechLevel(rulesRefs);</span>
        }
    }

    /**
     * Calculates the weight of the equipment. If {@code entity} is {@code null}, equipment without
     * a fixed weight will return {@link EquipmentType#TONNAGE_VARIABLE}.
     *
     * @param entity The unit the equipment is mounted on
     * @return       The weight of the equipment in tons
     */
    public double getTonnage(@Nullable Entity entity) {
<span class="fc" id="L331">        return getTonnage(entity, Entity.LOC_NONE, 1.0);</span>
    }

    /**
     * Calculates the weight of the equipment. If {@code entity} is {@code null}, equipment without
     * a fixed weight will return {@link EquipmentType#TONNAGE_VARIABLE}.
     *
     * @param entity The unit the equipment is mounted on
     * @param size   The size of variable-sized equipment
     * @return       The weight of the equipment in tons
     */
    public double getTonnage(@Nullable Entity entity, double size) {
<span class="nc" id="L343">        return getTonnage(entity, Entity.LOC_NONE, size);</span>
    }

    /**
     * Calculates the weight of the equipment. If {@code entity} is {@code null}, equipment without
     * a fixed weight will return {@link EquipmentType#TONNAGE_VARIABLE}.
     *
     * @param entity   The unit the equipment is mounted on
     * @param location The mount location
     * @param size     The size (for variable-sized equipment)
     * @return         The weight of the equipment in tons
     */
    public double getTonnage(Entity entity, int location, double size) {
<span class="fc" id="L356">        return tonnage;</span>
    }

    /**
     * Calculates the weight of the equipment, with the option to override the standard rounding based on unit
     * type. This allows for the optional fractional accounting construction rules.
     * If {@code entity} is {@code null}, equipment without a fixed weight will
     * return {@link EquipmentType#TONNAGE_VARIABLE}.
     *
     * @param entity        The unit the equipment is mounted on
     * @param location      The mount location
     * @param size          The size (for variable-sized equipment)
     * @param defaultMethod The rounding method to use for any variable weight equipment. Any equipment
     *                      that is normally rounded to either the half ton or kg based on unit type
     *                      will have this method applied instead.
     * @return              The weight of the equipment in tons
     */
    public double getTonnage(Entity entity, int location, double size, RoundWeight defaultMethod) {
        // Default implementation does not deal with variable-weight equipment.
<span class="fc" id="L375">        return getTonnage(entity, location, size);</span>
    }

    void setTonnage(double tonnage) {
<span class="fc" id="L379">        this.tonnage = tonnage;</span>
<span class="fc" id="L380">    }</span>

    public int getCriticals(Entity entity) {
<span class="fc" id="L383">        return getCriticals(entity, 1.0);</span>
    }

    public int getCriticals(Entity entity, double size) {
<span class="fc" id="L387">        return criticals;</span>
    }

    public int getTankSlots(Entity entity) {
<span class="nc" id="L391">        return tankslots;</span>
    }

    public int getSupportVeeSlots(Entity entity) {
<span class="nc bnc" id="L395" title="All 2 branches missed.">        if (svslots == MECH_SLOT_COST) {</span>
<span class="nc" id="L396">            return getCriticals(entity);</span>
        }
<span class="nc" id="L398">        return svslots;</span>
    }

    public boolean isExplosive(Mounted mounted) {
<span class="nc" id="L402">        return isExplosive(mounted, false);</span>
    }

    public boolean isExplosive(Mounted mounted, boolean ignoreCharge) {
<span class="nc bnc" id="L406" title="All 2 branches missed.">        if(null == mounted) {</span>
<span class="nc" id="L407">            return explosive;</span>
        }
        
        // Special case: discharged M- and B-pods shouldn't explode.
<span class="nc bnc" id="L411" title="All 4 branches missed.">        if (((this instanceof MPodWeapon) || (this instanceof BPodWeapon))</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                &amp;&amp; ((mounted.getLinked() == null) || (mounted.getLinked()</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">                        .getUsableShotsLeft() == 0))) {</span>
<span class="nc" id="L414">            return false;</span>
        }


        // special case: RISC laser pulse module are only explosive when the
        // laser they're linked to is working
<span class="nc bnc" id="L420" title="All 4 branches missed.">        if ((mounted.getType() instanceof MiscType) &amp;&amp; mounted.getType().hasFlag(MiscType.F_RISC_LASER_PULSE_MODULE)) {</span>
<span class="nc bnc" id="L421" title="All 4 branches missed.">            if ((mounted.getLinked() == null) || mounted.getLinked().isInoperable()) {</span>
<span class="nc" id="L422">                return false;</span>
            }
        }

        // special-case. RACs only explode when jammed
<span class="nc bnc" id="L427" title="All 2 branches missed.">        if ((mounted.getType() instanceof WeaponType)</span>
<span class="nc bnc" id="L428" title="All 2 branches missed.">                &amp;&amp; (((WeaponType) mounted.getType()).getAmmoType() == AmmoType.T_AC_ROTARY)) {</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">            if (!mounted.isJammed()) {</span>
<span class="nc" id="L430">                return false;</span>
            }
        }

        // special case. ACs only explode when firing incendiary ammo
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if ((mounted.getType() instanceof WeaponType)</span>
<span class="nc bnc" id="L436" title="All 2 branches missed.">                &amp;&amp; ((((WeaponType) mounted.getType()).getAmmoType() == AmmoType.T_AC)</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                        || (((WeaponType) mounted.getType()).getAmmoType() == AmmoType.T_LAC)</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">                        || (((WeaponType) mounted.getType()).getAmmoType() == AmmoType.T_AC_IMP)</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">                        || (((WeaponType) mounted.getType()).getAmmoType() == AmmoType.T_PAC))) {</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">            if (!mounted.isUsedThisRound()) {</span>
<span class="nc" id="L441">                return false;</span>
            }
<span class="nc" id="L443">            Mounted ammo = mounted.getLinked();</span>
<span class="nc bnc" id="L444" title="All 4 branches missed.">            if ((ammo == null) || !(ammo.getType() instanceof AmmoType)</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">                    || (((AmmoType) ammo.getType()).getMunitionType() != AmmoType.M_INCENDIARY_AC)) {</span>
<span class="nc" id="L446">                return false;</span>
            }
        }

        // special case. HVACs only explode when there's ammo left
<span class="nc bnc" id="L451" title="All 2 branches missed.">        if (mounted.getType() instanceof HVACWeapon) {</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">            if ((mounted.getEntity() == null)</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                    || (mounted.getLinked() == null)</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">                    || (mounted.getEntity().getTotalAmmoOfType(</span>
<span class="nc" id="L455">                            mounted.getLinked().getType()) == 0)) {</span>
<span class="nc" id="L456">                return false;</span>
            }
        }

        // special case. Blue Shield Particle Field Damper only explodes when
        // switched on
<span class="nc bnc" id="L462" title="All 2 branches missed.">        if ((mounted.getType() instanceof MiscType)</span>
<span class="nc bnc" id="L463" title="All 2 branches missed.">                &amp;&amp; (mounted.getType().hasFlag(MiscType.F_BLUE_SHIELD) &amp;&amp; mounted</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">                        .curMode().equals(&quot;Off&quot;))) {</span>
<span class="nc" id="L465">            return false;</span>
        }

        // special case. PPC with Capacitor only explodes when charged
<span class="nc bnc" id="L469" title="All 2 branches missed.">        if (ignoreCharge) {</span>
            // for BV purposes, we need to ignore the chargedness and check only
            // if there's a capacitor
<span class="nc bnc" id="L472" title="All 2 branches missed.">            if ((mounted.getType() instanceof PPCWeapon)</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">                    &amp;&amp; (mounted.getLinkedBy() != null)) {</span>
<span class="nc" id="L474">                return true;</span>
            }
<span class="nc bnc" id="L476" title="All 2 branches missed.">            if ((mounted.getType() instanceof MiscType)</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">                    &amp;&amp; mounted.getType().hasFlag(MiscType.F_PPC_CAPACITOR)</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">                    &amp;&amp; (mounted.getLinked() != null)) {</span>
<span class="nc" id="L479">                return true;</span>
            }

        }
<span class="nc bnc" id="L483" title="All 2 branches missed.">        if ((mounted.getType() instanceof MiscType)</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                &amp;&amp; mounted.getType().hasFlag(MiscType.F_PPC_CAPACITOR)</span>
<span class="nc bnc" id="L485" title="All 2 branches missed.">                &amp;&amp; !mounted.curMode().equals(&quot;Charge&quot;)) {</span>
<span class="nc" id="L486">            return false;</span>
        }
<span class="nc bnc" id="L488" title="All 2 branches missed.">        if ((mounted.getType() instanceof PPCWeapon)</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">                &amp;&amp; (mounted.hasChargedCapacitor() == 0)) {</span>
<span class="nc" id="L490">            return false;</span>
        }

        // If we're here, then none of the special cases apply and we should
        // just return our own explosive status.
<span class="nc" id="L495">        return explosive;</span>
    }

    public boolean isHittable() {
<span class="fc" id="L499">        return hittable;</span>
    }

    // like margarine!
    public boolean isSpreadable() {
<span class="fc" id="L504">        return spreadable;</span>
    }

    public int getToHitModifier() {
<span class="nc" id="L508">        return toHitModifier;</span>
    }

    public BigInteger getFlags() {
<span class="nc" id="L512">        return flags;</span>
    }

    public boolean hasFlag(BigInteger flag) {
<span class="fc bfc" id="L516" title="All 2 branches covered.">        return !(flags.and(flag)).equals(BigInteger.valueOf(0));</span>
    }

    public double getBV(Entity entity) {
<span class="nc" id="L520">        return bv;</span>
    }

    /**
     * @return - whether the equipment must be considered part of the base chassis when
     *           mounted on an omni unit
     */
    public boolean isOmniFixedOnly() {
<span class="nc" id="L528">        return omniFixedOnly;</span>
    }

    /**
     * @return &lt;code&gt;true&lt;/code&gt; if this type of equipment has set of modes that
     *         it can be in.
     */
    public boolean hasModes() {
<span class="pc bpc" id="L536" title="1 of 4 branches missed.">        return (modes != null) &amp;&amp; (!modes.isEmpty());</span>
    }
    
    /**
     * Simple way to check if a piece of equipment has a specific usage/firing mode
     * @param modeType The name of the mode to check.
     * @return True or false.
     */
    public boolean hasModeType(String modeType) {
<span class="nc bnc" id="L545" title="All 2 branches missed.">    	if(!hasModes()) {</span>
<span class="nc" id="L546">    		return false;</span>
    	}
    	
<span class="nc bnc" id="L549" title="All 2 branches missed.">    	for(EquipmentMode mode : modes) {</span>
<span class="nc bnc" id="L550" title="All 2 branches missed.">    		if(mode.getName().equals(modeType)) {</span>
<span class="nc" id="L551">    			return true;</span>
    		}
<span class="nc" id="L553">    	}</span>
    	
<span class="nc" id="L555">    	return false;</span>
    }

    /**
     * @return the number of modes that this type of equipment can be in or
     *         &lt;code&gt;0&lt;/code&gt; if it doesn't have modes.
     */
    public int getModesCount() {
<span class="pc bpc" id="L563" title="1 of 2 branches missed.">        if (modes != null) {</span>
<span class="fc" id="L564">            return modes.size();</span>
        }
<span class="nc" id="L566">        return 0;</span>
    }

    /**
     * @return &lt;code&gt;Enumeration&lt;/code&gt; of the &lt;code&gt;EquipmentMode&lt;/code&gt; that
     *         this type of equipment can be in
     */
    public Enumeration&lt;EquipmentMode&gt; getModes() {
<span class="nc bnc" id="L574" title="All 2 branches missed.">        if (modes != null) {</span>
<span class="nc" id="L575">            return modes.elements();</span>
        }

<span class="nc" id="L578">        return new Enumeration&lt;EquipmentMode&gt;() {</span>
            public boolean hasMoreElements() {
<span class="nc" id="L580">                return false;</span>
            }

            public EquipmentMode nextElement() {
<span class="nc" id="L584">                return null;</span>
            }

        };
    }

    /**
     * Sets the modes that this type of equipment can be in. By default the
     * EquipmentType doesn't have the modes, so don't try to call this method
     * with null or empty argument.
     *
     * @param modes
     *            non null, non empty list of available mode names.
     */
    protected void setModes(String[] modes) {
<span class="pc bpc" id="L599" title="3 of 6 branches missed.">        assert ((modes != null) &amp;&amp; (modes.length &gt; 0)) : &quot;List of modes must not be null or empty&quot;;</span>
<span class="fc" id="L600">        Vector&lt;EquipmentMode&gt; newModes = new Vector&lt;EquipmentMode&gt;(modes.length);</span>
<span class="fc bfc" id="L601" title="All 2 branches covered.">        for (String mode : modes) {</span>
<span class="fc" id="L602">            newModes.addElement(EquipmentMode.getMode(mode));</span>
        }
<span class="fc" id="L604">        this.modes = newModes;</span>
<span class="fc" id="L605">    }</span>

    /**
     * Remove a specific mode from the list of modes.
     *
     * @param mode
     * @return
     */
    public boolean removeMode(String mode) {
<span class="pc bpc" id="L614" title="1 of 2 branches missed.">        if (modes != null) {</span>
<span class="nc" id="L615">            return modes.remove(EquipmentMode.getMode(mode));</span>
        } else {
<span class="fc" id="L617">            return false;</span>
        }
    }
    
    /**
     * Add a mode to the Equipment
     *
     * @param mode The mode to be added
     * @return true if the mode was added; false if modes was null or the mode was already present
     * @author Simon (Juliez)
     */
    public boolean addMode(String mode) {
<span class="nc bnc" id="L629" title="All 2 branches missed.">        if (modes == null) {</span>
<span class="nc" id="L630">            modes = new Vector&lt;EquipmentMode&gt;();</span>
        }
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (!modes.contains(EquipmentMode.getMode(mode))) {</span>
<span class="nc" id="L633">            return modes.add(EquipmentMode.getMode(mode));</span>
        } else {
<span class="nc" id="L635">            return false;</span>
        }
    }

    /**
     * Clears the modes that this type of equipment can be in. This is useful
     * where a subtype such as Streak LRMs has no modes, but the supertype of
     * that type such as standard LRMs has modes that do not apply to the
     * subtype
     */
    protected void clearModes() {
<span class="fc" id="L646">        modes = null;</span>
<span class="fc" id="L647">    }</span>

    public void addEndTurnMode(String mode) {
<span class="nc" id="L650">        endTurnModes.add(mode);</span>
<span class="nc" id="L651">    }</span>

    /**
     * Some equipment types might have both instant and next turn mode
     * switching. This method checks for end of turn modes that are kept in a
     * vector of names. It is used by the {@link Mounted#setMode(int)} method to
     * distinguish instant and end of turn switching.
     *
     * @param mode
     *            - the &lt;code&gt;String&lt;/code&gt; of the mode name involved in the
     *            switch
     * @return true if the mode name is found in the next turn mode vector
     */
    public boolean isNextTurnModeSwitch(String mode) {
<span class="nc bnc" id="L665" title="All 2 branches missed.">        for (String modeName : endTurnModes) {</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">            if (modeName.equals(mode)) {</span>
<span class="nc" id="L667">                return true;</span>
            }
<span class="nc" id="L669">        }</span>
<span class="nc" id="L670">        return false;</span>
    }

    /**
     * &lt;p&gt;
     * Returns the mode number &lt;code&gt;modeNum&lt;/code&gt; from the list of modes
     * available for this type of equipment. Modes are numbered from
     * &lt;code&gt;0&lt;code&gt; to
     * &lt;code&gt;getModesCount()-1&lt;/code&gt;
     * &lt;p&gt;
     * Fails if this type of the equipment doesn't have modes, or given mode is
     * out of the valid range.
     *
     * @param modeNum
     * @return mode number &lt;code&gt;modeNum&lt;/code&gt; from the list of modes available
     *         for this type of equipment.
     * @see #hasModes()
     */
    public EquipmentMode getMode(int modeNum) {
<span class="pc bpc" id="L689" title="4 of 8 branches missed.">        assert ((modes != null) &amp;&amp; (modeNum &gt;= 0) &amp;&amp; (modeNum &lt; modes.size())) : &quot;Invalid Mode&quot;;</span>
<span class="fc" id="L690">        return modes.elementAt(modeNum);</span>
    }

    public void setInstantModeSwitch(boolean b) {
<span class="fc" id="L694">        instantModeSwitch = b;</span>
<span class="fc" id="L695">    }</span>

    public boolean hasInstantModeSwitch() {
<span class="fc" id="L698">        return instantModeSwitch;</span>
    }

    public void setInternalName(String s) {
<span class="fc" id="L702">        internalName = s;</span>
<span class="fc" id="L703">        addLookupName(s);</span>
<span class="fc" id="L704">    }</span>

    public void addLookupName(String s) {
<span class="fc" id="L707">        EquipmentType.lookupHash.put(s.toLowerCase(), this); // static variable</span>
<span class="fc" id="L708">        namesVector.addElement(s); // member variable</span>
<span class="fc" id="L709">    }</span>

    public static EquipmentType get(String key) {
<span class="fc bfc" id="L712" title="All 2 branches covered.">        if (null == EquipmentType.lookupHash) {</span>
<span class="fc" id="L713">            EquipmentType.initializeTypes();</span>
        }
<span class="fc" id="L715">        return EquipmentType.lookupHash.get(key.toLowerCase());</span>
    }

    public Enumeration&lt;String&gt; getNames() {
<span class="fc" id="L719">        return namesVector.elements();</span>
    }

    public static void initializeTypes() {
<span class="pc bpc" id="L723" title="1 of 2 branches missed.">        if (null == EquipmentType.allTypes) {</span>
<span class="fc" id="L724">            EquipmentType.allTypes = new Vector&lt;EquipmentType&gt;();</span>
<span class="fc" id="L725">            EquipmentType.lookupHash = new Hashtable&lt;String, EquipmentType&gt;();</span>

<span class="fc" id="L727">            WeaponType.initializeTypes();</span>
<span class="fc" id="L728">            AmmoType.initializeTypes();</span>
<span class="fc" id="L729">            MiscType.initializeTypes();</span>
<span class="fc" id="L730">            BombType.initializeTypes();</span>
<span class="fc" id="L731">            SmallWeaponAmmoType.initializeTypes();</span>
<span class="fc bfc" id="L732" title="All 2 branches covered.">            for (EquipmentType et : allTypes) {</span>
<span class="pc bpc" id="L733" title="1 of 2 branches missed.">                if (et.getTechAdvancement().getStaticTechLevel() == null) {</span>
<span class="nc" id="L734">                    et.getTechAdvancement().setStaticTechLevel(et.getTechAdvancement()</span>
<span class="nc" id="L735">                            .guessStaticTechLevel(et.getRulesRefs()));</span>
                }
<span class="fc" id="L737">            }</span>
        }
<span class="fc" id="L739">    }</span>

    public static Enumeration&lt;EquipmentType&gt; getAllTypes() {
<span class="pc bpc" id="L742" title="1 of 2 branches missed.">        if (null == EquipmentType.allTypes) {</span>
<span class="nc" id="L743">            EquipmentType.initializeTypes();</span>
        }
<span class="fc" id="L745">        return EquipmentType.allTypes.elements();</span>
    }

    protected static void addType(EquipmentType type) {
<span class="pc bpc" id="L749" title="1 of 2 branches missed.">        if (null == EquipmentType.allTypes) {</span>
<span class="nc" id="L750">            EquipmentType.initializeTypes();</span>
        }
<span class="fc" id="L752">        EquipmentType.allTypes.addElement(type);</span>
<span class="fc" id="L753">    }</span>

    public static int getArmorType(EquipmentType et) {
<span class="pc bpc" id="L756" title="1 of 2 branches missed.">        if (null == et) {</span>
<span class="nc" id="L757">            return T_ARMOR_UNKNOWN;</span>
        }
<span class="pc bpc" id="L759" title="1 of 2 branches missed.">        for (int x = 0; x &lt; armorNames.length; x++) {</span>
            // Some armor names (Industrial), have a space in the name, so trim
<span class="fc bfc" id="L761" title="All 2 branches covered.">            if (armorNames[x].trim().equals(et.getName().trim())) {</span>
<span class="fc" id="L762">                return x;</span>
            }
        }
<span class="nc" id="L765">        return T_ARMOR_UNKNOWN;</span>
    }

    public static String getArmorTypeName(int armorType) {
<span class="pc bpc" id="L769" title="1 of 4 branches missed.">        if ((armorType &lt; 0) || (armorType &gt;= armorNames.length)) {</span>
<span class="fc" id="L770">            return &quot;UNKNOWN&quot;;</span>
        }
<span class="fc" id="L772">        return armorNames[armorType];</span>
    }

    public static String getArmorTypeName(int armorType, boolean clan) {
<span class="pc bpc" id="L776" title="1 of 4 branches missed.">        if ((armorType &lt; 0) || (armorType &gt;= armorNames.length)) {</span>
<span class="fc" id="L777">            return &quot;UNKNOWN&quot;;</span>
        }
<span class="fc bfc" id="L779" title="All 2 branches covered.">        return clan ? &quot;Clan &quot; + armorNames[armorType] : &quot;IS &quot;</span>
<span class="fc" id="L780">                + armorNames[armorType];</span>
    }

    /**
     * Convenience method to test whether an EquipmentType instance is armor. This works
     * by comparing the results of {@link #getName()} to the armor names array and returning
     * {@code true} if there is a match.
     *
     * @param et The equipment instance to test
     * @return   Whether the equipment is an armor type
     */
    public static boolean isArmorType(EquipmentType et) {
<span class="nc bnc" id="L792" title="All 2 branches missed.">        return getArmorType(et) != T_ARMOR_UNKNOWN;</span>
    }
    
    public static int getStructureType(EquipmentType et) {
<span class="fc bfc" id="L796" title="All 2 branches covered.">        if (et == null) {</span>
<span class="fc" id="L797">            return T_STRUCTURE_UNKNOWN;</span>
        }
<span class="pc bpc" id="L799" title="1 of 2 branches missed.">        for (int x = 0; x &lt; structureNames.length; x++) {</span>
<span class="pc bpc" id="L800" title="1 of 2 branches missed.">            if (structureNames[x].equals(et.getName())) {</span>
<span class="fc" id="L801">                return x;</span>
            }
        }
<span class="nc" id="L804">        return T_STRUCTURE_UNKNOWN;</span>
    }

    public static String getStructureTypeName(int structureType) {
<span class="pc bpc" id="L808" title="2 of 4 branches missed.">        if ((structureType &lt; 0) || (structureType &gt;= structureNames.length)) {</span>
<span class="nc" id="L809">            return &quot;UNKNOWN&quot;;</span>
        }
<span class="fc" id="L811">        return structureNames[structureType];</span>
    }

    public static String getStructureTypeName(int structureType, boolean clan) {
<span class="pc bpc" id="L815" title="1 of 4 branches missed.">        if ((structureType &lt; 0) || (structureType &gt;= structureNames.length)) {</span>
<span class="fc" id="L816">            return &quot;UNKNOWN&quot;;</span>
        }
<span class="fc bfc" id="L818" title="All 2 branches covered.">        return clan ? &quot;Clan &quot; + structureNames[structureType] : &quot;IS &quot;</span>
<span class="fc" id="L819">                + structureNames[structureType];</span>
    }

    /**
     * Convenience method to test whether an EquipmentType instance is mech structure. This works
     * by comparing the results of {@link #getName()} to the structure names array and returning
     * {@code true} if there is a match.
     *
     * @param et The equipment instance to test
     * @return   Whether the equipment is a structure type
     */
    public static boolean isStructureType(EquipmentType et) {
<span class="nc bnc" id="L831" title="All 2 branches missed.">        return getStructureType(et) != T_STRUCTURE_UNKNOWN;</span>
    }

    public static String getBaArmorTypeName(int armorType) {
<span class="nc" id="L835">        return getArmorTypeName(armorType);</span>
    }

    public static String getBaArmorTypeName(int armorType, boolean clan) {
<span class="nc" id="L839">        return getArmorTypeName(armorType, clan);</span>
    }

    public static double getBaArmorWeightPerPoint(int type, boolean isClan) {
<span class="nc bnc" id="L843" title="All 11 branches missed.">        switch (type) {</span>
        case T_ARMOR_BA_STANDARD_PROTOTYPE:
<span class="nc" id="L845">            return 0.1;</span>
        case T_ARMOR_BA_STANDARD_ADVANCED:
<span class="nc" id="L847">            return 0.04;</span>
        case T_ARMOR_BA_STEALTH:
<span class="nc bnc" id="L849" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L850">                return 0.035;</span>
            }
<span class="nc" id="L852">            return 0.06;</span>
        case T_ARMOR_BA_STEALTH_BASIC:
<span class="nc bnc" id="L854" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L855">                return 0.03;</span>
            }
<span class="nc" id="L857">            return 0.055;</span>
        case T_ARMOR_BA_STEALTH_IMP:
<span class="nc bnc" id="L859" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L860">                return 0.035;</span>
            }
<span class="nc" id="L862">            return 0.06;</span>
        case T_ARMOR_BA_STEALTH_PROTOTYPE:
<span class="nc" id="L864">            return 0.1;</span>
        case T_ARMOR_BA_FIRE_RESIST:
<span class="nc" id="L866">            return 0.03;</span>
        case T_ARMOR_BA_MIMETIC:
<span class="nc" id="L868">            return 0.05;</span>
        case T_ARMOR_BA_REFLECTIVE:
<span class="nc bnc" id="L870" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L871">                return 0.03;</span>
            } else {
<span class="nc" id="L873">                return 0.055;</span>
            }
        case T_ARMOR_BA_REACTIVE:
<span class="nc bnc" id="L876" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L877">                return 0.035;</span>
            } else {
<span class="nc" id="L879">                return 0.06;</span>
            }
        case T_ARMOR_BA_STANDARD:
        default:
<span class="nc bnc" id="L883" title="All 2 branches missed.">            if (isClan) {</span>
<span class="nc" id="L884">                return 0.025;</span>
            }
<span class="nc" id="L886">            return 0.05;</span>
        }
    }
    
    /**
     * Computes protomech armor weight by point.
     *  
     * @param type    The armor type
     * @return        The weight of a point of armor in kg
     */
    public static double getProtomechArmorWeightPerPoint(int type) {
<span class="nc bnc" id="L897" title="All 2 branches missed.">        if (type == T_ARMOR_EDP) {</span>
<span class="nc" id="L898">            return 0.075;</span>
        }
<span class="nc" id="L900">        return 0.05;</span>
    }

    /**
     * Lookup method for protomech armor cost
     * @param type The type of armor.
     * @return     The cost per point in C-bills
     */
    public static int getProtomechArmorCostPerPoint(int type) {
        // currently only one type of specialized armor for protomechs; anything else is treated as standard
<span class="nc bnc" id="L910" title="All 2 branches missed.">        if (type == T_ARMOR_EDP) {</span>
<span class="nc" id="L911">            return 1250;</span>
        }
<span class="nc" id="L913">        return 625;</span>
    }

    /**
     * Gives the weight of a single point of armor at a particular BAR for a
     * given tech level.
     */
<span class="fc" id="L920">    private static final double[][] SV_ARMOR_WEIGHT =</span>
            {{0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
                    {0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
                    {.040, .025, .016, .013, .012, .011},
                    {.060, .038, .024, .019, .017, .016},
                    {.000, .050, .032, .026, .023, .021},
                    {.000, .063, .040, .032, .028, .026},
                    {.000, .000, .048, .038, .034, .032},
                    {.000, .000, .056, .045, .040, .037},
                    {.000, .000, .000, .051, .045, .042},
                    {.000, .000, .000, .057, .051, .047},
                    {.000, .000, .000, .063, .056, .052}};

    /**
     * `Lookup method for the weight of a point of support vehicle armor.
     *
     * @param bar        The armor's barrier armor rating
     * @param techRating The armor's tech rating (0-5 corresponds to A-F)
     * @return           The weight of a point of armor in tons. Returns 0.0 for invalid value.
     */
    public static double getSupportVehicleArmorWeightPerPoint(int bar, int techRating) {
<span class="nc bnc" id="L941" title="All 8 branches missed.">        if ((bar &gt;= 0) &amp;&amp; (techRating &gt;= 0)</span>
                &amp;&amp; (bar &lt; SV_ARMOR_WEIGHT.length) &amp;&amp; (techRating &lt; SV_ARMOR_WEIGHT[bar].length)) {
<span class="nc" id="L943">            return SV_ARMOR_WEIGHT[bar][techRating];</span>
        }
<span class="nc" id="L945">        return 0.0;</span>
    }

    /**
     * Cost in C-bills of a single point of SV armor for various BAR values.
     */
<span class="fc" id="L951">    private static int[] SV_ARMOR_COST = {</span>
            0, 0, 50, 100, 150, 200, 250, 300, 400, 500, 625
    };

    /**
     * Cost lookup for standard SV armor.
     *
     * @param bar The barrier armor rating of the support vehicle armor
     * @return    The cost per point, in C-bills.
     */
    public static double getSupportVehicleArmorCostPerPoint(int bar) {
<span class="nc bnc" id="L962" title="All 2 branches missed.">        if (bar &lt; 0) {</span>
<span class="nc" id="L963">            return 0;</span>
        }
<span class="nc" id="L965">        return SV_ARMOR_COST[Math.min(bar, SV_ARMOR_COST.length - 1)];</span>
    }
    
    /* Armor and structure are stored as integers and standard uses a generic MiscType that
     * does not have its own TechAdvancement.
     */

<span class="fc" id="L972">    protected static final TechAdvancement TA_STANDARD_ARMOR = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L973">            .setAdvancement(2460, 2470, 2470).setApproximate(true, false, false)</span>
<span class="fc" id="L974">            .setTechRating(RATING_D).setAvailability(RATING_C, RATING_C, RATING_C, RATING_B)</span>
<span class="fc" id="L975">            .setStaticTechLevel(SimpleTechLevel.INTRO);</span>
<span class="fc" id="L976">    protected static final TechAdvancement TA_STANDARD_STRUCTURE = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L977">            .setAdvancement(2430, 2439, 2505).setApproximate(true, false, false).setIntroLevel(true)</span>
<span class="fc" id="L978">            .setTechRating(RATING_D).setAvailability(RATING_C, RATING_C, RATING_C, RATING_C)</span>
<span class="fc" id="L979">            .setStaticTechLevel(SimpleTechLevel.INTRO);</span>
<span class="fc" id="L980">    protected static final TechAdvancement TA_NONE = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L981">            .setAdvancement(DATE_NONE).setTechRating(RATING_A)</span>
<span class="fc" id="L982">            .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L983">            .setStaticTechLevel(SimpleTechLevel.INTRO);</span>
<span class="fc" id="L984">    private static final TechAdvancement[] TA_SV_ARMOR = {</span>
            TA_NONE, // Placeholder for index 0
            TA_NONE, // Placeholder for index 1
<span class="fc" id="L987">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(DATE_PS, DATE_PS, DATE_PS)</span>
<span class="fc" id="L988">                    .setTechRating(RATING_A).setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L989">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 2</span>
<span class="fc" id="L990">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(DATE_PS, DATE_PS, DATE_PS)</span>
<span class="fc" id="L991">                    .setTechRating(RATING_A).setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L992">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 3</span>
<span class="fc" id="L993">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(DATE_PS, DATE_PS, DATE_PS)</span>
<span class="fc" id="L994">                    .setTechRating(RATING_B).setAvailability(RATING_B, RATING_B, RATING_A, RATING_A)</span>
<span class="fc" id="L995">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 4</span>
<span class="fc" id="L996">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(DATE_ES, DATE_ES, DATE_ES)</span>
<span class="fc" id="L997">                    .setTechRating(RATING_B).setAvailability(RATING_B, RATING_B, RATING_B, RATING_A)</span>
<span class="fc" id="L998">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 5</span>
<span class="fc" id="L999">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(DATE_ES, DATE_ES, DATE_ES)</span>
<span class="fc" id="L1000">                    .setTechRating(RATING_C).setAvailability(RATING_C, RATING_B, RATING_B, RATING_A)</span>
<span class="fc" id="L1001">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 6</span>
<span class="fc" id="L1002">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(2250, 2300, 2305)</span>
<span class="fc" id="L1003">                    .setApproximate(true, true, false).setPrototypeFactions(F_TA)</span>
<span class="fc" id="L1004">                    .setProductionFactions(F_TA).setTechRating(RATING_C)</span>
<span class="fc" id="L1005">                    .setAvailability(RATING_C, RATING_B, RATING_B, RATING_B)</span>
<span class="fc" id="L1006">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 7</span>
<span class="fc" id="L1007">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(2425, 2435, 22445)</span>
<span class="fc" id="L1008">                    .setPrototypeFactions(F_TH).setProductionFactions(F_TH)</span>
<span class="fc" id="L1009">                    .setTechRating(RATING_D)</span>
<span class="fc" id="L1010">                    .setAvailability(RATING_C, RATING_C, RATING_B, RATING_B)</span>
<span class="fc" id="L1011">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 8</span>
<span class="fc" id="L1012">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(2440, 2450, 2470)</span>
<span class="fc" id="L1013">                    .setPrototypeFactions(F_TH).setProductionFactions(F_TH)</span>
<span class="fc" id="L1014">                    .setTechRating(RATING_D)</span>
<span class="fc" id="L1015">                    .setAvailability(RATING_C, RATING_C, RATING_C, RATING_B)</span>
<span class="fc" id="L1016">                    .setStaticTechLevel(SimpleTechLevel.STANDARD), // BAR 9</span>
<span class="fc" id="L1017">            new TechAdvancement(TECH_BASE_ALL).setAdvancement(2460, 2470, 2505)</span>
<span class="fc" id="L1018">                    .setPrototypeFactions(F_TH).setProductionFactions(F_TH)</span>
<span class="fc" id="L1019">                    .setApproximate(true, false, false).setTechRating(RATING_D)</span>
<span class="fc" id="L1020">                    .setAvailability(RATING_D, RATING_D, RATING_D, RATING_C)</span>
<span class="fc" id="L1021">                    .setStaticTechLevel(SimpleTechLevel.STANDARD) // BAR 10</span>
    };

    /**
     * Tech advancement for armor based on the armor type index and tech base
     * 
     * @param at   The armor type constant
     * @param clan The armor tech base
     * @return     The tech advancement for the armor
     */
    public static TechAdvancement getArmorTechAdvancement(int at, boolean clan) {
<span class="fc bfc" id="L1032" title="All 2 branches covered.">        if (at == T_ARMOR_STANDARD) {</span>
<span class="fc" id="L1033">            return TA_STANDARD_ARMOR;</span>
        }
<span class="fc" id="L1035">        String armorName = EquipmentType.getArmorTypeName(at, clan);</span>
<span class="fc" id="L1036">        EquipmentType armor = EquipmentType.get(armorName);</span>
<span class="fc bfc" id="L1037" title="All 2 branches covered.">        if (armor != null) {</span>
<span class="fc" id="L1038">            return armor.getTechAdvancement();</span>
        }
<span class="fc" id="L1040">        return TA_NONE;</span>
    }

    /**
     * Tech advancement for support vehicle armor
     *
     * @param bar The armor's barrier armor rating
     * @return    The armor tech advancement
     */
    public static TechAdvancement getSVArmorTechAdvancement(int bar) {
<span class="nc bnc" id="L1050" title="All 4 branches missed.">        if ((bar &gt;= 0) &amp;&amp; (bar &lt; TA_SV_ARMOR.length)) {</span>
<span class="nc" id="L1051">            return TA_SV_ARMOR[bar];</span>
        }
<span class="nc" id="L1053">        return TA_NONE;</span>
    }

    public static TechAdvancement getStructureTechAdvancement(int at, boolean clan) {
<span class="fc bfc" id="L1057" title="All 2 branches covered.">        if (at == T_STRUCTURE_STANDARD) {</span>
<span class="fc" id="L1058">            return TA_STANDARD_STRUCTURE;</span>
        }
<span class="fc" id="L1060">        String structureName = EquipmentType.getStructureTypeName(at, clan);</span>
<span class="fc" id="L1061">        EquipmentType structure = EquipmentType.get(structureName);</span>
<span class="pc bpc" id="L1062" title="1 of 2 branches missed.">        if (structure != null) {</span>
<span class="nc" id="L1063">            return structure.getTechAdvancement();</span>
        }
<span class="fc" id="L1065">        return TA_NONE;</span>
    }

    /**
     * For variable-sized equipment this assumes a size of 1.0.
     *
     * @return The C-Bill cost of the piece of equipment.
     */
    public double getCost(Entity entity, boolean armored, int loc) {
<span class="nc" id="L1074">        return getCost(entity, armored, loc, 1.0);</span>
    }

    /**
     * @return The C-Bill cost of the piece of equipment.
     */
    public double getCost(Entity entity, boolean armored, int loc, double size) {
<span class="nc" id="L1081">        return cost;</span>
    }

    public double getRawCost() {
<span class="nc" id="L1085">        return cost;</span>
    }

    /**
     * @return Whether the item weight varies according to the unit it's installed on
     */
    public boolean isVariableTonnage() {
<span class="nc bnc" id="L1092" title="All 2 branches missed.">        return tonnage == TONNAGE_VARIABLE;</span>
    }

    /**
     * @return Whether the item BV varies according to the unit it's installed on
     */
    public boolean isVariableBV() {
<span class="nc bnc" id="L1099" title="All 2 branches missed.">        return bv == BV_VARIABLE;</span>
    }

    /**
     * @return Whether the item cost varies according to the unit it's installed on
     */
    public boolean isVariableCost() {
<span class="nc bnc" id="L1106" title="All 2 branches missed.">        return cost == COST_VARIABLE;</span>
    }

    public boolean isVariableCriticals() {
<span class="nc bnc" id="L1110" title="All 2 branches missed.">        return criticals == CRITICALS_VARIABLE;</span>
    }

    /**
     * @return Whether the item's size is variable independent of external factors
     */
    public boolean isVariableSize() {
<span class="fc" id="L1117">        return false;</span>
    }

    /**
     * @return The increment between sizes of variable-sized equipment
     */
    public Double variableStepSize() {
<span class="nc" id="L1124">        return 1.0;</span>
    }

    /**
     * @return The maximum size of variable-sized equipment. Items with no maximum
     *         return {@code null}.
     */
    public @Nullable Double variableMaxSize() {
<span class="nc" id="L1132">        return null;</span>
    }

    public TechAdvancement getTechAdvancement() {
<span class="fc" id="L1136">        return techAdvancement;</span>
    }

    public int getTechRating() {
<span class="fc" id="L1140">        return techAdvancement.getTechRating();</span>
    }

    /**
     * @deprecated Use {@link #calcEraAvailability(int,boolean) calcEraAvailability to get availability
     *      for IS/Clan in a given year, or {@link #getBaseAvailability(int) getBaseAvailability}
     *      to get the base code for the era type, or getBaseEraAvailability to get the base code.
     */
    @Deprecated
    public int getAvailability(int era) {
<span class="nc" id="L1150">        return calcEraAvailability(era);</span>
    }

    /**
     * @deprecated Use {@link #getYearAvailabilityName(int,boolean) getYearAvailabilityName}
     *      to get availability for IS or Clan in a specific year,
     *      or {@link #getEraAvailabilityName(int) getEraAvailabilityName to get code(s) for the era.
     */
    @Deprecated
    public String getAvailabilityName(int era) {
<span class="nc" id="L1160">        return getEraAvailabilityName(era);</span>
    }

    public boolean isClan() {
<span class="fc bfc" id="L1164" title="All 2 branches covered.">        return techAdvancement.getTechBase() == TECH_BASE_CLAN;</span>
    }
    
    public boolean isMixedTech() {
<span class="nc bnc" id="L1168" title="All 2 branches missed.">        return techAdvancement.getTechBase() == TECH_BASE_ALL;</span>
    }
    
    public int getTechBase() {
<span class="fc" id="L1172">        return techAdvancement.getTechBase();</span>
    }

    public static String getEquipDateAsString(int date) {
<span class="nc bnc" id="L1176" title="All 2 branches missed.">        if (date == DATE_NONE) {</span>
<span class="nc" id="L1177">            return &quot;-&quot;;</span>
        } else {
<span class="nc" id="L1179">            return Integer.toString(date);</span>
        }

    }
    
    @Override
    public int getIntroductionDate(boolean clan) {
<span class="fc" id="L1186">        return techAdvancement.getIntroductionDate(clan);</span>
    }
    
    @Override
    public int getIntroductionDate() {
<span class="fc" id="L1191">        return techAdvancement.getIntroductionDate();</span>
    }
    
    @Override
    public int getIntroductionDate(boolean clan, int faction) {
<span class="fc" id="L1196">        return techAdvancement.getIntroductionDate(clan, faction);</span>
    }

    @Override
    public int getExtinctionDate(boolean clan) {
<span class="fc" id="L1201">        return techAdvancement.getExtinctionDate(clan);</span>
    }

    @Override
    public int getExtinctionDate() {
<span class="fc" id="L1206">        return techAdvancement.getExtinctionDate();</span>
    }

    @Override
    public int getExtinctionDate(boolean clan, int faction) {
<span class="fc" id="L1211">        return techAdvancement.getExtinctionDate(clan, faction);</span>
    }

    @Override
    public int getReintroductionDate(boolean clan) {
<span class="nc" id="L1216">        return techAdvancement.getReintroductionDate(clan);</span>
    }

    @Override
    public int getReintroductionDate() {
<span class="fc" id="L1221">        return techAdvancement.getReintroductionDate();</span>
    }

    @Override
    public int getReintroductionDate(boolean clan, int faction) {
<span class="fc" id="L1226">        return techAdvancement.getReintroductionDate(clan, faction);</span>
    }

    public static double getArmorCost(int inArmor) {
<span class="nc bnc" id="L1230" title="All 4 branches missed.">        if ((inArmor &lt; 0) || (inArmor &gt;= armorCosts.length)) {</span>
<span class="nc" id="L1231">            return -1;</span>
        }
<span class="nc" id="L1233">        return armorCosts[inArmor];</span>
    }

    public static double getStructureCost(int inStructure) {
<span class="nc bnc" id="L1237" title="All 4 branches missed.">        if ((inStructure &lt; 0) || (inStructure &gt;= structureCosts.length)) {</span>
<span class="nc" id="L1238">            return -1;</span>
        }
<span class="nc" id="L1240">        return structureCosts[inStructure];</span>
    }

    public static double getArmorPointMultiplier(int inArmor) {
<span class="nc" id="L1244">        return EquipmentType.getArmorPointMultiplier(inArmor,</span>
                TechConstants.T_IS_TW_NON_BOX);
    }

    public static double getArmorPointMultiplier(int inArmor, int inTechLevel) {
<span class="pc bpc" id="L1249" title="4 of 8 branches missed.">        return EquipmentType</span>
<span class="fc" id="L1250">                .getArmorPointMultiplier(</span>
                        inArmor,
                        ((inTechLevel == TechConstants.T_CLAN_TW) || (inTechLevel == TechConstants.T_CLAN_ADVANCED))
                                || (inTechLevel == TechConstants.T_CLAN_EXPERIMENTAL)
                                || (inTechLevel == TechConstants.T_CLAN_UNOFFICIAL));
    }

    public static double getArmorPointMultiplier(int inArmor, boolean clanArmor) {
<span class="pc bpc" id="L1258" title="1 of 4 branches missed.">        if ((inArmor &lt; 0) || (inArmor &gt;= armorPointMultipliers.length)) {</span>
<span class="fc" id="L1259">            return POINT_MULTIPLIER_UNKNOWN;</span>
        }
        /*
         * now handled in a single if statement
        if ((inArmor == T_ARMOR_FERRO_FIBROUS) &amp;&amp; clanArmor) {
            return POINT_MULTIPLIER_CLAN_FF;
        }
        if ((inArmor == T_ARMOR_ALUM) &amp;&amp; clanArmor) {
            return POINT_MULTIPLIER_CLAN_FF;
        }*/
        // Clan armors of these types have a multiplier exactly 0.08 higher than the I.S. variety
<span class="pc bpc" id="L1270" title="5 of 6 branches missed.">        if (clanArmor &amp;&amp; ((inArmor == T_ARMOR_ALUM) || (inArmor == T_ARMOR_FERRO_FIBROUS))) {</span>
<span class="nc" id="L1271">            return armorPointMultipliers[inArmor] + POINT_ADDITION_CLAN_FF;</span>

        }
<span class="fc" id="L1274">        return armorPointMultipliers[inArmor];</span>
    }

    @Override
    public boolean equals(Object obj) {
<span class="fc bfc" id="L1279" title="All 2 branches covered.">        if(this == obj) {</span>
<span class="fc" id="L1280">            return true;</span>
        }
<span class="pc bpc" id="L1282" title="2 of 4 branches missed.">        if((null == obj) || (getClass() != obj.getClass())) {</span>
<span class="nc" id="L1283">            return false;</span>
        }
<span class="fc" id="L1285">        final EquipmentType other = (EquipmentType) obj;</span>
<span class="fc" id="L1286">        return Objects.equals(internalName, other.internalName);</span>
    }
    
    @Override
    public int hashCode() {
<span class="nc" id="L1291">        return Objects.hashCode(internalName);</span>
    }

    public static void writeEquipmentDatabase(File f) {
        try {
<span class="nc" id="L1296">            BufferedWriter w = new BufferedWriter(new FileWriter(f));</span>
<span class="nc" id="L1297">            w.write(&quot;Megamek Equipment Database&quot;);</span>
<span class="nc" id="L1298">            w.newLine();</span>
<span class="nc" id="L1299">            w.write(&quot;This file can be regenerated with java -jar MegaMek.jar -eqdb &quot;);</span>
<span class="nc" id="L1300">            w.write(f.toString());</span>
<span class="nc" id="L1301">            w.newLine();</span>
<span class="nc" id="L1302">            w.write(&quot;Type,Tech Base,Rules,Name,Aliases&quot;);</span>
<span class="nc" id="L1303">            w.newLine();</span>
<span class="nc" id="L1304">            for (Enumeration&lt;EquipmentType&gt; e = EquipmentType.getAllTypes(); e</span>
<span class="nc bnc" id="L1305" title="All 2 branches missed.">                    .hasMoreElements();) {</span>
<span class="nc" id="L1306">                EquipmentType type = e.nextElement();</span>
<span class="nc bnc" id="L1307" title="All 2 branches missed.">                if (type instanceof AmmoType) {</span>
<span class="nc" id="L1308">                    w.write(&quot;A,&quot;);</span>
<span class="nc bnc" id="L1309" title="All 2 branches missed.">                } else if (type instanceof WeaponType) {</span>
<span class="nc" id="L1310">                    w.write(&quot;W,&quot;);</span>
                } else {
<span class="nc" id="L1312">                    w.write(&quot;M,&quot;);</span>
                }
<span class="nc bnc" id="L1314" title="All 2 branches missed.">                for (int year : type.getTechLevels().keySet()) {</span>
<span class="nc" id="L1315">                    w.write(year</span>
                            + &quot;-&quot;
<span class="nc" id="L1317">                            + TechConstants.getTechName(type.getTechLevel(year)));</span>
<span class="nc" id="L1318">                }</span>
<span class="nc" id="L1319">                w.write(&quot;,&quot;);</span>
<span class="nc bnc" id="L1320" title="All 2 branches missed.">                for (int year : type.getTechLevels().keySet()) {</span>
<span class="nc" id="L1321">                    w.write(year</span>
                            + &quot;-&quot;
<span class="nc" id="L1323">                            + TechConstants.getLevelName(type</span>
<span class="nc" id="L1324">                                    .getTechLevel(year)));</span>
<span class="nc" id="L1325">                }</span>
<span class="nc" id="L1326">                w.write(&quot;,&quot;);</span>
<span class="nc" id="L1327">                for (Enumeration&lt;String&gt; names = type.getNames(); names</span>
<span class="nc bnc" id="L1328" title="All 2 branches missed.">                        .hasMoreElements();) {</span>
<span class="nc" id="L1329">                    String name = names.nextElement();</span>
<span class="nc" id="L1330">                    w.write(name + &quot;,&quot;);</span>
<span class="nc" id="L1331">                }</span>
<span class="nc" id="L1332">                w.newLine();</span>
<span class="nc" id="L1333">            }</span>
<span class="nc" id="L1334">            w.flush();</span>
<span class="nc" id="L1335">            w.close();</span>
<span class="nc" id="L1336">        } catch (IOException e) {</span>
<span class="nc" id="L1337">            e.printStackTrace();</span>
<span class="nc" id="L1338">        }</span>
<span class="nc" id="L1339">    }</span>

    public static void writeEquipmentExtendedDatabase(File f) {
        try {
<span class="nc" id="L1343">            BufferedWriter w = new BufferedWriter(new FileWriter(f));</span>
<span class="nc" id="L1344">            w.write(&quot;Megamek Equipment Extended Database&quot;);</span>
<span class="nc" id="L1345">            w.newLine();</span>
<span class="nc" id="L1346">            w.write(&quot;This file can be regenerated with java -jar MegaMek.jar -eqedb &quot;);</span>
<span class="nc" id="L1347">            w.write(f.toString());</span>
<span class="nc" id="L1348">            w.newLine();</span>
<span class="nc" id="L1349">            w.write(&quot;Type,Name,Tech Base,Rules,Tech Rating,Static Tech Level,Introduction Date,Prototype Date,Production Date,Common Date,Extinction Date,Re-Introduction Date,Tonnage,Crits,Cost,BV,Alias&quot;);</span>
<span class="nc" id="L1350">            w.newLine();</span>
<span class="nc" id="L1351">            for (Enumeration&lt;EquipmentType&gt; e = EquipmentType.getAllTypes(); e</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">                    .hasMoreElements();) {</span>
<span class="nc" id="L1353">                EquipmentType type = e.nextElement();</span>
<span class="nc bnc" id="L1354" title="All 2 branches missed.">                if (type instanceof AmmoType) {</span>
<span class="nc" id="L1355">                    w.write(&quot;A&quot;);</span>
<span class="nc bnc" id="L1356" title="All 2 branches missed.">                } else if (type instanceof WeaponType) {</span>
<span class="nc" id="L1357">                    w.write(&quot;W&quot;);</span>
                } else {
<span class="nc" id="L1359">                    w.write(&quot;M&quot;);</span>
                }

<span class="nc" id="L1362">                w.write(&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1363">                w.write(type.getName());</span>

                // Gather the unique tech levels for this equipment ...
<span class="nc" id="L1366">                List&lt;Integer&gt; levels = type.getTechLevels().keySet().stream()</span>
<span class="nc" id="L1367">                        .map(year -&gt; type.getTechLevel(year))</span>
<span class="nc" id="L1368">                        .sorted()   // ordered for ease of use</span>
<span class="nc" id="L1369">                        .distinct()</span>
<span class="nc" id="L1370">                        .collect(Collectors.toList());</span>

                // ... and use them to output the tech names ...
<span class="nc" id="L1373">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1374">                w.write(levels.stream()</span>
<span class="nc" id="L1375">                        .map(TechConstants::getTechName)</span>
<span class="nc" id="L1376">                        .distinct()</span>
<span class="nc" id="L1377">                        .collect(Collectors.joining(&quot;/&quot;)));</span>

                // ... and associated rules levels.
<span class="nc" id="L1380">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1381">                w.write(levels.stream()</span>
<span class="nc" id="L1382">                        .map(TechConstants::getLevelName)</span>
<span class="nc" id="L1383">                        .distinct()</span>
<span class="nc" id="L1384">                        .collect(Collectors.joining(&quot;/&quot;)));</span>

<span class="nc" id="L1386">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1387">                w.write(type.getFullRatingName());</span>
<span class="nc" id="L1388">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1389">                w.write(type.getTechAdvancement().getStaticTechLevel().toString());</span>
<span class="nc" id="L1390">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1391">                w.write(type.getTechAdvancement().getIntroductionDateName());</span>
<span class="nc" id="L1392">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1393">                w.write(type.getTechAdvancement().getPrototypeDateName());</span>
<span class="nc" id="L1394">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1395">                w.write(type.getTechAdvancement().getProductionDateName());</span>
<span class="nc" id="L1396">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1397">                w.write(type.getTechAdvancement().getCommonDateName());</span>
<span class="nc" id="L1398">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1399">                w.write(type.getTechAdvancement().getExtinctionDateName());</span>
<span class="nc" id="L1400">                w.write(&quot;\&quot;,\&quot;&quot;);</span>
<span class="nc" id="L1401">                w.write(type.getTechAdvancement().getReintroductionDateName());</span>
<span class="nc" id="L1402">                w.write(&quot;\&quot;,&quot;);</span>
<span class="nc bnc" id="L1403" title="All 2 branches missed.">                if (type.tonnage == EquipmentType.TONNAGE_VARIABLE) {</span>
<span class="nc" id="L1404">                    w.write(&quot;Variable&quot;);</span>
                } else {
<span class="nc" id="L1406">                    w.write(Double.toString(type.tonnage));</span>
                }
<span class="nc" id="L1408">                w.write(&quot;,&quot;);</span>
<span class="nc bnc" id="L1409" title="All 2 branches missed.">                if (type.criticals == EquipmentType.CRITICALS_VARIABLE) {</span>
<span class="nc" id="L1410">                    w.write(&quot;Variable&quot;);</span>
                } else {
<span class="nc" id="L1412">                    w.write(Integer.toString(type.criticals));</span>
                }
<span class="nc" id="L1414">                w.write(&quot;,&quot;);</span>
<span class="nc bnc" id="L1415" title="All 2 branches missed.">                if (type.cost == EquipmentType.COST_VARIABLE) {</span>
<span class="nc" id="L1416">                    w.write(&quot;Variable&quot;);</span>
                } else {
<span class="nc" id="L1418">                    w.write(Double.toString(type.getCost(null, false, -1, 1.0)));</span>
                }
<span class="nc" id="L1420">                w.write(&quot;,&quot;);</span>
<span class="nc bnc" id="L1421" title="All 2 branches missed.">                if (type.bv == EquipmentType.BV_VARIABLE) {</span>
<span class="nc" id="L1422">                    w.write(&quot;Variable&quot;);</span>
                } else {
<span class="nc" id="L1424">                    w.write(Double.toString(type.bv));</span>
                }
<span class="nc" id="L1426">                w.write(&quot;,&quot;);</span>
<span class="nc" id="L1427">                for (Enumeration&lt;String&gt; names = type.getNames(); names</span>
<span class="nc bnc" id="L1428" title="All 2 branches missed.">                        .hasMoreElements();) {</span>
<span class="nc" id="L1429">                    String name = names.nextElement();</span>
<span class="nc" id="L1430">                    w.write(&quot;\&quot;&quot; + name + &quot;\&quot;,&quot;);</span>
<span class="nc" id="L1431">                }</span>
<span class="nc" id="L1432">                w.newLine();</span>
<span class="nc" id="L1433">            }</span>
<span class="nc" id="L1434">            w.flush();</span>
<span class="nc" id="L1435">            w.close();</span>
<span class="nc" id="L1436">        } catch (IOException e) {</span>
<span class="nc" id="L1437">            e.printStackTrace();</span>
<span class="nc" id="L1438">        }</span>
<span class="nc" id="L1439">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L1443">        return &quot;EquipmentType: &quot; + name;</span>
    }

    protected static GameOptions getGameOptions() {
<span class="nc bnc" id="L1447" title="All 2 branches missed.">        if (Server.getServerInstance() == null) {</span>
<span class="nc" id="L1448">            return null;</span>
<span class="nc bnc" id="L1449" title="All 2 branches missed.">        } else if (Server.getServerInstance().getGame() == null) {</span>
<span class="nc" id="L1450">            return null;</span>
        }
<span class="nc" id="L1452">        return Server.getServerInstance().getGame().getOptions();</span>
    }

    public String getShortName() {
<span class="nc bnc" id="L1456" title="All 2 branches missed.">        if (shortName.isBlank()) {</span>
<span class="nc" id="L1457">            return getName();</span>
        }
<span class="nc" id="L1459">        return shortName;</span>
    }

    public String getShortName(double size) {
<span class="nc" id="L1463">        return getShortName();</span>
    }

    @Override
    public boolean isIntroLevel() {
<span class="fc" id="L1468">        return techAdvancement.isIntroLevel();</span>
    }

    @Override
    public boolean isUnofficial() {
<span class="fc" id="L1473">        return techAdvancement.isUnofficial();</span>
    }

    @Override
    public int getPrototypeDate() {
<span class="fc" id="L1478">        return techAdvancement.getPrototypeDate();</span>
    }

    @Override
    public int getPrototypeDate(boolean clan, int faction) {
<span class="fc" id="L1483">        return techAdvancement.getPrototypeDate(clan, faction);</span>
    }

    @Override
    public int getProductionDate() {
<span class="fc" id="L1488">        return techAdvancement.getProductionDate();</span>
    }

    @Override
    public int getProductionDate(boolean clan, int faction) {
<span class="fc" id="L1493">        return techAdvancement.getProductionDate(clan, faction);</span>
    }

    @Override
    public int getCommonDate() {
<span class="fc" id="L1498">        return techAdvancement.getCommonDate();</span>
    }

    @Override
    public int getBaseAvailability(int era) {
<span class="fc" id="L1503">        return techAdvancement.getBaseAvailability(era);</span>
    }

    /**
     * This does not include heat generated by stealth armor, as that depends on whether
     * it is installed as patchwork and does not appear in the equipment list of all unit types.
     * 
     * @return The amount of heat generated by the equipment
     */
    public int getHeat() {
<span class="nc" id="L1513">        return 0;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>