<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MissionRole.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ratgenerator</a> &gt; <span class="el_source">MissionRole.java</span></div><h1>MissionRole.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2005 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.client.ratgenerator;

import java.util.Collection;
import java.util.HashSet;

import megamek.common.UnitType;

/**
 * Used to adjust availability to conform to a particular mission role.
 * 
 * @author Neoancient
 *
 */
<span class="nc" id="L27">public enum MissionRole {</span>
    /*General combat roles */
<span class="nc" id="L29">    RECON, RAIDER, INCENDIARY, EW_SUPPORT, ARTILLERY, MISSILE_ARTILLERY, APC, TRAINING, COMMAND,</span>
    /* Non-combat roles */
<span class="nc" id="L31">    CARGO, SUPPORT, CIVILIAN,</span>
    /* Ground forces */
<span class="nc" id="L33">    FIRE_SUPPORT, SR_FIRE_SUPPORT, URBAN, SPOTTER, ANTI_AIRCRAFT, ANTI_INFANTRY, INF_SUPPORT, CAVALRY,</span>
    /* Specialized ground support roles */
<span class="nc" id="L35">    SPECOPS, ENGINEER, MINESWEEPER, MINELAYER,</span>
    /* ASF roles */
<span class="nc" id="L37">    BOMBER, ESCORT, INTERCEPTOR, GROUND_SUPPORT, //unused: STRIKE,</span>
    /* DropShip roles */
<span class="nc" id="L39">    ASSAULT, MECH_CARRIER, ASF_CARRIER, VEE_CARRIER, INFANTRY_CARRIER, BA_CARRIER, TROOP_CARRIER,</span>
<span class="nc" id="L40">    TUG, POCKET_WARSHIP, PROTOMECH_CARRIER,</span>
    /* WarShip roles */
<span class="nc" id="L42">    CORVETTE, DESTROYER, FRIGATE, CRUISER, BATTLESHIP,</span>
    /* Mechanized Battle armor */
<span class="nc" id="L44">    OMNI, MECHANIZED_BA, MAG_CLAMP,</span>
    /* Infantry roles */
<span class="nc" id="L46">    MARINE, MOUNTAINEER, XCT, PARATROOPER, ANTI_MEK, FIELD_GUN,</span>
    /* allows artillery but does not filter out all other roles */
<span class="nc" id="L48">    MIXED_ARTILLERY; </span>
    
    public boolean fitsUnitType(int unitType) {
<span class="nc bnc" id="L51" title="All 22 branches missed.">        switch (this) {</span>
        case RECON:
        case SUPPORT:
<span class="nc" id="L54">            return true;</span>
        
        case CIVILIAN:
<span class="nc bnc" id="L57" title="All 4 branches missed.">            return unitType &gt;= UnitType.SMALL_CRAFT &amp;&amp; unitType != UnitType.WARSHIP;</span>
            
        case COMMAND:
<span class="nc bnc" id="L60" title="All 2 branches missed.">            return unitType &lt;= UnitType.GUN_EMPLACEMENT;</span>
            
        case SPECOPS:
<span class="nc bnc" id="L63" title="All 2 branches missed.">            return unitType &lt; UnitType.JUMPSHIP;</span>
            
        case URBAN:
        case ANTI_INFANTRY:
        case INF_SUPPORT:
<span class="nc bnc" id="L68" title="All 2 branches missed.">            return unitType &lt;= UnitType.TANK;</span>
            
        case FIRE_SUPPORT:
        case CAVALRY:
        case RAIDER:
        case APC:
<span class="nc bnc" id="L74" title="All 4 branches missed.">            return unitType &lt;= UnitType.TANK || unitType == UnitType.VTOL;</span>
            
        case ARTILLERY:
        case MISSILE_ARTILLERY:
<span class="nc bnc" id="L78" title="All 6 branches missed.">            return unitType &lt; UnitType.CONV_FIGHTER || unitType == UnitType.SMALL_CRAFT || unitType == UnitType.DROPSHIP;</span>
            
        case INCENDIARY:
        case ANTI_AIRCRAFT:
<span class="nc bnc" id="L82" title="All 2 branches missed.">            return unitType &lt;= UnitType.PROTOMEK; // all ground units</span>
            
        case ENGINEER:
        case MINESWEEPER:
        case MINELAYER:
<span class="nc bnc" id="L87" title="All 4 branches missed.">            return unitType &lt; UnitType.TANK || unitType == UnitType.INFANTRY;</span>

        case CARGO:
<span class="nc bnc" id="L90" title="All 4 branches missed.">            return unitType &lt; UnitType.BATTLE_ARMOR || unitType &gt; UnitType.PROTOMEK;</span>
            
        case EW_SUPPORT:
<span class="nc bnc" id="L93" title="All 4 branches missed.">            return unitType &lt;= UnitType.TANK || unitType == UnitType.AERO;</span>

        case TRAINING:
<span class="nc bnc" id="L96" title="All 2 branches missed.">            return unitType &lt; UnitType.SMALL_CRAFT;</span>
        
        case SPOTTER:
<span class="nc bnc" id="L99" title="All 2 branches missed.">            return unitType &lt;= UnitType.AERO;</span>
            
        case BOMBER:
        case ESCORT:
        case INTERCEPTOR:
        case GROUND_SUPPORT:
        //case STRIKE:
<span class="nc bnc" id="L106" title="All 4 branches missed.">            return unitType == UnitType.AERO || unitType == UnitType.CONV_FIGHTER;</span>
            
        case ASSAULT:
        case VEE_CARRIER:
        case INFANTRY_CARRIER:
        case BA_CARRIER:
        case MECH_CARRIER:
        case TUG:
        case POCKET_WARSHIP:
        case PROTOMECH_CARRIER:
<span class="nc bnc" id="L116" title="All 2 branches missed.">            return unitType == UnitType.DROPSHIP;</span>
            
        case TROOP_CARRIER:
        case ASF_CARRIER:
<span class="nc bnc" id="L120" title="All 4 branches missed.">            return unitType == UnitType.DROPSHIP || unitType == UnitType.WARSHIP;</span>
            
        case CORVETTE:
        case DESTROYER:
        case FRIGATE:
        case CRUISER:
        case BATTLESHIP:
<span class="nc bnc" id="L127" title="All 2 branches missed.">            return unitType == UnitType.WARSHIP;</span>
            
        case OMNI:
<span class="nc bnc" id="L130" title="All 6 branches missed.">            return (unitType == UnitType.MEK)</span>
                    || (unitType == UnitType.AERO)
                    || (unitType == UnitType.TANK);
            // This should apply to fixed-wing support also, but that cannot be distinguished from conventional fighters here.
            
        case MECHANIZED_BA:
        case MAG_CLAMP:
<span class="nc bnc" id="L137" title="All 2 branches missed.">            return unitType == UnitType.BATTLE_ARMOR;</span>
            
        case MARINE:
        case XCT:
<span class="nc bnc" id="L141" title="All 4 branches missed.">            return unitType == UnitType.INFANTRY || unitType == UnitType.BATTLE_ARMOR;</span>
            
        case MOUNTAINEER:
        case PARATROOPER:
        case ANTI_MEK:
        case FIELD_GUN:
<span class="nc bnc" id="L147" title="All 2 branches missed.">            return unitType == UnitType.INFANTRY;</span>
            
        case MIXED_ARTILLERY:
            /* TODO: allow inclusion of artillery without binary either/or */ 
        default:
<span class="nc" id="L152">            return false;</span>
        }
    }
    
    public static Double adjustAvailabilityByRole(double avRating, Collection&lt;MissionRole&gt; desiredRoles,
            ModelRecord mRec, int year, int strictness) {
<span class="nc" id="L158">        boolean roleApplied = false;</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (desiredRoles == null) {</span>
<span class="nc" id="L160">            desiredRoles = new HashSet&lt;MissionRole&gt;();</span>
        }
<span class="nc" id="L162">        double[] avAdj = new double[5];</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">        for (int i = 0; i &lt; avAdj.length; i++) {</span>
<span class="nc" id="L164">            avAdj[i] = (i + 1) * strictness / 3.0;</span>
        }
<span class="nc bnc" id="L166" title="All 2 branches missed.">        if (desiredRoles.size() &gt; 0) {</span>
<span class="nc" id="L167">            roleApplied = true;</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">            for (MissionRole role : desiredRoles) {</span>
<span class="nc bnc" id="L169" title="All 40 branches missed.">                switch (role) {</span>
                case ARTILLERY:
<span class="nc bnc" id="L171" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(ARTILLERY)</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">                            &amp;&amp; !mRec.getRoles().contains(MISSILE_ARTILLERY)) {</span>
<span class="nc" id="L173">                        return null;</span>
                    }
                    break;
                case MISSILE_ARTILLERY:
<span class="nc bnc" id="L177" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(MISSILE_ARTILLERY)) {</span>
<span class="nc" id="L178">                        return null;</span>
                    }
                    break;
                case ENGINEER:
<span class="nc bnc" id="L182" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(ENGINEER)) {</span>
<span class="nc" id="L183">                        return null;</span>
                    }
                    break;
                case RECON:
<span class="nc bnc" id="L187" title="All 2 branches missed.">                    if (mRec.getRoles().contains(RECON)){</span>
<span class="nc" id="L188">                            avRating += avAdj[2];</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(EW_SUPPORT)) {</span>
<span class="nc" id="L190">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(SPOTTER)) {</span>
<span class="nc" id="L192">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc bnc" id="L194" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L195">                            return null;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                        } else if (mRec.getUnitType() != UnitType.INFANTRY</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                                &amp;&amp; mRec.getUnitType() != UnitType.BATTLE_ARMOR</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                                    &amp;&amp; mRec.getSpeed() &lt; 4 + avAdj[2] - mRec.getWeightClass()) {</span>
<span class="nc" id="L199">                            return null;</span>
                        } else {
<span class="nc" id="L201">                            avRating += mRec.getSpeed() - (4 + avAdj[2] - mRec.getWeightClass());</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                            if (mRec.getRoles().contains(URBAN) ||</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">                                    mRec.getRoles().contains(INF_SUPPORT) ||</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">                                    mRec.getRoles().contains(ANTI_INFANTRY) ||</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">                                    mRec.getRoles().contains(APC) ||</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">                                    mRec.getRoles().contains(MOUNTAINEER) ||</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">                                    mRec.getRoles().contains(PARATROOPER) ||</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">                                    mRec.getRoles().contains(MARINE) ||</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                                    mRec.getRoles().contains(XCT)) {</span>
<span class="nc" id="L210">                                avRating -= avAdj[3];</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                            } else if (mRec.getRoles().contains(SPECOPS)) {</span>
<span class="nc" id="L212">                                avRating -= avAdj[4];</span>
                            } else {
<span class="nc" id="L214">                                avRating -= avAdj[0];</span>
                            }
                        }
                    }
<span class="nc" id="L218">                    break;</span>
                case COMMAND:
<span class="nc bnc" id="L220" title="All 2 branches missed.">                    if (mRec.getRoles().contains(COMMAND)) {</span>
<span class="nc" id="L221">                        avRating += avAdj[2];</span>
                    }
<span class="nc bnc" id="L223" title="All 2 branches missed.">                    if ((ModelRecord.NETWORK_COMPANY_COMMAND &amp; mRec.getNetworkMask()) != 0) {</span>
<span class="nc" id="L224">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                    } else if ((ModelRecord.NETWORK_C3_MASTER &amp; mRec.getNetworkMask()) != 0) {</span>
<span class="nc" id="L226">                        avRating += avAdj[0];</span>
                    }
                    break;
                case FIELD_GUN:
<span class="nc bnc" id="L230" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(FIELD_GUN)) {</span>
<span class="nc" id="L231">                        return null;</span>
                    }
                    break;
                case FIRE_SUPPORT:
<span class="nc bnc" id="L235" title="All 2 branches missed.">                    if (mRec.getRoles().contains(FIRE_SUPPORT)</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">                            || mRec.getLongRange() &gt; 0.75) {</span>
<span class="nc" id="L237">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                    } else if (mRec.getLongRange() &gt; 0.5) {</span>
<span class="nc" id="L239">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">                    } else if (mRec.getLongRange() &gt; 0.2) {</span>
<span class="nc" id="L241">                        avRating += avAdj[0];</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(SR_FIRE_SUPPORT)</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                            || mRec.getRoles().contains(ANTI_AIRCRAFT)</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">                            || mRec.getRoles().contains(MISSILE_ARTILLERY)) {</span>
<span class="nc" id="L245">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L247">                        return null;</span>
                    }
                    break;
                case INF_SUPPORT:
<span class="nc bnc" id="L251" title="All 2 branches missed.">                    if (mRec.getRoles().contains(INF_SUPPORT)) {</span>
<span class="nc" id="L252">                        avRating += strictness;</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(APC)) {</span>
<span class="nc" id="L254">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(ANTI_INFANTRY)</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">                            || mRec.getRoles().contains(URBAN)) {</span>
<span class="nc" id="L257">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc bnc" id="L259" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L260">                            return null;</span>
                        } else {
<span class="nc bnc" id="L262" title="All 2 branches missed.">                            if (mRec.getRoles().contains(MOUNTAINEER) ||</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                                    mRec.getRoles().contains(PARATROOPER)) {</span>
<span class="nc" id="L264">                                avRating -= avAdj[2];</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                            } else if (mRec.getRoles().contains(INCENDIARY) ||</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                                    mRec.getRoles().contains(MARINE) ||</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                                    mRec.getRoles().contains(XCT)) {</span>
<span class="nc" id="L268">                                avRating -= avAdj[3];</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">                            } else if (mRec.getRoles().contains(SPECOPS)) {</span>
<span class="nc" id="L270">                                avRating -= avAdj[4];</span>
                            } else {
<span class="nc" id="L272">                                avRating -= avAdj[1];</span>
                            }
                        }
                    }
<span class="nc" id="L276">                    break;</span>
                case OMNI:
<span class="nc bnc" id="L278" title="All 4 branches missed.">                    if (isSpecialized(desiredRoles, mRec) || !mRec.isOmni()) {</span>
<span class="nc" id="L279">                        return null;</span>
                    }
                    break;
                case MECHANIZED_BA:
<span class="nc bnc" id="L283" title="All 2 branches missed.">                    if (mRec.getUnitType() == UnitType.BATTLE_ARMOR</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">                            &amp;&amp; !mRec.canDoMechanizedBA()) {</span>
<span class="nc" id="L285">                        return null;                        </span>
                    }
                    break;
                case MAG_CLAMP:
<span class="nc bnc" id="L289" title="All 2 branches missed.">                    if (mRec.getUnitType() == UnitType.BATTLE_ARMOR</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                            &amp;&amp; !mRec.hasMagClamp()) {</span>
<span class="nc" id="L291">                        return null;                        </span>
                    }
                    break;
                case URBAN:
<span class="nc bnc" id="L295" title="All 2 branches missed.">                    if (mRec.getRoles().contains(URBAN)) {</span>
<span class="nc" id="L296">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(ANTI_INFANTRY)) {</span>
<span class="nc" id="L298">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(INF_SUPPORT)) {</span>
<span class="nc" id="L300">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc bnc" id="L302" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L303">                            return null;</span>
                        }
<span class="nc bnc" id="L305" title="All 2 branches missed.">                        if (mRec.getRoles().contains(FIRE_SUPPORT) ||</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                                mRec.getRoles().contains(SR_FIRE_SUPPORT) ||</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">                                mRec.getRoles().contains(ANTI_AIRCRAFT)) {</span>
<span class="nc" id="L308">                            avRating -= avAdj[0];</span>
                        }
<span class="nc bnc" id="L310" title="All 2 branches missed.">                        if (mRec.getRoles().contains(MARINE) ||</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                                mRec.getRoles().contains(XCT)) {</span>
<span class="nc" id="L312">                            avRating -= avAdj[2];</span>
                        }
<span class="nc bnc" id="L314" title="All 2 branches missed.">                        if (mRec.getRoles().contains(MOUNTAINEER) ||</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                                mRec.getRoles().contains(PARATROOPER) ||</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">                                mRec.getRoles().contains(SPECOPS)) {</span>
<span class="nc" id="L317">                            avRating -= avAdj[3];</span>
                        }
                    }
<span class="nc bnc" id="L320" title="All 4 branches missed.">                    if (avRating &gt; 0 &amp;&amp; mRec.getUnitType() == UnitType.TANK) {</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">                        if (mRec.getMechSummary().getUnitSubType().equals(&quot;Wheeled&quot;)) {</span>
<span class="nc" id="L322">                            avRating += avAdj[2];</span>
<span class="nc bnc" id="L323" title="All 2 branches missed.">                        } else if (mRec.getMechSummary().getUnitSubType().equals(&quot;Tracked&quot;)) {</span>
<span class="nc" id="L324">                            avRating -= avAdj[2];</span>
                        }
                    }
                    break;
                    
                case RAIDER:
<span class="nc bnc" id="L330" title="All 2 branches missed.">                    if (mRec.getRoles().contains(RAIDER)) {</span>
<span class="nc" id="L331">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc bnc" id="L333" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L334">                            return null;</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">                        } else if (mRec.getAmmoRequirement() &lt; 0.2) {</span>
<span class="nc" id="L336">                            avRating += avAdj[0];</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                        } else if (mRec.getAmmoRequirement() &lt; 0.5) {</span>
<span class="nc" id="L338">                            avRating += avAdj[1];</span>
                        }
<span class="nc bnc" id="L340" title="All 2 branches missed.">                        if (mRec.getUnitType() != UnitType.INFANTRY</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                                &amp;&amp; mRec.getUnitType() != UnitType.BATTLE_ARMOR</span>
<span class="nc bnc" id="L342" title="All 2 branches missed.">                                    &amp;&amp; mRec.getSpeed() &lt; 3 + avAdj[2] - mRec.getWeightClass()) {</span>
<span class="nc" id="L343">                            avRating -= 2 + avAdj[2] - mRec.getWeightClass() - mRec.getSpeed();</span>
                        }
                    }
                    break;
                case INCENDIARY:
<span class="nc bnc" id="L348" title="All 2 branches missed.">                    if (mRec.getRoles().contains(INCENDIARY)) {</span>
<span class="nc" id="L349">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc bnc" id="L351" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L352">                            avRating = 0;</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">                        } else if (mRec.hasIncendiaryWeapon()) {</span>
<span class="nc" id="L354">                            avRating += avAdj[2];</span>
                        } else {
<span class="nc" id="L356">                            avRating -= avAdj[2];</span>
                        }
                    }
<span class="nc" id="L359">                    break;</span>
                case ANTI_AIRCRAFT:
<span class="nc bnc" id="L361" title="All 2 branches missed.">                    if (mRec.getRoles().contains(ANTI_AIRCRAFT) ||</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">                            mRec.getFlak() &gt; 0.75) {</span>
<span class="nc" id="L363">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">                    } else if (mRec.getFlak() &gt; 0.5) {</span>
<span class="nc" id="L365">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                    } else if (mRec.getFlak() &gt; 0.2) {</span>
<span class="nc" id="L367">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc bnc" id="L369" title="All 2 branches missed.">                        if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L370">                            return null;</span>
                        } else {
<span class="nc" id="L372">                            avRating -= avAdj[1];</span>
                        }
                    }
<span class="nc" id="L375">                    break;</span>
                case ANTI_INFANTRY:
<span class="nc bnc" id="L377" title="All 2 branches missed.">                    if (mRec.getRoles().contains(ANTI_INFANTRY)) {</span>
<span class="nc" id="L378">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">                    } else     if (isSpecialized(desiredRoles, mRec)) {</span>
<span class="nc" id="L380">                        return null;</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">                    } else if (!mRec.hasAPWeapons()) {</span>
<span class="nc" id="L382">                        avRating -= avAdj[2];</span>
                    }
                    break;
                    
                case GROUND_SUPPORT:
<span class="nc bnc" id="L387" title="All 2 branches missed.">                    if (mRec.getRoles().contains(GROUND_SUPPORT)) {</span>
<span class="nc" id="L388">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc" id="L390">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L392">                    break;</span>
                case INTERCEPTOR:
<span class="nc bnc" id="L394" title="All 2 branches missed.">                    if (mRec.getRoles().contains(INTERCEPTOR)) {</span>
<span class="nc" id="L395">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc" id="L397">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L399">                    break;</span>
                case BOMBER:
<span class="nc bnc" id="L401" title="All 2 branches missed.">                    if (mRec.getRoles().contains(BOMBER)) {</span>
<span class="nc" id="L402">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc" id="L404">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L406">                    break;</span>
                case ESCORT:
<span class="nc bnc" id="L408" title="All 2 branches missed.">                    if (mRec.getRoles().contains(ESCORT)) {</span>
<span class="nc" id="L409">                        avRating += avAdj[2];</span>
                    } else {
<span class="nc" id="L411">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L413">                    break;</span>
                case CAVALRY:
<span class="nc bnc" id="L415" title="All 2 branches missed.">                    if (mRec.getUnitType() == UnitType.INFANTRY</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">                            || mRec.getUnitType() == UnitType.BATTLE_ARMOR) {</span>
<span class="nc" id="L417">                        avRating += avAdj[2] * (mRec.getSpeed() - 3);</span>
                    } else {
<span class="nc" id="L419">                        avRating += avAdj[2] * (mRec.getSpeed() - (7 - mRec.getWeightClass()));                    </span>
                    }
<span class="nc" id="L421">                    break;</span>
                //Large craft roles
                case CIVILIAN:
<span class="nc bnc" id="L424" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(CIVILIAN)) {</span>
<span class="nc" id="L425">                        return null;</span>
                    }
                    break;
                case CARGO:
<span class="nc bnc" id="L429" title="All 2 branches missed.">                    if (mRec.getRoles().contains(CARGO)) {</span>
<span class="nc" id="L430">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(CIVILIAN)) {</span>
<span class="nc" id="L432">                        avRating += avAdj[1];</span>
                    } else {
<span class="nc" id="L434">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L436">                    break;</span>
                case SUPPORT:
<span class="nc bnc" id="L438" title="All 2 branches missed.">                    if (mRec.getRoles().contains(SUPPORT)) {</span>
<span class="nc" id="L439">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(TUG)) {</span>
<span class="nc" id="L441">                        avRating += avAdj[1];</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(CARGO)</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">                                || mRec.getRoles().contains(CIVILIAN)) {</span>
<span class="nc" id="L444">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L446">                        avRating -= avAdj[2];</span>
                    }
<span class="nc" id="L448">                    break;</span>
                case TUG:
<span class="nc bnc" id="L450" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(TUG)) {</span>
<span class="nc" id="L451">                        return null;</span>
                    }
                    break;
                case POCKET_WARSHIP:
<span class="nc bnc" id="L455" title="All 2 branches missed.">                    if (mRec.getRoles().contains(POCKET_WARSHIP)) {</span>
<span class="nc" id="L456">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(ASSAULT)) {</span>
<span class="nc" id="L458">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L460">                        return null;</span>
                    }
                    break;
                case ASSAULT:
<span class="nc bnc" id="L464" title="All 2 branches missed.">                    if (mRec.getRoles().contains(ASSAULT)) {</span>
<span class="nc" id="L465">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L466" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(POCKET_WARSHIP)) {</span>
<span class="nc" id="L467">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L469">                        return null;</span>
                    }
                    break;
                case MECH_CARRIER:
<span class="nc bnc" id="L473" title="All 2 branches missed.">                    if (mRec.getRoles().contains(MECH_CARRIER)) {</span>
<span class="nc" id="L474">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L475" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(TROOP_CARRIER)) {</span>
<span class="nc" id="L476">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L478">                        return null;</span>
                    }
                    break;
                case ASF_CARRIER:
<span class="nc bnc" id="L482" title="All 2 branches missed.">                    if (mRec.getRoles().contains(ASF_CARRIER)) {</span>
<span class="nc" id="L483">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(ASSAULT)) {</span>
<span class="nc" id="L485">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L487">                        return null;</span>
                    }
                    break;
                case BA_CARRIER:
<span class="nc bnc" id="L491" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(BA_CARRIER)) {</span>
<span class="nc" id="L492">                        return null;</span>
                    }
                    break;
                case INFANTRY_CARRIER:
<span class="nc bnc" id="L496" title="All 2 branches missed.">                    if (mRec.getRoles().contains(INFANTRY_CARRIER)) {</span>
<span class="nc" id="L497">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(TROOP_CARRIER)) {</span>
<span class="nc" id="L499">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L501">                        return null;</span>
                    }
                    break;
                case VEE_CARRIER:
<span class="nc bnc" id="L505" title="All 2 branches missed.">                    if (mRec.getRoles().contains(VEE_CARRIER)) {</span>
<span class="nc" id="L506">                        avRating += avAdj[2];</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">                    } else if (mRec.getRoles().contains(TROOP_CARRIER)) {</span>
<span class="nc" id="L508">                        avRating += avAdj[0];</span>
                    } else {
<span class="nc" id="L510">                        return null;</span>
                    }
                    break;
                case PROTOMECH_CARRIER:
<span class="nc bnc" id="L514" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(PROTOMECH_CARRIER)) {</span>
<span class="nc" id="L515">                        return null;</span>
                    }
                    break;
                case TROOP_CARRIER:
<span class="nc bnc" id="L519" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(TROOP_CARRIER)) {</span>
<span class="nc" id="L520">                        return null;</span>
                    }
                    break;
                case CORVETTE:
<span class="nc bnc" id="L524" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(CORVETTE)) {</span>
<span class="nc" id="L525">                        return null;</span>
                    }
                    break;
                case DESTROYER:
<span class="nc bnc" id="L529" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(DESTROYER)) {</span>
<span class="nc" id="L530">                        return null;</span>
                    }
                    break;
                case FRIGATE:
<span class="nc bnc" id="L534" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(FRIGATE)) {</span>
<span class="nc" id="L535">                        return null;</span>
                    }
                    break;
                case CRUISER:
<span class="nc bnc" id="L539" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(CRUISER)) {</span>
<span class="nc" id="L540">                        return null;</span>
                    }
                    break;
                case BATTLESHIP:
<span class="nc bnc" id="L544" title="All 2 branches missed.">                    if (!mRec.getRoles().contains(BATTLESHIP)) {</span>
<span class="nc" id="L545">                        return null;</span>
                    }
                    break;
                default:
<span class="nc" id="L549">                    roleApplied = false;</span>
                }
<span class="nc" id="L551">            }</span>
        }
        /* Reduce rating of units with certain specialized functions if the roles does not
         * require them.
         */
<span class="nc bnc" id="L556" title="All 2 branches missed.">        if (!roleApplied) {</span>
<span class="nc bnc" id="L557" title="All 4 branches missed.">            if ((mRec.getRoles().contains(SUPPORT) &amp;&amp; !desiredRoles.contains(SUPPORT)) ||</span>
<span class="nc bnc" id="L558" title="All 8 branches missed.">                    (mRec.getRoles().contains(CARGO) &amp;&amp; !(desiredRoles.contains(CARGO) || desiredRoles.size() &gt; 1 || mRec.getUnitType() == UnitType.WARSHIP)) ||</span>
<span class="nc bnc" id="L559" title="All 4 branches missed.">                    (mRec.getRoles().contains(TUG) &amp;&amp; !desiredRoles.contains(TUG)) ||</span>
<span class="nc bnc" id="L560" title="All 4 branches missed.">                    (mRec.getRoles().contains(CIVILIAN) &amp;&amp; !desiredRoles.contains(CIVILIAN)) ||</span>
<span class="nc bnc" id="L561" title="All 4 branches missed.">                    (mRec.getRoles().contains(TRAINING) &amp;&amp; !desiredRoles.contains(TRAINING)) ||</span>
<span class="nc bnc" id="L562" title="All 4 branches missed.">                    (mRec.getRoles().contains(FIELD_GUN) &amp;&amp; !desiredRoles.contains(FIELD_GUN)) ||</span>
<span class="nc bnc" id="L563" title="All 4 branches missed.">                    (mRec.getRoles().contains(ARTILLERY) &amp;&amp; !desiredRoles.contains(MIXED_ARTILLERY))) {</span>
<span class="nc" id="L564">                return null;</span>
            }
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if (mRec.getRoles().contains(MISSILE_ARTILLERY) &amp;&amp;</span>
<span class="nc bnc" id="L567" title="All 2 branches missed.">                    !desiredRoles.contains(ARTILLERY)</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">                    &amp;&amp; !desiredRoles.contains(MISSILE_ARTILLERY)</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">                    &amp;&amp; !desiredRoles.contains(FIRE_SUPPORT)</span>
<span class="nc bnc" id="L570" title="All 2 branches missed.">                    &amp;&amp; !desiredRoles.contains(MIXED_ARTILLERY)) {</span>
<span class="nc" id="L571">                return null;</span>
            }
<span class="nc bnc" id="L573" title="All 2 branches missed.">            if (mRec.getRoles().contains(RECON) ||</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">                    mRec.getRoles().contains(EW_SUPPORT)) {</span>
<span class="nc" id="L575">                avRating -= avAdj[0];</span>
            }
<span class="nc bnc" id="L577" title="All 2 branches missed.">            if (mRec.getRoles().contains(URBAN) ||</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">                    mRec.getRoles().contains(INF_SUPPORT) ||</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">                    mRec.getRoles().contains(ANTI_INFANTRY) ||</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">                    mRec.getRoles().contains(APC) ||</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">                    mRec.getRoles().contains(MOUNTAINEER) ||</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">                    mRec.getRoles().contains(PARATROOPER)) {</span>
<span class="nc" id="L583">                avRating -= avAdj[1];</span>
            }
<span class="nc bnc" id="L585" title="All 2 branches missed.">            if (mRec.getRoles().contains(INCENDIARY) ||</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">                    mRec.getRoles().contains(MARINE) ||</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                    mRec.getRoles().contains(XCT)) {</span>
<span class="nc" id="L588">                avRating -= avAdj[2];</span>
            }
<span class="nc bnc" id="L590" title="All 2 branches missed.">            if (mRec.getRoles().contains(SPECOPS)) {</span>
<span class="nc" id="L591">                avRating -= avAdj[3];</span>
            }
        }
<span class="nc" id="L594">        return avRating;</span>
    }

    private static boolean isSpecialized(Collection&lt;MissionRole&gt; desiredRoles,
            ModelRecord mRec) {
<span class="nc bnc" id="L599" title="All 4 branches missed.">        return (mRec.getRoles().contains(SUPPORT) &amp;&amp; !desiredRoles.contains(SUPPORT)) ||</span>
<span class="nc bnc" id="L600" title="All 4 branches missed.">                (mRec.getRoles().contains(CARGO) &amp;&amp; !desiredRoles.contains(CARGO)) ||</span>
<span class="nc bnc" id="L601" title="All 4 branches missed.">                (mRec.getRoles().contains(TUG) &amp;&amp; !desiredRoles.contains(TUG)) ||</span>
<span class="nc bnc" id="L602" title="All 4 branches missed.">                (mRec.getRoles().contains(CIVILIAN) &amp;&amp; !desiredRoles.contains(CIVILIAN)) ||</span>
<span class="nc bnc" id="L603" title="All 4 branches missed.">                (mRec.getRoles().contains(TRAINING) &amp;&amp; !desiredRoles.contains(TRAINING)) ||</span>
<span class="nc bnc" id="L604" title="All 4 branches missed.">                (mRec.getRoles().contains(ARTILLERY) &amp;&amp; !desiredRoles.contains(ARTILLERY)</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">                        &amp;&amp; !desiredRoles.contains(MIXED_ARTILLERY));</span>
    }
    
    public static MissionRole parseRole(String role) {
<span class="nc bnc" id="L609" title="All 53 branches missed.">        switch (role.toLowerCase().replace(&quot;_&quot;, &quot; &quot;)) {</span>
        case &quot;recon&quot;:
<span class="nc" id="L611">            return RECON;</span>
        case &quot;fire support&quot;:
<span class="nc" id="L613">            return FIRE_SUPPORT;</span>
        case &quot;command&quot;:
<span class="nc" id="L615">            return COMMAND;</span>
        case &quot;sr fire support&quot;:
<span class="nc" id="L617">            return SR_FIRE_SUPPORT;</span>
        case &quot;spotter&quot;:
<span class="nc" id="L619">            return SPOTTER;</span>
        case &quot;urban&quot;:
<span class="nc" id="L621">            return URBAN;</span>
        case &quot;infantry support&quot;:
        case &quot;inf support&quot;:
<span class="nc" id="L624">            return INF_SUPPORT;</span>
        case &quot;cavalry&quot;:
<span class="nc" id="L626">            return CAVALRY;</span>
        case &quot;raider&quot;:
<span class="nc" id="L628">            return RAIDER;</span>
        case &quot;incendiary&quot;:
        case &quot;incindiary&quot;:
<span class="nc" id="L631">            return INCENDIARY;</span>
        case &quot;ew support&quot;:
<span class="nc" id="L633">            return EW_SUPPORT;</span>
        case &quot;artillery&quot;:
<span class="nc" id="L635">            return ARTILLERY;</span>
        case &quot;missile artillery&quot;:
<span class="nc" id="L637">            return MISSILE_ARTILLERY;</span>
        case &quot;anti-aircraft&quot;:
        case &quot;anti aircraft&quot;:
<span class="nc" id="L640">            return ANTI_AIRCRAFT;</span>
        case &quot;anti-infantry&quot;:
        case &quot;anti infantry&quot;:
<span class="nc" id="L643">            return ANTI_INFANTRY;</span>
        case &quot;apc&quot;:
<span class="nc" id="L645">            return APC;</span>
        case &quot;spec ops&quot;:
        case &quot;specops&quot;:
<span class="nc" id="L648">            return SPECOPS;</span>
        case &quot;cargo&quot;:
<span class="nc" id="L650">            return CARGO;</span>
        case &quot;support&quot;:
<span class="nc" id="L652">            return SUPPORT;</span>
        case &quot;bomber&quot;:
<span class="nc" id="L654">            return BOMBER;</span>
        case &quot;escort&quot;:
<span class="nc" id="L656">            return ESCORT;</span>
        case &quot;interceptor&quot;:
<span class="nc" id="L658">            return INTERCEPTOR;</span>
        case &quot;ground support&quot;:
<span class="nc" id="L660">            return GROUND_SUPPORT;</span>
        //case &quot;strike&quot;:
            //return STRIKE;
        case &quot;training&quot;:
<span class="nc" id="L664">            return TRAINING;</span>
        case &quot;assault&quot;:
<span class="nc" id="L666">            return ASSAULT;</span>
        case &quot;mech carrier&quot;:
<span class="nc" id="L668">            return MECH_CARRIER;</span>
        case &quot;asf carrier&quot;:
<span class="nc" id="L670">            return ASF_CARRIER;</span>
        case &quot;vee carrier&quot;:
<span class="nc" id="L672">            return VEE_CARRIER;</span>
        case &quot;infantry carrier&quot;:
<span class="nc" id="L674">            return INFANTRY_CARRIER;</span>
        case &quot;ba carrier&quot;:
<span class="nc" id="L676">            return BA_CARRIER;</span>
        case &quot;protomech carrier&quot;:
<span class="nc" id="L678">            return PROTOMECH_CARRIER;</span>
        case &quot;tug&quot;:
<span class="nc" id="L680">            return TUG;</span>
        case &quot;troop carrier&quot;:
<span class="nc" id="L682">            return TROOP_CARRIER;</span>
        case &quot;pocket ws&quot;:
        case &quot;pocket warship&quot;:
<span class="nc" id="L685">            return POCKET_WARSHIP;</span>
        case &quot;corvette&quot;:
<span class="nc" id="L687">            return CORVETTE;</span>
        case &quot;destroyer&quot;:
<span class="nc" id="L689">            return DESTROYER;</span>
        case &quot;frigate&quot;:
<span class="nc" id="L691">            return FRIGATE;</span>
        case &quot;cruiser&quot;:
<span class="nc" id="L693">            return CRUISER;</span>
        case &quot;battleship&quot;:
<span class="nc" id="L695">            return BATTLESHIP;</span>
        case &quot;engineer&quot;:
<span class="nc" id="L697">            return ENGINEER;</span>
        case &quot;marine&quot;:
<span class="nc" id="L699">            return MARINE;</span>
        case &quot;mountaineer&quot;:
<span class="nc" id="L701">            return MOUNTAINEER;</span>
        case &quot;xct&quot;:
<span class="nc" id="L703">            return XCT;</span>
        case &quot;paratrooper&quot;:
<span class="nc" id="L705">            return PARATROOPER;</span>
        case &quot;anti-mek&quot;:
        case &quot;anti mek&quot;:
<span class="nc" id="L708">            return ANTI_MEK;</span>
        case &quot;omni&quot;:
<span class="nc" id="L710">            return OMNI;</span>
        case &quot;mechanized ba&quot;:
<span class="nc" id="L712">            return MECHANIZED_BA;</span>
        case &quot;mag clamp&quot;:
<span class="nc" id="L714">            return MAG_CLAMP;</span>
        case &quot;field gun&quot;:
<span class="nc" id="L716">            return FIELD_GUN;</span>
        case &quot;civilian&quot;:
<span class="nc" id="L718">            return CIVILIAN;</span>
        case &quot;minesweeper&quot;:
<span class="nc" id="L720">            return MINESWEEPER;</span>
        case &quot;minelayer&quot;:
<span class="nc" id="L722">            return MINELAYER;</span>
        }
<span class="nc" id="L724">        return null;</span>
    }
    
    @Override
    public String toString() {
<span class="nc" id="L729">        return name().toLowerCase();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>