<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExtraPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing.unitDisplay</a> &gt; <span class="el_source">ExtraPanel.java</span></div><h1>ExtraPanel.java</h1><pre class="source lang-java linenums">package megamek.client.ui.swing.unitDisplay;

import java.awt.Color;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Image;
import java.awt.Insets;
import java.awt.Rectangle;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.util.Enumeration;

import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.ScrollPaneConstants;
import javax.swing.SwingConstants;

import megamek.client.ui.Messages;
import megamek.client.ui.swing.ClientGUI;
import megamek.client.ui.swing.HeatEffects;
import megamek.client.ui.swing.Slider;
import megamek.client.ui.swing.widget.BackGroundDrawer;
import megamek.client.ui.swing.widget.PMUtil;
import megamek.client.ui.swing.widget.PicMap;
import megamek.client.ui.swing.widget.SkinXMLHandler;
import megamek.client.ui.swing.widget.UnitDisplaySkinSpecification;
import megamek.common.BattleArmor;
import megamek.common.ComputeECM;
import megamek.common.Configuration;
import megamek.common.Coords;
import megamek.common.Entity;
import megamek.common.IGame;
import megamek.common.ILocationExposureStatus;
import megamek.common.INarcPod;
import megamek.common.IPlayer;
import megamek.common.Mech;
import megamek.common.Mounted;
import megamek.common.Sensor;
import megamek.common.Tank;
import megamek.common.options.OptionsConstants;
import megamek.common.util.fileUtils.MegaMekFile;
import megamek.common.weapons.other.TSEMPWeapon;

/**
 * This class shows information about a unit that doesn't belong elsewhere.
 */
class ExtraPanel extends PicMap implements ActionListener, ItemListener {

    /**
     * 
     */
    private final UnitDisplay unitDisplay;

    /**
     *
     */
    private static final long serialVersionUID = -4907296187995261075L;

    private JLabel lblLastTarget;
    private JLabel curSensorsL;
    private JLabel narcLabel;
    private JLabel unusedL;
    private JLabel carrysL;
    private JLabel heatL;
    private JLabel sinksL;
    private JTextArea unusedR;
    private JTextArea carrysR;
    private JTextArea heatR;
    private JTextArea lastTargetR;
    private JTextArea sinksR;
    private JButton sinks2B;
    private JButton dumpBombs;
    private JList&lt;String&gt; narcList;
    private int myMechId;

    private JComboBox&lt;String&gt; chSensors;

    private Slider prompt;

    private int sinks;
    private boolean dontChange;

<span class="nc" id="L90">    private int minTopMargin = 8;</span>
<span class="nc" id="L91">    private int minLeftMargin = 8;</span>

<span class="nc" id="L93">    JButton activateHidden = new JButton(</span>
<span class="nc" id="L94">            Messages.getString(&quot;MechDisplay.ActivateHidden.Label&quot;));</span>

<span class="nc" id="L96">    JComboBox&lt;String&gt; activateHiddenPhase = new JComboBox&lt;&gt;();</span>

<span class="nc" id="L98">    ExtraPanel(UnitDisplay unitDisplay) {</span>
<span class="nc" id="L99">        this.unitDisplay = unitDisplay;</span>
<span class="nc" id="L100">        prompt = null;</span>

<span class="nc" id="L102">        narcLabel = new JLabel(</span>
<span class="nc" id="L103">                Messages.getString(&quot;MechDisplay.AffectedBy&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L104">        narcLabel.setOpaque(false);</span>
<span class="nc" id="L105">        narcLabel.setForeground(Color.WHITE);</span>

<span class="nc" id="L107">        narcList = new JList&lt;String&gt;(new DefaultListModel&lt;String&gt;());</span>

        // transport stuff
        // unusedL = new JLabel( &quot;Unused Space:&quot;, JLabel.CENTER );

<span class="nc" id="L112">        unusedL = new JLabel(</span>
<span class="nc" id="L113">                Messages.getString(&quot;MechDisplay.UnusedSpace&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L114">        unusedL.setOpaque(false);</span>
<span class="nc" id="L115">        unusedL.setForeground(Color.WHITE);</span>
<span class="nc" id="L116">        unusedR = new JTextArea(&quot;&quot;, 2, 25); //$NON-NLS-1$</span>
<span class="nc" id="L117">        unusedR.setEditable(false);</span>
<span class="nc" id="L118">        unusedR.setOpaque(false);</span>
<span class="nc" id="L119">        unusedR.setForeground(Color.WHITE);</span>

<span class="nc" id="L121">        carrysL = new JLabel(</span>
<span class="nc" id="L122">                Messages.getString(&quot;MechDisplay.Carryng&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L123">        carrysL.setOpaque(false);</span>
<span class="nc" id="L124">        carrysL.setForeground(Color.WHITE);</span>
<span class="nc" id="L125">        carrysR = new JTextArea(&quot;&quot;, 4, 25); //$NON-NLS-1$</span>
<span class="nc" id="L126">        carrysR.setEditable(false);</span>
<span class="nc" id="L127">        carrysR.setOpaque(false);</span>
<span class="nc" id="L128">        carrysR.setForeground(Color.WHITE);</span>

<span class="nc" id="L130">        sinksL = new JLabel(</span>
<span class="nc" id="L131">                Messages.getString(&quot;MechDisplay.activeSinksLabel&quot;),</span>
                SwingConstants.CENTER);
<span class="nc" id="L133">        sinksL.setOpaque(false);</span>
<span class="nc" id="L134">        sinksL.setForeground(Color.WHITE);</span>
<span class="nc" id="L135">        sinksR = new JTextArea(&quot;&quot;, 1, 25);</span>
<span class="nc" id="L136">        sinksR.setEditable(false);</span>
<span class="nc" id="L137">        sinksR.setOpaque(false);</span>
<span class="nc" id="L138">        sinksR.setForeground(Color.WHITE);</span>

<span class="nc" id="L140">        sinks2B = new JButton(</span>
<span class="nc" id="L141">                Messages.getString(&quot;MechDisplay.configureActiveSinksLabel&quot;));</span>
<span class="nc" id="L142">        sinks2B.setActionCommand(&quot;changeSinks&quot;);</span>
<span class="nc" id="L143">        sinks2B.addActionListener(this);</span>

<span class="nc" id="L145">        dumpBombs = new JButton(</span>
<span class="nc" id="L146">                Messages.getString(&quot;MechDisplay.DumpBombsLabel&quot;));</span>
<span class="nc" id="L147">        dumpBombs.setActionCommand(&quot;dumpBombs&quot;);</span>
<span class="nc" id="L148">        dumpBombs.addActionListener(this);</span>

<span class="nc" id="L150">        heatL = new JLabel(</span>
<span class="nc" id="L151">                Messages.getString(&quot;MechDisplay.HeatEffects&quot;), SwingConstants.CENTER); //$NON-NLS-1$</span>
<span class="nc" id="L152">        heatL.setOpaque(false);</span>
<span class="nc" id="L153">        heatL.setForeground(Color.WHITE);</span>
<span class="nc" id="L154">        heatR = new JTextArea(&quot;&quot;, 4, 25); //$NON-NLS-1$</span>
<span class="nc" id="L155">        heatR.setEditable(false);</span>
<span class="nc" id="L156">        heatR.setOpaque(false);</span>
<span class="nc" id="L157">        heatR.setForeground(Color.WHITE);</span>
        
<span class="nc" id="L159">        lblLastTarget = new JLabel(</span>
<span class="nc" id="L160">                Messages.getString(&quot;MechDisplay.LastTarget&quot;),</span>
                SwingConstants.CENTER);
<span class="nc" id="L162">        lblLastTarget.setForeground(Color.WHITE);</span>
<span class="nc" id="L163">        lblLastTarget.setOpaque(false);</span>
<span class="nc" id="L164">        lastTargetR = new JTextArea(&quot;&quot;, 4, 25); //$NON-NLS-1$</span>
<span class="nc" id="L165">        lastTargetR.setEditable(false);</span>
<span class="nc" id="L166">        lastTargetR.setOpaque(false);</span>
<span class="nc" id="L167">        lastTargetR.setForeground(Color.WHITE);</span>

<span class="nc" id="L169">        curSensorsL = new JLabel(</span>
<span class="nc" id="L170">                (Messages.getString(&quot;MechDisplay.CurrentSensors&quot;))</span>
<span class="nc" id="L171">                        .concat(&quot; &quot;),</span>
                SwingConstants.CENTER);
<span class="nc" id="L173">        curSensorsL.setForeground(Color.WHITE);</span>
<span class="nc" id="L174">        curSensorsL.setOpaque(false);</span>

<span class="nc" id="L176">        chSensors = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L177">        chSensors.addItemListener(this);</span>

<span class="nc" id="L179">        activateHidden.setToolTipText(Messages</span>
<span class="nc" id="L180">                .getString(&quot;MechDisplay.ActivateHidden.ToolTip&quot;));</span>
<span class="nc" id="L181">        activateHiddenPhase.setToolTipText(Messages</span>
<span class="nc" id="L182">                .getString(&quot;MechDisplay.ActivateHiddenPhase.ToolTip&quot;));</span>
<span class="nc" id="L183">        activateHidden.addActionListener(this);</span>
<span class="nc" id="L184">        activateHiddenPhase.addItem(IGame.Phase</span>
<span class="nc" id="L185">                .getDisplayableName(IGame.Phase.PHASE_MOVEMENT));</span>
<span class="nc" id="L186">        activateHiddenPhase.addItem(IGame.Phase</span>
<span class="nc" id="L187">                .getDisplayableName(IGame.Phase.PHASE_FIRING));</span>
<span class="nc" id="L188">        activateHiddenPhase.addItem(IGame.Phase</span>
<span class="nc" id="L189">                .getDisplayableName(IGame.Phase.PHASE_PHYSICAL));</span>
<span class="nc" id="L190">        activateHiddenPhase.addItem(Messages</span>
<span class="nc" id="L191">                .getString(&quot;MechDisplay.ActivateHidden.StopActivating&quot;));</span>

        // layout choice panel
        GridBagLayout gridbag;
        GridBagConstraints c;

<span class="nc" id="L197">        gridbag = new GridBagLayout();</span>
<span class="nc" id="L198">        c = new GridBagConstraints();</span>
<span class="nc" id="L199">        setLayout(gridbag);</span>

<span class="nc" id="L201">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L202">        c.insets = new Insets(15, 9, 1, 9);</span>
<span class="nc" id="L203">        c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L204">        c.anchor = GridBagConstraints.CENTER;</span>
<span class="nc" id="L205">        c.weighty = 1.0;</span>

<span class="nc" id="L207">        gridbag.setConstraints(curSensorsL, c);</span>
<span class="nc" id="L208">        add(curSensorsL);</span>

<span class="nc" id="L210">        gridbag.setConstraints(chSensors, c);</span>
<span class="nc" id="L211">        add(chSensors);</span>

<span class="nc" id="L213">        gridbag.setConstraints(narcLabel, c);</span>
<span class="nc" id="L214">        add(narcLabel);</span>

<span class="nc" id="L216">        c.insets = new Insets(1, 9, 1, 9);</span>
<span class="nc" id="L217">        JScrollPane scrollPane = new JScrollPane(narcList);</span>
<span class="nc" id="L218">        scrollPane</span>
<span class="nc" id="L219">                .setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);</span>
<span class="nc" id="L220">        gridbag.setConstraints(scrollPane, c);</span>
<span class="nc" id="L221">        add(scrollPane);</span>

<span class="nc" id="L223">        gridbag.setConstraints(unusedL, c);</span>
<span class="nc" id="L224">        add(unusedL);</span>

<span class="nc" id="L226">        gridbag.setConstraints(unusedR, c);</span>
<span class="nc" id="L227">        add(unusedR);</span>

<span class="nc" id="L229">        gridbag.setConstraints(carrysL, c);</span>
<span class="nc" id="L230">        add(carrysL);</span>

<span class="nc" id="L232">        gridbag.setConstraints(carrysR, c);</span>
<span class="nc" id="L233">        add(carrysR);</span>

<span class="nc" id="L235">        gridbag.setConstraints(dumpBombs, c);</span>
<span class="nc" id="L236">        add(dumpBombs);</span>

<span class="nc" id="L238">        gridbag.setConstraints(sinksL, c);</span>
<span class="nc" id="L239">        add(sinksL);</span>

<span class="nc" id="L241">        gridbag.setConstraints(sinksR, c);</span>
<span class="nc" id="L242">        add(sinksR);</span>

<span class="nc" id="L244">        gridbag.setConstraints(sinks2B, c);</span>
<span class="nc" id="L245">        add(sinks2B);</span>

<span class="nc" id="L247">        gridbag.setConstraints(heatL, c);</span>
<span class="nc" id="L248">        add(heatL);</span>

<span class="nc" id="L250">        c.insets = new Insets(1, 9, 18, 9);</span>
<span class="nc" id="L251">        gridbag.setConstraints(heatR, c);</span>
<span class="nc" id="L252">        add(heatR);</span>
        
<span class="nc" id="L254">        c.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L255">        gridbag.setConstraints(lblLastTarget, c);</span>
<span class="nc" id="L256">        add(lblLastTarget);</span>
        
<span class="nc" id="L258">        c.insets = new Insets(1, 9, 18, 9);</span>
<span class="nc" id="L259">        gridbag.setConstraints(lastTargetR, c);</span>
<span class="nc" id="L260">        add(lastTargetR);</span>

<span class="nc" id="L262">        c.insets = new Insets(1, 9, 1, 9);</span>
<span class="nc" id="L263">        gridbag.setConstraints(activateHidden, c);</span>
<span class="nc" id="L264">        c.insets = new Insets(1, 9, 6, 9);</span>
<span class="nc" id="L265">        gridbag.setConstraints(activateHiddenPhase, c);</span>
<span class="nc" id="L266">        add(activateHidden);</span>
<span class="nc" id="L267">        add(activateHiddenPhase);</span>

<span class="nc" id="L269">        setBackGround();</span>
<span class="nc" id="L270">        onResize();</span>
<span class="nc" id="L271">    }</span>

    @Override
    public void onResize() {
<span class="nc" id="L275">        int w = getSize().width;</span>
<span class="nc" id="L276">        Rectangle r = getContentBounds();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (r == null) {</span>
<span class="nc" id="L278">            return;</span>
        }
<span class="nc" id="L280">        int dx = Math.round(((w - r.width) / 2));</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (dx &lt; minLeftMargin) {</span>
<span class="nc" id="L282">            dx = minLeftMargin;</span>
        }
<span class="nc" id="L284">        int dy = minTopMargin;</span>
<span class="nc" id="L285">        setContentMargins(dx, dy, dx, dy);</span>
<span class="nc" id="L286">    }</span>

    private void setBackGround() {
        UnitDisplaySkinSpecification udSpec = SkinXMLHandler
<span class="nc" id="L290">                .getUnitDisplaySkin();</span>

<span class="nc" id="L292">        Image tile = getToolkit()</span>
<span class="nc" id="L293">                .getImage(</span>
<span class="nc" id="L294">                        new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L295">                                .getBackgroundTile()).toString());</span>
<span class="nc" id="L296">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L297">        int b = BackGroundDrawer.TILING_BOTH;</span>
<span class="nc" id="L298">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L300">        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_TOP;</span>
<span class="nc" id="L301">        tile = getToolkit().getImage(</span>
<span class="nc" id="L302">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getTopLine())</span>
<span class="nc" id="L303">                        .toString());</span>
<span class="nc" id="L304">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L305">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L307">        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_BOTTOM;</span>
<span class="nc" id="L308">        tile = getToolkit().getImage(</span>
<span class="nc" id="L309">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getBottomLine())</span>
<span class="nc" id="L310">                        .toString());</span>
<span class="nc" id="L311">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L312">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L314">        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_LEFT;</span>
<span class="nc" id="L315">        tile = getToolkit().getImage(</span>
<span class="nc" id="L316">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getLeftLine())</span>
<span class="nc" id="L317">                        .toString());</span>
<span class="nc" id="L318">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L319">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L321">        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_RIGHT;</span>
<span class="nc" id="L322">        tile = getToolkit().getImage(</span>
<span class="nc" id="L323">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getRightLine())</span>
<span class="nc" id="L324">                        .toString());</span>
<span class="nc" id="L325">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L326">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L328">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</span>
                | BackGroundDrawer.HALIGN_LEFT;
<span class="nc" id="L330">        tile = getToolkit().getImage(</span>
<span class="nc" id="L331">                new MegaMekFile(Configuration.widgetsDir(), udSpec.getTopLeftCorner())</span>
<span class="nc" id="L332">                        .toString());</span>
<span class="nc" id="L333">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L334">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L336">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</span>
                | BackGroundDrawer.HALIGN_LEFT;
<span class="nc" id="L338">        tile = getToolkit().getImage(</span>
<span class="nc" id="L339">                new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L340">                        .getBottomLeftCorner()).toString());</span>
<span class="nc" id="L341">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L342">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L344">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</span>
                | BackGroundDrawer.HALIGN_RIGHT;
<span class="nc" id="L346">        tile = getToolkit()</span>
<span class="nc" id="L347">                .getImage(</span>
<span class="nc" id="L348">                        new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L349">                                .getTopRightCorner()).toString());</span>
<span class="nc" id="L350">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L351">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L353">        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</span>
                | BackGroundDrawer.HALIGN_RIGHT;
<span class="nc" id="L355">        tile = getToolkit().getImage(</span>
<span class="nc" id="L356">                new MegaMekFile(Configuration.widgetsDir(), udSpec</span>
<span class="nc" id="L357">                        .getBottomRightCorner()).toString());</span>
<span class="nc" id="L358">        PMUtil.setImage(tile, this);</span>
<span class="nc" id="L359">        addBgDrawer(new BackGroundDrawer(tile, b));</span>

<span class="nc" id="L361">    }</span>

    /**
     * updates fields for the specified mech
     */
    public void displayMech(Entity en) {
        // Clear the &quot;Affected By&quot; list.
<span class="nc" id="L368">        ((DefaultListModel&lt;String&gt;) narcList.getModel()).removeAllElements();</span>
<span class="nc" id="L369">        sinks = 0;</span>
<span class="nc" id="L370">        myMechId = en.getId();</span>
<span class="nc" id="L371">        ClientGUI clientgui = unitDisplay.getClientGUI();</span>
<span class="nc bnc" id="L372" title="All 2 branches missed.">        if ((clientgui != null) &amp;&amp; (clientgui.getClient().getLocalPlayer().getId() != en</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">                .getOwnerId())) {</span>
<span class="nc" id="L374">            sinks2B.setEnabled(false);</span>
<span class="nc" id="L375">            dumpBombs.setEnabled(false);</span>
<span class="nc" id="L376">            chSensors.setEnabled(false);</span>
<span class="nc" id="L377">            dontChange = true;</span>
        } else {
<span class="nc" id="L379">            sinks2B.setEnabled(true);</span>
<span class="nc" id="L380">            dumpBombs.setEnabled(false);</span>
<span class="nc" id="L381">            chSensors.setEnabled(true);</span>
<span class="nc" id="L382">            dontChange = false;</span>
        }
        // Walk through the list of teams. There
        // can't be more teams than players.
        StringBuffer buff;
<span class="nc bnc" id="L387" title="All 2 branches missed.">        if (clientgui != null) {</span>
<span class="nc" id="L388">            Enumeration&lt;IPlayer&gt; loop = clientgui.getClient().getGame().getPlayers();</span>
<span class="nc bnc" id="L389" title="All 2 branches missed.">            while (loop.hasMoreElements()) {</span>
<span class="nc" id="L390">                IPlayer player = loop.nextElement();</span>
<span class="nc" id="L391">                int team = player.getTeam();</span>
<span class="nc bnc" id="L392" title="All 4 branches missed.">                if (en.isNarcedBy(team) &amp;&amp; !player.isObserver()) {</span>
<span class="nc" id="L393">                    buff = new StringBuffer(</span>
<span class="nc" id="L394">                            Messages.getString(&quot;MechDisplay.NARCedBy&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L395">                    buff.append(player.getName());</span>
<span class="nc" id="L396">                    buff.append(&quot; [&quot;)//$NON-NLS-1$</span>
<span class="nc" id="L397">                            .append(IPlayer.teamNames[team]).append(']');</span>
<span class="nc" id="L398">                    ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L399">                            .addElement(buff.toString());</span>
                }
<span class="nc bnc" id="L401" title="All 4 branches missed.">                if (en.isINarcedBy(team) &amp;&amp; !player.isObserver()) {</span>
<span class="nc" id="L402">                    buff = new StringBuffer(</span>
<span class="nc" id="L403">                            Messages.getString(&quot;MechDisplay.INarcHoming&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L404">                    buff.append(player.getName());</span>
<span class="nc" id="L405">                    buff.append(&quot; [&quot;)//$NON-NLS-1$</span>
<span class="nc" id="L406">                            .append(IPlayer.teamNames[team]).append(&quot;] &quot;)//$NON-NLS-1$</span>
<span class="nc" id="L407">                            .append(Messages.getString(&quot;MechDisplay.attached&quot;))//$NON-NLS-1$</span>
<span class="nc" id="L408">                            .append('.');</span>
<span class="nc" id="L409">                    ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L410">                            .addElement(buff.toString());</span>
                }
<span class="nc" id="L412">            }</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (en.isINarcedWith(INarcPod.ECM)) {</span>
<span class="nc" id="L414">                buff = new StringBuffer(</span>
<span class="nc" id="L415">                        Messages.getString(&quot;MechDisplay.iNarcECMPodAttached&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L416">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L417">                        .addElement(buff.toString());</span>
            }
<span class="nc bnc" id="L419" title="All 2 branches missed.">            if (en.isINarcedWith(INarcPod.HAYWIRE)) {</span>
<span class="nc" id="L420">                buff = new StringBuffer(</span>
<span class="nc" id="L421">                        Messages.getString(&quot;MechDisplay.iNarcHaywirePodAttached&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L422">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L423">                        .addElement(buff.toString());</span>
            }
<span class="nc bnc" id="L425" title="All 2 branches missed.">            if (en.isINarcedWith(INarcPod.NEMESIS)) {</span>
<span class="nc" id="L426">                buff = new StringBuffer(</span>
<span class="nc" id="L427">                        Messages.getString(&quot;MechDisplay.iNarcNemesisPodAttached&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L428">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L429">                        .addElement(buff.toString());</span>
            }

            // Show inferno track.
<span class="nc bnc" id="L433" title="All 2 branches missed.">            if (en.infernos.isStillBurning()) {</span>
<span class="nc" id="L434">                buff = new StringBuffer(</span>
<span class="nc" id="L435">                        Messages.getString(&quot;MechDisplay.InfernoBurnRemaining&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L436">                buff.append(en.infernos.getTurnsLeftToBurn());</span>
<span class="nc" id="L437">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L438">                        .addElement(buff.toString());</span>
            }
<span class="nc bnc" id="L440" title="All 4 branches missed.">            if ((en instanceof Tank) &amp;&amp; ((Tank) en).isOnFire()) {</span>
<span class="nc" id="L441">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L442">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.OnFire&quot;)); //$NON-NLS-1$
            }

            // Show electromagnic interference.
<span class="nc bnc" id="L447" title="All 2 branches missed.">            if (en.isSufferingEMI()) {</span>
<span class="nc" id="L448">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L449">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.IsEMId&quot;)); //$NON-NLS-1$
            }

            // Show ECM affect.
<span class="nc" id="L454">            Coords pos = en.getPosition();</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">            if (ComputeECM.isAffectedByAngelECM(en, pos, pos)) {</span>
<span class="nc" id="L456">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L457">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.InEnemyAngelECMField&quot;)); //$NON-NLS-1$
<span class="nc bnc" id="L459" title="All 2 branches missed.">            } else if (ComputeECM.isAffectedByECM(en, pos, pos)) {</span>
<span class="nc" id="L460">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L461">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.InEnemyECMField&quot;)); //$NON-NLS-1$
            }

            // Active Stealth Armor? If yes, we're under ECM
<span class="nc bnc" id="L466" title="All 6 branches missed.">            if (en.isStealthActive()</span>
                    &amp;&amp; ((en instanceof Mech) || (en instanceof Tank))) {
<span class="nc" id="L468">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L469">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.UnderStealth&quot;)); //$NON-NLS-1$
            }

            // burdened due to unjettisoned body-mounted missiles on BA?
<span class="nc bnc" id="L474" title="All 4 branches missed.">            if ((en instanceof BattleArmor) &amp;&amp; ((BattleArmor) en).isBurdened()) {</span>
<span class="nc" id="L475">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L476">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.Burdened&quot;)); //$NON-NLS-1$
            }

            // suffering from taser feedback?
<span class="nc bnc" id="L481" title="All 2 branches missed.">            if (en.getTaserFeedBackRounds() &gt; 0) {</span>
<span class="nc" id="L482">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L483">                        .addElement(en.getTaserFeedBackRounds()</span>
<span class="nc" id="L484">                                + &quot; &quot; + Messages.getString(&quot;MechDisplay.TaserFeedBack&quot;));//$NON-NLS-1$</span>
            }

            // taser interference?
<span class="nc bnc" id="L488" title="All 2 branches missed.">            if (en.getTaserInterference() &gt; 0) {</span>
<span class="nc" id="L489">                ((DefaultListModel&lt;String&gt;) narcList.getModel()).addElement(&quot;+&quot; //$NON-NLS-1$</span>
<span class="nc" id="L490">                        + en.getTaserInterference()</span>
                        + &quot; &quot;
<span class="nc" id="L492">                        + Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.TaserInterference&quot;));//$NON-NLS-1$
            }

            // suffering from TSEMP Interference?
<span class="nc bnc" id="L497" title="All 2 branches missed.">            if (en.getTsempEffect() == TSEMPWeapon.TSEMP_EFFECT_INTERFERENCE) {</span>
<span class="nc" id="L498">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L499">                        .addElement(Messages.getString(&quot;MechDisplay.TSEMPInterference&quot;));//$NON-NLS-1$</span>
            }

<span class="nc bnc" id="L502" title="All 2 branches missed.">            if (en.hasDamagedRHS()) {</span>
<span class="nc" id="L503">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L504">                        .addElement(Messages.getString(&quot;MechDisplay.RHSDamaged&quot;));//$NON-NLS-1$</span>
            }

            // Show Turret Locked.
<span class="nc bnc" id="L508" title="All 4 branches missed.">            if ((en instanceof Tank) &amp;&amp; !((Tank) en).hasNoTurret()</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">                    &amp;&amp; !en.canChangeSecondaryFacing()) {</span>
<span class="nc" id="L510">                ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L511">                        .addElement(Messages.getString(&quot;MechDisplay&quot; //$NON-NLS-1$</span>
                                + &quot;.Turretlocked&quot;)); //$NON-NLS-1$
            }

            // Show jammed weapons.
<span class="nc bnc" id="L516" title="All 2 branches missed.">            for (Mounted weapon : en.getWeaponList()) {</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">                if (weapon.isJammed()) {</span>
<span class="nc" id="L518">                    buff = new StringBuffer(weapon.getName());</span>
<span class="nc" id="L519">                    buff.append(Messages.getString(&quot;MechDisplay.isJammed&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L520">                    ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L521">                            .addElement(buff.toString());</span>
                }
<span class="nc" id="L523">            }</span>

            // Show breached locations.
<span class="nc bnc" id="L526" title="All 2 branches missed.">            for (int loc = 0; loc &lt; en.locations(); loc++) {</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">                if (en.getLocationStatus(loc) == ILocationExposureStatus.BREACHED) {</span>
<span class="nc" id="L528">                    buff = new StringBuffer(en.getLocationName(loc));</span>
<span class="nc" id="L529">                    buff.append(Messages.getString(&quot;MechDisplay.Breached&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L530">                    ((DefaultListModel&lt;String&gt;) narcList.getModel())</span>
<span class="nc" id="L531">                            .addElement(buff.toString());</span>
                }
            }

<span class="nc bnc" id="L535" title="All 2 branches missed.">            if (narcList.getModel().getSize() == 0) {</span>
<span class="nc" id="L536">                ((DefaultListModel&lt;String&gt;) narcList.getModel()).addElement(&quot; &quot;); //$NON-NLS-1$</span>
            }
        }


        // transport values
<span class="nc" id="L542">        String unused = en.getUnusedString();</span>
<span class="nc bnc" id="L543" title="All 2 branches missed.">        if (&quot;&quot;.equals(unused)) {</span>
<span class="nc" id="L544">            unused = Messages.getString(&quot;MechDisplay.None&quot;); //$NON-NLS-1$</span>
        }
<span class="nc" id="L546">        unusedR.setText(unused);</span>
<span class="nc" id="L547">        carrysR.setText(null);</span>
        // boolean hasText = false;
<span class="nc bnc" id="L549" title="All 2 branches missed.">        for (Entity other : en.getLoadedUnits()) {</span>
<span class="nc" id="L550">            carrysR.append(other.getShortName());</span>
<span class="nc" id="L551">            carrysR.append(&quot;\n&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L552">        }</span>

        // Show club(s).
<span class="nc bnc" id="L555" title="All 2 branches missed.">        for (Mounted club : en.getClubs()) {</span>
<span class="nc" id="L556">            carrysR.append(club.getName());</span>
<span class="nc" id="L557">            carrysR.append(&quot;\n&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L558">        }</span>

        // Show searchlight
<span class="nc bnc" id="L561" title="All 2 branches missed.">        if (en.hasSpotlight()) {</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (en.isUsingSpotlight()) {</span>
<span class="nc" id="L563">                carrysR.append(Messages.getString(&quot;MechDisplay.SearchlightOn&quot;)); //$NON-NLS-1$</span>
            } else {
<span class="nc" id="L565">                carrysR.append(Messages.getString(&quot;MechDisplay.SearchlightOff&quot;)); //$NON-NLS-1$</span>
            }
        }

        // Show Heat Effects, but only for Mechs.
<span class="nc" id="L570">        heatR.setText(&quot;&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L571">        sinksR.setText(&quot;&quot;);</span>

<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (en instanceof Mech) {</span>
<span class="nc" id="L574">            Mech m = (Mech) en;</span>

<span class="nc bnc" id="L576" title="All 2 branches missed.">            sinks2B.setEnabled(!dontChange);</span>
<span class="nc" id="L577">            sinks = m.getActiveSinksNextRound();</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">            if (m.hasDoubleHeatSinks()) {</span>
<span class="nc" id="L579">                sinksR.append(Messages.getString(</span>
                        &quot;MechDisplay.activeSinksTextDouble&quot;, //$NON-NLS-1$
<span class="nc" id="L581">                        new Object[]{Integer.valueOf(sinks),</span>
<span class="nc" id="L582">                                     Integer.valueOf(sinks * 2)}));</span>
            } else {
<span class="nc" id="L584">                sinksR.append(Messages.getString(</span>
                        &quot;MechDisplay.activeSinksTextSingle&quot;, //$NON-NLS-1$
<span class="nc" id="L586">                        new Object[]{Integer.valueOf(sinks)}));</span>
            }

<span class="nc" id="L589">            boolean hasTSM = false;</span>
<span class="nc" id="L590">            boolean mtHeat = false;</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">            if (((Mech) en).hasTSM()) {</span>
<span class="nc" id="L592">                hasTSM = true;</span>
            }

<span class="nc bnc" id="L595" title="All 2 branches missed.">            if ((clientgui != null)</span>
<span class="nc" id="L596">                    &amp;&amp; clientgui.getClient().getGame().getOptions()</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">                            .booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_HEAT)) { //$NON-NLS-1$</span>
<span class="nc" id="L598">                mtHeat = true;</span>
            }
<span class="nc" id="L600">            heatR.append(HeatEffects.getHeatEffects(en.heat, mtHeat, hasTSM));</span>
<span class="nc" id="L601">        } else {</span>
            // Non-Mechs cannot configure their heatsinks
<span class="nc" id="L603">            sinks2B.setEnabled(false);</span>
        }
        /*
         * if (en instanceof Aero &amp;&amp; ((Aero) en).hasBombs() &amp;&amp;
         * IGame.Phase.PHASE_DEPLOYMENT != clientgui.getClient().game
         * .getPhase()) { // TODO: I should at some point check and make
         * sure that this // unit has any bombs that it could dump
         * dumpBombs.setEnabled(!dontChange); } else {
         */
<span class="nc" id="L612">        dumpBombs.setEnabled(false);</span>
        // }

<span class="nc" id="L615">        refreshSensorChoices(en);</span>

<span class="nc bnc" id="L617" title="All 2 branches missed.">        if (null != en.getActiveSensor()) {</span>
<span class="nc" id="L618">            curSensorsL.setText((Messages</span>
<span class="nc" id="L619">                    .getString(&quot;MechDisplay.CurrentSensors&quot;)).concat(&quot; &quot;) //$NON-NLS-1$</span>
<span class="nc" id="L620">                    .concat(en.getSensorDesc()));</span>
        } else {
<span class="nc" id="L622">            curSensorsL.setText((Messages</span>
<span class="nc" id="L623">                    .getString(&quot;MechDisplay.CurrentSensors&quot;)).concat(&quot; &quot;)); //$NON-NLS-1$</span>
        }
        
<span class="nc bnc" id="L626" title="All 2 branches missed.">        if (en.getLastTarget() != Entity.NONE) {</span>
<span class="nc" id="L627">            lastTargetR.setText(en.getLastTargetDisplayName());</span>
        } else {
<span class="nc" id="L629">            lastTargetR.setText(Messages.getString(&quot;MechDisplay.None&quot;)); //$NON-NLS-1$</span>
        }

<span class="nc bnc" id="L632" title="All 4 branches missed.">        activateHidden.setEnabled(!dontChange &amp;&amp; en.isHidden());</span>
<span class="nc bnc" id="L633" title="All 4 branches missed.">        activateHiddenPhase.setEnabled(!dontChange &amp;&amp; en.isHidden());</span>

<span class="nc" id="L635">        onResize();</span>
<span class="nc" id="L636">    } // End public void displayMech( Entity )</span>

    private void refreshSensorChoices(Entity en) {
<span class="nc" id="L639">        chSensors.removeItemListener(this);</span>
<span class="nc" id="L640">        chSensors.removeAllItems();</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">        for (int i = 0; i &lt; en.getSensors().size(); i++) {</span>
<span class="nc" id="L642">            Sensor sensor = en.getSensors().elementAt(i);</span>
<span class="nc" id="L643">            String condition = &quot;&quot;;</span>
<span class="nc bnc" id="L644" title="All 4 branches missed.">            if (sensor.isBAP() &amp;&amp; !en.hasBAP(false)) {</span>
<span class="nc" id="L645">                condition = &quot; (Disabled)&quot;;</span>
            }
<span class="nc" id="L647">            chSensors.addItem(sensor.getDisplayName() + condition);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">            if (sensor.getType() == en.getNextSensor().getType()) {</span>
<span class="nc" id="L649">                chSensors.setSelectedIndex(i);</span>
            }
        }
<span class="nc" id="L652">        chSensors.addItemListener(this);</span>
<span class="nc" id="L653">    }</span>

    public void itemStateChanged(ItemEvent ev) {
<span class="nc" id="L656">        ClientGUI clientgui = unitDisplay.getClientGUI();</span>
<span class="nc bnc" id="L657" title="All 2 branches missed.">        if (clientgui == null) {</span>
<span class="nc" id="L658">            return;</span>
        }
        // Only act when a new item is selected
<span class="nc bnc" id="L661" title="All 2 branches missed.">        if (ev.getStateChange() != ItemEvent.SELECTED) {</span>
<span class="nc" id="L662">            return;</span>
        }
<span class="nc bnc" id="L664" title="All 2 branches missed.">        if ((ev.getItemSelectable() == chSensors)) {</span>
<span class="nc" id="L665">            int sensorIdx = chSensors.getSelectedIndex();</span>
<span class="nc" id="L666">            Entity en = clientgui.getClient().getGame().getEntity(myMechId);</span>
<span class="nc" id="L667">            Sensor s = en.getSensors().elementAt(sensorIdx);</span>
<span class="nc" id="L668">            en.setNextSensor(s);</span>
<span class="nc" id="L669">            refreshSensorChoices(en);</span>
<span class="nc" id="L670">            String sensorMsg = Messages.getString(</span>
                    &quot;MechDisplay.willSwitchAtEnd&quot;, new Object[] { //$NON-NLS-1$
<span class="nc" id="L672">                            &quot;Active Sensors&quot;, s.getDisplayName() }); //$NON-NLS-1$</span>
<span class="nc" id="L673">            clientgui.systemMessage(sensorMsg);</span>
<span class="nc" id="L674">            clientgui.getClient().sendSensorChange(myMechId, sensorIdx);</span>
        }
<span class="nc" id="L676">    }</span>

    public void actionPerformed(ActionEvent ae) {
<span class="nc" id="L679">        ClientGUI clientgui = unitDisplay.getClientGUI();</span>
<span class="nc bnc" id="L680" title="All 2 branches missed.">        if (clientgui == null) {</span>
<span class="nc" id="L681">            return;</span>
        }
<span class="nc bnc" id="L683" title="All 4 branches missed.">        if (&quot;changeSinks&quot;.equals(ae.getActionCommand()) &amp;&amp; !dontChange) { //$NON-NLS-1$</span>
<span class="nc" id="L684">            prompt = new Slider(clientgui.frame,</span>
<span class="nc" id="L685">                    Messages.getString(&quot;MechDisplay.changeSinks&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L686">                    Messages.getString(&quot;MechDisplay.changeSinks&quot;), sinks, //$NON-NLS-1$</span>
<span class="nc" id="L687">                    0, ((Mech) clientgui.getClient().getGame()</span>
<span class="nc" id="L688">                            .getEntity(myMechId)).getNumberOfSinks());</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">            if (!prompt.showDialog()) {</span>
<span class="nc" id="L690">                return;</span>
            }
<span class="nc" id="L692">            clientgui.getMenuBar().actionPerformed(ae);</span>
<span class="nc" id="L693">            int numActiveSinks = prompt.getValue();</span>

<span class="nc" id="L695">            ((Mech) clientgui.getClient().getGame().getEntity(myMechId))</span>
<span class="nc" id="L696">                    .setActiveSinksNextRound(numActiveSinks);</span>
<span class="nc" id="L697">            clientgui.getClient().sendSinksChange(myMechId, numActiveSinks);</span>
<span class="nc" id="L698">            displayMech(clientgui.getClient().getGame().getEntity(myMechId));</span>
<span class="nc bnc" id="L699" title="All 4 branches missed.">        } else if (activateHidden.equals(ae.getSource()) &amp;&amp; !dontChange) {</span>
<span class="nc" id="L700">            IGame.Phase activationPhase = IGame.Phase</span>
<span class="nc" id="L701">                    .getPhaseFromName((String) activateHiddenPhase</span>
<span class="nc" id="L702">                            .getSelectedItem());</span>
<span class="nc" id="L703">            clientgui.getClient().sendActivateHidden(myMechId, activationPhase);</span>
        }
<span class="nc" id="L705">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>