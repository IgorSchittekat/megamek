<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ForceGenerationOptionsPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">ForceGenerationOptionsPanel.java</span></div><h1>ForceGenerationOptionsPanel.java</h1><pre class="source lang-java linenums">/*
 * MegaMek -
 * Copyright (C) 2016, 2020 - The MegaMek Team. All rights reserved.
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.client.ui.swing;

import java.awt.BorderLayout;
import java.awt.CardLayout;
import java.awt.Component;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.util.*;
import java.util.stream.Collectors;
import java.util.stream.IntStream;

import javax.swing.AbstractButton;
import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.DefaultListCellRenderer;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SwingConstants;

import megamek.client.ratgenerator.FactionRecord;
import megamek.client.ratgenerator.FormationType;
import megamek.client.ratgenerator.MissionRole;
import megamek.client.ratgenerator.ModelRecord;
import megamek.client.ratgenerator.RATGenerator;
import megamek.client.ratgenerator.UnitTable;
import megamek.client.ratgenerator.UnitTable.Parameters;
import megamek.client.ui.Messages;
import megamek.common.EntityMovementMode;
import megamek.common.EntityWeightClass;
import megamek.common.MechSummary;
import megamek.common.UnitType;

/**
 * Panel that allows choice of year, faction, rating, unit type
 *
 * @author Neoancient
 */
class ForceGenerationOptionsPanel extends JPanel implements ActionListener, FocusListener {
    //region Variable Declarations
    private static final long serialVersionUID = -3462304612643343012L;

<span class="nc" id="L68">    public enum Use {</span>
<span class="nc" id="L69">        RAT_GENERATOR, FORMATION_BUILDER //, FORCE_GENERATOR</span>
    }

<span class="nc" id="L72">    private JTextField txtNumUnits = new JTextField(3);</span>
<span class="nc" id="L73">    private JTextField txtYear = new JTextField(4);</span>
<span class="nc" id="L74">    private JComboBox&lt;FactionRecord&gt; cbFaction = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L75">    private JComboBox&lt;FactionRecord&gt; cbSubfaction = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L76">    private JCheckBox chkShowMinor = new JCheckBox(</span>
<span class="nc" id="L77">            Messages.getString(&quot;RandomArmyDialog.ShowMinorFactions&quot;));</span>
<span class="nc" id="L78">    private JComboBox&lt;String&gt; cbUnitType = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L79">    private JComboBox&lt;String&gt; cbRating = new JComboBox&lt;&gt;();</span>

    private UnitTypeOptions panUnitTypeOptions;

    private int ratGenYear;

<span class="nc" id="L85">    private static final int[] UNIT_TYPES = {</span>
        UnitType.MEK, UnitType.TANK, UnitType.BATTLE_ARMOR, UnitType.INFANTRY, UnitType.PROTOMEK,
        UnitType.VTOL, UnitType.NAVAL, UnitType.CONV_FIGHTER, UnitType.AERO, UnitType.SMALL_CRAFT,
        UnitType.DROPSHIP, UnitType.JUMPSHIP, UnitType.WARSHIP
    };
    private static final int EARLIEST_YEAR = 2398;
    private static final int LATEST_YEAR = 3150;
    //endregion Variable Declarations

    //region Constructors
<span class="nc" id="L95">    public ForceGenerationOptionsPanel(Use use) {</span>
<span class="nc" id="L96">        setLayout(new GridBagLayout());</span>
        
<span class="nc" id="L98">        GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L99">        c.gridx = 0;</span>
<span class="nc" id="L100">        c.gridy = 0;</span>
<span class="nc" id="L101">        c.gridwidth = 1;</span>
<span class="nc" id="L102">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L103">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L104">        c.weightx = 0.0;</span>
<span class="nc" id="L105">        c.weighty = 0.0;</span>
<span class="nc" id="L106">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Year&quot;)), c);</span>

<span class="nc" id="L108">        c = new GridBagConstraints();</span>
<span class="nc" id="L109">        c.gridx = 1;</span>
<span class="nc" id="L110">        c.gridy = 0;</span>
<span class="nc" id="L111">        c.gridwidth = 1;</span>
<span class="nc" id="L112">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L113">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L114">        c.weightx = 0.0;</span>
<span class="nc" id="L115">        c.weighty = 0.0;</span>
<span class="nc" id="L116">        add(txtYear, c);</span>
<span class="nc" id="L117">        txtYear.setText(String.valueOf(ratGenYear));</span>
<span class="nc" id="L118">        txtYear.addFocusListener(this);</span>

<span class="nc" id="L120">        c = new GridBagConstraints();</span>
<span class="nc" id="L121">        c.gridx = 2;</span>
<span class="nc" id="L122">        c.gridy = 0;</span>
<span class="nc" id="L123">        c.gridwidth = 1;</span>
<span class="nc" id="L124">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L125">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L126">        c.weightx = 0.0;</span>
<span class="nc" id="L127">        c.weighty = 0.0;</span>
<span class="nc" id="L128">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Unit&quot;)), c);</span>

<span class="nc" id="L130">        txtNumUnits.setText(&quot;4&quot;);</span>

<span class="nc" id="L132">        c = new GridBagConstraints();</span>
<span class="nc" id="L133">        c.gridx = 3;</span>
<span class="nc" id="L134">        c.gridy = 0;</span>
<span class="nc" id="L135">        c.gridwidth = 1;</span>
<span class="nc" id="L136">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L137">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L138">        c.weightx = 0.0;</span>
<span class="nc" id="L139">        c.weighty = 0.0;</span>
<span class="nc" id="L140">        add(txtNumUnits, c);</span>

<span class="nc" id="L142">        c = new GridBagConstraints();</span>
<span class="nc" id="L143">        c.gridx = 0;</span>
<span class="nc" id="L144">        c.gridy = 1;</span>
<span class="nc" id="L145">        c.gridwidth = 1;</span>
<span class="nc" id="L146">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L147">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L148">        c.weightx = 0.0;</span>
<span class="nc" id="L149">        c.weighty = 0.0;</span>
<span class="nc" id="L150">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Faction&quot;)), c);</span>

<span class="nc" id="L152">        c = new GridBagConstraints();</span>
<span class="nc" id="L153">        c.gridx = 1;</span>
<span class="nc" id="L154">        c.gridy = 1;</span>
<span class="nc" id="L155">        c.gridwidth = 1;</span>
<span class="nc" id="L156">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L157">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L158">        c.weightx = 0.0;</span>
<span class="nc" id="L159">        c.weighty = 0.0;</span>
<span class="nc" id="L160">        add(cbFaction, c);</span>
<span class="nc" id="L161">        cbFaction.setRenderer(factionCbRenderer);</span>
<span class="nc" id="L162">        cbFaction.addActionListener(this);</span>

<span class="nc" id="L164">        c = new GridBagConstraints();</span>
<span class="nc" id="L165">        c.gridx = 0;</span>
<span class="nc" id="L166">        c.gridy = 2;</span>
<span class="nc" id="L167">        c.gridwidth = 1;</span>
<span class="nc" id="L168">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L169">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L170">        c.weightx = 0.0;</span>
<span class="nc" id="L171">        c.weighty = 0.0;</span>
<span class="nc" id="L172">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Command&quot;)), c);</span>

<span class="nc" id="L174">        c = new GridBagConstraints();</span>
<span class="nc" id="L175">        c.gridx = 1;</span>
<span class="nc" id="L176">        c.gridy = 2;</span>
<span class="nc" id="L177">        c.gridwidth = 1;</span>
<span class="nc" id="L178">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L179">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L180">        c.weightx = 0.0;</span>
<span class="nc" id="L181">        c.weighty = 0.0;</span>
<span class="nc" id="L182">        add(cbSubfaction, c);</span>
<span class="nc" id="L183">        cbSubfaction.setRenderer(factionCbRenderer);</span>
<span class="nc" id="L184">        cbSubfaction.addActionListener(this);</span>

<span class="nc" id="L186">        c = new GridBagConstraints();</span>
<span class="nc" id="L187">        c.gridx = 2;</span>
<span class="nc" id="L188">        c.gridy = 1;</span>
<span class="nc" id="L189">        c.gridwidth = 1;</span>
<span class="nc" id="L190">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L191">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L192">        c.weightx = 0.0;</span>
<span class="nc" id="L193">        c.weighty = 0.0;</span>
<span class="nc" id="L194">        add(chkShowMinor, c);</span>
<span class="nc" id="L195">        chkShowMinor.addActionListener(this);</span>

<span class="nc" id="L197">        c = new GridBagConstraints();</span>
<span class="nc" id="L198">        c.gridx = 0;</span>
<span class="nc" id="L199">        c.gridy = 3;</span>
<span class="nc" id="L200">        c.gridwidth = 1;</span>
<span class="nc" id="L201">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L202">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L203">        c.weightx = 0.0;</span>
<span class="nc" id="L204">        c.weighty = 0.0;</span>
<span class="nc" id="L205">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.UnitType&quot;)), c);</span>

<span class="nc bnc" id="L207" title="All 2 branches missed.">        boolean restrictUnitType = use == Use.FORMATION_BUILDER;</span>
        
<span class="nc bnc" id="L209" title="All 2 branches missed.">        for (int unitType : UNIT_TYPES) {</span>
<span class="nc bnc" id="L210" title="All 4 branches missed.">            if ((unitType &lt; UnitType.JUMPSHIP) || !restrictUnitType) {</span>
<span class="nc" id="L211">                cbUnitType.addItem(UnitType.getTypeName(unitType));</span>
            }
        }
<span class="nc" id="L214">        cbUnitType.setSelectedItem(0);</span>
<span class="nc" id="L215">        cbUnitType.addActionListener(this);</span>

<span class="nc" id="L217">        c = new GridBagConstraints();</span>
<span class="nc" id="L218">        c.gridx = 1;</span>
<span class="nc" id="L219">        c.gridy = 3;</span>
<span class="nc" id="L220">        c.gridwidth = 1;</span>
<span class="nc" id="L221">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L222">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L223">        c.weightx = 0.0;</span>
<span class="nc" id="L224">        c.weighty = 0.0;</span>
<span class="nc" id="L225">        add(cbUnitType, c);</span>

<span class="nc" id="L227">        c = new GridBagConstraints();</span>
<span class="nc" id="L228">        c.gridx = 2;</span>
<span class="nc" id="L229">        c.gridy = 3;</span>
<span class="nc" id="L230">        c.gridwidth = 1;</span>
<span class="nc" id="L231">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L232">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L233">        c.weightx = 0.0;</span>
<span class="nc" id="L234">        c.weighty = 0.0;</span>
<span class="nc" id="L235">        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Rating&quot;)), c);</span>

<span class="nc" id="L237">        c = new GridBagConstraints();</span>
<span class="nc" id="L238">        c.gridx = 3;</span>
<span class="nc" id="L239">        c.gridy = 3;</span>
<span class="nc" id="L240">        c.gridwidth = 1;</span>
<span class="nc" id="L241">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L242">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L243">        c.weightx = 0.0;</span>
<span class="nc" id="L244">        c.weighty = 0.0;</span>
<span class="nc" id="L245">        add(cbRating, c);</span>

<span class="nc bnc" id="L247" title="All 3 branches missed.">        switch (use) {</span>
            case RAT_GENERATOR:
<span class="nc" id="L249">                panUnitTypeOptions = new RATGenUnitTypeOptions();</span>
<span class="nc" id="L250">                break;</span>
            case FORMATION_BUILDER:
<span class="nc" id="L252">                panUnitTypeOptions = new FormationUnitTypeOptions();</span>
                break;
        }

<span class="nc" id="L256">        c = new GridBagConstraints();</span>
<span class="nc" id="L257">        c.gridx = 0;</span>
<span class="nc" id="L258">        c.gridy = 4;</span>
<span class="nc" id="L259">        c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L260">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L261">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L262">        c.weightx = 0.0;</span>
<span class="nc" id="L263">        c.weighty = 0.5;</span>
<span class="nc" id="L264">        add(panUnitTypeOptions, c);</span>

<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (!RATGenerator.getInstance().isInitialized()) {</span>
<span class="nc" id="L267">            RATGenerator.getInstance().registerListener(this);</span>
        }
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (RATGenerator.getInstance().isInitialized()) {</span>
<span class="nc" id="L270">            updateFactionChoice();</span>
        }

<span class="nc bnc" id="L273" title="All 2 branches missed.">        if (panUnitTypeOptions != null) {</span>
<span class="nc" id="L274">            panUnitTypeOptions.optionsChanged();</span>
        }
<span class="nc" id="L276">    }</span>
    //endregion Constructors

    public int getNumUnits() {
<span class="nc" id="L280">        return Integer.parseInt(txtNumUnits.getText());</span>
    }

    public int getYear() {
<span class="nc" id="L284">        return Integer.parseInt(txtYear.getText());</span>
    }

    public FactionRecord getFaction() {
<span class="nc bnc" id="L288" title="All 2 branches missed.">        if (cbSubfaction.getSelectedItem() == null) {</span>
<span class="nc" id="L289">            return (FactionRecord) cbFaction.getSelectedItem();</span>
        } else {
<span class="nc" id="L291">            return (FactionRecord) cbSubfaction.getSelectedItem();</span>
        }
    }

    public Integer getUnitType() {
<span class="nc" id="L296">        String unitType = (String) cbUnitType.getSelectedItem();</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">        return ModelRecord.parseUnitType((unitType == null) ? &quot;&quot; : unitType);</span>
    }

    public String getRating() {
<span class="nc" id="L301">        return (String) cbRating.getSelectedItem();</span>
    }

    public void setYear(int year) {
<span class="nc" id="L305">        ratGenYear = year;</span>
<span class="nc" id="L306">        txtYear.setText(String.valueOf(year));</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">        if (RATGenerator.getInstance().isInitialized()) {</span>
<span class="nc" id="L308">            updateFactionChoice();</span>
        }
<span class="nc" id="L310">    }</span>

    public Integer getIntegerOption(String key) {
<span class="nc bnc" id="L313" title="All 2 branches missed.">        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getIntegerVal(key);</span>
    }

    public Boolean getBooleanOption(String key) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getBooleanVal(key);</span>
    }

    public String getStringOption(String key) {
<span class="nc bnc" id="L321" title="All 2 branches missed.">        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getStringVal(key);</span>
    }

    public List&lt;?&gt; getListOption(String key) {
<span class="nc bnc" id="L325" title="All 2 branches missed.">        return (panUnitTypeOptions == null) ? new ArrayList&lt;&gt;() : panUnitTypeOptions.getListVal(key);</span>
    }

    public void updateFactionChoice() {
<span class="nc" id="L329">        FactionRecord old = (FactionRecord)cbFaction.getSelectedItem();</span>
<span class="nc" id="L330">        cbFaction.removeActionListener(this);</span>
<span class="nc" id="L331">        cbFaction.removeAllItems();</span>
<span class="nc" id="L332">        List&lt;FactionRecord&gt; recs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">        for (FactionRecord fRec : RATGenerator.getInstance().getFactionList()) {</span>
<span class="nc bnc" id="L334" title="All 4 branches missed.">            if ((!fRec.isMinor() || chkShowMinor.isSelected())</span>
<span class="nc bnc" id="L335" title="All 4 branches missed.">                    &amp;&amp; !fRec.getKey().contains(&quot;.&quot;) &amp;&amp; fRec.isActiveInYear(ratGenYear)) {</span>
<span class="nc" id="L336">                recs.add(fRec);</span>
            }
<span class="nc" id="L338">        }</span>
<span class="nc" id="L339">        recs.sort(factionSorter);</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">        for (FactionRecord fRec : recs) {</span>
<span class="nc" id="L341">            cbFaction.addItem(fRec);</span>
<span class="nc" id="L342">        }</span>
<span class="nc" id="L343">        cbFaction.setSelectedItem(old);</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">        if (cbFaction.getSelectedItem() == null) {</span>
<span class="nc" id="L345">            cbFaction.setSelectedItem(RATGenerator.getInstance().getFaction(&quot;IS&quot;));</span>
        }
<span class="nc" id="L347">        updateSubfactionChoice();</span>
<span class="nc" id="L348">        cbFaction.addActionListener(this);</span>
<span class="nc" id="L349">    }</span>

    public void updateSubfactionChoice() {
<span class="nc" id="L352">        FactionRecord old = (FactionRecord)cbSubfaction.getSelectedItem();</span>
<span class="nc" id="L353">        cbSubfaction.removeActionListener(this);</span>
<span class="nc" id="L354">        cbSubfaction.removeAllItems();</span>
<span class="nc" id="L355">        FactionRecord selectedFaction = (FactionRecord)cbFaction.getSelectedItem();</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">        if (selectedFaction != null) {</span>
<span class="nc" id="L357">            List&lt;FactionRecord&gt; recs = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">            for (FactionRecord fRec : RATGenerator.getInstance().getFactionList()) {</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">                if (fRec.getKey().startsWith(selectedFaction.getKey() + &quot;.&quot;)</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">                        &amp;&amp; fRec.isActiveInYear(ratGenYear)) {</span>
<span class="nc" id="L361">                    recs.add(fRec);</span>
                }
<span class="nc" id="L363">            }</span>
<span class="nc" id="L364">            recs.sort(factionSorter);</span>
<span class="nc" id="L365">            cbSubfaction.addItem(null); //No specific subcommand.</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">            for (FactionRecord fRec : recs) {</span>
<span class="nc" id="L367">                cbSubfaction.addItem(fRec);</span>
<span class="nc" id="L368">            }</span>
        }
<span class="nc" id="L370">        cbSubfaction.setSelectedItem(old);</span>
<span class="nc" id="L371">        updateRatingChoice();</span>
<span class="nc" id="L372">        cbSubfaction.addActionListener(this);</span>
<span class="nc" id="L373">    }</span>

    /**
     * When faction or subfaction is changed, refresh ratings combo box with appropriate
     * values for selected faction.
     */
    public void updateRatingChoice() {
<span class="nc" id="L380">        int current = cbRating.getSelectedIndex();</span>
<span class="nc" id="L381">        cbRating.removeAllItems();</span>
<span class="nc" id="L382">        FactionRecord fRec = (FactionRecord) cbSubfaction.getSelectedItem();</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (fRec == null) {</span>
            // Subfaction is &quot;general&quot;
<span class="nc" id="L385">            fRec = (FactionRecord) cbFaction.getSelectedItem();</span>
        }
<span class="nc bnc" id="L387" title="All 2 branches missed.">        if (fRec == null) {</span>
<span class="nc" id="L388">            fRec = RATGenerator.getInstance().getFaction(&quot;IS&quot;);</span>
        }
<span class="nc" id="L390">        List&lt;String&gt; ratingLevels = fRec.getRatingLevels();</span>

<span class="nc bnc" id="L392" title="All 2 branches missed.">        if (ratingLevels.isEmpty()) {</span>
            // Get rating levels from parent faction(s)
<span class="nc" id="L394">            ratingLevels = fRec.getRatingLevelSystem();</span>
        }
<span class="nc bnc" id="L396" title="All 2 branches missed.">        if (ratingLevels.size() &gt; 1) {</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">            for (int i = ratingLevels.size() - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L398">                cbRating.addItem(ratingLevels.get(i));</span>
            }
        }
<span class="nc bnc" id="L401" title="All 4 branches missed.">        if (current &lt; 0 &amp;&amp; cbRating.getItemCount() &gt; 0) {</span>
<span class="nc" id="L402">            cbRating.setSelectedIndex(0);</span>
        } else {
<span class="nc" id="L404">            cbRating.setSelectedIndex(Math.min(current, cbRating.getItemCount() - 1));</span>
        }
<span class="nc" id="L406">    }</span>

    @Override
    public void actionPerformed(ActionEvent ev) {
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (ev.getSource().equals(cbFaction)) {</span>
<span class="nc" id="L411">            updateSubfactionChoice();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">        } else if (ev.getSource().equals(cbSubfaction)) {</span>
<span class="nc" id="L413">            updateRatingChoice();</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">        } else if (ev.getSource().equals(chkShowMinor)) {</span>
<span class="nc" id="L415">            updateFactionChoice();</span>
<span class="nc bnc" id="L416" title="All 2 branches missed.">        } else if (ev.getSource().equals(cbUnitType)) {</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">            if (panUnitTypeOptions != null) {</span>
<span class="nc" id="L418">                panUnitTypeOptions.optionsChanged();</span>
            }
<span class="nc bnc" id="L420" title="All 2 branches missed.">        } else if (ev.getActionCommand().equals(&quot;ratGenInitialized&quot;)) {</span>
<span class="nc" id="L421">            updateFactionChoice();</span>
<span class="nc" id="L422">            RATGenerator.getInstance().removeListener(this);</span>
<span class="nc" id="L423">            RATGenerator.getInstance().loadYear(ratGenYear);</span>
        }
<span class="nc" id="L425">    }</span>

    @Override
    public void focusGained(FocusEvent e) {
        //ignored
<span class="nc" id="L430">    }</span>

    @Override
    public void focusLost(FocusEvent e) {
<span class="nc bnc" id="L434" title="All 2 branches missed.">        if (e.getSource().equals(txtYear)) {</span>
            try {
<span class="nc" id="L436">                ratGenYear = Integer.parseInt(txtYear.getText());</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">                if (ratGenYear &lt; EARLIEST_YEAR) {</span>
<span class="nc" id="L438">                    ratGenYear = EARLIEST_YEAR;</span>
<span class="nc bnc" id="L439" title="All 2 branches missed.">                } else if (ratGenYear &gt; LATEST_YEAR) {</span>
<span class="nc" id="L440">                    ratGenYear = LATEST_YEAR;</span>
                }
<span class="nc" id="L442">            } catch (NumberFormatException ex) {</span>
                //ignore and restore to previous value
<span class="nc" id="L444">            }</span>
<span class="nc" id="L445">            setYear(ratGenYear);</span>
<span class="nc" id="L446">            RATGenerator.getInstance().loadYear(ratGenYear);</span>
        }
<span class="nc" id="L448">    }</span>
    
    public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {
<span class="nc" id="L451">        panUnitTypeOptions.updateGeneratedUnits(list);</span>
<span class="nc" id="L452">    }</span>

<span class="nc" id="L454">    private DefaultListCellRenderer factionCbRenderer = new DefaultListCellRenderer() {</span>
        private static final long serialVersionUID = -333065979253244440L;

        @Override
        public Component getListCellRendererComponent(JList&lt;?&gt; list, Object value, int index,
                                                      boolean isSelected, boolean cellHasFocus) {
<span class="nc bnc" id="L460" title="All 2 branches missed.">            if (value == null) {</span>
<span class="nc" id="L461">                setText(&quot;General&quot;);</span>
            } else {
<span class="nc" id="L463">                setText(((FactionRecord) value).getName(ratGenYear));</span>
            }
<span class="nc" id="L465">            return this;</span>
        }
    };
    
<span class="nc" id="L469">    private Comparator&lt;FactionRecord&gt; factionSorter = new Comparator&lt;FactionRecord&gt;() {</span>
        @Override
        public int compare(FactionRecord o1, FactionRecord o2) {
<span class="nc" id="L472">            return o1.getName(ratGenYear).compareTo(o2.getName(ratGenYear));</span>
        }
    };

    /**
     * Additional options that are conditional on the selected unit type can be added
     */
<span class="nc" id="L479">    abstract static class UnitTypeOptions extends JPanel {</span>
        private static final long serialVersionUID = -7141802206126462796L;

        abstract public void optionsChanged();
        
        public Integer getIntegerVal(String key) {
<span class="nc" id="L485">            return null;</span>
        }
        
        public Boolean getBooleanVal(String key) {
<span class="nc" id="L489">            return null;</span>
        }
        
        public String getStringVal(String key) {
<span class="nc" id="L493">            return null;</span>
        }
        
        public List&lt;?&gt; getListVal(String key) {
<span class="nc" id="L497">            return new ArrayList&lt;&gt;();</span>
        }
        
        public abstract void updateGeneratedUnits(List&lt;MechSummary&gt; list);
    }
    
    public class RATGenUnitTypeOptions extends UnitTypeOptions {
        private static final long serialVersionUID = 6536972747395725718L;

<span class="nc" id="L506">        private Map&lt;String, RATGenUnitTypeCard&gt; cardMap = new HashMap&lt;&gt;();</span>
        
<span class="nc" id="L508">        public RATGenUnitTypeOptions() {</span>
<span class="nc" id="L509">            setLayout(new CardLayout());</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">            for (int i = 0; i &lt; cbUnitType.getItemCount(); i++) {</span>
<span class="nc" id="L511">                int ut = ModelRecord.parseUnitType(cbUnitType.getItemAt(i));</span>
<span class="nc" id="L512">                RATGenUnitTypeCard card = new RATGenUnitTypeCard(ut);</span>
<span class="nc" id="L513">                cardMap.put(cbUnitType.getItemAt(i), card);</span>
<span class="nc" id="L514">                add(card, cbUnitType.getItemAt(i));</span>
            }
<span class="nc" id="L516">        }</span>
        
        public void optionsChanged() {
<span class="nc" id="L519">            ((CardLayout) getLayout()).show(this, (String) cbUnitType.getSelectedItem());</span>
<span class="nc" id="L520">        }</span>
        
        private RATGenUnitTypeCard currentCard() {
<span class="nc" id="L523">            String selectedCard = (String) cbUnitType.getSelectedItem();</span>
<span class="nc" id="L524">            return cardMap.get(selectedCard);</span>
        }
        
        @Override
        public Integer getIntegerVal(String key) {
<span class="nc bnc" id="L529" title="All 3 branches missed.">            switch (key) {</span>
                case &quot;networkMask&quot;:
<span class="nc" id="L531">                    return currentCard().getNetworkMask();</span>
                case &quot;roleStrictness&quot;:
<span class="nc" id="L533">                    return currentCard().getRoleStrictness();</span>
                default:
<span class="nc" id="L535">                    return null;</span>
            }
        }
        
        @Override
        public List&lt;?&gt; getListVal(String key) {
<span class="nc bnc" id="L541" title="All 4 branches missed.">            switch(key) {</span>
                case &quot;weightClasses&quot;:
<span class="nc" id="L543">                    return currentCard().getSelectedWeights();</span>
                case &quot;motiveTypes&quot;:
<span class="nc" id="L545">                    return currentCard().getMotiveTypes();</span>
                case &quot;roles&quot;:
<span class="nc" id="L547">                    return currentCard().getSelectedRoles();</span>
                default:
<span class="nc" id="L549">                    return new ArrayList&lt;&gt;();</span>
            }
        }

        public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {

<span class="nc" id="L555">        }</span>
    }

    /**
     * Options that vary according to unit type
     */
    private static class RATGenUnitTypeCard extends JPanel {
        private static final long serialVersionUID = -3961143911841133921L;

<span class="nc" id="L564">        private JComboBox&lt;String&gt; cbWeightClass = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L565">        private List&lt;JCheckBox&gt; weightChecks = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L566">        private JComboBox&lt;String&gt; cbRoleStrictness = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L567">        private List&lt;JCheckBox&gt; roleChecks = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L568">        private ButtonGroup networkButtons = new ButtonGroup();</span>
<span class="nc" id="L569">        private List&lt;JCheckBox&gt; subtypeChecks = new ArrayList&lt;&gt;();</span>
        
<span class="nc" id="L571">        public RATGenUnitTypeCard(int unitType) {</span>
<span class="nc" id="L572">            setLayout(new BorderLayout());</span>

<span class="nc" id="L574">            JPanel panWeightClass = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L575">            panWeightClass.setBorder(BorderFactory.createTitledBorder(Messages</span>
<span class="nc" id="L576">                    .getString(&quot;RandomArmyDialog.WeightClass&quot;)));</span>
<span class="nc" id="L577">            add(panWeightClass, BorderLayout.WEST);</span>
            
<span class="nc" id="L579">            JPanel panRoles = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L580">            panRoles.setBorder(BorderFactory.createTitledBorder(Messages</span>
<span class="nc" id="L581">                    .getString(&quot;RandomArmyDialog.MissionRole&quot;)));</span>
            
<span class="nc" id="L583">            JPanel panStrictness = new JPanel();</span>
<span class="nc" id="L584">            panStrictness.add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Strictness&quot;)));</span>
<span class="nc" id="L585">            cbRoleStrictness.setToolTipText(Messages.getString(&quot;RandomArmyDialog.Strictness.tooltip&quot;));</span>
<span class="nc" id="L586">            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.Low&quot;));</span>
<span class="nc" id="L587">            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.Medium&quot;));</span>
<span class="nc" id="L588">            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.High&quot;));</span>
<span class="nc" id="L589">            cbRoleStrictness.setSelectedIndex(1);</span>
<span class="nc" id="L590">            panStrictness.add(cbRoleStrictness);</span>
            
<span class="nc" id="L592">            GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L593">            c.gridx = 0;</span>
<span class="nc" id="L594">            c.gridy = 0;</span>
<span class="nc" id="L595">            c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L596">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L597">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L598">            c.weightx = 0.0;</span>
<span class="nc" id="L599">            c.weighty = 0.0;</span>
<span class="nc" id="L600">            panRoles.add(panStrictness, c);</span>
            
<span class="nc" id="L602">            add(panRoles, BorderLayout.CENTER);</span>

<span class="nc" id="L604">            JPanel panNetwork = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L605">            panNetwork.setBorder(BorderFactory.createTitledBorder(Messages</span>
<span class="nc" id="L606">                    .getString(&quot;RandomArmyDialog.Network&quot;)));</span>
<span class="nc" id="L607">            add(panNetwork, BorderLayout.EAST);</span>
            
<span class="nc" id="L609">            JPanel panMotive = new JPanel();</span>
<span class="nc" id="L610">            add(panMotive, BorderLayout.NORTH);</span>
            
<span class="nc bnc" id="L612" title="All 8 branches missed.">            switch(unitType) {</span>
                case UnitType.MEK:
<span class="nc" id="L614">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_ULTRA_LIGHT,</span>
                            EntityWeightClass.WEIGHT_COLOSSAL, false);
<span class="nc" id="L616">                    break;</span>
                case UnitType.NAVAL:
                case UnitType.TANK:
<span class="nc" id="L619">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</span>
                            EntityWeightClass.WEIGHT_ASSAULT, false);
<span class="nc" id="L621">                    break;</span>
                case UnitType.PROTOMEK:
<span class="nc" id="L623">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</span>
                            EntityWeightClass.WEIGHT_ASSAULT, true);
<span class="nc" id="L625">                    break;</span>
                case UnitType.BATTLE_ARMOR:
<span class="nc" id="L627">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_ULTRA_LIGHT,</span>
                            EntityWeightClass.WEIGHT_ASSAULT, true);
<span class="nc" id="L629">                    break;</span>
                case UnitType.AERO:
<span class="nc" id="L631">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</span>
                            EntityWeightClass.WEIGHT_HEAVY, false);
<span class="nc" id="L633">                    break;</span>
                case UnitType.DROPSHIP:
<span class="nc" id="L635">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_SMALL_DROP,</span>
                            EntityWeightClass.WEIGHT_LARGE_DROP, true);
<span class="nc" id="L637">                    break;</span>
                case UnitType.WARSHIP:
<span class="nc" id="L639">                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_SMALL_WAR,</span>
                            EntityWeightClass.WEIGHT_LARGE_WAR, true);
<span class="nc" id="L641">                    break;</span>
                default:
<span class="nc" id="L643">                    panWeightClass.setVisible(false);</span>
            }
            
<span class="nc bnc" id="L646" title="All 2 branches missed.">            for (MissionRole role : MissionRole.values()) {</span>
<span class="nc bnc" id="L647" title="All 2 branches missed.">                if (role.fitsUnitType(unitType)) {</span>
<span class="nc" id="L648">                    JCheckBox chk = new JCheckBox(Messages.getString(&quot;MissionRole.&quot;</span>
<span class="nc" id="L649">                            + role.toString()));</span>
<span class="nc" id="L650">                    chk.setToolTipText(Messages.getString(&quot;MissionRole.&quot;</span>
<span class="nc" id="L651">                            + role.toString() + &quot;.tooltip&quot;));</span>
<span class="nc" id="L652">                    chk.setName(role.toString());</span>
<span class="nc" id="L653">                    roleChecks.add(chk);</span>
                }
            }
<span class="nc" id="L656">            roleChecks.sort(Comparator.comparing(AbstractButton::getText));</span>
<span class="nc" id="L657">            c = new GridBagConstraints();</span>
<span class="nc" id="L658">            c.gridwidth = 1;</span>
<span class="nc" id="L659">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L660">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L661">            c.weightx = 0.0;</span>
<span class="nc" id="L662">            c.weighty = 0.0;</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">            for (int i = 0; i &lt; roleChecks.size(); i++) {</span>
<span class="nc" id="L664">                c.gridx = i % 3;</span>
<span class="nc" id="L665">                c.gridy = i / 3 + 1;</span>
<span class="nc bnc" id="L666" title="All 2 branches missed.">                if (c.gridx == 2) {</span>
<span class="nc" id="L667">                    c.weightx = 1.0;</span>
                } else {
<span class="nc" id="L669">                    c.weightx = 0.0;</span>
                }
<span class="nc bnc" id="L671" title="All 2 branches missed.">                if (i == roleChecks.size() - 1) {</span>
<span class="nc" id="L672">                    c.weighty = 1.0;</span>
                }
<span class="nc" id="L674">                panRoles.add(roleChecks.get(i), c);</span>
            }
            
<span class="nc" id="L677">            c = new GridBagConstraints();</span>
<span class="nc" id="L678">            c.gridx = 0;</span>
<span class="nc" id="L679">            c.gridy = 0;</span>
<span class="nc" id="L680">            c.gridwidth = 1;</span>
<span class="nc" id="L681">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L682">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L683">            c.weightx = 0.0;</span>
<span class="nc" id="L684">            c.weighty = 0.0;</span>

<span class="nc bnc" id="L686" title="All 4 branches missed.">            switch (unitType) {</span>
                case UnitType.MEK:
                case UnitType.TANK:
                case UnitType.VTOL:
                case UnitType.NAVAL:
                case UnitType.CONV_FIGHTER:
                case UnitType.AERO:
<span class="nc" id="L693">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</span>
                            ModelRecord.NETWORK_NONE);
<span class="nc" id="L695">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3S&quot;),</span>
                            ModelRecord.NETWORK_C3_SLAVE);
<span class="nc" id="L697">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3M&quot;),</span>
                            ModelRecord.NETWORK_C3_MASTER);
<span class="nc" id="L699">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3I&quot;),</span>
                            ModelRecord.NETWORK_C3I);
<span class="nc" id="L701">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3SB&quot;),</span>
                            ModelRecord.NETWORK_BOOSTED_SLAVE);
<span class="nc" id="L703">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3MB&quot;),</span>
                            ModelRecord.NETWORK_BOOSTED_MASTER);
<span class="nc" id="L705">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3CC&quot;),</span>
                            ModelRecord.NETWORK_COMPANY_COMMAND);
<span class="nc" id="L707">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3CCB&quot;),</span>
                            ModelRecord.NETWORK_COMPANY_COMMAND|ModelRecord.NETWORK_BOOSTED);
<span class="nc" id="L709">                    c.weighty = 1.0;</span>
<span class="nc" id="L710">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.Nova&quot;),</span>
                            ModelRecord.NETWORK_NOVA);
<span class="nc" id="L712">                    break;</span>
                case UnitType.BATTLE_ARMOR:
<span class="nc" id="L714">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</span>
                            ModelRecord.NETWORK_NONE);
<span class="nc" id="L716">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3BA&quot;),</span>
                            ModelRecord.NETWORK_BA_C3);
<span class="nc" id="L718">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3BAB&quot;),</span>
                            ModelRecord.NETWORK_BOOSTED_SLAVE);
<span class="nc" id="L720">                    c.weighty = 1.0;</span>
<span class="nc" id="L721">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3I&quot;),</span>
                            ModelRecord.NETWORK_C3I);
<span class="nc" id="L723">                    break;</span>
                case UnitType.DROPSHIP:
                case UnitType.JUMPSHIP:
                case UnitType.WARSHIP:
                case UnitType.SPACE_STATION:
<span class="nc" id="L728">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</span>
                            ModelRecord.NETWORK_NONE);
<span class="nc" id="L730">                    c.weighty = 1.0;</span>
<span class="nc" id="L731">                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3N&quot;),</span>
                            ModelRecord.NETWORK_NAVAL_C3);
                    break;
            }
            
<span class="nc bnc" id="L736" title="All 6 branches missed.">            switch (unitType) {</span>
                case UnitType.TANK:
<span class="nc" id="L738">                    panMotive.add(createSubtypeCheck(&quot;hover&quot;, true));</span>
<span class="nc" id="L739">                    panMotive.add(createSubtypeCheck(&quot;tracked&quot;, true));</span>
<span class="nc" id="L740">                    panMotive.add(createSubtypeCheck(&quot;wheeled&quot;, true));</span>
<span class="nc" id="L741">                    panMotive.add(createSubtypeCheck(&quot;wige&quot;, true));</span>
<span class="nc" id="L742">                    panMotive.add(createSubtypeCheck(&quot;vtol&quot;, false));</span>
<span class="nc" id="L743">                    break;</span>
                case UnitType.INFANTRY:
<span class="nc" id="L745">                    panMotive.add(createSubtypeCheck(&quot;leg&quot;, true));</span>
<span class="nc" id="L746">                    panMotive.add(createSubtypeCheck(&quot;jump&quot;, true));</span>
<span class="nc" id="L747">                    panMotive.add(createSubtypeCheck(&quot;motorized&quot;, true));</span>
<span class="nc" id="L748">                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.hover&quot;),</span>
                            &quot;hover&quot;, true));
<span class="nc" id="L750">                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.tracked&quot;),</span>
                            &quot;tracked&quot;, true));
<span class="nc" id="L752">                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.wheeled&quot;),</span>
                            &quot;wheeled&quot;, true));
<span class="nc" id="L754">                    break;</span>
                case UnitType.BATTLE_ARMOR:
<span class="nc" id="L756">                    panMotive.add(createSubtypeCheck(&quot;leg&quot;, true));</span>
<span class="nc" id="L757">                    panMotive.add(createSubtypeCheck(&quot;jump&quot;, true));</span>
<span class="nc" id="L758">                    panMotive.add(createSubtypeCheck(&quot;umu&quot;, true));</span>
<span class="nc" id="L759">                    panMotive.add(createSubtypeCheck(&quot;vtol&quot;, true));</span>
<span class="nc" id="L760">                    break;</span>
                case UnitType.NAVAL:
<span class="nc" id="L762">                    panMotive.add(createSubtypeCheck(&quot;naval&quot;, true));</span>
<span class="nc" id="L763">                    panMotive.add(createSubtypeCheck(&quot;hydrofoil&quot;, true));</span>
<span class="nc" id="L764">                    panMotive.add(createSubtypeCheck(&quot;submarine&quot;, true));</span>
<span class="nc" id="L765">                    break;</span>
                case UnitType.DROPSHIP:
<span class="nc" id="L767">                    panMotive.add(createSubtypeCheck(&quot;aerodyne&quot;, true));</span>
<span class="nc" id="L768">                    panMotive.add(createSubtypeCheck(&quot;spheroid&quot;, true));</span>
                    break;
            }
<span class="nc" id="L771">        }</span>

        private void addWeightClasses(JPanel panel, int start, int end, boolean all) {
<span class="nc" id="L774">            cbWeightClass.addItem(Messages.getString(&quot;RandomArmyDialog.Mixed&quot;));</span>
<span class="nc" id="L775">            GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L776">            c.gridx = 1;</span>
<span class="nc" id="L777">            c.gridy = 0;</span>
<span class="nc" id="L778">            c.gridwidth = 1;</span>
<span class="nc" id="L779">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L780">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L781">            c.weightx = 0.0;</span>
<span class="nc" id="L782">            c.weighty = 0.0;</span>
<span class="nc" id="L783">            panel.add(cbWeightClass);</span>
            
<span class="nc" id="L785">            c.gridx = 0;</span>
<span class="nc" id="L786">            c.gridwidth = 2;</span>
<span class="nc bnc" id="L787" title="All 2 branches missed.">            for (int i = start; i &lt;= end; i++) {</span>
<span class="nc" id="L788">                String name = Messages.getString(&quot;RandomArmyDialog.weight_class_&quot; + i);</span>
<span class="nc" id="L789">                cbWeightClass.addItem(name);</span>
<span class="nc" id="L790">                JCheckBox chk = new JCheckBox(name);</span>
<span class="nc" id="L791">                chk.setName(String.valueOf(i));</span>
<span class="nc" id="L792">                chk.setSelected(all);</span>
<span class="nc" id="L793">                weightChecks.add(chk);</span>
<span class="nc" id="L794">                c.gridy++;</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">                if (i == end) {</span>
<span class="nc" id="L796">                    c.weightx = 1.0;</span>
<span class="nc" id="L797">                    c.weighty = 1.0;</span>
                }
<span class="nc" id="L799">                panel.add(chk, c);</span>
            }
<span class="nc" id="L801">            cbWeightClass.addActionListener(e -&gt; {</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">                for (JCheckBox chk : weightChecks) {</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">                    chk.setEnabled(cbWeightClass.getSelectedIndex() == 0);</span>
<span class="nc" id="L804">                }</span>
<span class="nc" id="L805">            });</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">            if (all) {</span>
<span class="nc" id="L807">                cbWeightClass.setSelectedIndex(0);</span>
<span class="nc bnc" id="L808" title="All 2 branches missed.">            } else if (start &gt; EntityWeightClass.WEIGHT_ULTRA_LIGHT) {</span>
<span class="nc" id="L809">                cbWeightClass.setSelectedIndex(1);</span>
            } else {
<span class="nc" id="L811">                cbWeightClass.setSelectedIndex(2);</span>
            }
<span class="nc" id="L813">        }</span>

        private void addNetworkButton(JPanel panel, GridBagConstraints constraints, ButtonGroup group,
                                      String text, int mask) {
<span class="nc" id="L817">            JRadioButton btn = new JRadioButton(text);</span>
<span class="nc" id="L818">            btn.setActionCommand(String.valueOf(mask));</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">            btn.setSelected(mask == ModelRecord.NETWORK_NONE);</span>
<span class="nc" id="L820">            panel.add(btn, constraints);</span>
<span class="nc" id="L821">            group.add(btn);</span>
<span class="nc" id="L822">            constraints.gridy++;</span>
<span class="nc" id="L823">        }</span>

        private JCheckBox createSubtypeCheck(String name, boolean select) {
<span class="nc" id="L826">            return createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Motive.&quot; + name),</span>
                    name, select);
        }

        private JCheckBox createSubtypeCheck(String text, String name, boolean select) {
<span class="nc" id="L831">            JCheckBox chk = new JCheckBox(text);</span>
<span class="nc" id="L832">            chk.setName(name);</span>
<span class="nc" id="L833">            chk.setSelected(select);</span>
<span class="nc" id="L834">            subtypeChecks.add(chk);</span>
<span class="nc" id="L835">            return chk;</span>
        }

        public List&lt;Integer&gt; getSelectedWeights() {
<span class="nc bnc" id="L839" title="All 2 branches missed.">            if (cbWeightClass.getSelectedIndex() &gt; 0) {</span>
<span class="nc" id="L840">                List&lt;Integer&gt; retVal = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L841">                retVal.add(Integer.parseInt(weightChecks</span>
<span class="nc" id="L842">                        .get(cbWeightClass.getSelectedIndex() - 1).getName()));</span>
<span class="nc" id="L843">                return retVal;</span>
            }
<span class="nc" id="L845">            return weightChecks.stream().filter(AbstractButton::isSelected)</span>
<span class="nc" id="L846">                    .map(chk -&gt; Integer.parseInt(chk.getName())).collect(Collectors.toList());</span>
        }

        public List&lt;MissionRole&gt; getSelectedRoles() {
<span class="nc" id="L850">            return roleChecks.stream().filter(AbstractButton::isSelected)</span>
<span class="nc" id="L851">                    .map(chk -&gt; MissionRole.parseRole(chk.getName()))</span>
<span class="nc" id="L852">                        .filter(Objects::nonNull).collect(Collectors.toList());</span>
        }

        public int getRoleStrictness() {
<span class="nc" id="L856">            return cbRoleStrictness.getSelectedIndex() + 1;</span>
        }

        public int getNetworkMask() {
<span class="nc bnc" id="L860" title="All 2 branches missed.">            if (networkButtons.getSelection() != null) {</span>
<span class="nc" id="L861">                return Integer.parseInt(networkButtons.getSelection().getActionCommand());</span>
            }
<span class="nc" id="L863">            return ModelRecord.NETWORK_NONE;</span>
        }

        public List&lt;EntityMovementMode&gt; getMotiveTypes() {
<span class="nc" id="L867">            return subtypeChecks.stream().filter(AbstractButton::isSelected)</span>
<span class="nc" id="L868">                    .map(chk -&gt; EntityMovementMode.getMode(chk.getName())).collect(Collectors.toList());</span>
        }
    }
    
    private class FormationUnitTypeOptions extends UnitTypeOptions {
        private static final long serialVersionUID = -6448946137013919069L;

        FormationTypesCard groundCard;
        FormationTypesCard airCard;
        
<span class="nc" id="L878">        public FormationUnitTypeOptions() {</span>
<span class="nc" id="L879">            setLayout(new CardLayout());</span>
            
<span class="nc" id="L881">            groundCard = new FormationTypesCard(true);</span>
<span class="nc" id="L882">            airCard = new FormationTypesCard(false);</span>
<span class="nc" id="L883">            add(groundCard, &quot;Ground&quot;);</span>
<span class="nc" id="L884">            add(airCard, &quot;Air&quot;);</span>
<span class="nc" id="L885">        }</span>
        
        public void optionsChanged() {
<span class="nc bnc" id="L888" title="All 2 branches missed.">            if (getUnitType() != null) {</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">                ((CardLayout) getLayout()).show(this, (getUnitType() &lt; UnitType.CONV_FIGHTER)</span>
<span class="nc" id="L890">                        ? &quot;Ground&quot; : &quot;Air&quot;);</span>
            }
<span class="nc" id="L892">            currentCard().updateUnitType(getUnitType());</span>
<span class="nc" id="L893">        }</span>
        
        private FormationTypesCard currentCard() {
<span class="nc bnc" id="L896" title="All 4 branches missed.">            if ((getUnitType() != null) &amp;&amp; (getUnitType() &gt;= UnitType.CONV_FIGHTER)) {</span>
<span class="nc" id="L897">                return airCard;</span>
            } else {
<span class="nc" id="L899">                return groundCard;</span>
            }
        }
        
        @Override
        public Integer getIntegerVal(String key) {
<span class="nc bnc" id="L905" title="All 4 branches missed.">            switch (key) {</span>
                case &quot;numOtherUnits&quot;:
<span class="nc" id="L907">                    return currentCard().numOtherUnits();</span>
                case &quot;otherUnitType&quot;:
<span class="nc" id="L909">                    return currentCard().getOtherUnitType();</span>
                case &quot;network&quot;:
<span class="nc" id="L911">                    return currentCard().getNetwork();</span>
                default:
<span class="nc" id="L913">                    return null;</span>
            }
        }
        
        @Override
        public Boolean getBooleanVal(String key) {
<span class="nc bnc" id="L919" title="All 3 branches missed.">            switch (key) {</span>
                case &quot;mechBA&quot;:
<span class="nc" id="L921">                    return currentCard().mechBA();</span>
                case &quot;airLance&quot;:
<span class="nc" id="L923">                    return currentCard().airLance();</span>
                default:
<span class="nc" id="L925">                    return null;</span>
            }
        }
        
        @Override
        public String getStringVal(String key) {
<span class="nc bnc" id="L931" title="All 2 branches missed.">            if (&quot;formationType&quot;.equals(key)) {</span>
<span class="nc" id="L932">                return currentCard().getFormation();</span>
            } else {
<span class="nc" id="L934">                return null;</span>
            }
        }
        
        @Override
        public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {
<span class="nc" id="L940">            currentCard().setGeneratedUnits(list);</span>
<span class="nc" id="L941">        }</span>
    }

    private class FormationTypesCard extends JPanel {

        private static final long serialVersionUID = 1439149790457737700L;

<span class="nc" id="L948">        private JRadioButton bSimpleFormation = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.simpleFormation&quot;));</span>
<span class="nc" id="L949">        private JRadioButton bMechBA = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.mechBA&quot;));</span>
<span class="nc" id="L950">        private JRadioButton bAirLance = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.airLance&quot;));</span>
<span class="nc" id="L951">        private JRadioButton bOtherUnitType = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.otherUnitType&quot;));</span>
<span class="nc" id="L952">        private JComboBox&lt;String&gt; cbOtherUnitType = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L953">        private JTextField tNumUnits = new JTextField(&quot;0&quot;);</span>
<span class="nc" id="L954">        private ButtonGroup formationBtnGroup = new ButtonGroup();</span>
<span class="nc" id="L955">        private JComboBox&lt;String&gt; cbNetwork = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L956">        private Map&lt;String, Integer&gt; networkOptions = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L957">        private JTextArea txtNoFormation = new JTextArea();</span>
<span class="nc" id="L958">        private List&lt;MechSummary&gt; generatedUnits = null;</span>
        
<span class="nc" id="L960">        public FormationTypesCard(boolean groundUnit) {</span>
<span class="nc" id="L961">            setLayout(new GridBagLayout());</span>
            
<span class="nc" id="L963">            JPanel panFormations = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L964">            JPanel panOtherOptions = new JPanel(new GridBagLayout());</span>
            
<span class="nc" id="L966">            GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L967">            c.gridx = 0;</span>
<span class="nc" id="L968">            c.gridy = 0;</span>
<span class="nc" id="L969">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L970">            c.weightx = 0.5;</span>
<span class="nc" id="L971">            c.weighty = 1.0;</span>
<span class="nc" id="L972">            add(panFormations, c);</span>
            
<span class="nc" id="L974">            c.gridx = 1;</span>
<span class="nc" id="L975">            c.gridy = 0;</span>
<span class="nc" id="L976">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L977">            c.weightx = 0.5;</span>
<span class="nc" id="L978">            c.weighty = 0.0;</span>
<span class="nc" id="L979">            add(panOtherOptions, c);</span>
            
            // Sort main types alphabetically, and subtypes alphabetically within the main.
<span class="nc" id="L982">            List&lt;FormationType&gt; formations = FormationType.getAllFormations().stream()</span>
<span class="nc bnc" id="L983" title="All 2 branches missed.">                    .filter(ft -&gt; ft.isGround() == groundUnit).collect(Collectors.toList());</span>
<span class="nc" id="L984">            Map&lt;String,Set&lt;String&gt;&gt; formationGroups = formations.stream()</span>
<span class="nc" id="L985">                    .collect(Collectors.groupingBy(FormationType::getCategory, TreeMap::new,</span>
<span class="nc" id="L986">                            Collectors.mapping(FormationType::getName,</span>
<span class="nc" id="L987">                                    Collectors.toCollection(TreeSet::new))));</span>
                
<span class="nc" id="L989">            int rows = (formations.size() + 1) / 2;</span>

<span class="nc" id="L991">            c = new GridBagConstraints();</span>
<span class="nc" id="L992">            c.gridx = 2;</span>
<span class="nc" id="L993">            c.gridy = 0;</span>
<span class="nc" id="L994">            c.gridwidth = 1;</span>
<span class="nc" id="L995">            c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L996">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L997">            c.weightx = 0.0;</span>
<span class="nc" id="L998">            c.weighty = 1.0;</span>
            
<span class="nc" id="L1000">            Insets mainInsets = new Insets(0, 10, 0, 10);</span>
<span class="nc" id="L1001">            Insets subInsets = new Insets(0, 30, 0, 10);</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">            for (String group : formationGroups.keySet()) {</span>
<span class="nc" id="L1003">                c.insets = mainInsets;</span>
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                if (formationGroups.get(group).contains(group)) {</span>
<span class="nc" id="L1005">                    JRadioButton btn = new JRadioButton(FormationType.getFormationType(group).getNameWithFaction());</span>
<span class="nc bnc" id="L1006" title="All 2 branches missed.">                    if (formationBtnGroup.getButtonCount() == 0) {</span>
<span class="nc" id="L1007">                        btn.setSelected(true);</span>
                    }
<span class="nc" id="L1009">                    btn.setActionCommand(group);</span>
<span class="nc" id="L1010">                    panFormations.add(btn, c);</span>
<span class="nc" id="L1011">                    formationBtnGroup.add(btn);</span>
<span class="nc" id="L1012">                    formationGroups.get(group).remove(group);</span>
<span class="nc" id="L1013">                } else {</span>
<span class="nc" id="L1014">                    JLabel lbl = new JLabel(FormationType.getFormationType(group).getNameWithFaction(),</span>
                            SwingConstants.LEFT);
<span class="nc" id="L1016">                    panFormations.add(lbl, c);</span>
                }
<span class="nc" id="L1018">                c.gridy++;</span>
<span class="nc" id="L1019">                c.insets = subInsets;</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">                for (String form : formationGroups.get(group)) {</span>
<span class="nc" id="L1021">                    JRadioButton btn = new JRadioButton(FormationType.getFormationType(form).getNameWithFaction());</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">                    if (formationBtnGroup.getButtonCount() == 0) {</span>
<span class="nc" id="L1023">                        btn.setSelected(true);</span>
                    }
<span class="nc" id="L1025">                    btn.setActionCommand(form);</span>
<span class="nc" id="L1026">                    panFormations.add(btn, c);</span>
<span class="nc" id="L1027">                    formationBtnGroup.add(btn);</span>
<span class="nc" id="L1028">                    c.gridy++;</span>
<span class="nc" id="L1029">                }</span>
<span class="nc bnc" id="L1030" title="All 2 branches missed.">                if (c.gridy &gt;= rows) {</span>
<span class="nc" id="L1031">                    c.gridx++;</span>
<span class="nc" id="L1032">                    c.gridy = 0;</span>
                }
<span class="nc" id="L1034">            }</span>
            
<span class="nc" id="L1036">            ButtonGroup btnGroup = new ButtonGroup();            </span>
<span class="nc" id="L1037">            c.gridx = 0;</span>
<span class="nc" id="L1038">            c.gridy = 0;</span>
<span class="nc" id="L1039">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L1040">            c.gridwidth = 2;</span>
<span class="nc" id="L1041">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L1042">            c.weightx = 0.0;</span>
<span class="nc" id="L1043">            c.weighty = 0.0;</span>
<span class="nc" id="L1044">            panOtherOptions.add(bSimpleFormation, c);</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">            bSimpleFormation.addItemListener(ev -&gt; tNumUnits.setEnabled(!bSimpleFormation.isSelected()));</span>
<span class="nc" id="L1046">            btnGroup.add(bSimpleFormation);</span>
            
<span class="nc" id="L1048">            c.gridx = 0;</span>
<span class="nc" id="L1049">            c.gridy++;</span>
<span class="nc" id="L1050">            c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L1051">            c.gridwidth = 2;</span>
<span class="nc" id="L1052">            c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L1053">            c.weightx = 0.0;</span>
<span class="nc" id="L1054">            c.weighty = 0.0;</span>
<span class="nc" id="L1055">            panOtherOptions.add(bMechBA, c);</span>
<span class="nc" id="L1056">            btnGroup.add(bMechBA);</span>

<span class="nc" id="L1058">            c.gridy++;</span>
<span class="nc" id="L1059">            c.gridwidth = 2;</span>
<span class="nc" id="L1060">            panOtherOptions.add(bAirLance, c);</span>
<span class="nc" id="L1061">            btnGroup.add(bAirLance);</span>

<span class="nc" id="L1063">            c.gridy++;</span>
<span class="nc" id="L1064">            c.gridwidth = 2;</span>
<span class="nc" id="L1065">            panOtherOptions.add(bOtherUnitType, c);</span>
<span class="nc" id="L1066">            btnGroup.add(bOtherUnitType);</span>
<span class="nc" id="L1067">            bOtherUnitType.addItemListener(ev -&gt; cbOtherUnitType.setEnabled(bOtherUnitType.isSelected()));</span>

<span class="nc" id="L1069">            c.gridx = 0;</span>
<span class="nc" id="L1070">            c.gridy++;</span>
<span class="nc" id="L1071">            c.gridwidth = 2;</span>
<span class="nc" id="L1072">            panOtherOptions.add(cbOtherUnitType, c);</span>
<span class="nc" id="L1073">            cbOtherUnitType.setEnabled(false);</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">            for (int i = 0; i &lt; UnitType.JUMPSHIP; i++) {</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">                if (i != UnitType.GUN_EMPLACEMENT) {</span>
<span class="nc" id="L1076">                    cbOtherUnitType.addItem(UnitType.getTypeName(i));</span>
                }
            }

<span class="nc" id="L1080">            c.gridx = 0;</span>
<span class="nc" id="L1081">            c.gridy++;</span>
<span class="nc" id="L1082">            c.gridwidth = 1;</span>
<span class="nc" id="L1083">            panOtherOptions.add(new JLabel(Messages.getString(&quot;RandomArmyDialog.additionalUnits&quot;)), c);</span>
<span class="nc" id="L1084">            c.gridx = 1;</span>
<span class="nc" id="L1085">            c.gridwidth = 1;</span>
<span class="nc" id="L1086">            panOtherOptions.add(tNumUnits, c);</span>

<span class="nc" id="L1088">            bSimpleFormation.setSelected(true);</span>

<span class="nc bnc" id="L1090" title="All 2 branches missed.">            if (groundUnit) {</span>
<span class="nc" id="L1091">                c.gridx = 0;</span>
<span class="nc" id="L1092">                c.gridy++;</span>
<span class="nc" id="L1093">                c.gridwidth = 1;</span>
<span class="nc" id="L1094">                panOtherOptions.add(new JLabel(Messages.getString(&quot;ForceGenerationOptions.Network&quot;)), c);</span>

<span class="nc" id="L1096">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.Optional&quot;),</span>
<span class="nc" id="L1097">                        ModelRecord.NETWORK_NONE);</span>
<span class="nc" id="L1098">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3Lance&quot;),</span>
<span class="nc" id="L1099">                        ModelRecord.NETWORK_C3_MASTER);</span>
<span class="nc" id="L1100">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3Command&quot;),</span>
<span class="nc" id="L1101">                        ModelRecord.NETWORK_C3_MASTER | ModelRecord.NETWORK_COMPANY_COMMAND);</span>
<span class="nc" id="L1102">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3i&quot;),</span>
<span class="nc" id="L1103">                        ModelRecord.NETWORK_C3I);</span>
<span class="nc" id="L1104">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3BLance&quot;),</span>
<span class="nc" id="L1105">                        ModelRecord.NETWORK_BOOSTED_MASTER);</span>
<span class="nc" id="L1106">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3BCommand&quot;),</span>
<span class="nc" id="L1107">                        ModelRecord.NETWORK_BOOSTED_MASTER | ModelRecord.NETWORK_COMPANY_COMMAND);</span>
<span class="nc" id="L1108">                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.Nova&quot;),</span>
<span class="nc" id="L1109">                        ModelRecord.NETWORK_NOVA);</span>
<span class="nc" id="L1110">                networkOptions.keySet().forEach(cbNetwork::addItem);</span>
<span class="nc" id="L1111">                c.gridx = 0;</span>
<span class="nc" id="L1112">                c.gridy++;</span>
<span class="nc" id="L1113">                c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1114">                panOtherOptions.add(cbNetwork, c);</span>
            }

<span class="nc" id="L1117">            c.gridx = 0;</span>
<span class="nc" id="L1118">            c.gridy++;</span>
<span class="nc" id="L1119">            c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L1120">            JButton btn = new JButton(Messages.getString(&quot;ForceGenerationOptions.formationAnalysis&quot;));</span>
<span class="nc" id="L1121">            panOtherOptions.add(btn, c);</span>
<span class="nc" id="L1122">            btn.addActionListener(ev -&gt; showAnalysis());</span>

<span class="nc" id="L1124">            c.gridy++;</span>
<span class="nc" id="L1125">            txtNoFormation.setText(Messages.getString(&quot;ForceGenerationOptions.noFormation&quot;));</span>
<span class="nc" id="L1126">            txtNoFormation.setLineWrap(true);</span>
<span class="nc" id="L1127">            txtNoFormation.setWrapStyleWord(true);</span>
<span class="nc" id="L1128">            txtNoFormation.setVisible(false);</span>
<span class="nc" id="L1129">            panOtherOptions.add(txtNoFormation, c);</span>
<span class="nc" id="L1130">        }</span>

        public String getFormation() {
<span class="nc bnc" id="L1133" title="All 2 branches missed.">            if (formationBtnGroup.getSelection() != null) {</span>
<span class="nc" id="L1134">                return formationBtnGroup.getSelection().getActionCommand();</span>
            }
<span class="nc" id="L1136">            return null;</span>
        }

        public boolean mechBA() {
<span class="nc" id="L1140">            return bMechBA.isSelected();</span>
        }

        public boolean airLance() {
<span class="nc" id="L1144">            return bAirLance.isSelected();</span>
        }

        public int numOtherUnits() {
            try {
<span class="nc" id="L1149">                return Integer.parseInt(tNumUnits.getText());</span>
<span class="nc" id="L1150">            } catch (NumberFormatException ex) {</span>
<span class="nc" id="L1151">                tNumUnits.setText(&quot;0&quot;);</span>
<span class="nc" id="L1152">                return 0;</span>
            }
        }
        
        public int getOtherUnitType() {
<span class="nc" id="L1157">            String otherUnitType = (String) cbOtherUnitType.getSelectedItem();</span>
<span class="nc bnc" id="L1158" title="All 4 branches missed.">            if (!bOtherUnitType.isSelected() || (otherUnitType == null)) {</span>
<span class="nc" id="L1159">                otherUnitType = &quot;&quot;;</span>
            }
<span class="nc" id="L1161">            return ModelRecord.parseUnitType(otherUnitType);</span>
        }
        
        public void updateUnitType(int ut) {
<span class="nc" id="L1165">            boolean selectionDisabled = false;</span>
<span class="nc bnc" id="L1166" title="All 2 branches missed.">            for (Enumeration&lt;AbstractButton&gt; e = formationBtnGroup.getElements(); e.hasMoreElements();) {</span>
<span class="nc" id="L1167">                final AbstractButton btn = e.nextElement();</span>
<span class="nc" id="L1168">                FormationType ft = FormationType.getFormationType(btn.getActionCommand());</span>
<span class="nc bnc" id="L1169" title="All 2 branches missed.">                if (ft != null) {</span>
<span class="nc" id="L1170">                    btn.setEnabled(ft.isAllowedUnitType(ut));</span>
<span class="nc bnc" id="L1171" title="All 4 branches missed.">                    if (btn.isSelected() &amp;&amp; !btn.isEnabled()) {</span>
<span class="nc" id="L1172">                        selectionDisabled = true;</span>
                    }
                }
<span class="nc" id="L1175">            }</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">            if (selectionDisabled) {</span>
<span class="nc bnc" id="L1177" title="All 2 branches missed.">                for (Enumeration&lt;AbstractButton&gt; e = formationBtnGroup.getElements(); e.hasMoreElements();) {</span>
<span class="nc" id="L1178">                    final AbstractButton btn = e.nextElement();</span>
<span class="nc bnc" id="L1179" title="All 2 branches missed.">                    if (btn.isEnabled()) {</span>
<span class="nc" id="L1180">                        btn.setSelected(true);</span>
<span class="nc" id="L1181">                        return;</span>
                    }
<span class="nc" id="L1183">                }</span>
                //We shouldn't reach this point, but if we do the previous selection doesn't change.
            }
<span class="nc" id="L1186">        }</span>
        
        public int getNetwork() {
<span class="nc" id="L1189">            String networkOption = (String) cbNetwork.getSelectedItem();</span>
<span class="nc bnc" id="L1190" title="All 2 branches missed.">            return (networkOptions.get(networkOption) != null) ? networkOptions.get((networkOption))</span>
<span class="nc" id="L1191">                    : ModelRecord.NETWORK_NONE;</span>
        }
        
        private void showAnalysis() {
<span class="nc" id="L1195">            List&lt;UnitTable.Parameters&gt; params = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1196">            FormationType ft = FormationType.getFormationType(getFormation());</span>
<span class="nc" id="L1197">            Parameters p = new UnitTable.Parameters(getFaction(),</span>
<span class="nc" id="L1198">                    getUnitType(), ratGenYear, (String)cbRating.getSelectedItem(),</span>
<span class="nc" id="L1199">                    IntStream.rangeClosed(ft.getMinWeightClass(), ft.getMaxWeightClass())</span>
<span class="nc" id="L1200">                    .boxed().collect(Collectors.toList()),</span>
<span class="nc" id="L1201">                    ModelRecord.NETWORK_NONE, EnumSet.noneOf(EntityMovementMode.class),</span>
<span class="nc" id="L1202">                    ft.getMissionRoles(),</span>
<span class="nc" id="L1203">                    2, getFaction());</span>
<span class="nc" id="L1204">            params.add(p);</span>
<span class="nc" id="L1205">            int numUnits = getNumUnits();</span>
<span class="nc bnc" id="L1206" title="All 2 branches missed.">            if (getOtherUnitType() &gt;= 0) {</span>
<span class="nc" id="L1207">                p = p.copy();</span>
<span class="nc" id="L1208">                p.setUnitType(getOtherUnitType());</span>
<span class="nc" id="L1209">                params.add(p);</span>
<span class="nc" id="L1210">                numUnits += numOtherUnits();</span>
            }
<span class="nc" id="L1212">            AnalyzeFormationDialog afd = new AnalyzeFormationDialog(null,</span>
                    generatedUnits,
<span class="nc" id="L1214">                    FormationType.getFormationType(getFormation()),</span>
<span class="nc" id="L1215">                    params, numUnits, getNetwork());</span>
<span class="nc" id="L1216">            afd.setVisible(true);</span>
<span class="nc" id="L1217">        }</span>
        
        public void setGeneratedUnits(List&lt;MechSummary&gt; list) {
<span class="nc" id="L1220">            generatedUnits = list;</span>
<span class="nc bnc" id="L1221" title="All 4 branches missed.">            txtNoFormation.setVisible(list == null || list.isEmpty());</span>
<span class="nc" id="L1222">        }</span>
    }    
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>