<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BehaviorSettings.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.bot.princess</a> &gt; <span class="el_source">BehaviorSettings.java</span></div><h1>BehaviorSettings.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2003 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.client.bot.princess;

import megamek.common.logging.DefaultMmLogger;
import megamek.common.logging.LogLevel;
import megamek.common.logging.MMLogger;
import megamek.common.util.StringUtil;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

import java.util.HashSet;
import java.util.Set;

/**
 * Created with IntelliJ IDEA.
 *
 * @version $Id$
 * @lastModifiedBy Deric &quot;Netzilla&quot; Page (deric dot page at usa dot net)
 * @since 8/17/13 10:47 PM
 */
public class BehaviorSettings {

<span class="fc" id="L37">    static final double[] SELF_PRESERVATION_VALUES = {</span>
            2.5,
            5,
            7.5,
            10,
            12.5,
            15,
            17.5,
            20,
            22.5,
            25,
            30};
<span class="fc" id="L49">    static final int[] FALL_SHAME_VALUES = {</span>
            10,
            20,
            40,
            60,
            80,
            100,
            120,
            140,
            160,
            180,
            200};
<span class="fc" id="L61">    protected static final double[] BRAVERY = {</span>
            0.1,
            0.3,
            0.6,
            0.9,
            1.2,
            1.5,
            1.8,
            2.1,
            2.4,
            2.7,
            3.0};
<span class="fc" id="L73">    static final double[] HYPER_AGGRESSION_VALUES = {</span>
            0.25,
            0.5,
            1,
            1.5,
            2,
            2.5,
            3,
            3.5,
            4,
            4.5,
            5};
<span class="fc" id="L85">    static final double[] HERD_MENTALITY_VALUES = {</span>
            0.1,
            0.2,
            0.4,
            0.6,
            0.8,
            1.0,
            1.2,
            1.4,
            1.6,
            1.8,
            2.0};

<span class="fc" id="L98">    private String description = BehaviorSettingsFactory.DEFAULT_BEHAVIOR_DESCRIPTION;</span>

<span class="fc" id="L100">    private boolean forcedWithdrawal = true; // Will I follow the Forced Withdrawal rules?</span>
<span class="fc" id="L101">    private boolean goHome = false; // Should I immediately proceed to my home board edge?</span>
<span class="fc" id="L102">    private boolean autoFlee = false; // Should I flee even if I'm not crippled?</span>
<span class="fc" id="L103">    private int selfPreservationIndex = 5; // How worried about enemy damage am I?</span>
<span class="fc" id="L104">    private int fallShameIndex = 5; // How much do I want to avoid failed Piloting Rolls?</span>
<span class="fc" id="L105">    private int hyperAggressionIndex = 5; // How close to I want to get to my enemies?</span>
<span class="fc" id="L106">    private CardinalEdge destinationEdge = CardinalEdge.NEAREST_OR_NONE; // Which edge am I trying to reach?</span>
<span class="fc" id="L107">    private CardinalEdge retreatEdge = CardinalEdge.NEAREST_OR_NONE; // To which edge will my units flee when crippled?</span>
<span class="fc" id="L108">    private final Set&lt;String&gt; strategicBuildingTargets = new HashSet&lt;&gt;(); // What (besides enemy units) do I want to</span>
    // blow up?
<span class="fc" id="L110">    private final Set&lt;Integer&gt; priorityUnitTargets = new HashSet&lt;&gt;(); // What units do I especially want to blow up?</span>
<span class="fc" id="L111">    private int herdMentalityIndex = 5; // How close do I want to stick to my teammates?</span>
<span class="fc" id="L112">    private int braveryIndex = 5; // How quickly will I try to escape once damaged?</span>
<span class="fc" id="L113">    private LogLevel verbosity = LogLevel.WARNING; // Verbosity of Princess chat messages.  Separate from the verbosity of the MegaMek log.</span>

<span class="fc" id="L115">    private MMLogger logger = null;</span>

<span class="fc" id="L117">    public BehaviorSettings() {</span>
<span class="fc" id="L118">    }</span>

<span class="fc" id="L120">    public BehaviorSettings(final Element behavior) throws PrincessException {</span>
<span class="fc" id="L121">        fromXml(behavior);</span>
<span class="fc" id="L122">    }</span>

    private MMLogger getLogger() {
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if (null == logger) {</span>
<span class="nc" id="L126">            logger = DefaultMmLogger.getInstance();</span>
        }
<span class="nc" id="L128">        return logger;</span>
    }

    void setLogger(final MMLogger logger) {
<span class="fc" id="L132">        this.logger = logger;</span>
<span class="fc" id="L133">    }</span>

    public BehaviorSettings getCopy() throws PrincessException {
<span class="fc" id="L136">        final BehaviorSettings copy = new BehaviorSettings();</span>
<span class="fc" id="L137">        copy.setDestinationEdge(getDestinationEdge());</span>
<span class="fc" id="L138">        copy.setRetreatEdge(getRetreatEdge());</span>
<span class="fc" id="L139">        copy.setForcedWithdrawal(isForcedWithdrawal());</span>
<span class="fc" id="L140">        copy.setAutoFlee(shouldAutoFlee());</span>
<span class="fc" id="L141">        copy.setDescription(getDescription());</span>
<span class="fc" id="L142">        copy.setFallShameIndex(getFallShameIndex());</span>
<span class="fc" id="L143">        copy.setBraveryIndex(getBraveryIndex());</span>
<span class="fc" id="L144">        copy.setHerdMentalityIndex(getHerdMentalityIndex());</span>
<span class="fc" id="L145">        copy.setHyperAggressionIndex(getHyperAggressionIndex());</span>
<span class="fc" id="L146">        copy.setSelfPreservationIndex(getSelfPreservationIndex());</span>
<span class="fc" id="L147">        copy.setVerbosity(getVerbosity());</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">        for (final String t : getStrategicBuildingTargets()) {</span>
<span class="nc" id="L149">            copy.addStrategicTarget(t);</span>
<span class="nc" id="L150">        }</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">        for (final Integer p : getPriorityUnitTargets()) {</span>
<span class="nc" id="L152">            copy.addPriorityUnit(p);</span>
<span class="nc" id="L153">        }</span>
<span class="fc" id="L154">        return copy;</span>
    }

    /**
     * The verbosity of Princess chat messages.  This is separate from the megameklog.txt logging level.
     */
    public LogLevel getVerbosity() {
<span class="fc" id="L161">        return verbosity;</span>
    }

    /**
     * The verbosity of Princess chat messages.  This is separate from the megameklog.txt logging level.
     */
    public void setVerbosity(final LogLevel verbosity) {
<span class="fc" id="L168">        this.verbosity = verbosity;</span>
<span class="fc" id="L169">    }</span>

    /**
     * @return TRUE if I should immediately proceed to my home board edge.
     */
    public boolean shouldGoHome() {
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        return destinationEdge != CardinalEdge.NEAREST_OR_NONE;</span>
    }


    /**
     * @return TRUE if I should flee off the board even if I am not crippled or Forced Withdrawal is not in effect.
     */
    public boolean shouldAutoFlee() {
<span class="fc" id="L183">        return autoFlee;</span>
    }

    /**
     * @param autoFlee Set TRUE if I should flee off the board even if I am not crippled or Forced Withdrawal is not in
     *                 effect.
     */
    public void setAutoFlee(final boolean autoFlee) {
<span class="fc" id="L191">        this.autoFlee = autoFlee;</span>
<span class="fc" id="L192">    }</span>

    /**
     * Returns the name for this type of behavior.
     *
     * @return the name for this type of behavior.
     */
    public String getDescription() {
<span class="fc" id="L200">        return description;</span>
    }

    /**
     * Sets the name for this type of behavior.  Must be unique in order to save.
     *
     * @param description The name to be used.
     */
    public void setDescription(final String description) throws PrincessException {
<span class="fc bfc" id="L209" title="All 2 branches covered.">        if (StringUtil.isNullOrEmpty(description)) {</span>
<span class="fc" id="L210">            throw new PrincessException(&quot;Description is required!&quot;);</span>
        }
<span class="fc" id="L212">        this.description = description.trim();</span>
<span class="fc" id="L213">    }</span>

    /**
     * A list of hexes that Princess will attempt to move to and attack.
     *
     * @return A list of hexes that Princess will attempt to move to and attack.
     */
    public Set&lt;String&gt; getStrategicBuildingTargets() {
<span class="fc" id="L221">        return new HashSet&lt;&gt;(strategicBuildingTargets);</span>
    }

    /**
     * Adds a target that Princess will attempt to move to and attack.
     *
     * @param target The target to be added.
     */
    public void addStrategicTarget(final String target) {
<span class="fc bfc" id="L230" title="All 2 branches covered.">        if (StringUtil.isNullOrEmpty(target)) {</span>
<span class="fc" id="L231">            return;</span>
        }
<span class="fc" id="L233">        strategicBuildingTargets.add(target);</span>
<span class="fc" id="L234">    }</span>

    /**
     * Removes a target that Princess will attempt to move to and attack.
     *
     * @param target The target to be removed.
     */
    void removeStrategicTarget(final String target) {
<span class="fc" id="L242">        strategicBuildingTargets.remove(target);</span>
<span class="fc" id="L243">    }</span>

    /**
     * @return A list of enemy units that Princess will prioritize over others.
     */
    public Set&lt;Integer&gt; getPriorityUnitTargets() {
<span class="fc" id="L249">        return new HashSet&lt;&gt;(priorityUnitTargets);</span>
    }

    /**
     * Add an enemy unit to the priority list.
     *
     * @param id The ID of the unit to be added.
     */
    public void addPriorityUnit(final int id) {
<span class="fc" id="L258">        priorityUnitTargets.add(id);</span>
<span class="fc" id="L259">    }</span>

    /**
     * Add an enemy unit to the priority list.
     *
     * @param id The ID of the unit to be added.
     */
    public void addPriorityUnit(final String id) {
<span class="fc bfc" id="L267" title="All 2 branches covered.">        if (!StringUtil.isPositiveInteger(id)) {</span>
<span class="fc" id="L268">            return;</span>
        }
<span class="fc" id="L270">        addPriorityUnit(Integer.parseInt(id));</span>
<span class="fc" id="L271">    }</span>

    /**
     * Remove a unit from the priority target list.
     *
     * @param id The ID of the unit to be removed.
     */
    void removePriorityUnit(final int id) {
<span class="fc" id="L279">        priorityUnitTargets.remove(id);</span>
<span class="fc" id="L280">    }</span>

    /**
     * Remove a unit from the priority target list.
     *
     * @param id The ID of the unit to be removed.
     */
    void removePriorityUnit(final String id) {
<span class="pc bpc" id="L288" title="1 of 2 branches missed.">        if (!StringUtil.isPositiveInteger(id)) {</span>
<span class="fc" id="L289">            return;</span>
        }
<span class="nc" id="L291">        removePriorityUnit(Integer.parseInt(id));</span>
<span class="nc" id="L292">    }</span>

    /**
     * When this is true, Princess will follow the Forced Withdrawal rules from Total Warfare.
     *
     * @return Should Princess follow the Forced Withdrawal rules?
     */
    public boolean isForcedWithdrawal() {
<span class="fc" id="L300">        return forcedWithdrawal;</span>
    }

    /**
     * When this is true, Princess will follow the Forced Withdrawal rules from Total Warfare.
     *
     * @param forcedWithdrawal Should Princess follow the Forced Withdrawal rules?
     */
    public void setForcedWithdrawal(final boolean forcedWithdrawal) {
<span class="fc" id="L309">        this.forcedWithdrawal = forcedWithdrawal;</span>
<span class="fc" id="L310">    }</span>

    /**
     * When this is true, Princess will follow the Forced Withdrawal rules from Total Warfare.
     *
     * @param forcedWithdrawal Should Princess follow the Forced Withdrawal rules?
     */
    public void setForcedWithdrawal(final String forcedWithdrawal) {
<span class="fc" id="L318">        setForcedWithdrawal(&quot;true&quot;.equalsIgnoreCase(forcedWithdrawal));</span>
<span class="fc" id="L319">    }</span>

    private int validateIndex(final int index) {
<span class="fc bfc" id="L322" title="All 2 branches covered.">        if (0 &gt; index) {</span>
<span class="fc" id="L323">            return 0;</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        } else if (10 &lt; index) {</span>
<span class="fc" id="L325">            return 10;</span>
        }
<span class="fc" id="L327">        return index;</span>
    }

    /**
     * How quickly will I try to escape once damaged?
     *
     * @return Index of the Bravery value.
     */
    public int getBraveryIndex() {
<span class="fc" id="L336">        return braveryIndex;</span>
    }

    /**
     * How quickly will I try to escape once damaged?
     *
     * @return Bravery modifier value.
     */
    double getBraveryValue() {
<span class="nc" id="L345">        return getBraveryValue(braveryIndex);</span>
    }

    /**
     * How quickly will I try to escape once damaged?
     *
     * @param index The index of the Bravery modifier to retrieve.
     * @return Bravery modifier value at given index.
     */
    protected double getBraveryValue(final int index) {
<span class="nc" id="L355">        return BRAVERY[validateIndex(index)];</span>
    }

    /**
     * How quickly will I try to escape once damaged?
     *
     * @param index The index of the Bravery modifier to be used.
     */
    public void setBraveryIndex(final int index) {
<span class="fc" id="L364">        braveryIndex = validateIndex(index);</span>
<span class="fc" id="L365">    }</span>

    /**
     * How quickly will I try to escape once damaged?
     *
     * @param index The index of the Bravery modifier to be used.
     */
    public void setBraveryIndex(final String index) throws PrincessException {
        try {
<span class="fc" id="L374">            setBraveryIndex(Integer.parseInt(index));</span>
<span class="nc" id="L375">        } catch (final NumberFormatException ex) {</span>
<span class="nc" id="L376">            throw new PrincessException(ex);</span>
<span class="fc" id="L377">        }</span>
<span class="fc" id="L378">    }</span>

    /**
     * @return The index of my current {@link #FALL_SHAME_VALUES}.
     */
    public int getFallShameIndex() {
<span class="fc" id="L384">        return fallShameIndex;</span>
    }

    /**
     * @return How much do I want to avoid failed Piloting Rolls?
     */
    int getFallShameValue() {
<span class="nc" id="L391">        return getFallShameValue(getFallShameIndex());</span>
    }

    /**
     * @param index The index of the {@link #FALL_SHAME_VALUES} sought.
     * @return The value at the given index.  Indexes less than 0 are treated as 0 and indexes greater than 10 are
     *         treated as 10.
     */
    protected int getFallShameValue(final int index) {
<span class="nc" id="L400">        return FALL_SHAME_VALUES[validateIndex(index)];</span>
    }

    /**
     * @param index The index of my current {@link #FALL_SHAME_VALUES}.
     */
    public void setFallShameIndex(final int index) {
<span class="fc" id="L407">        this.fallShameIndex = validateIndex(index);</span>
<span class="fc" id="L408">    }</span>

    /**
     * @param index The index of my current {@link #FALL_SHAME_VALUES}.
     */
    public void setFallShameIndex(final String index) throws PrincessException {
        try {
<span class="fc" id="L415">            setFallShameIndex(Integer.parseInt(index));</span>
<span class="nc" id="L416">        } catch (final NumberFormatException ex) {</span>
<span class="nc" id="L417">            throw new PrincessException(ex);</span>
<span class="fc" id="L418">        }</span>
<span class="fc" id="L419">    }</span>

    /**
     * How close do I want to stick to my teammates?
     *
     * @return Index of the current herd mentality value.
     */
    public int getHerdMentalityIndex() {
<span class="fc" id="L427">        return herdMentalityIndex;</span>
    }

    /**
     * How close do I want to stick to my teammates?
     *
     * @return Current herd mentality value.
     */
    double getHerdMentalityValue() {
<span class="nc" id="L436">        return getHerdMentalityValue(herdMentalityIndex);</span>
    }

    /**
     * How close do I want to stick to my teammates?
     *
     * @param index The index [0-10] of the herd mentality value that should be used.
     * @return The herd mentality value at the specified index.
     */
    protected double getHerdMentalityValue(final int index) {
<span class="nc" id="L446">        return HERD_MENTALITY_VALUES[validateIndex(index)];</span>
    }

    /**
     * How close do I want to stick to my teammates?
     *
     * @param herdMentalityIndex The index [0-10] of the herd mentality that should be used.
     */
    public void setHerdMentalityIndex(final int herdMentalityIndex) {
<span class="fc" id="L455">        this.herdMentalityIndex = validateIndex(herdMentalityIndex);</span>
<span class="fc" id="L456">    }</span>

    /**
     * How close do I want to stick to my teammates?
     *
     * @param index The index [&quot;0&quot;-&quot;10&quot;] of the herd mentality value that should be used.
     */
    public void setHerdMentalityIndex(final String index) throws PrincessException {
        try {
<span class="fc" id="L465">            setHerdMentalityIndex(Integer.parseInt(index));</span>
<span class="nc" id="L466">        } catch (final NumberFormatException ex) {</span>
<span class="nc" id="L467">            throw new PrincessException(ex);</span>
<span class="fc" id="L468">        }</span>
<span class="fc" id="L469">    }</span>

    /**
     * Princess's home edge.
     *
     * @return The {@link CardinalEdge} princess will flee to.
     */
    public CardinalEdge getDestinationEdge() {
<span class="fc" id="L477">        return destinationEdge;</span>
    }

    /**
     * Princess's home edge.
     *
     * @param destinationEdge The {@link CardinalEdge} princess should flee to.
     */
    public void setDestinationEdge(final CardinalEdge destinationEdge) {
<span class="pc bpc" id="L486" title="1 of 2 branches missed.">        if (null == destinationEdge)</span>
<span class="nc" id="L487">            return;</span>

<span class="fc" id="L489">        this.destinationEdge = destinationEdge;</span>
<span class="fc" id="L490">    }</span>

    /**
     * Princess's home edge.
     *
     * @param destinationEdge the index of the {@link CardinalEdge} princess should flee to.  See {@link CardinalEdge#getIndex()}
     */
    public void setDestinationEdge(final int destinationEdge) {
<span class="fc" id="L498">        setDestinationEdge(CardinalEdge.getCardinalEdge(destinationEdge));</span>
<span class="fc" id="L499">    }</span>

    /**
     * Princess's home edge.
     *
     * @param destinationEdge the index of the {@link CardinalEdge} princess should flee to.  See {@link CardinalEdge#getIndex()}
     */
    public void setDestinationEdge(final String destinationEdge) throws PrincessException {
        try {
<span class="fc" id="L508">            setDestinationEdge(Integer.parseInt(destinationEdge.trim()));</span>
<span class="nc" id="L509">        } catch (final NumberFormatException e) {</span>
<span class="nc" id="L510">            throw new PrincessException(&quot;Invalid destinationEdge value.&quot;, e);</span>
<span class="fc" id="L511">        }</span>
<span class="fc" id="L512">    }</span>
    
    /**
     * Princess's home edge.
     *
     * @return The {@link CardinalEdge} princess will flee to.
     */
    public CardinalEdge getRetreatEdge() {
<span class="fc" id="L520">        return retreatEdge;</span>
    }

    /**
     * Princess's home edge.
     *
     * @param retreatEdge The {@link CardinalEdge} princess should flee to.
     */
    public void setRetreatEdge(final CardinalEdge retreatEdge) {
<span class="pc bpc" id="L529" title="1 of 2 branches missed.">        if (null == retreatEdge)</span>
<span class="nc" id="L530">            return;</span>

<span class="fc" id="L532">        this.retreatEdge = retreatEdge;</span>
<span class="fc" id="L533">    }</span>

    /**
     * Princess's home edge.
     *
     * @param retreatEdge the index of the {@link CardinalEdge} princess should flee to.  See {@link CardinalEdge#getIndex()}
     */
    public void setRetreatEdge(final int retreatEdge) {
<span class="fc" id="L541">        setRetreatEdge(CardinalEdge.getCardinalEdge(retreatEdge));</span>
<span class="fc" id="L542">    }</span>

    /**
     * Princess's home edge.
     *
     * @param retreatEdge the index of the {@link CardinalEdge} princess should flee to.  See {@link CardinalEdge#getIndex()}
     */
    public void setRetreatEdge(final String retreatEdge) throws PrincessException {
        try {
<span class="fc" id="L551">            setRetreatEdge(Integer.parseInt(retreatEdge.trim()));</span>
<span class="fc" id="L552">        } catch (final NumberFormatException e) {</span>
<span class="fc" id="L553">            throw new PrincessException(&quot;Invalid retreatEdge value.&quot;, e);</span>
<span class="fc" id="L554">        }</span>
<span class="fc" id="L555">    }</span>

    /**
     * How close to I want to get to my enemies?
     *
     * @return Index of the current hyper aggression value.
     */
    public int getHyperAggressionIndex() {
<span class="fc" id="L563">        return hyperAggressionIndex;</span>
    }

    /**
     * How close to I want to get to my enemies?
     *
     * @return Current hyper aggression value.
     */
    double getHyperAggressionValue() {
<span class="nc" id="L572">        return getHyperAggressionValue(hyperAggressionIndex);</span>
    }

    /**
     * How close to I want to get to my enemies?
     *
     * @param index The index[0-10] of the hyper aggression value desired.
     * @return The hyper aggression value at the given index.
     */
    protected double getHyperAggressionValue(final int index) {
<span class="nc" id="L582">        return HYPER_AGGRESSION_VALUES[validateIndex(index)];</span>
    }

    /**
     * How close to I want to get to my enemies?
     *
     * @param hyperAggressionIndex The index [0-10] of the hyper aggression value to be used.
     */
    public void setHyperAggressionIndex(final int hyperAggressionIndex) {
<span class="fc" id="L591">        this.hyperAggressionIndex = validateIndex(hyperAggressionIndex);</span>
<span class="fc" id="L592">    }</span>

    /**
     * How close to I want to get to my enemies?
     *
     * @param index The index [&quot;0&quot;-&quot;10&quot;] of the hyper aggression value to be used.
     */
    public void setHyperAggressionIndex(final String index) throws PrincessException {
        try {
<span class="fc" id="L601">            setHyperAggressionIndex(Integer.parseInt(index));</span>
<span class="nc" id="L602">        } catch (final NumberFormatException ex) {</span>
<span class="nc" id="L603">            throw new PrincessException(ex);</span>
<span class="fc" id="L604">        }</span>
<span class="fc" id="L605">    }</span>

    /**
     * How worried about enemy damage am I?
     *
     * @return Index of the current self preservation value.
     */
    public int getSelfPreservationIndex() {
<span class="fc" id="L613">        return selfPreservationIndex;</span>
    }

    /**
     * How worried about enemy damage am I?
     *
     * @return The current self preservation value.
     */
    public double getSelfPreservationValue() {
<span class="nc" id="L622">        return getSelfPreservationValue(selfPreservationIndex);</span>
    }

    /**
     * How worried about enemy damage am I?
     *
     * @param index The index [0-10] of the self preservation value desired.
     * @return The self preservation value at the specified index.
     */
    public double getSelfPreservationValue(int index) {
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (0 &gt; index) {</span>
<span class="nc" id="L633">            index = 0;</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">        } else if (10 &lt; index) {</span>
<span class="nc" id="L635">            index = 10;</span>
        }
<span class="nc" id="L637">        return SELF_PRESERVATION_VALUES[index];</span>
    }

    /**
     * How worried about enemy damage am I?
     *
     * @param selfPreservationIndex The index [0-10] of the self preservation value to be used.
     */
    public void setSelfPreservationIndex(final int selfPreservationIndex) {
<span class="fc" id="L646">        this.selfPreservationIndex = validateIndex(selfPreservationIndex);</span>
<span class="fc" id="L647">    }</span>

    /**
     * How worried about enemy damage am I?
     *
     * @param index The index [&quot;0&quot;-&quot;10&quot;] of the self preservation value to be used.
     */
    public void setSelfPreservationIndex(final String index) throws PrincessException {
        try {
<span class="fc" id="L656">            setSelfPreservationIndex(Integer.parseInt(index));</span>
<span class="nc" id="L657">        } catch (final NumberFormatException ex) {</span>
<span class="nc" id="L658">            throw new PrincessException(ex);</span>
<span class="fc" id="L659">        }</span>
<span class="fc" id="L660">    }</span>

    /**
     * Sets up the behavior parameters based on the passed in XML.
     *
     * @param behavior The XML element containing the behavior parameters.
     * @return TRUE if the XML was successfully parsed.
     */
    @SuppressWarnings(&quot;UnusedReturnValue&quot;)
    boolean fromXml(final Element behavior) throws PrincessException {
<span class="fc" id="L670">        final NodeList children = behavior.getChildNodes();</span>
<span class="fc bfc" id="L671" title="All 2 branches covered.">        for (int i = 0; i &lt; children.getLength(); i++) {</span>
<span class="fc" id="L672">            final Node child = children.item(i);</span>
<span class="fc bfc" id="L673" title="All 2 branches covered.">            if (&quot;name&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L674">                setDescription(child.getTextContent());</span>
<span class="fc bfc" id="L675" title="All 2 branches covered.">            } else if (&quot;forcedWithdrawal&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L676">                setForcedWithdrawal(child.getTextContent());</span>
<span class="fc bfc" id="L677" title="All 2 branches covered.">            } else if (&quot;autoFlee&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L678">                setAutoFlee(&quot;true&quot;.equalsIgnoreCase(child.getTextContent()));</span>
<span class="fc bfc" id="L679" title="All 2 branches covered.">            } else if (&quot;fallShameIndex&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L680">                setFallShameIndex(child.getTextContent());</span>
<span class="fc bfc" id="L681" title="All 2 branches covered.">            } else if (&quot;hyperAggressionIndex&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L682">                setHyperAggressionIndex(child.getTextContent());</span>
<span class="fc bfc" id="L683" title="All 2 branches covered.">            } else if (&quot;selfPreservationIndex&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L684">                setSelfPreservationIndex(child.getTextContent());</span>
<span class="fc bfc" id="L685" title="All 2 branches covered.">            } else if (&quot;destinationEdge&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L686">                setDestinationEdge(child.getTextContent());</span>
<span class="fc bfc" id="L687" title="All 2 branches covered.">            } else if (&quot;retreatEdge&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L688">                setRetreatEdge(child.getTextContent());</span>
<span class="fc bfc" id="L689" title="All 2 branches covered.">            } else if (&quot;herdMentalityIndex&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L690">                setHerdMentalityIndex(child.getTextContent());</span>
<span class="fc bfc" id="L691" title="All 2 branches covered.">            } else if (&quot;braveryIndex&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L692">                setBraveryIndex(child.getTextContent());</span>
<span class="fc bfc" id="L693" title="All 2 branches covered.">            } else if (&quot;verbosity&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L694">                setVerbosity(LogLevel.getLogLevel(child.getTextContent()));</span>
<span class="fc bfc" id="L695" title="All 2 branches covered.">            } else if (&quot;strategicTargets&quot;.equalsIgnoreCase(child.getNodeName())) {</span>
<span class="fc" id="L696">                final NodeList targets = child.getChildNodes();</span>
<span class="fc bfc" id="L697" title="All 2 branches covered.">                for (int j = 0; j &lt; targets.getLength(); j++) {</span>
<span class="fc" id="L698">                    final Node t = targets.item(j);</span>
<span class="fc bfc" id="L699" title="All 2 branches covered.">                    if (&quot;target&quot;.equalsIgnoreCase(t.getNodeName())) {</span>
<span class="fc" id="L700">                        addStrategicTarget(t.getTextContent());</span>
                    }
<span class="fc bfc" id="L702" title="All 2 branches covered.">                    if (&quot;unit&quot;.equalsIgnoreCase(t.getNodeName())) {</span>
<span class="fc" id="L703">                        addPriorityUnit(t.getTextContent());</span>
                    }
                }
            }
        }
<span class="fc" id="L708">        return true;</span>
    }

    /**
     * @return TRUE if this is the default behavior settings for a princess bot.
     */
    public boolean isDefault() {
<span class="nc" id="L715">        return BehaviorSettingsFactory.DEFAULT_BEHAVIOR_DESCRIPTION.equalsIgnoreCase(description);</span>
    }

    /**
     * Returns an XML representation of the behavior settings.
     *
     * @return An XML {@link org.w3c.dom.Element} describing this behavior settings object.
     */
    Element toXml(final Document doc,
                  final boolean includeTargets) {
<span class="nc" id="L725">        final String METHOD_NAME = &quot;toXml(Document, boolean)&quot;;</span>
        
        try {
<span class="nc" id="L728">            final Element behavior = doc.createElement(&quot;behavior&quot;);</span>

<span class="nc" id="L730">            final Element nameNode = doc.createElement(&quot;name&quot;);</span>
<span class="nc" id="L731">            nameNode.setTextContent(StringUtil.makeXmlSafe(getDescription()));</span>
<span class="nc" id="L732">            behavior.appendChild(nameNode);</span>

<span class="nc" id="L734">            final Element destinationEdgeNode = doc.createElement(&quot;destinationEdge&quot;);</span>
<span class="nc" id="L735">            destinationEdgeNode.setTextContent(&quot;&quot; + getDestinationEdge().getIndex());</span>
<span class="nc" id="L736">            behavior.appendChild(destinationEdgeNode);</span>
            
<span class="nc" id="L738">            final Element retreatEdgeNode = doc.createElement(&quot;retreatEdge&quot;);</span>
<span class="nc" id="L739">            retreatEdgeNode.setTextContent(&quot;&quot; + getRetreatEdge().getIndex());</span>
<span class="nc" id="L740">            behavior.appendChild(retreatEdgeNode);</span>

<span class="nc" id="L742">            final Element forcedWithdrawalNode = doc.createElement(&quot;forcedWithdrawal&quot;);</span>
<span class="nc" id="L743">            forcedWithdrawalNode.setTextContent(&quot;&quot; + isForcedWithdrawal());</span>
<span class="nc" id="L744">            behavior.appendChild(forcedWithdrawalNode);</span>

<span class="nc" id="L746">            final Element goHomeNode = doc.createElement(&quot;goHome&quot;);</span>
<span class="nc" id="L747">            goHomeNode.setTextContent(&quot;&quot; + shouldGoHome());</span>
<span class="nc" id="L748">            behavior.appendChild(goHomeNode);</span>

<span class="nc" id="L750">            final Element autoFleeNode = doc.createElement(&quot;autoFlee&quot;);</span>
<span class="nc" id="L751">            autoFleeNode.setTextContent(&quot;&quot; + shouldAutoFlee());</span>
<span class="nc" id="L752">            behavior.appendChild(autoFleeNode);</span>

<span class="nc" id="L754">            final Element fallShameNode = doc.createElement(&quot;fallShameIndex&quot;);</span>
<span class="nc" id="L755">            fallShameNode.setTextContent(&quot;&quot; + getFallShameIndex());</span>
<span class="nc" id="L756">            behavior.appendChild(fallShameNode);</span>

<span class="nc" id="L758">            final Element hyperAggressionNode = doc.createElement(&quot;hyperAggressionIndex&quot;);</span>
<span class="nc" id="L759">            hyperAggressionNode.setTextContent(&quot;&quot; + getHyperAggressionIndex());</span>
<span class="nc" id="L760">            behavior.appendChild(hyperAggressionNode);</span>

<span class="nc" id="L762">            final Element selfPreservationNode = doc.createElement(&quot;selfPreservationIndex&quot;);</span>
<span class="nc" id="L763">            selfPreservationNode.setTextContent(&quot;&quot; + getSelfPreservationIndex());</span>
<span class="nc" id="L764">            behavior.appendChild(selfPreservationNode);</span>

<span class="nc" id="L766">            final Element herdMentalityNode = doc.createElement(&quot;herdMentalityIndex&quot;);</span>
<span class="nc" id="L767">            herdMentalityNode.setTextContent(&quot;&quot; + getHerdMentalityIndex());</span>
<span class="nc" id="L768">            behavior.appendChild(herdMentalityNode);</span>

<span class="nc" id="L770">            final Element braveryNode = doc.createElement(&quot;braveryIndex&quot;);</span>
<span class="nc" id="L771">            braveryNode.setTextContent(&quot;&quot; + getBraveryIndex());</span>
<span class="nc" id="L772">            behavior.appendChild(braveryNode);</span>

<span class="nc" id="L774">            final Element verbosityNode = doc.createElement(&quot;verbosity&quot;);</span>
<span class="nc" id="L775">            verbosityNode.setTextContent(getVerbosity().toString());</span>
<span class="nc" id="L776">            behavior.appendChild(verbosityNode);</span>

<span class="nc" id="L778">            final Element targetsNode = doc.createElement(&quot;strategicBuildingTargets&quot;);</span>
<span class="nc bnc" id="L779" title="All 2 branches missed.">            if (includeTargets) {</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">                for (final String t : getStrategicBuildingTargets()) {</span>
<span class="nc" id="L781">                    final Element targetElement = doc.createElement(&quot;target&quot;);</span>
<span class="nc" id="L782">                    targetElement.setTextContent(StringUtil.makeXmlSafe(t));</span>
<span class="nc" id="L783">                    targetsNode.appendChild(targetElement);</span>
<span class="nc" id="L784">                }</span>
<span class="nc bnc" id="L785" title="All 2 branches missed.">                for (final int id : getPriorityUnitTargets()) {</span>
<span class="nc" id="L786">                    final Element unitElement = doc.createElement(&quot;unit&quot;);</span>
<span class="nc" id="L787">                    unitElement.setTextContent(String.valueOf(id));</span>
<span class="nc" id="L788">                    targetsNode.appendChild(unitElement);</span>
<span class="nc" id="L789">                }</span>
            }
<span class="nc" id="L791">            behavior.appendChild(targetsNode);</span>

<span class="nc" id="L793">            return behavior;</span>
<span class="nc" id="L794">        } catch (final Exception e) {</span>
<span class="nc" id="L795">            getLogger().error(e);</span>
            
        }

<span class="nc" id="L799">        return null;</span>
    }

    /**
     * @return A string log of these behavior settings.
     */
    public String toLog() {
<span class="fc" id="L806">        final StringBuilder out = new StringBuilder(&quot;Princess Behavior: &quot;).append(getDescription());</span>
<span class="fc" id="L807">        out.append(&quot;\n\tDestination Edge: &quot;).append(getDestinationEdge());</span>
<span class="fc" id="L808">        out.append(&quot;\n\tRetreat Edge: &quot;).append(getRetreatEdge());</span>
<span class="fc" id="L809">        out.append(&quot;\n\tForced Withdrawal: &quot;).append(isForcedWithdrawal());</span>
<span class="fc" id="L810">        out.append(&quot;\n\tSelf Preservation: &quot;).append(getSelfPreservationIndex());</span>
<span class="fc" id="L811">        out.append(&quot;\n\tHyper Aggression: &quot;).append(getHyperAggressionIndex());</span>
<span class="fc" id="L812">        out.append(&quot;\n\tFall Shame: &quot;).append(getFallShameIndex());</span>
<span class="fc" id="L813">        out.append(&quot;\n\tBravery: &quot;).append(getBraveryIndex());</span>
<span class="fc" id="L814">        out.append(&quot;\n\tHerd Mentality: &quot;).append(getHerdMentalityIndex());</span>
<span class="fc" id="L815">        out.append(&quot;\n\tVerbosity: &quot;).append(getVerbosity());</span>
<span class="fc" id="L816">        out.append(&quot;\n\tTargets:&quot;);</span>
<span class="fc" id="L817">        out.append(&quot;\n\t\tCoords: &quot;);</span>
<span class="pc bpc" id="L818" title="1 of 2 branches missed.">        for (final String t : getStrategicBuildingTargets()) {</span>
<span class="nc" id="L819">            out.append(&quot;  &quot;).append(t);</span>
<span class="nc" id="L820">        }</span>
<span class="fc" id="L821">        out.append(&quot;\n\t\tUnits:&quot;);</span>
<span class="pc bpc" id="L822" title="1 of 2 branches missed.">        for (final int id : getPriorityUnitTargets()) {</span>
<span class="nc" id="L823">            out.append(&quot;  &quot;).append(id);</span>
<span class="nc" id="L824">        }</span>
<span class="fc" id="L825">        return out.toString();</span>
    }

    @Override
    public boolean equals(final Object o) {
<span class="pc bpc" id="L830" title="1 of 2 branches missed.">        if (this == o) return true;</span>
<span class="pc bpc" id="L831" title="1 of 2 branches missed.">        if (!(o instanceof BehaviorSettings)) return false;</span>

<span class="fc" id="L833">        final BehaviorSettings that = (BehaviorSettings) o;</span>

<span class="pc bpc" id="L835" title="1 of 2 branches missed.">        if (autoFlee != that.autoFlee) return false;</span>
<span class="pc bpc" id="L836" title="1 of 2 branches missed.">        if (braveryIndex != that.braveryIndex) return false;</span>
<span class="pc bpc" id="L837" title="1 of 2 branches missed.">        if (fallShameIndex != that.fallShameIndex) return false;</span>
<span class="pc bpc" id="L838" title="1 of 2 branches missed.">        if (forcedWithdrawal != that.forcedWithdrawal) return false;</span>
<span class="pc bpc" id="L839" title="1 of 2 branches missed.">        if (goHome != that.goHome) return false;</span>
<span class="pc bpc" id="L840" title="1 of 2 branches missed.">        if (herdMentalityIndex != that.herdMentalityIndex) return false;</span>
<span class="pc bpc" id="L841" title="1 of 2 branches missed.">        if (hyperAggressionIndex != that.hyperAggressionIndex) return false;</span>
<span class="pc bpc" id="L842" title="1 of 2 branches missed.">        if (selfPreservationIndex != that.selfPreservationIndex) return false;</span>
<span class="pc bpc" id="L843" title="1 of 2 branches missed.">        if (!description.equals(that.description)) return false;</span>
<span class="pc bpc" id="L844" title="1 of 2 branches missed.">        if (destinationEdge != that.destinationEdge) return false;</span>
<span class="pc bpc" id="L845" title="1 of 2 branches missed.">        if (retreatEdge != that.retreatEdge) return false;</span>
<span class="pc bpc" id="L846" title="4 of 6 branches missed.">        if (null != strategicBuildingTargets ? !strategicBuildingTargets.equals(that.strategicBuildingTargets) : null != that</span>
                .strategicBuildingTargets) {
<span class="nc" id="L848">            return false;</span>
        }
        //noinspection RedundantIfStatement
<span class="pc bpc" id="L851" title="4 of 6 branches missed.">        if (null != priorityUnitTargets ? !priorityUnitTargets.equals(that.priorityUnitTargets) : null != that</span>
                .priorityUnitTargets) {
<span class="nc" id="L853">            return false;</span>
        }

<span class="fc" id="L856">        return true;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L861">        int result = description.hashCode();</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">        result = 31 * result + (forcedWithdrawal ? 1 : 0);</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">        result = 31 * result + (goHome ? 1 : 0);</span>
<span class="nc bnc" id="L864" title="All 2 branches missed.">        result = 31 * result + (autoFlee ? 1 : 0);</span>
<span class="nc" id="L865">        result = 31 * result + selfPreservationIndex;</span>
<span class="nc" id="L866">        result = 31 * result + fallShameIndex;</span>
<span class="nc" id="L867">        result = 31 * result + hyperAggressionIndex;</span>
<span class="nc" id="L868">        result = 31 * result + destinationEdge.hashCode();</span>
<span class="nc" id="L869">        result = 31 * result + retreatEdge.hashCode();</span>
<span class="nc bnc" id="L870" title="All 2 branches missed.">        result = 31 * result + (null != strategicBuildingTargets ? strategicBuildingTargets.hashCode() : 0);</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">        result = 31 * result + (null != priorityUnitTargets ? priorityUnitTargets.hashCode() : 0);</span>
<span class="nc" id="L872">        result = 31 * result + herdMentalityIndex;</span>
<span class="nc" id="L873">        result = 31 * result + braveryIndex;</span>
<span class="nc" id="L874">        return result;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>