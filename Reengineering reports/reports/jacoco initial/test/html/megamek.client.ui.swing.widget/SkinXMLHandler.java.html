<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SkinXMLHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing.widget</a> &gt; <span class="el_source">SkinXMLHandler.java</span></div><h1>SkinXMLHandler.java</h1><pre class="source lang-java linenums">/*
* MegaMek -
* Copyright (C) 2000, 2001, 2002, 2003, 2004, 2006 Ben Mazur (bmazur@sev.org)
* Copyright (C) 2015 Nicholas Walczak (walczak@cs.umn.edu)
* Copyright (C) 2018 The MegaMek Team
*
* This program is free software; you can redistribute it and/or modify it under
* the terms of the GNU General Public License as published by the Free Software
* Foundation; either version 2 of the License, or (at your option) any later
* version.
*
* This program is distributed in the hope that it will be useful, but WITHOUT
* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
* FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
* details.
*/

package megamek.client.ui.swing.widget;

import java.awt.Color;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.Writer;
import java.util.ArrayList;
import java.util.Set;
import java.util.HashMap;
import java.util.Map;


import javax.xml.parsers.DocumentBuilder;

import megamek.client.ui.swing.GUIPreferences;
import megamek.client.ui.swing.widget.SkinSpecification.UIComponents;
import megamek.common.Configuration;
import megamek.common.util.fileUtils.MegaMekFile;
import megamek.utils.MegaMekXmlUtil;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NodeList;

/**
 * This class reads in an XML file that specifies different aspects of the
 * visual skin for Megamek.
 *
 * @author arlith
 *
 */
<span class="nc" id="L52">public class SkinXMLHandler {</span>

<span class="nc" id="L54">    public static String SKIN_FOOTER = &quot;&lt;/skin&gt;&quot;;</span>
    public static String SKIN_HEADER;

    static {
<span class="nc" id="L58">        StringBuffer sb = new StringBuffer();</span>
<span class="nc" id="L59">        sb.append(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;);</span>
<span class="nc" id="L60">        sb.append(&quot;&lt;!--\n&quot;);</span>
<span class="nc" id="L61">        sb.append(&quot;  This is the default skin for Megamek\n&quot;);</span>
<span class="nc" id="L62">        sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L63">        sb.append(&quot;  New skins can be created by specifying UI_Element tags\n&quot;);</span>
<span class="nc" id="L64">        sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L65">        sb.append(&quot;  The defaultElement UI_Element specifies the default border to be used by UI\n&quot;);</span>
<span class="nc" id="L66">        sb.append(&quot;    components\n&quot;);</span>
<span class="nc" id="L67">        sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L68">        sb.append(&quot;  The defaultButton UI_Element specifies the default border and background\n&quot;);</span>
<span class="nc" id="L69">        sb.append(&quot;   images to use for Megamek buttons.  The first image is the base default\n&quot;);</span>
<span class="nc" id="L70">        sb.append(&quot;   image and the second image is the pressed image\n&quot;);</span>
<span class="nc" id="L71">        sb.append(&quot;\n&quot;);</span>
<span class="nc" id="L72">        sb.append(&quot;  NOTE: All locations should be in data/images/widgets\n&quot;);</span>
<span class="nc" id="L73">        sb.append(&quot;--&gt;\n&quot;);</span>
<span class="nc" id="L74">        sb.append(&quot;&lt;skin xmlns:xsi=\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot;\n&quot;);</span>
<span class="nc" id="L75">        sb.append(&quot;    xsi:noNamespaceSchemaLocation=\&quot;skinSchema.xsd\&quot;&gt;\n&quot;);</span>
<span class="nc" id="L76">        SKIN_HEADER = sb.toString();</span>
    }

    /**
     * The file name for the default Skin XML file, found in the config dir.
     */
<span class="nc" id="L82">    public static String defaultSkinXML = &quot;defaultSkin.xml&quot;;</span>

    // General XML Tags
<span class="nc" id="L85">    public static String UI_ELEMENT = &quot;UI_Element&quot;;</span>
<span class="nc" id="L86">    public static String NAME = &quot;name&quot;;</span>

    // Skin Specification XML Tags
    public static final String FONT_COLOR = &quot;font_color&quot;; //$NON-NLS-1$
    public static final String BORDER = &quot;border&quot;; //$NON-NLS-1$
    public static final String PLAIN = &quot;plain&quot;; //$NON-NLS-1$
    public static final String NO_BORDER = &quot;no_border&quot;; //$NON-NLS-1$
    public static final String TILE_BACKGROUND = &quot;tile_background&quot;; //$NON-NLS-1$
    public static final String TR_CORNER = &quot;corner_top_right&quot;; //$NON-NLS-1$
    public static final String TL_CORNER = &quot;corner_top_left&quot;; //$NON-NLS-1$
    public static final String BR_CORNER = &quot;corner_bottom_right&quot;; //$NON-NLS-1$
    public static final String BL_CORNER = &quot;corner_bottom_left&quot;; //$NON-NLS-1$
    public static final String EDGE = &quot;edge&quot;; //$NON-NLS-1$
    public static final String EDGE_NAME = &quot;edgeName&quot;; //$NON-NLS-1$
    public static final String EDGE_ICON = &quot;edgeIcon&quot;; //$NON-NLS-1$
    public static final String ICON = &quot;icon&quot;; //$NON-NLS-1$
    public static final String TILED = &quot;tiled&quot;; //$NON-NLS-1$
    public static final String TOP_LINE = &quot;line_top&quot;; //$NON-NLS-1$
    public static final String BOTTOM_LINE = &quot;line_bottom&quot;; //$NON-NLS-1$
    public static final String RIGHT_LINE = &quot;line_right&quot;; //$NON-NLS-1$
    public static final String LEFT_LINE = &quot;line_left&quot;; //$NON-NLS-1$
    public static final String BACKGROUND_IMAGE = &quot;background_image&quot;; //$NON-NLS-1$
    public static final String SHOW_SCROLL_BARS = &quot;show_scroll_bars&quot;; //$NON-NLS-1$
    public static final String SHOULD_BOLD = &quot;should_bold_mouseover&quot;; //$NON-NLS-1$
    public static final String FONT_NAME = &quot;font_name&quot;; //$NON-NLS-1$
    public static final String FONT_SIZE = &quot;font_size&quot;; //$NON-NLS-1$

    // Unit Display Skin Specification XML tags
    public static final String GeneralTabIdle = &quot;tab_general_idle&quot;; //$NON-NLS-1$
    public static final String PilotTabIdle = &quot;tab_pilot_idle&quot;; //$NON-NLS-1$
    public static final String ArmorTabIdle = &quot;tab_armor_idle&quot;; //$NON-NLS-1$
    public static final String SystemsTabIdle = &quot;tab_systems_idle&quot;; //$NON-NLS-1$
    public static final String WeaponsTabIdle = &quot;tab_weapon_idle&quot;; //$NON-NLS-1$
    public static final String ExtrasTabIdle = &quot;tab_extras_idle&quot;; //$NON-NLS-1$
    public static final String GeneralTabActive = &quot;tab_general_active&quot;; //$NON-NLS-1$
    public static final String PilotTabActive = &quot;tab_pilot_active&quot;; //$NON-NLS-1$
    public static final String ArmorTabActive = &quot;tab_armor_active&quot;; //$NON-NLS-1$
    public static final String SystemsTabActive = &quot;tab_systems_active&quot;; //$NON-NLS-1$
    public static final String WeaponsTabActive = &quot;tab_weapon_active&quot;; //$NON-NLS-1$
    public static final String ExtraTabActive = &quot;tab_extras_active&quot;; //$NON-NLS-1$
    public static final String CornerIdle = &quot;idle_corner&quot;; //$NON-NLS-1$
    public static final String CornerActive = &quot;active_corner&quot;; //$NON-NLS-1$

    public static final String BackgroundTile = &quot;background_tile&quot;; //$NON-NLS-1$
    public static final String TopLine = &quot;top_line&quot;; //$NON-NLS-1$
    public static final String BottomLine = &quot;bottom_line&quot;; //$NON-NLS-1$
    public static final String LeftLine = &quot;left_line&quot;; //$NON-NLS-1$
    public static final String RightLine = &quot;right_line&quot;; //$NON-NLS-1$
    public static final String TopLeftCorner = &quot;tl_corner&quot;; //$NON-NLS-1$
    public static final String BottomLeftCorner = &quot;bl_corner&quot;; //$NON-NLS-1$
    public static final String TopRightCorner = &quot;tr_corner&quot;; //$NON-NLS-1$
    public static final String BottomRightCorner = &quot;br_corner&quot;; //$NON-NLS-1$

    public static final String MechOutline = &quot;mech_outline&quot;; //$NON-NLS-1$

    private static Map&lt;String, SkinSpecification&gt; skinSpecs;

<span class="nc" id="L143">    private static UnitDisplaySkinSpecification udSpec = null;</span>

    /**
     * Checks whether the given path points to a file that is a valid skin
     * specification.
     *
     * @param fileName
     * @return
     */
    public static boolean validSkinSpecFile(String fileName) {
<span class="nc" id="L153">        File file = new MegaMekFile(Configuration.skinsDir(), fileName).getFile();</span>
<span class="nc bnc" id="L154" title="All 4 branches missed.">        if (!file.exists() || !file.isFile()) {</span>
<span class="nc" id="L155">            return false;</span>
        }
        try {
<span class="nc" id="L158">            DocumentBuilder builder = MegaMekXmlUtil.newSafeDocumentBuilder();</span>
<span class="nc" id="L159">            Document doc = builder.parse(file);</span>
            // TODO: Just validate against the XSD
            // Until that's done, just assume anything with UI_ELEMENT tags is
            //  valid
<span class="nc" id="L163">            NodeList listOfComponents = doc.getElementsByTagName(UI_ELEMENT);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">            if (listOfComponents.getLength() &gt; 0) {</span>
<span class="nc" id="L165">                return true;</span>
            } else {
<span class="nc" id="L167">                return false;</span>
            }
<span class="nc" id="L169">        } catch (Exception e) {</span>
<span class="nc" id="L170">            return false;</span>
        }
    }

    /**
     * Initializes using the default skin file.
     * @throws IOException
     */
    public static boolean initSkinXMLHandler() {
<span class="nc" id="L179">        String skinFilePath = GUIPreferences.getInstance().getSkinFile();</span>
<span class="nc" id="L180">        return initSkinXMLHandler(skinFilePath);</span>
    }

    /**
     * Initializes using the supplied skin file.
     * @throws IOException
     */
    public synchronized static boolean initSkinXMLHandler(String fileName) {
        // Reset UnitDisplay spec
<span class="nc" id="L189">        udSpec = null;</span>

<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (fileName == null) {</span>
<span class="nc" id="L192">            System.out.println(&quot;ERROR: Bad skin specification file: &quot; +</span>
                    &quot;null filename!&quot;);
<span class="nc" id="L194">            return false;</span>
        }

<span class="nc" id="L197">        File file = new MegaMekFile(Configuration.skinsDir(), fileName).getFile();</span>
<span class="nc bnc" id="L198" title="All 4 branches missed.">        if (!file.exists() || !file.isFile()) {</span>
<span class="nc" id="L199">            System.out.println(&quot;ERROR: Bad skin specification file: &quot; +</span>
                    &quot;file doesn't exist!  File name: &quot; + fileName);
<span class="nc" id="L201">            return false;</span>
        }

        // Build the XML document.
        try {
<span class="nc" id="L206">            DocumentBuilder builder = MegaMekXmlUtil.newSafeDocumentBuilder();</span>
<span class="nc" id="L207">            System.out.println(&quot;Parsing &quot; + file.getName());</span>
<span class="nc" id="L208">            Document doc = builder.parse(file);</span>
<span class="nc" id="L209">            System.out.println(&quot;Parsing finished.&quot;);</span>

            // Get the list of units.
<span class="nc" id="L212">            NodeList listOfComponents = doc.getElementsByTagName(UI_ELEMENT);</span>
<span class="nc" id="L213">            int totalComponents = listOfComponents.getLength();</span>
<span class="nc" id="L214">            skinSpecs = new HashMap&lt;String, SkinSpecification&gt;(</span>
                    (int)(totalComponents * 1.25));
<span class="nc bnc" id="L216" title="All 2 branches missed.">            for (int comp = 0; comp &lt; totalComponents; comp++) {</span>
<span class="nc" id="L217">                Element borderList = (Element) listOfComponents.item(comp);</span>

<span class="nc" id="L219">                String name = borderList.getElementsByTagName(NAME).</span>
<span class="nc" id="L220">                        item(0).getTextContent();</span>

<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (name.equals(SkinSpecification.UIComponents.UnitDisplay.getComp())) {</span>
<span class="nc" id="L223">                    parseUnitDisplaySkinSpec(borderList);</span>
<span class="nc" id="L224">                    continue;</span>
                }

                SkinSpecification skinSpec;
                // Parse no border
<span class="nc" id="L229">                Element noBorderEle = (Element) borderList</span>
<span class="nc" id="L230">                        .getElementsByTagName(NO_BORDER).item(0);</span>
<span class="nc" id="L231">                boolean noBorder = false;</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                if (noBorderEle != null) {</span>
<span class="nc" id="L233">                    noBorder = Boolean</span>
<span class="nc" id="L234">                            .parseBoolean(noBorderEle.getTextContent());</span>
                }

                // Get the first element of this node.
<span class="nc" id="L238">                Element plainTag = (Element)</span>
<span class="nc" id="L239">                        borderList.getElementsByTagName(PLAIN).item(0);</span>
                // If there is no plain tag, load the icons
<span class="nc bnc" id="L241" title="All 4 branches missed.">                if (plainTag == null &amp;&amp; !noBorder) {</span>
                    // Get the border specs
<span class="nc" id="L243">                    Element border = (Element)</span>
<span class="nc" id="L244">                            borderList.getElementsByTagName(BORDER).item(0);</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">                    if (border == null) {</span>
<span class="nc" id="L246">                        System.err.println(&quot;Missing &lt;&quot; + BORDER +</span>
                                &quot;&gt; tag in element #&quot; + comp);
<span class="nc" id="L248">                        continue;</span>
                    }

<span class="nc" id="L251">                    skinSpec = parseBorderTag(name, border);</span>
<span class="nc" id="L252">                } else { // Plain skin, no icons</span>
<span class="nc" id="L253">                    skinSpec = new SkinSpecification(name);</span>
<span class="nc" id="L254">                    skinSpec.noBorder = noBorder;</span>
                }

                // Get the background specs
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (plainTag == null) {</span>
<span class="nc" id="L259">                    NodeList backgrounds =</span>
<span class="nc" id="L260">                            borderList.getElementsByTagName(BACKGROUND_IMAGE);</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">                    if (backgrounds != null){</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">                        for (int bg = 0; bg &lt; backgrounds.getLength(); bg++){</span>
<span class="nc" id="L263">                            skinSpec.backgrounds.add(</span>
<span class="nc" id="L264">                                    backgrounds.item(bg).getTextContent());</span>
                        }
                    }
                }

                // Parse show scroll bars
<span class="nc" id="L270">                Element showScrollEle = (Element) borderList</span>
<span class="nc" id="L271">                        .getElementsByTagName(SHOW_SCROLL_BARS).item(0);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                if (showScrollEle != null) {</span>
<span class="nc" id="L273">                    skinSpec.showScrollBars = Boolean</span>
<span class="nc" id="L274">                            .parseBoolean(showScrollEle.getTextContent());</span>
                }

                // Parse show should bold
<span class="nc" id="L278">                Element shouldBoldEle = (Element) borderList</span>
<span class="nc" id="L279">                        .getElementsByTagName(SHOULD_BOLD).item(0);</span>
<span class="nc bnc" id="L280" title="All 2 branches missed.">                if (shouldBoldEle != null) {</span>
<span class="nc" id="L281">                    skinSpec.shouldBoldMouseOver = Boolean</span>
<span class="nc" id="L282">                            .parseBoolean(shouldBoldEle.getTextContent());</span>
                }

                // Parse font name
<span class="nc" id="L286">                Element fontNameEle = (Element) borderList</span>
<span class="nc" id="L287">                        .getElementsByTagName(FONT_NAME).item(0);</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">                if (fontNameEle != null) {</span>
<span class="nc" id="L289">                    skinSpec.fontName = fontNameEle.getTextContent();</span>
                }

                // Parse font size
<span class="nc" id="L293">                Element fontSizeEle = (Element) borderList</span>
<span class="nc" id="L294">                        .getElementsByTagName(FONT_SIZE).item(0);</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">                if (fontSizeEle != null) {</span>
<span class="nc" id="L296">                    skinSpec.fontSize = Integer.parseInt(fontSizeEle.getTextContent());</span>
                }

                // Parse font colors
<span class="nc" id="L300">                NodeList fontColors = borderList</span>
<span class="nc" id="L301">                        .getElementsByTagName(FONT_COLOR);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">                if (fontColors.getLength() &gt; 0) {</span>
<span class="nc" id="L303">                    skinSpec.fontColors.clear();</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">                    for (int fc = 0; fc &lt; fontColors.getLength(); fc++) {</span>
<span class="nc" id="L305">                        String fontColorContent = fontColors.item(fc)</span>
<span class="nc" id="L306">                                .getTextContent();</span>
<span class="nc" id="L307">                        skinSpec.fontColors.add(Color.decode(fontColorContent));</span>
                    }
                }

                // Parse tile background
<span class="nc" id="L312">                Element tileBGEle = (Element) borderList</span>
<span class="nc" id="L313">                        .getElementsByTagName(TILE_BACKGROUND).item(0);</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                if (tileBGEle != null) {</span>
<span class="nc" id="L315">                    skinSpec.tileBackground = Boolean</span>
<span class="nc" id="L316">                            .parseBoolean(tileBGEle.getTextContent());</span>
                }

<span class="nc bnc" id="L319" title="All 2 branches missed.">                if (SkinSpecification.UIComponents.getUIComponent(name) == null) {</span>
<span class="nc" id="L320">                    System.out.println(&quot;SKIN ERROR: &quot;</span>
                            + &quot;Unable to add unrecognized UI component: &quot;
                            + name + &quot;!&quot;);
                } else {
<span class="nc" id="L324">                    skinSpecs.put(name, skinSpec);</span>
                }
            }

<span class="nc bnc" id="L328" title="All 2 branches missed.">            if (!skinSpecs.containsKey(UIComponents.DefaultUIElement.getComp())</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">                    || !skinSpecs.containsKey(UIComponents.DefaultButton.getComp())) {</span>
<span class="nc" id="L330">                System.out.println(&quot;SKIN ERROR: Bad skin specification file: &quot; +</span>
                        &quot;file doesn't specify &quot; + UIComponents.DefaultUIElement +
                        &quot; or &quot; + UIComponents.DefaultButton + &quot;!&quot;);
<span class="nc" id="L333">                return false;</span>
            }
<span class="nc" id="L335">        } catch (Exception e) {</span>
<span class="nc" id="L336">            System.out.println(e.getMessage());</span>
<span class="nc" id="L337">            e.printStackTrace();</span>
<span class="nc" id="L338">            return false;</span>
<span class="nc" id="L339">        }</span>
        // Skin spec didn't specify UnitDisplay skin, use default
<span class="nc bnc" id="L341" title="All 2 branches missed.">        if (udSpec == null) {</span>
<span class="nc" id="L342">            udSpec = new UnitDisplaySkinSpecification();</span>
        }
<span class="nc" id="L344">        return true;</span>
    }

    /**
     *  Create a new SkinSpecification and populate it from the supplied border
     *  tag
     *
     * @param border
     * @return
     */
    private static SkinSpecification parseBorderTag(String compName, Element border){
<span class="nc" id="L355">        SkinSpecification skinSpec = new SkinSpecification(compName);</span>

        // Parse Corner Icons
<span class="nc" id="L358">        skinSpec.tr_corner = border.getElementsByTagName(TR_CORNER).</span>
<span class="nc" id="L359">                item(0).getTextContent();</span>
<span class="nc" id="L360">        skinSpec.tl_corner = border.getElementsByTagName(TL_CORNER).</span>
<span class="nc" id="L361">                item(0).getTextContent();</span>
<span class="nc" id="L362">        skinSpec.br_corner = border.getElementsByTagName(BR_CORNER).</span>
<span class="nc" id="L363">                item(0).getTextContent();</span>
<span class="nc" id="L364">        skinSpec.bl_corner = border.getElementsByTagName(BL_CORNER).</span>
<span class="nc" id="L365">                item(0).getTextContent();</span>

        // Parse Edge Icons from Edge tag
<span class="nc" id="L368">        NodeList edgeNodes = border.getElementsByTagName(EDGE);</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">        for (int i = 0; i &lt; edgeNodes.getLength(); i++){</span>
            // An edge tag will have some number of icons
<span class="nc" id="L371">            ArrayList&lt;String&gt; icons = new ArrayList&lt;String&gt;();</span>
            // And icon can be tiled or static
<span class="nc" id="L373">            ArrayList&lt;Boolean&gt; shouldTile = new ArrayList&lt;Boolean&gt;();</span>
<span class="nc" id="L374">            NodeList edgeIcons = ((Element) edgeNodes.item(i))</span>
<span class="nc" id="L375">                    .getElementsByTagName(EDGE_ICON);</span>
            // Iterate through each icon/tiled pair
<span class="nc bnc" id="L377" title="All 2 branches missed.">            for (int j = 0; j &lt; edgeIcons.getLength(); j++){</span>
<span class="nc" id="L378">                String icon = ((Element) edgeIcons.item(j))</span>
<span class="nc" id="L379">                        .getElementsByTagName(ICON).item(0).getTextContent();</span>
<span class="nc" id="L380">                String tiled = ((Element) edgeIcons.item(j))</span>
<span class="nc" id="L381">                        .getElementsByTagName(TILED).item(0).getTextContent();</span>

<span class="nc bnc" id="L383" title="All 2 branches missed.">                if (icon == null){</span>
<span class="nc" id="L384">                    System.err.println(&quot;Missing &lt;&quot; + ICON + &quot;&gt; tag&quot;);</span>
<span class="nc" id="L385">                    continue;</span>
                }
<span class="nc bnc" id="L387" title="All 2 branches missed.">                if (tiled == null){</span>
<span class="nc" id="L388">                    System.err.println(&quot;Missing &lt;&quot; + TILED + &quot;&gt; tag&quot;);</span>
<span class="nc" id="L389">                    continue;</span>
                }
<span class="nc" id="L391">                icons.add(icon);</span>
<span class="nc" id="L392">                shouldTile.add(tiled.equalsIgnoreCase(&quot;true&quot;));</span>
            }

<span class="nc" id="L395">            String edgeName = ((Element) edgeNodes.item(i))</span>
<span class="nc" id="L396">                    .getElementsByTagName(EDGE_NAME).item(0).getTextContent();</span>

<span class="nc bnc" id="L398" title="All 2 branches missed.">            if (edgeName == null){</span>
<span class="nc" id="L399">                System.err.println(&quot;Missing &lt;&quot; + EDGE_NAME + &quot;&gt; tag&quot;);</span>
<span class="nc" id="L400">                continue;</span>
            }

<span class="nc bnc" id="L403" title="All 2 branches missed.">            if (edgeName.equals(&quot;top&quot;)){</span>
<span class="nc" id="L404">                skinSpec.topEdge = icons;</span>
<span class="nc" id="L405">                skinSpec.topShouldTile = shouldTile;</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            } else if (edgeName.equals(&quot;bottom&quot;)){</span>
<span class="nc" id="L407">                skinSpec.bottomEdge = icons;</span>
<span class="nc" id="L408">                skinSpec.bottomShouldTile = shouldTile;</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            } else if (edgeName.equals(&quot;left&quot;)){</span>
<span class="nc" id="L410">                skinSpec.leftEdge = icons;</span>
<span class="nc" id="L411">                skinSpec.leftShouldTile = shouldTile;</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">            } else if (edgeName.equals(&quot;right&quot;)){</span>
<span class="nc" id="L413">                skinSpec.rightEdge = icons;</span>
<span class="nc" id="L414">                skinSpec.rightShouldTile = shouldTile;</span>
            }
        }
<span class="nc" id="L417">        return skinSpec;</span>
    }

    /**
     * Given a UI_Component component with a UnitDisplay name, parse it into
     * a new UnitDisplaySkinSpecification.  This tupe of UI_Element has a
     * different structure than other UI_Elements.
     *
     * @param border
     */
    private static void parseUnitDisplaySkinSpec(Element border) {
<span class="nc" id="L428">        udSpec = new UnitDisplaySkinSpecification();</span>

<span class="nc bnc" id="L430" title="All 2 branches missed.">        if (border.getElementsByTagName(GeneralTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L431">            udSpec.setGeneralTabIdle(border</span>
<span class="nc" id="L432">                    .getElementsByTagName(GeneralTabIdle).item(0)</span>
<span class="nc" id="L433">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if (border.getElementsByTagName(PilotTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L436">            udSpec.setPilotTabIdle(border.getElementsByTagName(PilotTabIdle)</span>
<span class="nc" id="L437">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L439" title="All 2 branches missed.">        if (border.getElementsByTagName(ArmorTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L440">            udSpec.setArmorTabIdle(border.getElementsByTagName(ArmorTabIdle)</span>
<span class="nc" id="L441">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L443" title="All 2 branches missed.">        if (border.getElementsByTagName(SystemsTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L444">            udSpec.setSystemsTabIdle(border</span>
<span class="nc" id="L445">                    .getElementsByTagName(SystemsTabIdle).item(0)</span>
<span class="nc" id="L446">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (border.getElementsByTagName(WeaponsTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L449">            udSpec.setWeaponsTabIdle(border</span>
<span class="nc" id="L450">                    .getElementsByTagName(WeaponsTabIdle).item(0)</span>
<span class="nc" id="L451">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L453" title="All 2 branches missed.">        if (border.getElementsByTagName(ExtrasTabIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L454">            udSpec.setExtrasTabIdle(border.getElementsByTagName(ExtrasTabIdle)</span>
<span class="nc" id="L455">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L457" title="All 2 branches missed.">        if (border.getElementsByTagName(GeneralTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L458">            udSpec.setGeneralTabActive(border</span>
<span class="nc" id="L459">                    .getElementsByTagName(GeneralTabActive).item(0)</span>
<span class="nc" id="L460">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L462" title="All 2 branches missed.">        if (border.getElementsByTagName(PilotTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L463">            udSpec.setPilotTabActive(border</span>
<span class="nc" id="L464">                    .getElementsByTagName(PilotTabActive).item(0)</span>
<span class="nc" id="L465">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L467" title="All 2 branches missed.">        if (border.getElementsByTagName(ArmorTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L468">            udSpec.setArmorTabActive(border</span>
<span class="nc" id="L469">                    .getElementsByTagName(ArmorTabActive).item(0)</span>
<span class="nc" id="L470">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L472" title="All 2 branches missed.">        if (border.getElementsByTagName(SystemsTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L473">            udSpec.setSystemsTabActive(border</span>
<span class="nc" id="L474">                    .getElementsByTagName(SystemsTabActive).item(0)</span>
<span class="nc" id="L475">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L477" title="All 2 branches missed.">        if (border.getElementsByTagName(WeaponsTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L478">            udSpec.setWeaponsTabActive(border</span>
<span class="nc" id="L479">                    .getElementsByTagName(WeaponsTabActive).item(0)</span>
<span class="nc" id="L480">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L482" title="All 2 branches missed.">        if (border.getElementsByTagName(ExtraTabActive).getLength() &gt; 0) {</span>
<span class="nc" id="L483">            udSpec.setExtraTabActive(border</span>
<span class="nc" id="L484">                    .getElementsByTagName(ExtraTabActive).item(0)</span>
<span class="nc" id="L485">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (border.getElementsByTagName(CornerIdle).getLength() &gt; 0) {</span>
<span class="nc" id="L488">            udSpec.setCornerIdle(border.getElementsByTagName(CornerIdle)</span>
<span class="nc" id="L489">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L491" title="All 2 branches missed.">        if (border.getElementsByTagName(CornerActive).getLength() &gt; 0) {</span>
<span class="nc" id="L492">            udSpec.setCornerActive(border.getElementsByTagName(CornerActive)</span>
<span class="nc" id="L493">                    .item(0).getTextContent());</span>
        }

<span class="nc bnc" id="L496" title="All 2 branches missed.">        if (border.getElementsByTagName(BackgroundTile).getLength() &gt; 0) {</span>
<span class="nc" id="L497">            udSpec.setBackgroundTile(border</span>
<span class="nc" id="L498">                    .getElementsByTagName(BackgroundTile).item(0)</span>
<span class="nc" id="L499">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L501" title="All 2 branches missed.">        if (border.getElementsByTagName(TopLine).getLength() &gt; 0) {</span>
<span class="nc" id="L502">            udSpec.setTopLine(border</span>
<span class="nc" id="L503">                    .getElementsByTagName(TopLine).item(0)</span>
<span class="nc" id="L504">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L506" title="All 2 branches missed.">        if (border.getElementsByTagName(BottomLine).getLength() &gt; 0) {</span>
<span class="nc" id="L507">            udSpec.setBottomLine(border</span>
<span class="nc" id="L508">                    .getElementsByTagName(BottomLine).item(0)</span>
<span class="nc" id="L509">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L511" title="All 2 branches missed.">        if (border.getElementsByTagName(LeftLine).getLength() &gt; 0) {</span>
<span class="nc" id="L512">            udSpec.setLeftLine(border.getElementsByTagName(LeftLine)</span>
<span class="nc" id="L513">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L515" title="All 2 branches missed.">        if (border.getElementsByTagName(RightLine).getLength() &gt; 0) {</span>
<span class="nc" id="L516">            udSpec.setRightLine(border.getElementsByTagName(RightLine)</span>
<span class="nc" id="L517">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L519" title="All 2 branches missed.">        if (border.getElementsByTagName(TopLeftCorner).getLength() &gt; 0) {</span>
<span class="nc" id="L520">            udSpec.setTopLeftCorner(border.getElementsByTagName(TopLeftCorner)</span>
<span class="nc" id="L521">                    .item(0).getTextContent());</span>
        }
<span class="nc bnc" id="L523" title="All 2 branches missed.">        if (border.getElementsByTagName(BottomLeftCorner).getLength() &gt; 0) {</span>
<span class="nc" id="L524">            udSpec.setBottomLeftCorner(border</span>
<span class="nc" id="L525">                    .getElementsByTagName(BottomLeftCorner).item(0)</span>
<span class="nc" id="L526">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L528" title="All 2 branches missed.">        if (border.getElementsByTagName(TopRightCorner).getLength() &gt; 0) {</span>
<span class="nc" id="L529">            udSpec.setTopRightCorner(border</span>
<span class="nc" id="L530">                    .getElementsByTagName(TopRightCorner).item(0)</span>
<span class="nc" id="L531">                    .getTextContent());</span>
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if (border.getElementsByTagName(BottomRightCorner).getLength() &gt; 0) {</span>
<span class="nc" id="L534">            udSpec.setBottomRightCorner(border</span>
<span class="nc" id="L535">                    .getElementsByTagName(BottomRightCorner).item(0)</span>
<span class="nc" id="L536">                    .getTextContent());</span>
        }

<span class="nc bnc" id="L539" title="All 2 branches missed.">        if (border.getElementsByTagName(MechOutline).getLength() &gt; 0) {</span>
<span class="nc" id="L540">            udSpec.setMechOutline(border</span>
<span class="nc" id="L541">                    .getElementsByTagName(MechOutline).item(0)</span>
<span class="nc" id="L542">                    .getTextContent());</span>
        }
<span class="nc" id="L544">    }</span>

    /**
     * Writes the current skin to the specified XML file.
     *
     * @param filename
     */
    public static void writeSkinToFile(String filename) {
<span class="nc" id="L552">        File filePath = new MegaMekFile(Configuration.skinsDir(),</span>
<span class="nc" id="L553">                filename).getFile();</span>

<span class="nc" id="L555">        try (Writer output = new BufferedWriter(new OutputStreamWriter(</span>
                new FileOutputStream(filePath)));){
<span class="nc" id="L557">            output.write(SKIN_HEADER);</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">            for (String component : skinSpecs.keySet()) {</span>
<span class="nc" id="L559">                writeSkinComponent(component, output);</span>
<span class="nc" id="L560">            }</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">            if (udSpec != null) {</span>
<span class="nc" id="L562">                writeUnitDisplaySkinSpec(output);</span>
            }
<span class="nc" id="L564">            output.write(SKIN_FOOTER);</span>
<span class="nc" id="L565">            output.close();</span>
<span class="nc" id="L566">        } catch (IOException e) {</span>
<span class="nc" id="L567">            System.out.println(e.getMessage());</span>
<span class="nc" id="L568">            e.printStackTrace();</span>
<span class="nc" id="L569">        }</span>
<span class="nc" id="L570">    }</span>

    /**
     * Helper method for writing the UI_Element tag related to a
     * UnitDisplaySkinSpecification.
     *
     * @param out
     * @throws IOException
     */
    private static void writeUnitDisplaySkinSpec(Writer out) throws IOException {
        // If the spec is null, nothing to do
<span class="nc bnc" id="L581" title="All 2 branches missed.">        if (udSpec == null) {</span>
<span class="nc" id="L582">            return;</span>
        }

<span class="nc" id="L585">        out.write(&quot;\t&lt;&quot; + UI_ELEMENT + &quot;&gt;\n&quot;);</span>

        // Write Component name
<span class="nc" id="L588">        out.write(&quot;\t\t&lt;&quot; + NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L589">        out.write(SkinSpecification.UIComponents.UnitDisplay.getComp());</span>
<span class="nc" id="L590">        out.write(&quot;&lt;/&quot; + NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L592">        out.write(&quot;\t\t\t&lt;&quot; + GeneralTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L593">        out.write(udSpec.getGeneralTabIdle());</span>
<span class="nc" id="L594">        out.write(&quot;&lt;/&quot; + GeneralTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L596">        out.write(&quot;\t\t\t&lt;&quot; + PilotTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L597">        out.write(udSpec.getPilotTabIdle());</span>
<span class="nc" id="L598">        out.write(&quot;&lt;/&quot; + PilotTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L600">        out.write(&quot;\t\t\t&lt;&quot; + ArmorTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L601">        out.write(udSpec.getArmorTabIdle());</span>
<span class="nc" id="L602">        out.write(&quot;&lt;/&quot; + ArmorTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L604">        out.write(&quot;\t\t\t&lt;&quot; + SystemsTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L605">        out.write(udSpec.getSystemsTabIdle());</span>
<span class="nc" id="L606">        out.write(&quot;&lt;/&quot; + SystemsTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L608">        out.write(&quot;\t\t\t&lt;&quot; + WeaponsTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L609">        out.write(udSpec.getWeaponsTabIdle());</span>
<span class="nc" id="L610">        out.write(&quot;&lt;/&quot; + WeaponsTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L612">        out.write(&quot;\t\t\t&lt;&quot; + ExtrasTabIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L613">        out.write(udSpec.getExtrasTabIdle());</span>
<span class="nc" id="L614">        out.write(&quot;&lt;/&quot; + ExtrasTabIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L616">        out.write(&quot;\t\t\t&lt;&quot; + GeneralTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L617">        out.write(udSpec.getGeneralTabActive());</span>
<span class="nc" id="L618">        out.write(&quot;&lt;/&quot; + GeneralTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L620">        out.write(&quot;\t\t\t&lt;&quot; + PilotTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L621">        out.write(udSpec.getPilotTabActive());</span>
<span class="nc" id="L622">        out.write(&quot;&lt;/&quot; + PilotTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L624">        out.write(&quot;\t\t\t&lt;&quot; + ArmorTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L625">        out.write(udSpec.getArmorTabActive());</span>
<span class="nc" id="L626">        out.write(&quot;&lt;/&quot; + ArmorTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L628">        out.write(&quot;\t\t\t&lt;&quot; + SystemsTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L629">        out.write(udSpec.getSystemsTabActive());</span>
<span class="nc" id="L630">        out.write(&quot;&lt;/&quot; + SystemsTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L632">        out.write(&quot;\t\t\t&lt;&quot; + WeaponsTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L633">        out.write(udSpec.getWeaponsTabActive());</span>
<span class="nc" id="L634">        out.write(&quot;&lt;/&quot; + WeaponsTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L636">        out.write(&quot;\t\t\t&lt;&quot; + ExtraTabActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L637">        out.write(udSpec.getExtraTabActive());</span>
<span class="nc" id="L638">        out.write(&quot;&lt;/&quot; + ExtraTabActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L640">        out.write(&quot;\t\t\t&lt;&quot; + CornerIdle + &quot;&gt;&quot;);</span>
<span class="nc" id="L641">        out.write(udSpec.getCornerIdle());</span>
<span class="nc" id="L642">        out.write(&quot;&lt;/&quot; + CornerIdle + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L644">        out.write(&quot;\t\t\t&lt;&quot; + CornerActive + &quot;&gt;&quot;);</span>
<span class="nc" id="L645">        out.write(udSpec.getCornerActive());</span>
<span class="nc" id="L646">        out.write(&quot;&lt;/&quot; + CornerActive + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L648">        out.write(&quot;\t\t\t&lt;&quot; + BackgroundTile + &quot;&gt;&quot;);</span>
<span class="nc" id="L649">        out.write(udSpec.getBackgroundTile());</span>
<span class="nc" id="L650">        out.write(&quot;&lt;/&quot; + BackgroundTile + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L652">        out.write(&quot;\t\t\t&lt;&quot; + TopLine + &quot;&gt;&quot;);</span>
<span class="nc" id="L653">        out.write(udSpec.getTopLine());</span>
<span class="nc" id="L654">        out.write(&quot;&lt;/&quot; + TopLine + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L656">        out.write(&quot;\t\t\t&lt;&quot; + BottomLine + &quot;&gt;&quot;);</span>
<span class="nc" id="L657">        out.write(udSpec.getBottomLine());</span>
<span class="nc" id="L658">        out.write(&quot;&lt;/&quot; + BottomLine + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L660">        out.write(&quot;\t\t\t&lt;&quot; + LeftLine + &quot;&gt;&quot;);</span>
<span class="nc" id="L661">        out.write(udSpec.getLeftLine());</span>
<span class="nc" id="L662">        out.write(&quot;&lt;/&quot; + LeftLine + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L664">        out.write(&quot;\t\t\t&lt;&quot; + RightLine + &quot;&gt;&quot;);</span>
<span class="nc" id="L665">        out.write(udSpec.getRightLine());</span>
<span class="nc" id="L666">        out.write(&quot;&lt;/&quot; + RightLine + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L668">        out.write(&quot;\t\t\t&lt;&quot; + TopLeftCorner + &quot;&gt;&quot;);</span>
<span class="nc" id="L669">        out.write(udSpec.getTopLeftCorner());</span>
<span class="nc" id="L670">        out.write(&quot;&lt;/&quot; + TopLeftCorner + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L672">        out.write(&quot;\t\t\t&lt;&quot; + BottomLeftCorner + &quot;&gt;&quot;);</span>
<span class="nc" id="L673">        out.write(udSpec.getBottomLeftCorner());</span>
<span class="nc" id="L674">        out.write(&quot;&lt;/&quot; + BottomLeftCorner + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L676">        out.write(&quot;\t\t\t&lt;&quot; + TopRightCorner + &quot;&gt;&quot;);</span>
<span class="nc" id="L677">        out.write(udSpec.getTopRightCorner());</span>
<span class="nc" id="L678">        out.write(&quot;&lt;/&quot; + TopRightCorner + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L680">        out.write(&quot;\t\t\t&lt;&quot; + BottomRightCorner + &quot;&gt;&quot;);</span>
<span class="nc" id="L681">        out.write(udSpec.getBottomRightCorner());</span>
<span class="nc" id="L682">        out.write(&quot;&lt;/&quot; + BottomRightCorner + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L684">        out.write(&quot;\t\t\t&lt;&quot; + MechOutline + &quot;&gt;&quot;);</span>
<span class="nc" id="L685">        out.write(udSpec.getMechOutline());</span>
<span class="nc" id="L686">        out.write(&quot;&lt;/&quot; + MechOutline + &quot;&gt;\n&quot;);</span>

        // Close UI_ELEMENT tag
<span class="nc" id="L689">        out.write(&quot;\t&lt;/&quot; + UI_ELEMENT + &quot;&gt;\n\n&quot;);</span>
<span class="nc" id="L690">    }</span>

    /**
     * Convenience method for writing out the UI_ELEMENT tag.
     * @param component
     * @param out
     * @throws IOException
     */
    private static void writeSkinComponent(String component, Writer out)
            throws IOException {
<span class="nc" id="L700">        out.write(&quot;\t&lt;&quot; + UI_ELEMENT + &quot;&gt;\n&quot;);</span>

        // Write Component name
<span class="nc" id="L703">        out.write(&quot;\t\t&lt;&quot; + NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L704">        out.write(component);</span>
<span class="nc" id="L705">        out.write(&quot;&lt;/&quot; + NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L707">        SkinSpecification skinSpec = getSkin(component);</span>

        // Write Border
<span class="nc" id="L710">        out.write(&quot;\t\t&lt;&quot; + NO_BORDER + &quot;&gt;&quot;);</span>
<span class="nc" id="L711">        out.write(((Boolean)skinSpec.noBorder).toString());</span>
<span class="nc" id="L712">        out.write(&quot;&lt;/&quot; + NO_BORDER + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L713">        writeBorder(skinSpec, out);</span>

        // Write background
<span class="nc bnc" id="L716" title="All 2 branches missed.">        for (String bgImg : skinSpec.backgrounds) {</span>
<span class="nc" id="L717">            out.write(&quot;\t\t&lt;&quot; + BACKGROUND_IMAGE + &quot;&gt;&quot;);</span>
<span class="nc" id="L718">            out.write(bgImg);</span>
<span class="nc" id="L719">            out.write(&quot;&lt;/&quot; + BACKGROUND_IMAGE + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L720">        }</span>
<span class="nc" id="L721">        out.write(&quot;\t\t&lt;&quot; + TILE_BACKGROUND + &quot;&gt;&quot;);</span>
<span class="nc" id="L722">        out.write(((Boolean)skinSpec.tileBackground).toString());</span>
<span class="nc" id="L723">        out.write(&quot;&lt;/&quot; + TILE_BACKGROUND + &quot;&gt;\n&quot;);</span>

        // Write colors
<span class="nc bnc" id="L726" title="All 2 branches missed.">        for (Color fontColor : skinSpec.fontColors) {</span>
<span class="nc" id="L727">            out.write(&quot;\t\t&lt;&quot; + FONT_COLOR + &quot;&gt;&quot;);</span>
<span class="nc" id="L728">            out.write(&quot;#&quot;</span>
<span class="nc" id="L729">                    + Integer.toHexString(fontColor.getRGB()).substring(2));</span>
<span class="nc" id="L730">            out.write(&quot;&lt;/&quot; + FONT_COLOR + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L731">        }</span>

        // Write show scroll bars
<span class="nc" id="L734">        out.write(&quot;\t\t&lt;&quot; + SHOW_SCROLL_BARS + &quot;&gt;&quot;);</span>
<span class="nc" id="L735">        out.write(((Boolean)skinSpec.showScrollBars).toString());</span>
<span class="nc" id="L736">        out.write(&quot;&lt;/&quot; + SHOW_SCROLL_BARS + &quot;&gt;\n&quot;);</span>

        // Write should bold mouseover
<span class="nc" id="L739">        out.write(&quot;\t\t&lt;&quot; + SHOULD_BOLD + &quot;&gt;&quot;);</span>
<span class="nc" id="L740">        out.write(((Boolean)skinSpec.shouldBoldMouseOver).toString());</span>
<span class="nc" id="L741">        out.write(&quot;&lt;/&quot; + SHOULD_BOLD + &quot;&gt;\n&quot;);</span>

        // Write font name
<span class="nc bnc" id="L744" title="All 2 branches missed.">        if (skinSpec.fontName != null) {</span>
<span class="nc" id="L745">            out.write(&quot;\t\t&lt;&quot; + FONT_NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L746">            out.write(skinSpec.fontName);</span>
<span class="nc" id="L747">            out.write(&quot;&lt;/&quot; + FONT_NAME + &quot;&gt;\n&quot;);</span>
        }

        // Write font name
<span class="nc bnc" id="L751" title="All 2 branches missed.">        if (skinSpec.fontName != null) {</span>
<span class="nc" id="L752">            out.write(&quot;\t\t&lt;&quot; + FONT_SIZE + &quot;&gt;&quot;);</span>
<span class="nc" id="L753">            out.write(skinSpec.fontSize);</span>
<span class="nc" id="L754">            out.write(&quot;&lt;/&quot; + FONT_SIZE + &quot;&gt;\n&quot;);</span>
        }

        // Close UI_ELEMENT tag
<span class="nc" id="L758">        out.write(&quot;\t&lt;/&quot; + UI_ELEMENT + &quot;&gt;\n\n&quot;);</span>
<span class="nc" id="L759">    }</span>

    /**
     * Convenience method for writing out the BORDER element.
     *
     * @param skinSpec
     * @param out
     * @throws IOException
     */
    private static void writeBorder(SkinSpecification skinSpec, Writer out)
            throws IOException {
<span class="nc" id="L770">        out.write(&quot;\t\t&lt;!-- Specification of border images --&gt;\n&quot;);</span>
<span class="nc" id="L771">        out.write(&quot;\t\t&lt;&quot; + BORDER + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L773">        out.write(&quot;\t\t\t&lt;!-- Corner images --&gt;\n&quot;);</span>
        // Top Left Corner
<span class="nc" id="L775">        out.write(&quot;\t\t\t&lt;&quot; + TL_CORNER + &quot;&gt;&quot;);</span>
<span class="nc" id="L776">        out.write(skinSpec.tl_corner);</span>
<span class="nc" id="L777">        out.write(&quot;&lt;/&quot; + TL_CORNER + &quot;&gt;\n&quot;);</span>
        // Top Right Corner
<span class="nc" id="L779">        out.write(&quot;\t\t\t&lt;&quot; + TR_CORNER + &quot;&gt;&quot;);</span>
<span class="nc" id="L780">        out.write(skinSpec.tr_corner);</span>
<span class="nc" id="L781">        out.write(&quot;&lt;/&quot; + TR_CORNER + &quot;&gt;\n&quot;);</span>
        // Bottom Left Corner
<span class="nc" id="L783">        out.write(&quot;\t\t\t&lt;&quot; + BL_CORNER + &quot;&gt;&quot;);</span>
<span class="nc" id="L784">        out.write(skinSpec.bl_corner);</span>
<span class="nc" id="L785">        out.write(&quot;&lt;/&quot; + BL_CORNER + &quot;&gt;\n&quot;);</span>
        // Bottom Right Corner
<span class="nc" id="L787">        out.write(&quot;\t\t\t&lt;&quot; + BR_CORNER + &quot;&gt;&quot;);</span>
<span class="nc" id="L788">        out.write(skinSpec.br_corner);</span>
<span class="nc" id="L789">        out.write(&quot;&lt;/&quot; + BR_CORNER + &quot;&gt;\n&quot;);</span>

        // Edges
<span class="nc" id="L792">        out.write(&quot;\t\t\t&lt;!-- Border lines: these images will be tiled --&gt;\n&quot;);</span>
<span class="nc" id="L793">        out.write(&quot;\t\t\t&lt;&quot; + EDGE + &quot;&gt;\n&quot;);</span>
        // Top Edge
<span class="nc bnc" id="L795" title="All 2 branches missed.">        for (int i = 0; i &lt; skinSpec.topEdge.size(); i++) {</span>
<span class="nc" id="L796">            out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
            // Edge Icon
<span class="nc" id="L798">            out.write(&quot;\t\t\t\t\t&lt;&quot; + ICON + &quot;&gt;&quot;);</span>
<span class="nc" id="L799">            out.write(skinSpec.topEdge.get(i));</span>
<span class="nc" id="L800">            out.write(&quot;&lt;/&quot; + ICON + &quot;&gt;\n&quot;);</span>
            // Tile state of icon
<span class="nc" id="L802">            out.write(&quot;\t\t\t\t\t&lt;&quot; + TILED + &quot;&gt;&quot;);</span>
<span class="nc" id="L803">            out.write(((Boolean)skinSpec.topShouldTile.get(i)).toString());</span>
<span class="nc" id="L804">            out.write(&quot;&lt;/&quot; + TILED + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L805">            out.write(&quot;\t\t\t\t&lt;/&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
        }

<span class="nc" id="L808">        out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L809">        out.write(&quot;top&quot;);</span>
<span class="nc" id="L810">        out.write(&quot;&lt;/&quot; + EDGE_NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L812">        out.write(&quot;\t\t\t&lt;/&quot; + EDGE + &quot;&gt;\n&quot;);</span>

        // Bottom Edge
<span class="nc" id="L815">        out.write(&quot;\t\t\t&lt;&quot; + EDGE + &quot;&gt;\n&quot;);</span>
<span class="nc bnc" id="L816" title="All 2 branches missed.">        for (int i = 0; i &lt; skinSpec.bottomEdge.size(); i++) {</span>
<span class="nc" id="L817">            out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
            // Edge Icon
<span class="nc" id="L819">            out.write(&quot;\t\t\t\t\t&lt;&quot; + ICON + &quot;&gt;&quot;);</span>
<span class="nc" id="L820">            out.write(skinSpec.bottomEdge.get(i));</span>
<span class="nc" id="L821">            out.write(&quot;&lt;/&quot; + ICON + &quot;&gt;\n&quot;);</span>
            // Tile state of icon
<span class="nc" id="L823">            out.write(&quot;\t\t\t\t\t&lt;&quot; + TILED + &quot;&gt;&quot;);</span>
<span class="nc" id="L824">            out.write(((Boolean)skinSpec.bottomShouldTile.get(i)).toString());</span>
<span class="nc" id="L825">            out.write(&quot;&lt;/&quot; + TILED + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L826">            out.write(&quot;\t\t\t\t&lt;/&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
        }
<span class="nc" id="L828">        out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L829">        out.write(&quot;bottom&quot;);</span>
<span class="nc" id="L830">        out.write(&quot;&lt;/&quot; + EDGE_NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L832">        out.write(&quot;\t\t\t&lt;/&quot; + EDGE + &quot;&gt;\n&quot;);</span>

        // Left Edge
<span class="nc" id="L835">        out.write(&quot;\t\t\t&lt;&quot; + EDGE + &quot;&gt;\n&quot;);</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">        for (int i = 0; i &lt; skinSpec.leftEdge.size(); i++) {</span>
<span class="nc" id="L837">            out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
            // Edge Icon
<span class="nc" id="L839">            out.write(&quot;\t\t\t\t\t&lt;&quot; + ICON + &quot;&gt;&quot;);</span>
<span class="nc" id="L840">            out.write(skinSpec.leftEdge.get(i));</span>
<span class="nc" id="L841">            out.write(&quot;&lt;/&quot; + ICON + &quot;&gt;\n&quot;);</span>
            // Tile state of icon
<span class="nc" id="L843">            out.write(&quot;\t\t\t\t\t&lt;&quot; + TILED + &quot;&gt;&quot;);</span>
<span class="nc" id="L844">            out.write(((Boolean)skinSpec.leftShouldTile.get(i)).toString());</span>
<span class="nc" id="L845">            out.write(&quot;&lt;/&quot; + TILED + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L846">            out.write(&quot;\t\t\t\t&lt;/&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
        }
<span class="nc" id="L848">        out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L849">        out.write(&quot;left&quot;);</span>
<span class="nc" id="L850">        out.write(&quot;&lt;/&quot; + EDGE_NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L852">        out.write(&quot;\t\t\t&lt;/&quot; + EDGE + &quot;&gt;\n&quot;);</span>

        // Right Edge
<span class="nc" id="L855">        out.write(&quot;\t\t\t&lt;&quot; + EDGE + &quot;&gt;\n&quot;);</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">        for (int i = 0; i &lt; skinSpec.rightEdge.size(); i++) {</span>
<span class="nc" id="L857">            out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
            // Edge Icon
<span class="nc" id="L859">            out.write(&quot;\t\t\t\t\t&lt;&quot; + ICON + &quot;&gt;&quot;);</span>
<span class="nc" id="L860">            out.write(skinSpec.rightEdge.get(i));</span>
<span class="nc" id="L861">            out.write(&quot;&lt;/&quot; + ICON + &quot;&gt;\n&quot;);</span>
            // Tile state of icon
<span class="nc" id="L863">            out.write(&quot;\t\t\t\t\t&lt;&quot; + TILED + &quot;&gt;&quot;);</span>
<span class="nc" id="L864">            out.write(((Boolean)skinSpec.rightShouldTile.get(i)).toString());</span>
<span class="nc" id="L865">            out.write(&quot;&lt;/&quot; + TILED + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L866">            out.write(&quot;\t\t\t\t&lt;/&quot; + EDGE_ICON + &quot;&gt;\n&quot;);</span>
        }
<span class="nc" id="L868">        out.write(&quot;\t\t\t\t&lt;&quot; + EDGE_NAME + &quot;&gt;&quot;);</span>
<span class="nc" id="L869">        out.write(&quot;right&quot;);</span>
<span class="nc" id="L870">        out.write(&quot;&lt;/&quot; + EDGE_NAME + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L872">        out.write(&quot;\t\t\t&lt;/&quot; + EDGE + &quot;&gt;\n&quot;);</span>

<span class="nc" id="L874">        out.write(&quot;\t\t&lt;/&quot; + BORDER + &quot;&gt;\n&quot;);</span>
<span class="nc" id="L875">    }</span>

    public static SkinSpecification getSkin(String component){
<span class="nc" id="L878">        return getSkin(component,false, false);</span>
    }

    public static SkinSpecification getSkin(String component, boolean defaultToPlain){
<span class="nc" id="L882">        return getSkin(component, defaultToPlain, false);</span>
    }

    /**
     * Returns the list of components that have SkinSpecifications.
     * @return
     */
    public synchronized static Set&lt;String&gt; getSkinnedComponents() {
<span class="nc" id="L890">        return skinSpecs.keySet();</span>
    }

    /**
     * Get a &lt;code&gt;SkinSpecification&lt;/code&gt; for a given component.
     *
     * @param component
     *            The name of the component to get skin info for.
     * @param defaultToPlain
     *            Determines if a default component should be used if no match,
     *            or a plain component
     * @return
     */
    public synchronized static SkinSpecification getSkin(String component,
            boolean defaultToPlain, boolean isBtn){
<span class="nc bnc" id="L905" title="All 2 branches missed.">        if (skinSpecs == null ){</span>
<span class="nc" id="L906">            boolean rv = initSkinXMLHandler();</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">            if (!rv) {</span>
                // This will return a blank skin spec file, which will act like
                // a plain skin.
<span class="nc" id="L910">                return new SkinSpecification(&quot;Plain&quot;);</span>
            }
        }

<span class="nc" id="L914">        SkinSpecification spec = skinSpecs.get(component);</span>
<span class="nc bnc" id="L915" title="All 2 branches missed.">        if (spec == null){</span>
<span class="nc bnc" id="L916" title="All 2 branches missed.">            if (defaultToPlain) {</span>
<span class="nc" id="L917">                spec = new SkinSpecification(&quot;Plain&quot;); //$NON-NLS-1$</span>
<span class="nc bnc" id="L918" title="All 2 branches missed.">            } else if (isBtn){</span>
<span class="nc" id="L919">                spec = skinSpecs.get(UIComponents.DefaultButton.getComp());</span>
            } else {
<span class="nc" id="L921">                spec = skinSpecs.get(UIComponents.DefaultUIElement.getComp());</span>
            }
        }
<span class="nc" id="L924">        return spec;</span>
    }

    public synchronized static UnitDisplaySkinSpecification getUnitDisplaySkin() {
<span class="nc bnc" id="L928" title="All 2 branches missed.">        if (udSpec == null) {</span>
<span class="nc" id="L929">            boolean rv = initSkinXMLHandler();</span>
<span class="nc bnc" id="L930" title="All 4 branches missed.">            if (!rv || (udSpec == null)) {</span>
                // This will return a blank ud skin spec file, which will show
                // the default skin for the unit display
<span class="nc" id="L933">                return new UnitDisplaySkinSpecification();</span>
            }
        }
<span class="nc" id="L936">        return udSpec;</span>
    }

    /**
     * Adds a new component to the SkinSpecs map.
     *
     * @param component
     */
    public synchronized static void addNewComp(String component) {
<span class="nc bnc" id="L945" title="All 2 branches missed.">        if (skinSpecs == null ){</span>
<span class="nc" id="L946">            boolean rv = initSkinXMLHandler();</span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">            if (!rv) {</span>
<span class="nc" id="L948">                return ;</span>
            }
        }
<span class="nc" id="L951">        SkinSpecification newSpec = new SkinSpecification(component);</span>
<span class="nc" id="L952">        skinSpecs.put(component, newSpec);</span>
<span class="nc" id="L953">    }</span>

    /**
     * Remove the specified componenet from the SkinSpecs map.
     *
     * @param component
     */
    public synchronized static void removeComp(String component) {
<span class="nc" id="L961">        skinSpecs.remove(component);</span>
<span class="nc" id="L962">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>