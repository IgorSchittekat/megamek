<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SkinSpecPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing.skinEditor</a> &gt; <span class="el_source">SkinSpecPanel.java</span></div><h1>SkinSpecPanel.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2000,2001,2002,2003,2004,2006 Ben Mazur (bmazur@sev.org)
 * Copyright Â© 2015 Nicholas Walczak (walczak@cs.umn.edu)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

package megamek.client.ui.swing.skinEditor;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JColorChooser;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.border.TitledBorder;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

import megamek.client.ui.Messages;
import megamek.client.ui.swing.widget.SkinSpecification;
import megamek.common.Configuration;

/**
 * Panel with elements for viewing and adjusting a specific SkinSpecification.
 * 
 * @author arlith
 */
public class SkinSpecPanel extends JPanel implements ListSelectionListener,
        ActionListener {

<span class="nc" id="L55">    JFileChooser fileChooser = new JFileChooser(Configuration.widgetsDir());</span>

    /**
     * A UI widget for displaying information related to a border widget (image
     * path and whether the image is tiled or not). Also supports a flag to
     * determine if the image should be allowed to tile (ie, corners should
     * never be tiled)
     * 
     * @author arlith
     *
     */
<span class="nc bnc" id="L66" title="All 2 branches missed.">    private class BorderElement extends JPanel implements ActionListener,</span>
            DocumentListener {

        /**
         * 
         */
        private static final long serialVersionUID = -2004313765932049794L;

        /**
         * Specifies the width of text fields
         */
        private static final int TEXTFIELD_COLS = 20;

<span class="nc" id="L79">        List&lt;JButton&gt; pathLbl = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L81">        List&lt;JTextField&gt; path = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L83">        List&lt;JCheckBox&gt; tiled = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L85">        List&lt;JButton&gt; removeButtons = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L87">        JButton addButton = new JButton(Messages.getString(&quot;SkinEditor.Add&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L89">        boolean displayTiled = false;</span>

        SkinSpecPanel skinPanel;

        /**
         * Constructor for BorderElements that only have one image (like
         * corners). The option to tile the image is not present, nor are the
         * add and remove buttons.
         *
         * @param elementName
         * @param imgPath
         */
        BorderElement(SkinSpecPanel skinPanel, String elementName,
<span class="nc" id="L102">                String imgPath) {</span>
<span class="nc" id="L103">            super(new GridBagLayout());</span>
<span class="nc" id="L104">            this.skinPanel = skinPanel;</span>
<span class="nc" id="L105">            setBorder(BorderFactory.createTitledBorder(</span>
<span class="nc" id="L106">                    BorderFactory.createEmptyBorder(), elementName,</span>
                    TitledBorder.LEFT, TitledBorder.TOP));

<span class="nc" id="L109">            displayTiled = false;</span>

<span class="nc" id="L111">            JButton newPathLbl = new JButton(</span>
<span class="nc" id="L112">                    Messages.getString(&quot;SkinEditor.Path&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L113">            newPathLbl.setMargin(new Insets(1, 1, 1, 1));</span>
<span class="nc" id="L114">            newPathLbl.setToolTipText(Messages.getString(</span>
                    &quot;SkinEditor.PathToolTip&quot;, //$NON-NLS-1$
<span class="nc" id="L116">                    new Object[] { Configuration.widgetsDir().getPath() }));</span>
<span class="nc" id="L117">            newPathLbl.addActionListener(this);</span>
<span class="nc" id="L118">            pathLbl.add(newPathLbl);</span>
<span class="nc" id="L119">            JTextField newPath = new JTextField(imgPath, TEXTFIELD_COLS);</span>
<span class="nc" id="L120">            newPath.getDocument().addDocumentListener(this);</span>
<span class="nc" id="L121">            path.add(newPath);</span>
<span class="nc" id="L122">            JCheckBox newTiled = new JCheckBox(</span>
<span class="nc" id="L123">                    Messages.getString(&quot;SkinEditor.Tiled&quot;), //$NON-NLS-1$</span>
                    false);
<span class="nc" id="L125">            newTiled.addActionListener(this);</span>
<span class="nc" id="L126">            tiled.add(newTiled);</span>
<span class="nc" id="L127">            removeButtons.add(new JButton());</span>

<span class="nc" id="L129">            layoutPanel();</span>
<span class="nc" id="L130">        }</span>

        /**
         * Constructor for BorderElements that can have multiple images, like
         * edges. An add button is used to allow more images to be added and
         * each image path added has the option to be tiled or not. There is
         * also a remove button added for each entry to allow them to be
         * removed. Remove buttons are enabled if there are more than one image,
         * otherwise if only one image is specified then the remove button is
         * disabled.
         *
         * @param elementName
         * @param imgPath
         * @param isTiled
         */
        BorderElement(SkinSpecPanel skinPanel, String elementName,
                List&lt;String&gt; imgPath, List&lt;Boolean&gt; isTiled) {
<span class="nc bnc" id="L147" title="All 2 branches missed.">            this(skinPanel, elementName, imgPath, isTiled, imgPath.size() &gt; 1);</span>
<span class="nc" id="L148">        }</span>

        /**
         * Constructor for BorderElements that can have multiple images, like
         * edges. An add button is used to allow more images to be added and
         * each image path added has the option to be tiled or not. There is
         * also a remove button added for each entry to allow them to be
         * removed.
         *
         * @param elementName
         * @param imgPath
         * @param isTiled
         * @param removeEnabled
         *            Determines if remove buttons are enabled
         */
        BorderElement(SkinSpecPanel skinPanel, String elementName,
                List&lt;String&gt; imgPath, List&lt;Boolean&gt; isTiled,
<span class="nc" id="L165">                boolean removeEnabled) {</span>
<span class="nc" id="L166">            super(new GridBagLayout());</span>
<span class="nc" id="L167">            this.skinPanel = skinPanel;</span>
<span class="nc" id="L168">            setBorder(BorderFactory.createTitledBorder(</span>
<span class="nc" id="L169">                    BorderFactory.createEmptyBorder(), elementName,</span>
                    TitledBorder.LEFT, TitledBorder.TOP));

<span class="nc" id="L172">            displayTiled = true;</span>
<span class="nc bnc" id="L173" title="All 4 branches missed.">            assert (imgPath.size() == isTiled.size());</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">            for (int i = 0; i &lt; imgPath.size(); i++) {</span>
<span class="nc" id="L175">                addPathRow(imgPath.get(i), isTiled.get(i), removeEnabled);</span>
            }
<span class="nc" id="L177">            addButton.setToolTipText(Messages</span>
<span class="nc" id="L178">                    .getString(&quot;SkinEditor.AddButtonToolTip&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L179">            addButton.setMargin(new Insets(1, 1, 1, 1));</span>
<span class="nc" id="L180">            addButton.setMaximumSize(new Dimension(40, 14));</span>
<span class="nc" id="L181">            addButton.setPreferredSize(new Dimension(40, 14));</span>
<span class="nc" id="L182">            addButton.addActionListener(this);</span>
<span class="nc" id="L183">            layoutPanel();</span>
<span class="nc" id="L184">        }</span>

        /**
         * Used for BorderElements that have multiple entries, this method adds
         * a row of PathButton, Path text field, tiled checkbox and remove
         * button
         */
        protected void addPathRow(String imgPath, boolean isTiled,
                boolean removeEnabled) {
<span class="nc" id="L193">            JButton newPathLbl = new JButton(</span>
<span class="nc" id="L194">                    Messages.getString(&quot;SkinEditor.Path&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L195">            newPathLbl.setMargin(new Insets(1, 1, 1, 1));</span>
<span class="nc" id="L196">            newPathLbl.setToolTipText(Messages.getString(</span>
                    &quot;SkinEditor.PathToolTip&quot;, //$NON-NLS-1$
<span class="nc" id="L198">                    new Object[] { Configuration.widgetsDir().getPath() }));</span>
<span class="nc" id="L199">            newPathLbl.addActionListener(this);</span>
<span class="nc" id="L200">            pathLbl.add(newPathLbl); //$NON-NLS-1$</span>
<span class="nc" id="L201">            JTextField newPath = new JTextField(imgPath, TEXTFIELD_COLS);</span>
<span class="nc" id="L202">            newPath.getDocument().addDocumentListener(this);</span>
<span class="nc" id="L203">            path.add(newPath);</span>
<span class="nc" id="L204">            JCheckBox newTiled = new JCheckBox(</span>
<span class="nc" id="L205">                    Messages.getString(&quot;SkinEditor.Tiled&quot;), //$NON-NLS-1$</span>
                    isTiled);
<span class="nc" id="L207">            newTiled.setToolTipText(Messages</span>
<span class="nc" id="L208">                    .getString(&quot;SkinEditor.TiledToolTip&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L209">            newTiled.addActionListener(this);</span>
<span class="nc" id="L210">            tiled.add(newTiled);</span>
<span class="nc" id="L211">            JButton newRemoveButton = new JButton(</span>
<span class="nc" id="L212">                    Messages.getString(&quot;SkinEditor.RemoveButton&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L213">            newRemoveButton.setToolTipText(Messages</span>
<span class="nc" id="L214">                    .getString(&quot;SkinEditor.RemoveButtonToolTip&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L215">            newRemoveButton.setMargin(new Insets(0, 0, 1, 0));</span>
<span class="nc" id="L216">            newRemoveButton.setPreferredSize(new Dimension(14, 14));</span>
<span class="nc" id="L217">            newRemoveButton.setMaximumSize(new Dimension(14, 14));</span>
<span class="nc" id="L218">            newRemoveButton.setEnabled(removeEnabled);</span>
<span class="nc" id="L219">            newRemoveButton.addActionListener(this);</span>
<span class="nc" id="L220">            removeButtons.add(newRemoveButton);</span>
<span class="nc" id="L221">        }</span>

        void layoutPanel() {
<span class="nc" id="L224">            removeAll();</span>
<span class="nc" id="L225">            GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L226">            gbc.insets = new Insets(1, 1, 1, 1);</span>
<span class="nc" id="L227">            gbc.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L228">            gbc.gridx = gbc.gridy = 0;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (displayTiled) {</span>
<span class="nc" id="L230">                add(addButton, gbc);</span>
<span class="nc" id="L231">                gbc.gridy++;</span>
            }
<span class="nc bnc" id="L233" title="All 2 branches missed.">            for (int i = 0; i &lt; path.size(); i++) {</span>
<span class="nc" id="L234">                gbc.gridx = 0;</span>
<span class="nc" id="L235">                gbc.gridwidth = 1;</span>
<span class="nc" id="L236">                gbc.weightx = 0;</span>
<span class="nc" id="L237">                gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L238">                add(pathLbl.get(i), gbc);</span>

<span class="nc" id="L240">                gbc.gridx++;</span>
<span class="nc" id="L241">                gbc.weightx = 1;</span>
<span class="nc" id="L242">                gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                if (!displayTiled) {</span>
<span class="nc" id="L244">                    gbc.gridwidth = 2;</span>
                }
<span class="nc" id="L246">                add(path.get(i), gbc);</span>

<span class="nc bnc" id="L248" title="All 2 branches missed.">                if (displayTiled) {</span>
<span class="nc" id="L249">                    gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L250">                    gbc.gridwidth = 1;</span>
<span class="nc" id="L251">                    gbc.weightx = 0;</span>
<span class="nc" id="L252">                    gbc.gridx++;</span>
<span class="nc" id="L253">                    add(tiled.get(i), gbc);</span>
<span class="nc" id="L254">                    gbc.gridx++;</span>
<span class="nc" id="L255">                    add(removeButtons.get(i), gbc);</span>
                }
<span class="nc" id="L257">                gbc.gridy++;</span>
            }
<span class="nc" id="L259">        }</span>

        @Override
        public void setEnabled(boolean en) {
<span class="nc" id="L263">            super.setEnabled(en);</span>
<span class="nc" id="L264">            addButton.setEnabled(en);</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">            for (int i = 0; i &lt; path.size(); i++) {</span>
<span class="nc" id="L266">                pathLbl.get(i).setEnabled(en);</span>
<span class="nc" id="L267">                path.get(i).setEnabled(en);</span>
<span class="nc" id="L268">                tiled.get(i).setEnabled(en);</span>
<span class="nc bnc" id="L269" title="All 4 branches missed.">                removeButtons.get(i).setEnabled((path.size() &gt; 1) &amp;&amp; en);</span>
            }
<span class="nc" id="L271">        }</span>

        @Override
        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L275" title="All 2 branches missed.">            if (e.getSource().equals(addButton)) {</span>
<span class="nc" id="L276">                addPathRow(&quot;&quot;, false, true);</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">                for (JButton removeButton : removeButtons) {</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">                    removeButton.setEnabled(path.size() &gt; 1);</span>
<span class="nc" id="L279">                }</span>
<span class="nc" id="L280">                layoutPanel();</span>
<span class="nc" id="L281">                skinPanel.notifySkinChanges(true);</span>
<span class="nc" id="L282">                skinPanel.signalValidate();</span>
            } else {
                // Did we press a remove button?
<span class="nc bnc" id="L285" title="All 2 branches missed.">                for (int i = 0; i &lt; removeButtons.size(); i++) {</span>
                    // Find the button pressed, and remove the entry
<span class="nc bnc" id="L287" title="All 2 branches missed.">                    if (e.getSource().equals(removeButtons.get(i))) {</span>
                        // Remove Listeners
<span class="nc" id="L289">                        pathLbl.get(i).removeActionListener(this);</span>
<span class="nc" id="L290">                        path.get(i).getDocument().removeDocumentListener(this);</span>
<span class="nc" id="L291">                        tiled.get(i).removeActionListener(this);</span>
<span class="nc" id="L292">                        removeButtons.get(i).removeActionListener(this);</span>

                        // Remove UI elements
<span class="nc" id="L295">                        pathLbl.remove(i);</span>
<span class="nc" id="L296">                        path.remove(i);</span>
<span class="nc" id="L297">                        tiled.remove(i);</span>
<span class="nc" id="L298">                        removeButtons.remove(i);</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">                        for (JButton removeButton : removeButtons) {</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                            removeButton.setEnabled(path.size() &gt; 1);</span>
<span class="nc" id="L301">                        }</span>
<span class="nc" id="L302">                        layoutPanel();</span>
<span class="nc" id="L303">                        skinPanel.notifySkinChanges(true);</span>
<span class="nc" id="L304">                        skinPanel.signalValidate();</span>
                        // We're done
<span class="nc" id="L306">                        return;</span>
                    }
                }
                // Did we press a pathLbl button?
<span class="nc bnc" id="L310" title="All 2 branches missed.">                for (int i = 0; i &lt; pathLbl.size(); i++) {</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                    if (e.getSource().equals(pathLbl.get(i))) {</span>
<span class="nc" id="L312">                        chooseFile(i);</span>
<span class="nc" id="L313">                        skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L314">                        skinPanel.signalValidate();</span>
<span class="nc" id="L315">                        return;</span>
                    }
                }
                // Did we press a tile button?
<span class="nc bnc" id="L319" title="All 2 branches missed.">                for (int i = 0; i &lt; tiled.size(); i++) {</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">                    if (e.getSource().equals(tiled.get(i))) {</span>
<span class="nc" id="L321">                        skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L322">                        return;</span>
                    }
                }
            }
<span class="nc" id="L326">        }</span>

        /**
         * Handles the pressing of a pathLbl button: display the file chooser
         * and update the path if a file is selected
         *
         * @param pathIdx
         */
        private void chooseFile(int pathIdx) {
<span class="nc" id="L335">            int returnVal = fileChooser.showOpenDialog(this);</span>
            // Did the user choose valid input?
<span class="nc bnc" id="L337" title="All 2 branches missed.">            if ((returnVal != JFileChooser.APPROVE_OPTION)</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">                    || (fileChooser.getSelectedFile() == null)) {</span>
<span class="nc" id="L339">                return;</span>
            }
            // Get relative path
<span class="nc" id="L342">            String relativePath = Configuration.widgetsDir().toURI()</span>
<span class="nc" id="L343">                    .relativize(fileChooser.getSelectedFile().toURI())</span>
<span class="nc" id="L344">                    .getPath();</span>
            // Set text
<span class="nc" id="L346">            path.get(pathIdx).getDocument().removeDocumentListener(this);</span>
<span class="nc" id="L347">            path.get(pathIdx).setText(relativePath);</span>
<span class="nc" id="L348">            path.get(pathIdx).getDocument().addDocumentListener(this);</span>
<span class="nc" id="L349">        }</span>

        @Override
        public void changedUpdate(DocumentEvent arg0) {
<span class="nc" id="L353">            skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L354">        }</span>

        @Override
        public void insertUpdate(DocumentEvent arg0) {
<span class="nc" id="L358">            skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L359">        }</span>

        @Override
        public void removeUpdate(DocumentEvent arg0) {
<span class="nc" id="L363">            skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L364">        }</span>
    }

    /**
     * Essentially the same thing as the BorderElement, but used for backgrounds
     * where each background image shares the same shouldTile state.
     * 
     * @author arlith
     *
     */
    private class BackgroundElement extends BorderElement {

        /**
         * 
         */
        private static final long serialVersionUID = 3448867645483831732L;

        BackgroundElement(SkinSpecPanel skinPanel, List&lt;String&gt; imgPath,
<span class="nc" id="L382">                List&lt;Boolean&gt; isTiled) {</span>
<span class="nc" id="L383">            super(skinPanel, Messages.getString(&quot;SkinEditor.Background&quot;), //$NON-NLS-1$</span>
                    imgPath, isTiled, true);
<span class="nc" id="L385">        }</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc" id="L388">            boolean tiledChecked = false;</span>
<span class="nc" id="L389">            boolean newValue = false;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">            if (e.getSource().equals(addButton)) {</span>
<span class="nc" id="L391">                addPathRow(&quot;&quot;, false, true);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">                for (JButton removeButton : removeButtons) {</span>
<span class="nc" id="L393">                    removeButton.setEnabled(true);</span>
<span class="nc" id="L394">                }</span>
<span class="nc" id="L395">                layoutPanel();</span>
<span class="nc" id="L396">                skinPanel.notifySkinChanges(true);</span>
<span class="nc" id="L397">                skinPanel.signalValidate();</span>
<span class="nc" id="L398">                return;</span>
            }
<span class="nc bnc" id="L400" title="All 2 branches missed.">            for (JCheckBox tileChk : tiled) {</span>
<span class="nc bnc" id="L401" title="All 2 branches missed.">                if (e.getSource().equals(tileChk)) {</span>
<span class="nc" id="L402">                    tiledChecked = true;</span>
<span class="nc" id="L403">                    newValue = tileChk.isSelected();</span>
                }
<span class="nc" id="L405">            }</span>
<span class="nc bnc" id="L406" title="All 2 branches missed.">            if (tiledChecked) {</span>
<span class="nc bnc" id="L407" title="All 2 branches missed.">                for (JCheckBox tileChk : tiled) {</span>
<span class="nc" id="L408">                    tileChk.setSelected(newValue);</span>
<span class="nc" id="L409">                }</span>
<span class="nc" id="L410">                skinPanel.notifySkinChanges(false);</span>
<span class="nc" id="L411">                return;</span>
            }
<span class="nc" id="L413">            super.actionPerformed(e);</span>
<span class="nc" id="L414">        }</span>

    }

    /**
     * 
     */
    private static final long serialVersionUID = -37452332974426228L;

    BorderElement tlCorner, trCorner, blCorner, brCorner;

    BorderElement topEdge, bottomEdge, leftEdge, rightEdge;

    BackgroundElement background;

<span class="nc" id="L429">    JCheckBox showScrollBars = new JCheckBox(</span>
<span class="nc" id="L430">            Messages.getString(&quot;SkinEditor.ShowScrollBars&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L432">    ArrayList&lt;JButton&gt; colorButtons = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L434">    JButton addColor = new JButton(</span>
<span class="nc" id="L435">            Messages.getString(&quot;SkinEditor.AddColor.Text&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L437">    JButton removeColor = new JButton(</span>
<span class="nc" id="L438">            Messages.getString(&quot;SkinEditor.RemoveColor.Text&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L440">    JLabel colorLbl = new JLabel(Messages.getString(&quot;SkinEditor.Color&quot;)); //$NON-NLS-1$</span>

    SkinSpecEditor skinEditor;

    /**
     * 
     */
    public SkinSpecPanel(SkinSpecEditor skinEditor) {
<span class="nc" id="L448">        super(new GridBagLayout());</span>
<span class="nc" id="L449">        this.skinEditor = skinEditor;</span>
<span class="nc" id="L450">        addColor.setToolTipText(Messages</span>
<span class="nc" id="L451">                .getString(&quot;SkinEditor.AddColor.ToolTip&quot;));</span>
<span class="nc" id="L452">        removeColor.setToolTipText(Messages</span>
<span class="nc" id="L453">                .getString(&quot;SkinEditor.RemoveColor.ToolTip&quot;));</span>
<span class="nc" id="L454">    }</span>

    /**
     * Add this SkinSpecEditor as a listener to all components.
     */
    private void addListeners() {
<span class="nc bnc" id="L460" title="All 2 branches missed.">        for (JButton colorButton : colorButtons) {</span>
<span class="nc" id="L461">            colorButton.addActionListener(this);</span>
<span class="nc" id="L462">        }</span>
<span class="nc" id="L463">        addColor.addActionListener(this);</span>
<span class="nc" id="L464">        removeColor.addActionListener(this);</span>
<span class="nc" id="L465">    }</span>

    /**
     * Remove thsi SkinSpecEditor as a listener from all components.
     */
    private void removeListeners() {
<span class="nc bnc" id="L471" title="All 2 branches missed.">        for (JButton colorButton : colorButtons) {</span>
<span class="nc" id="L472">            colorButton.removeActionListener(this);</span>
<span class="nc" id="L473">        }</span>
<span class="nc" id="L474">        addColor.removeActionListener(this);</span>
<span class="nc" id="L475">        removeColor.removeActionListener(this);</span>
<span class="nc" id="L476">    }</span>

    private void resetColorButtons(SkinSpecification skinSpec) {
        // Listeners must already be removed before calling this!
<span class="nc" id="L480">        colorButtons.clear();</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">        for (Color c : skinSpec.fontColors) {</span>
<span class="nc" id="L482">            JButton colorButton = new JButton();</span>
<span class="nc" id="L483">            colorButton.setMaximumSize(new Dimension(14, 14));</span>
<span class="nc" id="L484">            colorButton.setPreferredSize(new Dimension(14, 14));</span>
<span class="nc" id="L485">            colorButton.setForeground(c);</span>
<span class="nc" id="L486">            colorButton.setBackground(c);</span>
<span class="nc" id="L487">            colorButtons.add(colorButton);</span>
<span class="nc" id="L488">        }</span>
        // Don't add listeners, to prevent double add
<span class="nc" id="L490">    }</span>

    /**
     * Update the given SkinSpecification based on the state of the UI elements.
     *
     * @param skinSpec
     * @return
     */
    public void updateSkinSpec(SkinSpecification skinSpec, boolean enableBorders) {

<span class="nc bnc" id="L500" title="All 2 branches missed.">        skinSpec.noBorder = !enableBorders;</span>
<span class="nc" id="L501">        skinSpec.tl_corner = tlCorner.path.get(0).getText();</span>
<span class="nc" id="L502">        skinSpec.tr_corner = trCorner.path.get(0).getText();</span>
<span class="nc" id="L503">        skinSpec.bl_corner = blCorner.path.get(0).getText();</span>
<span class="nc" id="L504">        skinSpec.br_corner = brCorner.path.get(0).getText();</span>

        // Top Edge
<span class="nc" id="L507">        skinSpec.topEdge.clear();</span>
<span class="nc" id="L508">        skinSpec.topShouldTile.clear();</span>
<span class="nc bnc" id="L509" title="All 2 branches missed.">        for (int i = 0; i &lt; topEdge.path.size(); i++) {</span>
<span class="nc" id="L510">            skinSpec.topEdge.add(topEdge.path.get(i).getText());</span>
<span class="nc" id="L511">            skinSpec.topShouldTile.add(topEdge.tiled.get(i).isSelected());</span>
        }
        // Bottom Edge
<span class="nc" id="L514">        skinSpec.bottomEdge.clear();</span>
<span class="nc" id="L515">        skinSpec.bottomShouldTile.clear();</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">        for (int i = 0; i &lt; bottomEdge.path.size(); i++) {</span>
<span class="nc" id="L517">            skinSpec.bottomEdge.add(bottomEdge.path.get(i).getText());</span>
<span class="nc" id="L518">            skinSpec.bottomShouldTile.add(bottomEdge.tiled.get(i).isSelected());</span>
        }
        // Left Edge
<span class="nc" id="L521">        skinSpec.leftEdge.clear();</span>
<span class="nc" id="L522">        skinSpec.leftShouldTile.clear();</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">        for (int i = 0; i &lt; leftEdge.path.size(); i++) {</span>
<span class="nc" id="L524">            skinSpec.leftEdge.add(leftEdge.path.get(i).getText());</span>
<span class="nc" id="L525">            skinSpec.leftShouldTile.add(leftEdge.tiled.get(i).isSelected());</span>
        }
        // Right Edge
<span class="nc" id="L528">        skinSpec.rightEdge.clear();</span>
<span class="nc" id="L529">        skinSpec.rightShouldTile.clear();</span>
<span class="nc bnc" id="L530" title="All 2 branches missed.">        for (int i = 0; i &lt; rightEdge.path.size(); i++) {</span>
<span class="nc" id="L531">            skinSpec.rightEdge.add(rightEdge.path.get(i).getText());</span>
<span class="nc" id="L532">            skinSpec.rightShouldTile.add(rightEdge.tiled.get(i).isSelected());</span>
        }

        // Background
<span class="nc" id="L536">        skinSpec.backgrounds.clear();</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">        for (int i = 0; i &lt; background.path.size(); i++) {</span>
<span class="nc" id="L538">            skinSpec.backgrounds.add(background.path.get(i).getText());</span>
        }
<span class="nc" id="L540">        skinSpec.tileBackground = false;</span>
<span class="nc bnc" id="L541" title="All 2 branches missed.">        if (background.tiled.size() &gt; 0) {</span>
<span class="nc" id="L542">            skinSpec.tileBackground = background.tiled.get(0).isSelected();</span>
        }

        // Font Color
<span class="nc" id="L546">        skinSpec.fontColors.clear();</span>
<span class="nc bnc" id="L547" title="All 2 branches missed.">        for (JButton colorButton : colorButtons) {</span>
<span class="nc" id="L548">            skinSpec.fontColors.add(colorButton.getBackground());</span>
<span class="nc" id="L549">        }</span>

        // Show Scroll Bars
<span class="nc" id="L552">        skinSpec.showScrollBars = showScrollBars.isSelected();</span>

<span class="nc" id="L554">    }</span>

    /**
     * Update the editing panel with the currently selected SkinSpecification.
     */
    public void setupSkinEditPanel(SkinSpecification skinSpec) {
<span class="nc" id="L560">        removeListeners();</span>
<span class="nc" id="L561">        removeAll();</span>

<span class="nc bnc" id="L563" title="All 2 branches missed.">        boolean enableBorders = !skinSpec.noBorder;</span>

<span class="nc" id="L565">        GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L567">        gbc.gridx = gbc.gridy = 0;</span>
<span class="nc" id="L568">        gbc.weightx = 1.0;</span>
<span class="nc" id="L569">        gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L570">        gbc.insets = new Insets(0, 0, 4, 0);</span>

<span class="nc" id="L572">        JPanel borderPanel = new JPanel(new GridBagLayout());</span>
        // borderPanel.setLayout(new BoxLayout(borderPanel, BoxLayout.Y_AXIS));
<span class="nc" id="L574">        borderPanel.setBorder(BorderFactory.createTitledBorder(</span>
<span class="nc" id="L575">                BorderFactory.createLineBorder(Color.BLACK),</span>
<span class="nc" id="L576">                Messages.getString(&quot;SkinEditor.Borders&quot;), TitledBorder.TOP, //$NON-NLS-1$</span>
                TitledBorder.DEFAULT_POSITION));
<span class="nc" id="L578">        borderPanel.setEnabled(enableBorders);</span>

        // Top Left Corner
<span class="nc" id="L581">        tlCorner = new BorderElement(this,</span>
<span class="nc" id="L582">                Messages.getString(&quot;SkinEditor.TLC&quot;), //$NON-NLS-1$</span>
                skinSpec.tl_corner);
<span class="nc" id="L584">        tlCorner.setEnabled(enableBorders);</span>
<span class="nc" id="L585">        borderPanel.add(tlCorner, gbc);</span>
<span class="nc" id="L586">        gbc.gridx++;</span>
        // Top Right Corner
<span class="nc" id="L588">        trCorner = new BorderElement(this,</span>
<span class="nc" id="L589">                Messages.getString(&quot;SkinEditor.TRC&quot;), //$NON-NLS-1$</span>
                skinSpec.tr_corner);
<span class="nc" id="L591">        trCorner.setEnabled(enableBorders);</span>
<span class="nc" id="L592">        borderPanel.add(trCorner, gbc);</span>
<span class="nc" id="L593">        gbc.gridx = 0;</span>
<span class="nc" id="L594">        gbc.gridy++;</span>
        // Bottom Left Corner
<span class="nc" id="L596">        blCorner = new BorderElement(this,</span>
<span class="nc" id="L597">                Messages.getString(&quot;SkinEditor.BLC&quot;), //$NON-NLS-1$</span>
                skinSpec.bl_corner);
<span class="nc" id="L599">        blCorner.setEnabled(enableBorders);</span>
<span class="nc" id="L600">        borderPanel.add(blCorner, gbc);</span>
<span class="nc" id="L601">        gbc.gridx++;</span>
        // Bottom Right Corner
<span class="nc" id="L603">        brCorner = new BorderElement(this,</span>
<span class="nc" id="L604">                Messages.getString(&quot;SkinEditor.BRC&quot;), //$NON-NLS-1$</span>
                skinSpec.br_corner);
<span class="nc" id="L606">        brCorner.setEnabled(enableBorders);</span>
<span class="nc" id="L607">        borderPanel.add(brCorner, gbc);</span>
<span class="nc" id="L608">        gbc.gridy++;</span>
<span class="nc" id="L609">        gbc.gridx = 0;</span>

        // Top Edge
<span class="nc" id="L612">        topEdge = new BorderElement(this,</span>
<span class="nc" id="L613">                Messages.getString(&quot;SkinEditor.TopEdge&quot;), //$NON-NLS-1$</span>
                skinSpec.topEdge, skinSpec.topShouldTile);
<span class="nc" id="L615">        topEdge.setEnabled(enableBorders);</span>
<span class="nc" id="L616">        borderPanel.add(topEdge, gbc);</span>
<span class="nc" id="L617">        gbc.gridx++;</span>

        // Bottom Edge
<span class="nc" id="L620">        bottomEdge = new BorderElement(this,</span>
<span class="nc" id="L621">                Messages.getString(&quot;SkinEditor.BottomEdge&quot;), //$NON-NLS-1$</span>
                skinSpec.bottomEdge, skinSpec.bottomShouldTile);
<span class="nc" id="L623">        bottomEdge.setEnabled(enableBorders);</span>
<span class="nc" id="L624">        borderPanel.add(bottomEdge, gbc);</span>
<span class="nc" id="L625">        gbc.gridx = 0;</span>
<span class="nc" id="L626">        gbc.gridy++;</span>

        // Left Edge
<span class="nc" id="L629">        leftEdge = new BorderElement(this,</span>
<span class="nc" id="L630">                Messages.getString(&quot;SkinEditor.LeftEdge&quot;), //$NON-NLS-1$</span>
                skinSpec.leftEdge, skinSpec.leftShouldTile);
<span class="nc" id="L632">        leftEdge.setEnabled(enableBorders);</span>
<span class="nc" id="L633">        borderPanel.add(leftEdge, gbc);</span>
<span class="nc" id="L634">        gbc.gridx++;</span>

        // Right Edge
<span class="nc" id="L637">        rightEdge = new BorderElement(this,</span>
<span class="nc" id="L638">                Messages.getString(&quot;SkinEditor.RightEdge&quot;), //$NON-NLS-1$</span>
                skinSpec.rightEdge, skinSpec.rightShouldTile);
<span class="nc" id="L640">        rightEdge.setEnabled(enableBorders);</span>
<span class="nc" id="L641">        borderPanel.add(rightEdge, gbc);</span>
<span class="nc" id="L642">        gbc.gridy++;</span>
<span class="nc" id="L643">        gbc.gridx = 0;</span>

<span class="nc" id="L645">        gbc.gridx = gbc.gridy = 0;</span>
<span class="nc" id="L646">        add(borderPanel, gbc);</span>

<span class="nc" id="L648">        background = new BackgroundElement(this, skinSpec.backgrounds,</span>
<span class="nc" id="L649">                Collections.nCopies(skinSpec.backgrounds.size(),</span>
<span class="nc" id="L650">                        skinSpec.tileBackground));</span>

<span class="nc" id="L652">        gbc.gridy++;</span>

<span class="nc" id="L654">        add(background, gbc);</span>

<span class="nc" id="L656">        JPanel misc = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L657">        gbc.gridy++;</span>
<span class="nc" id="L658">        add(misc, gbc);</span>

<span class="nc" id="L660">        gbc.gridx = gbc.gridy = 0;</span>
<span class="nc" id="L661">        gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L662">        misc.add(showScrollBars);</span>

<span class="nc" id="L664">        resetColorButtons(skinSpec);</span>
<span class="nc" id="L665">        JPanel glue = new JPanel();</span>
<span class="nc" id="L666">        glue.add(colorLbl);</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">        for (JButton colorButton : colorButtons) {</span>
<span class="nc" id="L668">            glue.add(colorButton);</span>
<span class="nc" id="L669">        }</span>
<span class="nc" id="L670">        glue.add(addColor);</span>
<span class="nc" id="L671">        glue.add(removeColor);</span>
<span class="nc" id="L672">        gbc.gridy++;</span>
<span class="nc" id="L673">        misc.add(glue, gbc);</span>

<span class="nc" id="L675">        revalidate();</span>
<span class="nc" id="L676">        addListeners();</span>
<span class="nc" id="L677">    }</span>

    @Override
    public void valueChanged(ListSelectionEvent e) {
<span class="nc bnc" id="L681" title="All 2 branches missed.">        if (e.getValueIsAdjusting()) {</span>
<span class="nc" id="L682">            return;</span>
        }

<span class="nc" id="L685">    }</span>

    @Override
    public void actionPerformed(ActionEvent e) {
<span class="nc" id="L689">        removeListeners();</span>
<span class="nc" id="L690">        boolean notify = false;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        if (e.getSource() instanceof JButton) {</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">            if (addColor.equals(e.getSource())) {</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">                if (colorButtons.size() &lt; SkinSpecification.MAX_NUM_COLORS) {</span>
<span class="nc" id="L694">                    JButton colorButton = new JButton();</span>
<span class="nc" id="L695">                    colorButton.setMaximumSize(new Dimension(14, 14));</span>
<span class="nc" id="L696">                    colorButton.setPreferredSize(new Dimension(14, 14));</span>
<span class="nc" id="L697">                    colorButton.setForeground(Color.BLACK);</span>
<span class="nc" id="L698">                    colorButton.setBackground(Color.BLACK);</span>
<span class="nc" id="L699">                    colorButtons.add(colorButton);</span>
<span class="nc" id="L700">                    notify = true;</span>
<span class="nc" id="L701">                }</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">            } else if (removeColor.equals(e.getSource())) {</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                if (colorButtons.size() &gt; 1) {</span>
<span class="nc" id="L704">                    colorButtons.remove(colorButtons.size() - 1);</span>
<span class="nc" id="L705">                    notify = true;</span>
                }
<span class="nc bnc" id="L707" title="All 2 branches missed.">            } else if (colorButtons.contains(e.getSource())) {</span>
<span class="nc" id="L708">                JButton colorButton = (JButton) e.getSource();</span>
<span class="nc" id="L709">                Color newColor = JColorChooser.showDialog(this,</span>
<span class="nc" id="L710">                        Messages.getString(&quot;SkinEditor.ColorChoice&quot;), //$NON-NLS-1$</span>
<span class="nc" id="L711">                        colorButton.getBackground());</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">                if (newColor != null) {</span>
<span class="nc" id="L713">                    colorButton.setBackground(newColor);</span>
<span class="nc" id="L714">                    notify = true;</span>
                }
            }
        }
<span class="nc bnc" id="L718" title="All 2 branches missed.">        if (notify) {</span>
<span class="nc" id="L719">            notifySkinChanges(true);</span>
        } else { // If we notify, listeners are added, don't double-add
<span class="nc" id="L721">            addListeners();</span>
        }
<span class="nc" id="L723">    }</span>

    /**
     * Override the base setEnabled to also set the state of all members.
     */
    @Override
    public void setEnabled(boolean enabled) {
        // Corners
<span class="nc" id="L731">        tlCorner.setEnabled(enabled);</span>
<span class="nc" id="L732">        trCorner.setEnabled(enabled);</span>
<span class="nc" id="L733">        blCorner.setEnabled(enabled);</span>
<span class="nc" id="L734">        brCorner.setEnabled(enabled);</span>

        // Edges
<span class="nc" id="L737">        topEdge.setEnabled(enabled);</span>
<span class="nc" id="L738">        bottomEdge.setEnabled(enabled);</span>
<span class="nc" id="L739">        leftEdge.setEnabled(enabled);</span>
<span class="nc" id="L740">        rightEdge.setEnabled(enabled);</span>
<span class="nc" id="L741">    }</span>

    public void signalValidate() {
<span class="nc" id="L744">        skinEditor.validate();</span>
<span class="nc" id="L745">    }</span>

    public void notifySkinChanges(boolean setupSkinEditPanel) {
<span class="nc" id="L748">        skinEditor.notifySkinChanges(setupSkinEditPanel);</span>
<span class="nc" id="L749">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>