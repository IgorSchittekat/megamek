<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TripodMech.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">TripodMech.java</span></div><h1>TripodMech.java</h1><pre class="source lang-java linenums">/**
 * MegaMek -
 *  Copyright (C) 2013
 *    Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.common;

import java.io.PrintWriter;

import megamek.common.options.OptionsConstants;
import megamek.common.preference.PreferenceManager;

public class TripodMech extends Mech {
    /**
     *
     */
    private static final long serialVersionUID = 4166375446709772785L;

<span class="nc" id="L29">    private static final String[] LOCATION_NAMES = {&quot;Head&quot;, &quot;Center Torso&quot;,</span>
                                                    &quot;Right Torso&quot;, &quot;Left Torso&quot;, &quot;Right Arm&quot;, &quot;Left Arm&quot;, &quot;Right Leg&quot;,
                                                    &quot;Left Leg&quot;, &quot;Center Leg&quot;};

<span class="nc" id="L33">    private static final String[] LOCATION_ABBRS = {&quot;HD&quot;, &quot;CT&quot;, &quot;RT&quot;, &quot;LT&quot;,</span>
                                                    &quot;RA&quot;, &quot;LA&quot;, &quot;RL&quot;, &quot;LL&quot;, &quot;CL&quot;};

<span class="nc" id="L36">    private static final int[] NUM_OF_SLOTS = {6, 12, 12, 12, 12, 12, 6, 6, 6};</span>

    public TripodMech(String inGyroType, String inCockpitType) {
<span class="nc" id="L39">        this(getGyroTypeForString(inGyroType),</span>
<span class="nc" id="L40">             getCockpitTypeForString(inCockpitType));</span>
<span class="nc" id="L41">    }</span>

    public TripodMech() {
<span class="nc" id="L44">        this(Mech.GYRO_STANDARD, Mech.COCKPIT_STANDARD);</span>
<span class="nc" id="L45">    }</span>

    public TripodMech(int inGyroType, int inCockpitType) {
<span class="nc" id="L48">        super(inGyroType, inCockpitType);</span>

<span class="nc" id="L50">        movementMode = EntityMovementMode.TRIPOD;</span>
<span class="nc" id="L51">        originalMovementMode = EntityMovementMode.TRIPOD;</span>

<span class="nc" id="L53">        setCritical(LOC_RARM, 0, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_SHOULDER));
<span class="nc" id="L55">        setCritical(LOC_RARM, 1, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_UPPER_ARM));
<span class="nc" id="L57">        setCritical(LOC_RARM, 2, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_LOWER_ARM));
<span class="nc" id="L59">        setCritical(LOC_RARM, 3, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_HAND));

<span class="nc" id="L62">        setCritical(LOC_LARM, 0, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_SHOULDER));
<span class="nc" id="L64">        setCritical(LOC_LARM, 1, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_UPPER_ARM));
<span class="nc" id="L66">        setCritical(LOC_LARM, 2, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_LOWER_ARM));
<span class="nc" id="L68">        setCritical(LOC_LARM, 3, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_HAND));

<span class="nc" id="L71">        setCritical(LOC_CLEG, 0, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_HIP));
<span class="nc" id="L73">        setCritical(LOC_CLEG, 1, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_UPPER_LEG));
<span class="nc" id="L75">        setCritical(LOC_CLEG, 2, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_LOWER_LEG));
<span class="nc" id="L77">        setCritical(LOC_CLEG, 3, new CriticalSlot(CriticalSlot.TYPE_SYSTEM,</span>
                                                  ACTUATOR_FOOT));
<span class="nc" id="L79">    }</span>

    /**
     * Returns true if the location in question is a leg
     */
    @Override
    public boolean locationIsLeg(int loc) {
<span class="nc bnc" id="L86" title="All 6 branches missed.">        return (loc == LOC_LLEG) || (loc == LOC_RLEG) || (loc == LOC_CLEG);</span>
    }

    @Override
    public long getEntityType() {
<span class="nc" id="L91">        return Entity.ETYPE_MECH | Entity.ETYPE_TRIPOD_MECH;</span>
    }

    /**
     * Returns true if the entity can flip its arms
     */
    @Override
    public boolean canFlipArms() {
<span class="nc" id="L99">        boolean canFlip = true;</span>

<span class="nc bnc" id="L101" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_HAND, Mech.LOC_LARM)) {</span>
<span class="nc" id="L102">            canFlip = false;</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">        } else if (hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_LARM)) {</span>
<span class="nc" id="L104">            canFlip = false;</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        } else if (hasSystem(Mech.ACTUATOR_HAND, Mech.LOC_RARM)) {</span>
<span class="nc" id="L106">            canFlip = false;</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">        } else if (hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_RARM)) {</span>
<span class="nc" id="L108">            canFlip = false;</span>
        }

<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (hasQuirk(OptionsConstants.QUIRK_POS_HYPER_ACTUATOR)) {</span>
<span class="nc" id="L112">            canFlip = true;</span>
        }

<span class="nc bnc" id="L115" title="All 2 branches missed.">        if (isProne()) {</span>
<span class="nc" id="L116">            canFlip = false;</span>
        }

<span class="nc" id="L119">        return canFlip;</span>
    }

    @Override
    public int getWalkMP(boolean gravity, boolean ignoreheat,
                         boolean ignoremodulararmor) {
<span class="nc" id="L125">        int wmp = getOriginalWalkMP();</span>
<span class="nc" id="L126">        int legsDestroyed = 0;</span>
<span class="nc" id="L127">        int hipHits = 0;</span>
<span class="nc" id="L128">        int actuatorHits = 0;</span>

        //A Mech using tracks has its movement reduced by 1/3 per leg or track destroyed, based
        //on analogy with biped and quad mechs.
<span class="nc bnc" id="L132" title="All 2 branches missed.">        if (getMovementMode() == EntityMovementMode.TRACKED) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">            for (Mounted m : getMisc()) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                if (m.getType().hasFlag(MiscType.F_TRACKS)) {</span>
<span class="nc bnc" id="L135" title="All 4 branches missed.">                    if (m.isHit() || isLocationBad(m.getLocation())) {</span>
<span class="nc" id="L136">                        legsDestroyed++;</span>
                    }
                }
<span class="nc" id="L139">            }</span>
<span class="nc" id="L140">            wmp = (wmp * (3 - legsDestroyed)) / 3; </span>
        } else {
<span class="nc bnc" id="L142" title="All 2 branches missed.">            for (int i = 0; i &lt; locations(); i++) {</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                if (locationIsLeg(i)) {</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">                    if (!isLocationBad(i)) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                        if (legHasHipCrit(i)) {</span>
<span class="nc" id="L146">                            hipHits++;</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">                            if ((game == null)</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">                                || !game.getOptions().booleanOption(</span>
                                    OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {
<span class="nc" id="L150">                                continue;</span>
                            }
                        }
<span class="nc" id="L153">                        actuatorHits += countLegActuatorCrits(i);</span>
                    } else {
<span class="nc" id="L155">                        legsDestroyed++;</span>
                    }
                }
            }

            // leg damage effects
<span class="nc bnc" id="L161" title="All 2 branches missed.">            if (legsDestroyed &gt; 0) {</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">                wmp = (legsDestroyed == 1) ? 1 : 0;</span>
            } else {
<span class="nc bnc" id="L164" title="All 2 branches missed.">                if (hipHits &gt; 0) {</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                    if ((game != null)</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">                        &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                        wmp = (hipHits &gt;= 1) ? wmp - (2 * hipHits) : 0;</span>
                    } else {
<span class="nc bnc" id="L169" title="All 2 branches missed.">                        wmp = (hipHits == 1) ? (int) Math.ceil(wmp / 2.0) : 0;</span>
                    }
                }
<span class="nc" id="L172">                wmp -= actuatorHits;</span>
            }
        }

<span class="nc bnc" id="L176" title="All 2 branches missed.">        if (hasShield()) {</span>
<span class="nc" id="L177">            wmp -= getNumberOfShields(MiscType.S_SHIELD_LARGE);</span>
<span class="nc" id="L178">            wmp -= getNumberOfShields(MiscType.S_SHIELD_MEDIUM);</span>
        }

<span class="nc bnc" id="L181" title="All 4 branches missed.">        if (!ignoremodulararmor &amp;&amp; hasModularArmor()) {</span>
<span class="nc" id="L182">            wmp--;</span>
        }

<span class="nc bnc" id="L185" title="All 2 branches missed.">        if (!ignoreheat) {</span>
            // factor in heat
<span class="nc bnc" id="L187" title="All 2 branches missed.">            if ((game != null)</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_HEAT)) {</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">                if (heat &lt; 30) {</span>
<span class="nc" id="L190">                    wmp -= (heat / 5);</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                } else if (heat &gt;= 49) {</span>
<span class="nc" id="L192">                    wmp -= 9;</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">                } else if (heat &gt;= 43) {</span>
<span class="nc" id="L194">                    wmp -= 8;</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">                } else if (heat &gt;= 37) {</span>
<span class="nc" id="L196">                    wmp -= 7;</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                } else if (heat &gt;= 31) {</span>
<span class="nc" id="L198">                    wmp -= 6;</span>
                } else {
<span class="nc" id="L200">                    wmp -= 5;</span>
                }
            } else {
<span class="nc" id="L203">                wmp -= (heat / 5);</span>
            }
            // TSM negates some heat
<span class="nc bnc" id="L206" title="All 8 branches missed.">            if ((heat &gt;= 9) &amp;&amp; hasTSM() &amp;&amp; legsDestroyed == 0 &amp;&amp; movementMode != EntityMovementMode.TRACKED) {</span>
<span class="nc" id="L207">                wmp += 2;</span>
            }
        }
<span class="nc" id="L210">        wmp = Math.max(wmp - getCargoMpReduction(this), 0);</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        if (null != game) {</span>
<span class="nc" id="L212">            int weatherMod = game.getPlanetaryConditions()</span>
<span class="nc" id="L213">                                 .getMovementMods(this);</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">            if (weatherMod != 0) {</span>
<span class="nc" id="L215">                wmp = Math.max(wmp + weatherMod, 0);</span>
            }
        }
        // gravity
<span class="nc bnc" id="L219" title="All 2 branches missed.">        if (gravity) {</span>
<span class="nc" id="L220">            wmp = applyGravityEffectsOnMP(wmp);</span>
        }

        // For sanity sake...
<span class="nc" id="L224">        wmp = Math.max(0, wmp);</span>

<span class="nc" id="L226">        return wmp;</span>
    }

    /**
     * Returns this mech's running/flank mp modified for leg loss &amp; stuff.
     */
    @Override
    public int getRunMP(boolean gravity, boolean ignoreheat,
                        boolean ignoremodulararmor) {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if (countBadLegs() == 0) {</span>
<span class="nc" id="L236">            return super.getRunMP(gravity, ignoreheat, ignoremodulararmor);</span>
        }
<span class="nc" id="L238">        return getWalkMP(gravity, ignoreheat, ignoremodulararmor);</span>
    }

    /**
     * Returns run MP without considering MASC modified for leg loss &amp; stuff.
     */

    @Override
    public int getRunMPwithoutMASC(boolean gravity, boolean ignoreheat,
                                   boolean ignoremodulararmor) {
<span class="nc bnc" id="L248" title="All 2 branches missed.">        if (countBadLegs() == 0) {</span>
<span class="nc" id="L249">            return super.getRunMPwithoutMASC(gravity, ignoreheat,</span>
                                             ignoremodulararmor);
        }
<span class="nc" id="L252">        return getWalkMP(gravity, ignoreheat, ignoremodulararmor);</span>
    }

    /**
     * Sets the internal structure for the mech.
     *
     * @param head head
     * @param ct   center torso
     * @param t    right/left torso
     * @param arm  right/left arm
     * @param leg  right/left leg
     */
    @Override
    public void setInternal(int head, int ct, int t, int arm, int leg) {
<span class="nc" id="L266">        initializeInternal(head, LOC_HEAD);</span>
<span class="nc" id="L267">        initializeInternal(ct, LOC_CT);</span>
<span class="nc" id="L268">        initializeInternal(t, LOC_RT);</span>
<span class="nc" id="L269">        initializeInternal(t, LOC_LT);</span>
<span class="nc" id="L270">        initializeInternal(arm, LOC_RARM);</span>
<span class="nc" id="L271">        initializeInternal(arm, LOC_LARM);</span>
<span class="nc" id="L272">        initializeInternal(leg, LOC_RLEG);</span>
<span class="nc" id="L273">        initializeInternal(leg, LOC_LLEG);</span>
<span class="nc" id="L274">        initializeInternal(leg, LOC_CLEG);</span>
<span class="nc" id="L275">    }</span>

    /**
     * Add in any piloting skill mods
     */
    @Override
    public PilotingRollData addEntityBonuses(PilotingRollData roll) {
<span class="nc bnc" id="L282" title="All 2 branches missed.">        if (getCrew().hasDedicatedPilot()) {</span>
<span class="nc" id="L283">            roll.addModifier(-1, &quot;dedicated pilot&quot;);</span>
        } else {
<span class="nc" id="L285">            roll.addModifier(2, &quot;pilot incapacitated&quot;);</span>
        }
        
<span class="nc" id="L288">        int[] locsToCheck = new int[3];</span>

<span class="nc" id="L290">        locsToCheck[0] = Mech.LOC_RLEG;</span>
<span class="nc" id="L291">        locsToCheck[1] = Mech.LOC_LLEG;</span>
<span class="nc" id="L292">        locsToCheck[2] = Mech.LOC_CLEG;</span>

<span class="nc bnc" id="L294" title="All 2 branches missed.">        if (hasFunctionalLegAES()) {</span>
<span class="nc" id="L295">            roll.addModifier(-2, &quot;AES bonus&quot;);</span>
        }

<span class="nc bnc" id="L298" title="All 2 branches missed.">        if (countBadLegs() == 0) {</span>
<span class="nc" id="L299">            roll.addModifier(-1, &quot;tripod bonus&quot;);</span>
        }

<span class="nc bnc" id="L302" title="All 2 branches missed.">        for (int i = 0; i &lt; locsToCheck.length; i++) {</span>
<span class="nc" id="L303">            int loc = locsToCheck[i];</span>

<span class="nc bnc" id="L305" title="All 2 branches missed.">            if (isLocationBad(loc)) {</span>
<span class="nc" id="L306">                roll.addModifier(5, getLocationName(loc) + &quot; destroyed&quot;);</span>
            } else {
                // check for damaged hip actuators
<span class="nc bnc" id="L309" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                                    Mech.ACTUATOR_HIP, loc) &gt; 0) {
<span class="nc" id="L311">                    roll.addModifier(2, getLocationName(loc)</span>
                                        + &quot; Hip Actuator destroyed&quot;);
<span class="nc bnc" id="L313" title="All 2 branches missed.">                    if (!game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {</span>
<span class="nc" id="L314">                        continue;</span>
                    }
                }
                // upper leg actuators?
<span class="nc bnc" id="L318" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                                    Mech.ACTUATOR_UPPER_LEG, loc) &gt; 0) {
<span class="nc" id="L320">                    roll.addModifier(1, getLocationName(loc)</span>
                                        + &quot; Upper Leg Actuator destroyed&quot;);
                }
                // lower leg actuators?
<span class="nc bnc" id="L324" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                                    Mech.ACTUATOR_LOWER_LEG, loc) &gt; 0) {
<span class="nc" id="L326">                    roll.addModifier(1, getLocationName(loc)</span>
                                        + &quot; Lower Leg Actuator destroyed&quot;);
                }
                // foot actuators?
<span class="nc bnc" id="L330" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM,</span>
                                    Mech.ACTUATOR_FOOT, loc) &gt; 0) {
<span class="nc" id="L332">                    roll.addModifier(1, getLocationName(loc)</span>
                                        + &quot; Foot Actuator destroyed&quot;);
                }
            }
        }

<span class="nc" id="L338">        return super.addEntityBonuses(roll);</span>
    }

    /**
     * Returns a vector of slot counts for all locations
     */
    @Override
    protected int[] getNoOfSlots() {
<span class="nc" id="L346">        return NUM_OF_SLOTS;</span>
    }

    /**
     * Returns a vector of names for all locations
     */
    @Override
    public String[] getLocationNames() {
<span class="nc" id="L354">        return LOCATION_NAMES;</span>
    }

    /**
     * Returns a vector of abbreviations for all locations
     */
    @Override
    public String[] getLocationAbbrs() {
<span class="nc" id="L362">        return LOCATION_ABBRS;</span>
    }

    @Override
    protected double getArmActuatorCost() {
<span class="nc" id="L367">        double cost = 0;</span>
<span class="nc" id="L368">        int numOfUpperArmActuators = 0;</span>
<span class="nc" id="L369">        int numOfLowerArmActuators = 0;</span>
<span class="nc" id="L370">        int numOfHands = 0;</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_HAND, Mech.LOC_LARM)) {</span>
<span class="nc" id="L372">            numOfHands++;</span>
        }
<span class="nc bnc" id="L374" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_LARM)) {</span>
<span class="nc" id="L375">            numOfLowerArmActuators++;</span>
        }
<span class="nc bnc" id="L377" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_UPPER_ARM, Mech.LOC_LARM)) {</span>
<span class="nc" id="L378">            numOfUpperArmActuators++;</span>
        }
<span class="nc bnc" id="L380" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_HAND, Mech.LOC_RARM)) {</span>
<span class="nc" id="L381">            numOfHands++;</span>
        }
<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_RARM)) {</span>
<span class="nc" id="L384">            numOfLowerArmActuators++;</span>
        }
<span class="nc bnc" id="L386" title="All 2 branches missed.">        if (hasSystem(Mech.ACTUATOR_UPPER_ARM, Mech.LOC_RARM)) {</span>
<span class="nc" id="L387">            numOfUpperArmActuators++;</span>
        }
<span class="nc" id="L389">        cost += numOfUpperArmActuators * weight * 100;</span>
<span class="nc" id="L390">        cost += numOfLowerArmActuators * weight * 50;</span>
<span class="nc" id="L391">        cost += numOfHands * weight * 80;</span>
<span class="nc" id="L392">        return cost;</span>
    }

    @Override
    protected double getLegActuatorCost() {
<span class="nc" id="L397">        return (weight * 150 * 2) + (weight * 80 * 2) + (weight * 120 * 2);</span>
    }

    /**
     * Check to see if a Biped mech has a claw in one of its arms
     *
     * @param location (LOC_RARM or LOC_LARM)
     * @return True/False
     */
    public boolean hasClaw(int location) {
        // only arms have claws.
<span class="nc bnc" id="L408" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L409">            return false;</span>
        }
<span class="nc bnc" id="L411" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L412">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L415">                continue;</span>
            }
<span class="nc bnc" id="L417" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L418">                continue;</span>
            }
<span class="nc" id="L420">            Mounted m = cs.getMount();</span>
<span class="nc" id="L421">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">            if ((type instanceof MiscType)</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">                &amp;&amp; type.hasFlag(MiscType.F_HAND_WEAPON)</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">                &amp;&amp; type.hasSubType(MiscType.S_CLAW)) {</span>
<span class="nc bnc" id="L425" title="All 6 branches missed.">                return !(m.isDestroyed() || m.isMissing() || m.isBreached());</span>
            }
        }
<span class="nc" id="L428">        return false;</span>
    }

    /**
     * Checks to see if this bipmech has any vibro blades on them.
     *
     * @return boolean &lt;code&gt;true&lt;/code&gt; if the mech has vibroblades
     * &lt;code&gt;false&lt;/code&gt; if not.
     */
    @Override
    public boolean hasVibroblades() {
<span class="nc" id="L439">        int count = 0;</span>

<span class="nc bnc" id="L441" title="All 2 branches missed.">        if (hasVibrobladesInLocation(Mech.LOC_RARM)) {</span>
<span class="nc" id="L442">            count++;</span>
        }
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (hasVibrobladesInLocation(Mech.LOC_LARM)) {</span>
<span class="nc" id="L445">            count++;</span>
        }

<span class="nc bnc" id="L448" title="All 2 branches missed.">        return count &gt; 0;</span>
    }

    /**
     * Checks to see if this bipedmech has a vibroblade in this location.
     *
     * @param location
     * @return boolean &lt;code&gt;true&lt;/code&gt; if the mech has vibroblades
     * &lt;code&gt;false&lt;/code&gt; if not.
     */
    public boolean hasVibrobladesInLocation(int location) {

        // Only arms have VibroBlades.
<span class="nc bnc" id="L461" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L462">            return false;</span>
        }

<span class="nc bnc" id="L465" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L466">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L469">                continue;</span>
            }
<span class="nc bnc" id="L471" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L472">                continue;</span>
            }
<span class="nc" id="L474">            Mounted m = cs.getMount();</span>
            // sometimes this mounted is null in MML - causing problems so check
<span class="nc bnc" id="L476" title="All 2 branches missed.">            if (null == m) {</span>
<span class="nc" id="L477">                continue;</span>
            }
<span class="nc" id="L479">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L480" title="All 4 branches missed.">            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isVibroblade()) {</span>
<span class="nc bnc" id="L481" title="All 6 branches missed.">                return !(m.isDestroyed() || m.isMissing() || m.isBreached());</span>
            }
        }

<span class="nc" id="L485">        return false;</span>
    }

    /**
     * Does the entity have a retracted blade in the given location
     */
    @Override
    public boolean hasRetractedBlade(int loc) {
<span class="nc bnc" id="L493" title="All 2 branches missed.">        for (Mounted m : getEquipment()) {</span>
<span class="nc bnc" id="L494" title="All 6 branches missed.">            if ((m.getLocation() == loc) &amp;&amp; !m.isDestroyed() &amp;&amp; !m.isBreached()</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">                &amp;&amp; (m.getType() instanceof MiscType)</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                &amp;&amp; m.getType().hasFlag(MiscType.F_CLUB)</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                &amp;&amp; m.getType().hasSubType(MiscType.S_RETRACTABLE_BLADE)</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">                &amp;&amp; !m.curMode().equals(&quot;extended&quot;)) {</span>
<span class="nc" id="L499">                return true;</span>
            }
<span class="nc" id="L501">        }</span>
<span class="nc" id="L502">        return false;</span>
    }

    /**
     * Checks for Active Vibroblades in &lt;code&gt;location&lt;/code&gt; and returns the
     * amount of heat genereated if active.
     *
     * @param location
     * @return &lt;code&gt;int&lt;/code&gt; amount of heat genereated by an active
     * vibroblade.
     */
    @Override
    public int getActiveVibrobladeHeat(int location) {
<span class="nc" id="L515">        return getActiveVibrobladeHeat(location, false);</span>
    }

    @Override
    public int getActiveVibrobladeHeat(int location, boolean ignoreMode) {
        // Only arms have VibroBlades.
<span class="nc bnc" id="L521" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L522">            return 0;</span>
        }

<span class="nc bnc" id="L525" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L526">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L528" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L529">                continue;</span>
            }
<span class="nc bnc" id="L531" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L532">                continue;</span>
            }
<span class="nc" id="L534">            Mounted m = cs.getMount();</span>
            // sometimes this mounted is null in MML - causing problems so check
<span class="nc bnc" id="L536" title="All 2 branches missed.">            if (null == m) {</span>
<span class="nc" id="L537">                continue;</span>
            }
<span class="nc" id="L539">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L540" title="All 4 branches missed.">            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isVibroblade()</span>
<span class="nc bnc" id="L541" title="All 4 branches missed.">                &amp;&amp; (m.curMode().equals(&quot;Active&quot;) || ignoreMode)</span>
<span class="nc bnc" id="L542" title="All 6 branches missed.">                &amp;&amp; !(m.isDestroyed() || m.isMissing() || m.isBreached())) {</span>
<span class="nc" id="L543">                MiscType blade = (MiscType) type;</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">                if (blade.hasSubType(MiscType.S_VIBRO_LARGE)) {</span>
<span class="nc" id="L545">                    return 7;</span>
                }
<span class="nc bnc" id="L547" title="All 2 branches missed.">                if (blade.hasSubType(MiscType.S_VIBRO_MEDIUM)) {</span>
<span class="nc" id="L548">                    return 5;</span>
                }
                // else
<span class="nc" id="L551">                return 3;</span>
            }
        }

<span class="nc" id="L555">        return 0;</span>

    }

    /**
     * Does the mech have any shields. a mech can have up to 2 shields.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if unit has a shield crit.
     */
    @Override
    public boolean hasShield() {
<span class="nc bnc" id="L566" title="All 2 branches missed.">        for (Mounted m : getMisc()) {</span>
<span class="nc" id="L567">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L568" title="All 6 branches missed.">            if (((m.getLocation() == Mech.LOC_LARM) || (m.getLocation() == Mech.LOC_RARM))</span>
                    &amp;&amp; (type instanceof MiscType)
<span class="nc bnc" id="L570" title="All 2 branches missed.">                    &amp;&amp; ((MiscType) type).isShield()</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">                    &amp;&amp; !m.isInoperable()</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">                    &amp;&amp; (this.getInternal(m.getLocation()) &gt; 0)) {</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                for (int slot = 0; slot &lt; this.getNumberOfCriticals(m</span>
<span class="nc" id="L574">                        .getLocation()); slot++) {</span>
<span class="nc" id="L575">                    CriticalSlot cs = getCritical(m.getLocation(), slot);</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">                    if ((cs != null)</span>
<span class="nc bnc" id="L577" title="All 2 branches missed.">                            &amp;&amp; (cs.getType() == CriticalSlot.TYPE_EQUIPMENT)</span>
<span class="nc bnc" id="L578" title="All 4 branches missed.">                            &amp;&amp; cs.getMount().equals(m) &amp;&amp; !cs.isDestroyed()</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">                            &amp;&amp; !cs.isMissing()) {</span>
                        // when all crits of a shield are destroyed, it
                        // no longer hinders movement and stuff
<span class="nc" id="L582">                        return true;</span>
                    }
                }
            }
<span class="nc" id="L586">        }</span>
<span class="nc" id="L587">        return false;</span>
    }

    /**
     * Check to see how many shields of a certain size a mek has. you can have
     * up to shields per mek. However they can be of different size and each
     * size has its own draw backs. So check each size and add modifers based on
     * the number shields of that size.
     */
    @Override
    public int getNumberOfShields(long size) {

<span class="nc" id="L599">        int raShield = 0;</span>
<span class="nc" id="L600">        int laShield = 0;</span>

<span class="nc bnc" id="L602" title="All 2 branches missed.">        for (Mounted m : getMisc()) {</span>
<span class="nc" id="L603">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L604" title="All 4 branches missed.">            if ((type instanceof MiscType) &amp;&amp; type.hasFlag(MiscType.F_CLUB)</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">                &amp;&amp; (type.hasSubType(size))) {</span>
                // ok so we have a shield of certain size. no which arm is it.
<span class="nc bnc" id="L607" title="All 2 branches missed.">                if (m.getLocation() == Mech.LOC_RARM) {</span>
<span class="nc" id="L608">                    raShield = 1;</span>
                }
<span class="nc bnc" id="L610" title="All 2 branches missed.">                if (m.getLocation() == Mech.LOC_LARM) {</span>
<span class="nc" id="L611">                    laShield = 1;</span>
                }
                // break now.
<span class="nc bnc" id="L614" title="All 4 branches missed.">                if ((raShield &gt; 0) &amp;&amp; (laShield &gt; 0)) {</span>
<span class="nc" id="L615">                    return 2;</span>
                }
            }
<span class="nc" id="L618">        }</span>
<span class="nc" id="L619">        return raShield + laShield;</span>
    }

    /**
     * Does the mech have an active shield This should only be called after
     * hasShield has been called.
     */
    @Override
    public boolean hasActiveShield(int location, boolean rear) {

<span class="nc bnc" id="L629" title="All 3 branches missed.">        switch (location) {</span>
            case Mech.LOC_CT:
            case Mech.LOC_HEAD:
                // no rear head location so must be rear CT which is not
                // proected by
                // any shield
<span class="nc bnc" id="L635" title="All 2 branches missed.">                if (rear) {</span>
<span class="nc" id="L636">                    return false;</span>
                }
<span class="nc bnc" id="L638" title="All 2 branches missed.">                if (hasActiveShield(Mech.LOC_LARM)</span>
<span class="nc bnc" id="L639" title="All 2 branches missed.">                    || hasActiveShield(Mech.LOC_RARM)) {</span>
<span class="nc" id="L640">                    return true;</span>
                }
                // else
<span class="nc" id="L643">                return false;</span>
            case Mech.LOC_LARM:
            case Mech.LOC_LT:
            case Mech.LOC_LLEG:
<span class="nc" id="L647">                return hasActiveShield(Mech.LOC_LARM);</span>
            default:
<span class="nc" id="L649">                return hasActiveShield(Mech.LOC_RARM);</span>
        }
    }

    /**
     * Does the mech have an active shield This should only be called by
     * hasActiveShield(location,rear)
     */
    @Override
    public boolean hasActiveShield(int location) {

<span class="nc bnc" id="L660" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L661">            return false;</span>
        }

<span class="nc bnc" id="L664" title="All 2 branches missed.">        if (isShutDown()</span>
<span class="nc bnc" id="L665" title="All 4 branches missed.">            || (getCrew().isKoThisRound() || getCrew().isUnconscious())) {</span>
<span class="nc" id="L666">            return false;</span>
        }

<span class="nc bnc" id="L669" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L670">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L672" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L673">                continue;</span>
            }

<span class="nc bnc" id="L676" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L677">                continue;</span>
            }

<span class="nc bnc" id="L680" title="All 2 branches missed.">            if (cs.isDamaged()) {</span>
<span class="nc" id="L681">                continue;</span>
            }

<span class="nc" id="L684">            Mounted m = cs.getMount();</span>
<span class="nc" id="L685">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L686" title="All 4 branches missed.">            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isShield()</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">                &amp;&amp; m.curMode().equals(MiscType.S_ACTIVE_SHIELD)) {</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">                return m.getCurrentDamageCapacity(this, m.getLocation()) &gt; 0;</span>
            }
        }
<span class="nc" id="L691">        return false;</span>
    }

    /**
     * Does the mech have a passive shield This should only be called after
     * hasShield has been called.
     */
    @Override
    public boolean hasPassiveShield(int location, boolean rear) {

<span class="nc bnc" id="L701" title="All 3 branches missed.">        switch (location) {</span>
            // CT Head and legs are not protected by Passive shields.
            case Mech.LOC_CT:
            case Mech.LOC_HEAD:
            case Mech.LOC_LLEG:
            case Mech.LOC_RLEG:
<span class="nc" id="L707">                return false;</span>
            case Mech.LOC_LARM:
            case Mech.LOC_LT:
<span class="nc bnc" id="L710" title="All 2 branches missed.">                if (rear) {</span>
                    // that
<span class="nc" id="L712">                    return false;</span>
                }
<span class="nc" id="L714">                return hasPassiveShield(Mech.LOC_LARM);</span>
            // RA RT
            default:
<span class="nc bnc" id="L717" title="All 2 branches missed.">                if (rear) {</span>
                    // that
<span class="nc" id="L719">                    return false;</span>
                }
<span class="nc" id="L721">                return hasPassiveShield(Mech.LOC_RARM);</span>
        }
    }

    /**
     * Does the mech have a passive shield This should only be called by
     * hasPassiveShield(location,rear)
     */
    @Override
    public boolean hasPassiveShield(int location) {

<span class="nc bnc" id="L732" title="All 2 branches missed.">        if (isShutDown()</span>
<span class="nc bnc" id="L733" title="All 4 branches missed.">            || (getCrew().isKoThisRound() || getCrew().isUnconscious())) {</span>
<span class="nc" id="L734">            return false;</span>
        }

<span class="nc bnc" id="L737" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L738">            return false;</span>
        }

<span class="nc bnc" id="L741" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L742">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L744" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L745">                continue;</span>
            }

<span class="nc bnc" id="L748" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L749">                continue;</span>
            }

<span class="nc bnc" id="L752" title="All 2 branches missed.">            if (cs.isDamaged()) {</span>
<span class="nc" id="L753">                continue;</span>
            }

<span class="nc" id="L756">            Mounted m = cs.getMount();</span>
<span class="nc" id="L757">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L758" title="All 4 branches missed.">            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isShield()</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">                &amp;&amp; m.curMode().equals(MiscType.S_PASSIVE_SHIELD)) {</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">                return m.getCurrentDamageCapacity(this, m.getLocation()) &gt; 0;</span>
            }
        }
<span class="nc" id="L763">        return false;</span>
    }

    /**
     * Does the mech have an shield in no defense mode
     */
    @Override
    public boolean hasNoDefenseShield(int location) {

<span class="nc bnc" id="L772" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L773">            return false;</span>
        }

<span class="nc bnc" id="L776" title="All 2 branches missed.">        for (int slot = 0; slot &lt; this.getNumberOfCriticals(location); slot++) {</span>
<span class="nc" id="L777">            CriticalSlot cs = getCritical(location, slot);</span>

<span class="nc bnc" id="L779" title="All 2 branches missed.">            if (cs == null) {</span>
<span class="nc" id="L780">                continue;</span>
            }

<span class="nc bnc" id="L783" title="All 2 branches missed.">            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L784">                continue;</span>
            }

<span class="nc bnc" id="L787" title="All 2 branches missed.">            if (cs.isDamaged()) {</span>
<span class="nc" id="L788">                continue;</span>
            }

<span class="nc" id="L791">            Mounted m = cs.getMount();</span>
<span class="nc" id="L792">            EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">            if ((type instanceof MiscType)</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">                &amp;&amp; ((MiscType) type).isShield()</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">                &amp;&amp; (m.curMode().equals(MiscType.S_NO_SHIELD)</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">                    || isShutDown() || // if</span>
                    // he
                    // has
                    // a
                    // shield
                    // and
                    // the mek is SD or pilot
                    // KOed then it goes to no
                    // defense mode
<span class="nc bnc" id="L805" title="All 2 branches missed.">                    getCrew().isKoThisRound() || getCrew()</span>
<span class="nc bnc" id="L806" title="All 2 branches missed.">                    .isUnconscious())) {</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">                return m.getCurrentDamageCapacity(this, m.getLocation()) &gt; 0;</span>
            }
        }
<span class="nc" id="L810">        return false;</span>
    }

    /**
     * Checks is Biped Mek has functional AES in the location. Only works for
     * Arms
     */
    @Override
    public boolean hasFunctionalArmAES(int location) {

<span class="nc" id="L820">        boolean hasAES = false;</span>
<span class="nc bnc" id="L821" title="All 4 branches missed.">        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</span>
<span class="nc" id="L822">            return false;</span>
        }

<span class="nc bnc" id="L825" title="All 2 branches missed.">        for (Mounted mounted : getMisc()) {</span>
<span class="nc bnc" id="L826" title="All 2 branches missed.">            if ((mounted.getLocation() == location)</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">                &amp;&amp; mounted.getType().hasFlag(</span>
                    MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)
<span class="nc bnc" id="L829" title="All 4 branches missed.">                &amp;&amp; !mounted.isDestroyed() &amp;&amp; !mounted.isBreached()</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">                &amp;&amp; !mounted.isMissing()) {</span>
<span class="nc" id="L831">                hasAES = true;</span>
            } // AES is destroyed their for it cannot be used.
<span class="nc bnc" id="L833" title="All 2 branches missed.">            else if ((mounted.getLocation() == location)</span>
<span class="nc bnc" id="L834" title="All 2 branches missed.">                     &amp;&amp; mounted.getType().hasFlag(</span>
                    MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)) {
<span class="nc" id="L836">                return false;</span>
            }
<span class="nc" id="L838">        }</span>

<span class="nc" id="L840">        return hasAES;</span>
    }

    /**
     * Checks for functional AES in both legs
     */
    @Override
    public boolean hasFunctionalLegAES() {
<span class="nc" id="L848">        boolean rightLeg = false;</span>
<span class="nc" id="L849">        boolean leftLeg = false;</span>
<span class="nc" id="L850">        boolean centerLeg = false;</span>

<span class="nc bnc" id="L852" title="All 2 branches missed.">        for (Mounted mounted : getMisc()) {</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">            if ((mounted.getLocation() == Mech.LOC_LLEG)</span>
<span class="nc bnc" id="L854" title="All 2 branches missed.">                || (mounted.getLocation() == Mech.LOC_RLEG)</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">                || (mounted.getLocation() == Mech.LOC_CLEG)) {</span>
<span class="nc" id="L856">                if (((MiscType) mounted.getType())</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">                            .hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)</span>
<span class="nc bnc" id="L858" title="All 2 branches missed.">                    &amp;&amp; !mounted.isDestroyed()</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">                    &amp;&amp; !mounted.isBreached()</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">                    &amp;&amp; !mounted.isMissing()) {</span>
<span class="nc bnc" id="L861" title="All 2 branches missed.">                    if (mounted.getLocation() == Mech.LOC_LLEG) {</span>
<span class="nc" id="L862">                        leftLeg = true;</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">                    } else if (mounted.getLocation() == Mech.LOC_RLEG) {</span>
<span class="nc" id="L864">                        rightLeg = true;</span>
                    } else {
<span class="nc" id="L866">                        centerLeg = true;</span>
                    }
                }// AES is destroyed their for it cannot be used.
<span class="nc" id="L869">                else if (((MiscType) mounted.getType())</span>
<span class="nc bnc" id="L870" title="All 2 branches missed.">                        .hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)) {</span>
<span class="nc" id="L871">                    return false;</span>
                }
            }
<span class="nc" id="L874">        }</span>

<span class="nc bnc" id="L876" title="All 6 branches missed.">        return rightLeg &amp;&amp; leftLeg &amp;&amp; centerLeg;</span>
    }

    @Override
    public boolean canGoHullDown() {
        // check the option
<span class="nc" id="L882">        boolean retVal = game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN);</span>
<span class="nc bnc" id="L883" title="All 2 branches missed.">        if (!retVal) {</span>
<span class="nc" id="L884">            return false;</span>
        }
        // check the locations
<span class="nc bnc" id="L887" title="All 2 branches missed.">        retVal = (!isLocationBad(Mech.LOC_LLEG)</span>
<span class="nc bnc" id="L888" title="All 4 branches missed.">                  &amp;&amp; !isLocationBad(Mech.LOC_RLEG) &amp;&amp; !isLocationBad(LOC_CLEG)</span>
<span class="nc bnc" id="L889" title="All 4 branches missed.">                  &amp;&amp; !isLocationDoomed(Mech.LOC_LLEG) &amp;&amp; !isLocationDoomed(Mech.LOC_RLEG))</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                 &amp;&amp; !isLocationDoomed(LOC_CLEG);</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">        if (!retVal) {</span>
<span class="nc" id="L892">            return false;</span>
        }
        // check the Gyro
<span class="nc bnc" id="L895" title="All 2 branches missed.">        return !isGyroDestroyed();</span>
    }

    @Override
    public PilotingRollData checkGetUp(MoveStep step,
            EntityMovementType moveType) {

<span class="nc" id="L902">        PilotingRollData roll = super.checkGetUp(step, moveType);</span>

<span class="nc bnc" id="L904" title="All 2 branches missed.">        if (roll.getValue() != TargetRoll.CHECK_FALSE) {</span>
<span class="nc" id="L905">            addStandingPenalties(roll);</span>
        }

<span class="nc" id="L908">        return roll;</span>
    }

    public void addStandingPenalties(PilotingRollData roll) {

<span class="nc bnc" id="L913" title="All 2 branches missed.">        if (hasQuirk(OptionsConstants.QUIRK_NEG_NO_ARMS)) {</span>
<span class="nc" id="L914">            roll.addModifier(2, &quot;no/minimal arms&quot;);</span>
<span class="nc" id="L915">            return;</span>
        }

<span class="nc bnc" id="L918" title="All 2 branches missed.">        if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_ATTEMPTING_STAND)) {</span>
<span class="nc" id="L919">            int[] locsToCheck = new int[2];</span>

<span class="nc" id="L921">            locsToCheck[0] = Mech.LOC_RARM;</span>
<span class="nc" id="L922">            locsToCheck[1] = Mech.LOC_LARM;</span>

<span class="nc bnc" id="L924" title="All 2 branches missed.">            for (int i = 0; i &lt; locsToCheck.length; i++) {</span>
<span class="nc" id="L925">                int loc = locsToCheck[i];</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">                if (isLocationBad(loc)) {</span>
<span class="nc" id="L927">                    roll.addModifier(2, getLocationName(loc) + &quot; destroyed&quot;);</span>
                } else {
                    // check for damaged hip actuators
<span class="nc bnc" id="L930" title="All 2 branches missed.">                    if (!hasWorkingSystem(Mech.ACTUATOR_HAND, loc)) {</span>
<span class="nc" id="L931">                        roll.addModifier(1, getLocationName(loc)</span>
                                            + &quot; hand Actuator missing/destroyed&quot;);
<span class="nc bnc" id="L933" title="All 2 branches missed.">                    } else if (!hasWorkingSystem(Mech.ACTUATOR_LOWER_ARM, loc)) {</span>
<span class="nc" id="L934">                        roll.addModifier(1, getLocationName(loc)</span>
                                            + &quot; lower Actuator missing/destroyed&quot;);
<span class="nc bnc" id="L936" title="All 2 branches missed.">                    } else if (!hasWorkingSystem(Mech.ACTUATOR_UPPER_ARM, loc)) {</span>
<span class="nc" id="L937">                        roll.addModifier(1, getLocationName(loc)</span>
                                            + &quot; upper ctuator missing/destroyed&quot;);
<span class="nc bnc" id="L939" title="All 2 branches missed.">                    } else if (!hasWorkingSystem(Mech.ACTUATOR_SHOULDER, loc)) {</span>
<span class="nc" id="L940">                        roll.addModifier(1, getLocationName(loc)</span>
                                            + &quot; shoulder Actuator missing/destroyed&quot;);
                    }
                }
            }
        }

<span class="nc" id="L947">    }</span>

    /**
     * @return if this mech cannot stand up from hulldown
     */
    @Override
    public boolean cannotStandUpFromHullDown() {
<span class="nc" id="L954">        int i = 0;</span>
<span class="nc bnc" id="L955" title="All 2 branches missed.">        if (isLocationBad(LOC_LLEG)) {</span>
<span class="nc" id="L956">            i++;</span>
        }
<span class="nc bnc" id="L958" title="All 2 branches missed.">        if (isLocationBad(LOC_RLEG)) {</span>
<span class="nc" id="L959">            i++;</span>
        }
<span class="nc bnc" id="L961" title="All 2 branches missed.">        if (isLocationBad(LOC_CLEG)) {</span>
<span class="nc" id="L962">            i++;</span>
        }
<span class="nc bnc" id="L964" title="All 4 branches missed.">        return (i &gt;= 1) || isGyroDestroyed();</span>
    }

    @Override
    public boolean hasMPReducingHardenedArmor() {
<span class="nc bnc" id="L969" title="All 6 branches missed.">        return (armorType[LOC_LLEG] == EquipmentType.T_ARMOR_HARDENED)</span>
               || (armorType[LOC_RLEG] == EquipmentType.T_ARMOR_HARDENED)
               || (armorType[LOC_CLEG] == EquipmentType.T_ARMOR_HARDENED);
    }

    /**
     * Returns the number of locations in the entity
     */
    @Override
    public int locations() {
<span class="nc" id="L979">        return 9;</span>
    }

    /*
     * (non-Javadoc)
     *
     * @see megamek.common.Entity#rollHitLocation(int, int, int, int)
     */
    @Override
    public HitData rollHitLocation(int table, int side, int aimedLocation,
                                   int aimingMode, int cover) {
<span class="nc" id="L990">        int roll = -1;</span>

<span class="nc bnc" id="L992" title="All 4 branches missed.">        if ((aimedLocation != LOC_NONE)</span>
            &amp;&amp; (aimingMode != IAimingModes.AIM_MODE_NONE)) {

<span class="nc" id="L995">            roll = Compute.d6(2);</span>

<span class="nc bnc" id="L997" title="All 4 branches missed.">            if ((5 &lt; roll) &amp;&amp; (roll &lt; 9)) {</span>
<span class="nc bnc" id="L998" title="All 2 branches missed.">                return new HitData(aimedLocation, side == ToHitData.SIDE_REAR,</span>
                                   true);
            }
        }

<span class="nc bnc" id="L1003" title="All 4 branches missed.">        if ((table == ToHitData.HIT_NORMAL)</span>
            || (table == ToHitData.HIT_PARTIAL_COVER)) {
<span class="nc" id="L1005">            roll = Compute.d6(2);</span>
            try {
<span class="nc" id="L1007">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1008">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1009" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1010">                    pw.print(table);</span>
<span class="nc" id="L1011">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1012">                    pw.print(side);</span>
<span class="nc" id="L1013">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1014">                    pw.println(roll);</span>
                }
<span class="nc" id="L1016">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1017">                thrown.printStackTrace();</span>
<span class="nc" id="L1018">            }</span>
<span class="nc bnc" id="L1019" title="All 2 branches missed.">            if (side == ToHitData.SIDE_FRONT) {</span>
                // normal front hits
<span class="nc bnc" id="L1021" title="All 9 branches missed.">                switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L1023" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining() &amp;&amp; getCrew()</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">                                .getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L1025" title="All 2 branches missed.">                            &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L1026">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1027">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1029">                            result.setUndoneLocation(tac(table, side,</span>
                                                         Mech.LOC_CT, cover, false));
<span class="nc" id="L1031">                            return result;</span>
                        } // if
<span class="nc" id="L1033">                        return tac(table, side, Mech.LOC_CT, cover, false);</span>
                    case 3:
                    case 4:
<span class="nc" id="L1036">                        return new HitData(Mech.LOC_RARM);</span>
                    case 5:
                    case 9:
<span class="nc" id="L1039">                        int legRoll = Compute.d6();</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">                        if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1041">                            return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1042" title="All 2 branches missed.">                        } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1043">                            return new HitData(Mech.LOC_CLEG);</span>
                        } else {
<span class="nc" id="L1045">                            return new HitData(Mech.LOC_LLEG);</span>
                        }
                    case 6:
<span class="nc" id="L1048">                        return new HitData(Mech.LOC_RT);</span>
                    case 7:
<span class="nc" id="L1050">                        return new HitData(Mech.LOC_CT);</span>
                    case 8:
<span class="nc" id="L1052">                        return new HitData(Mech.LOC_LT);</span>
                    case 10:
                    case 11:
<span class="nc" id="L1055">                        return new HitData(Mech.LOC_LARM);</span>
                    case 12:
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1060">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1061">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1063">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1064">                            return result;</span>
                        } // if
<span class="nc" id="L1066">                        return new HitData(Mech.LOC_HEAD);</span>
                }
<span class="nc bnc" id="L1068" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_LEFT) {</span>
                // normal left side hits
<span class="nc bnc" id="L1070" title="All 9 branches missed.">                switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L1072" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining() &amp;&amp; getCrew()</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">                                .getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                            &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L1075">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1076">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1078">                            result.setUndoneLocation(tac(table, side,</span>
                                                         Mech.LOC_LT, cover, false));
<span class="nc" id="L1080">                            return result;</span>
                        } // if
<span class="nc" id="L1082">                        return tac(table, side, Mech.LOC_LT, cover, false);</span>
                    case 3:
                    case 6:
                    case 11:
<span class="nc" id="L1086">                        int legRoll = Compute.d6() + 1;</span>
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                        if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1088">                            return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1089" title="All 2 branches missed.">                        } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1090">                            return new HitData(Mech.LOC_CLEG);</span>
                        } else {
<span class="nc" id="L1092">                            return new HitData(Mech.LOC_LLEG);</span>
                        }
                    case 4:
                    case 5:
<span class="nc" id="L1096">                        return new HitData(Mech.LOC_LARM);</span>
                    case 7:
<span class="nc" id="L1098">                        return new HitData(Mech.LOC_LT);</span>
                    case 8:
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                        if (game.getOptions().booleanOption(</span>
                                OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)) {
<span class="nc" id="L1102">                            return new HitData(Mech.LOC_CT, true);</span>
                        }
<span class="nc" id="L1104">                        return new HitData(Mech.LOC_CT);</span>
                    case 9:
<span class="nc bnc" id="L1106" title="All 2 branches missed.">                        if (game.getOptions().booleanOption(</span>
                                OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)) {
<span class="nc" id="L1108">                            return new HitData(Mech.LOC_RT, true);</span>
                        }
<span class="nc" id="L1110">                        return new HitData(Mech.LOC_RT);</span>
                    case 10:
<span class="nc" id="L1112">                        return new HitData(Mech.LOC_RARM);</span>
                    case 12:
<span class="nc bnc" id="L1114" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1115" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1117">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1118">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1120">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1121">                            return result;</span>
                        } // if
<span class="nc" id="L1123">                        return new HitData(Mech.LOC_HEAD);</span>
                }
<span class="nc bnc" id="L1125" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_RIGHT) {</span>
                // normal right side hits
<span class="nc bnc" id="L1127" title="All 9 branches missed.">                switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L1129" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining() &amp;&amp; getCrew()</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">                                .getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L1131" title="All 2 branches missed.">                            &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L1132">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1133">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1135">                            result.setUndoneLocation(tac(table, side,</span>
                                                         Mech.LOC_RT, cover, false));
<span class="nc" id="L1137">                            return result;</span>
                        } // if
<span class="nc" id="L1139">                        return tac(table, side, Mech.LOC_RT, cover, false);</span>
                    case 3:
                    case 6:
                    case 11:
<span class="nc" id="L1143">                        int legRoll = Compute.d6() - 1;</span>
<span class="nc bnc" id="L1144" title="All 2 branches missed.">                        if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1145">                            return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">                        } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1147">                            return new HitData(Mech.LOC_CLEG);</span>
                        } else {
<span class="nc" id="L1149">                            return new HitData(Mech.LOC_LLEG);</span>
                        }
                    case 4:
                    case 5:
<span class="nc" id="L1153">                        return new HitData(Mech.LOC_RARM);</span>
                    case 7:
<span class="nc" id="L1155">                        return new HitData(Mech.LOC_RT);</span>
                    case 8:
<span class="nc bnc" id="L1157" title="All 2 branches missed.">                        if (game.getOptions().booleanOption(</span>
                                OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)) {
<span class="nc" id="L1159">                            return new HitData(Mech.LOC_CT, true);</span>
                        }
<span class="nc" id="L1161">                        return new HitData(Mech.LOC_CT);</span>
                    case 9:
<span class="nc bnc" id="L1163" title="All 2 branches missed.">                        if (game.getOptions().booleanOption(</span>
                                OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)) {
<span class="nc" id="L1165">                            return new HitData(Mech.LOC_LT, true);</span>
                        }
<span class="nc" id="L1167">                        return new HitData(Mech.LOC_LT);</span>
                    case 10:
<span class="nc" id="L1169">                        return new HitData(Mech.LOC_LARM);</span>
                    case 12:
<span class="nc bnc" id="L1171" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1172" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1174">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1175">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1177">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1178">                            return result;</span>
                        } // if
<span class="nc" id="L1180">                        return new HitData(Mech.LOC_HEAD);</span>
                }
<span class="nc bnc" id="L1182" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_REAR) {</span>
                // normal rear hits
<span class="nc bnc" id="L1184" title="All 2 branches missed.">                if (game.getOptions().booleanOption(</span>
                        OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)
<span class="nc bnc" id="L1186" title="All 2 branches missed.">                    &amp;&amp; isProne()) {</span>
<span class="nc bnc" id="L1187" title="All 9 branches missed.">                    switch (roll) {</span>
                        case 2:
<span class="nc bnc" id="L1189" title="All 2 branches missed.">                            if ((getCrew().hasEdgeRemaining() &amp;&amp; getCrew()</span>
<span class="nc" id="L1190">                                    .getOptions()</span>
<span class="nc bnc" id="L1191" title="All 2 branches missed.">                                    .booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L1192" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(</span>
                                    OptionsConstants.ADVCOMBAT_NO_TAC)) {
<span class="nc" id="L1194">                                getCrew().decreaseEdge();</span>
<span class="nc" id="L1195">                                HitData result = rollHitLocation(table, side,</span>
                                                                 aimedLocation, aimingMode, cover);
<span class="nc" id="L1197">                                result.setUndoneLocation(tac(table, side,</span>
                                                             Mech.LOC_CT, cover, true));
<span class="nc" id="L1199">                                return result;</span>
                            } // if
<span class="nc" id="L1201">                            return tac(table, side, Mech.LOC_CT, cover, true);</span>
                        case 3:
<span class="nc" id="L1203">                            return new HitData(Mech.LOC_RARM, true);</span>
                        case 4:
                        case 5:
                        case 9:
                        case 10:
<span class="nc" id="L1208">                            int legRoll = Compute.d6();</span>
<span class="nc bnc" id="L1209" title="All 2 branches missed.">                            if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1210">                                return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1211" title="All 2 branches missed.">                            } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1212">                                return new HitData(Mech.LOC_CLEG);</span>
                            } else {
<span class="nc" id="L1214">                                return new HitData(Mech.LOC_LLEG);</span>
                            }
                        case 6:
<span class="nc" id="L1217">                            return new HitData(Mech.LOC_RT, true);</span>
                        case 7:
<span class="nc" id="L1219">                            return new HitData(Mech.LOC_CT, true);</span>
                        case 8:
<span class="nc" id="L1221">                            return new HitData(Mech.LOC_LT, true);</span>
                        case 11:
<span class="nc" id="L1223">                            return new HitData(Mech.LOC_LARM, true);</span>
                        case 12:
<span class="nc bnc" id="L1225" title="All 2 branches missed.">                            if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1226" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                    &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1228">                                getCrew().decreaseEdge();</span>
<span class="nc" id="L1229">                                HitData result = rollHitLocation(table, side,</span>
                                                                 aimedLocation, aimingMode, cover);
<span class="nc" id="L1231">                                result.setUndoneLocation(new HitData(</span>
                                        Mech.LOC_HEAD, true));
<span class="nc" id="L1233">                                return result;</span>
                            } // if
<span class="nc" id="L1235">                            return new HitData(Mech.LOC_HEAD, true);</span>
                    }
                } else {
<span class="nc bnc" id="L1238" title="All 9 branches missed.">                    switch (roll) {</span>
                        case 2:
<span class="nc bnc" id="L1240" title="All 2 branches missed.">                            if ((getCrew().hasEdgeRemaining() &amp;&amp; getCrew()</span>
<span class="nc" id="L1241">                                    .getOptions()</span>
<span class="nc bnc" id="L1242" title="All 2 branches missed.">                                    .booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L1243" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(</span>
                                    OptionsConstants.ADVCOMBAT_NO_TAC)) {
<span class="nc" id="L1245">                                getCrew().decreaseEdge();</span>
<span class="nc" id="L1246">                                HitData result = rollHitLocation(table, side,</span>
                                                                 aimedLocation, aimingMode, cover);
<span class="nc" id="L1248">                                result.setUndoneLocation(tac(table, side,</span>
                                                             Mech.LOC_CT, cover, true));
<span class="nc" id="L1250">                                return result;</span>
                            } // if
<span class="nc" id="L1252">                            return tac(table, side, Mech.LOC_CT, cover, true);</span>
                        case 3:
                        case 4:
<span class="nc" id="L1255">                            return new HitData(Mech.LOC_RARM, true);</span>
                        case 5:
                        case 9:
<span class="nc" id="L1258">                            int legRoll = Compute.d6();</span>
<span class="nc bnc" id="L1259" title="All 2 branches missed.">                            if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1260">                                return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1261" title="All 2 branches missed.">                            } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1262">                                return new HitData(Mech.LOC_CLEG);</span>
                            } else {
<span class="nc" id="L1264">                                return new HitData(Mech.LOC_LLEG);</span>
                            }
                        case 6:
<span class="nc" id="L1267">                            return new HitData(Mech.LOC_RT, true);</span>
                        case 7:
<span class="nc" id="L1269">                            return new HitData(Mech.LOC_CT, true);</span>
                        case 8:
<span class="nc" id="L1271">                            return new HitData(Mech.LOC_LT, true);</span>
                        case 10:
                        case 11:
<span class="nc" id="L1274">                            return new HitData(Mech.LOC_LARM, true);</span>
                        case 12:
<span class="nc bnc" id="L1276" title="All 2 branches missed.">                            if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1277" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                    &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1279">                                getCrew().decreaseEdge();</span>
<span class="nc" id="L1280">                                HitData result = rollHitLocation(table, side,</span>
                                                                 aimedLocation, aimingMode, cover);
<span class="nc" id="L1282">                                result.setUndoneLocation(new HitData(</span>
                                        Mech.LOC_HEAD, true));
<span class="nc" id="L1284">                                return result;</span>
                            } // if
<span class="nc" id="L1286">                            return new HitData(Mech.LOC_HEAD, true);</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L1291" title="All 2 branches missed.">        if (table == ToHitData.HIT_PUNCH) {</span>
<span class="nc" id="L1292">            roll = Compute.d6(1);</span>
            try {
<span class="nc" id="L1294">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1295">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1296" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1297">                    pw.print(table);</span>
<span class="nc" id="L1298">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1299">                    pw.print(side);</span>
<span class="nc" id="L1300">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1301">                    pw.println(roll);</span>
                }
<span class="nc" id="L1303">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1304">                thrown.printStackTrace();</span>
<span class="nc" id="L1305">            }</span>
<span class="nc bnc" id="L1306" title="All 2 branches missed.">            if (side == ToHitData.SIDE_FRONT) {</span>
                // front punch hits
<span class="nc bnc" id="L1308" title="All 7 branches missed.">                switch (roll) {</span>
                    case 1:
<span class="nc" id="L1310">                        return new HitData(Mech.LOC_LARM);</span>
                    case 2:
<span class="nc" id="L1312">                        return new HitData(Mech.LOC_LT);</span>
                    case 3:
<span class="nc" id="L1314">                        return new HitData(Mech.LOC_CT);</span>
                    case 4:
<span class="nc" id="L1316">                        return new HitData(Mech.LOC_RT);</span>
                    case 5:
<span class="nc" id="L1318">                        return new HitData(Mech.LOC_RARM);</span>
                    case 6:
<span class="nc bnc" id="L1320" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1321" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1323">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1324">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1326">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1327">                            return result;</span>
                        } // if
<span class="nc" id="L1329">                        return new HitData(Mech.LOC_HEAD);</span>
                }
            }
<span class="nc bnc" id="L1332" title="All 2 branches missed.">            if (side == ToHitData.SIDE_LEFT) {</span>
                // left side punch hits
<span class="nc bnc" id="L1334" title="All 5 branches missed.">                switch (roll) {</span>
                    case 1:
                    case 2:
<span class="nc" id="L1337">                        return new HitData(Mech.LOC_LT);</span>
                    case 3:
<span class="nc" id="L1339">                        return new HitData(Mech.LOC_CT);</span>
                    case 4:
                    case 5:
<span class="nc" id="L1342">                        return new HitData(Mech.LOC_LARM);</span>
                    case 6:
<span class="nc bnc" id="L1344" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1345" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1347">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1348">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1350">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1351">                            return result;</span>
                        } // if
<span class="nc" id="L1353">                        return new HitData(Mech.LOC_HEAD);</span>
                }
            }
<span class="nc bnc" id="L1356" title="All 2 branches missed.">            if (side == ToHitData.SIDE_RIGHT) {</span>
                // right side punch hits
<span class="nc bnc" id="L1358" title="All 5 branches missed.">                switch (roll) {</span>
                    case 1:
                    case 2:
<span class="nc" id="L1361">                        return new HitData(Mech.LOC_RT);</span>
                    case 3:
<span class="nc" id="L1363">                        return new HitData(Mech.LOC_CT);</span>
                    case 4:
                    case 5:
<span class="nc" id="L1366">                        return new HitData(Mech.LOC_RARM);</span>
                    case 6:
<span class="nc bnc" id="L1368" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1369" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1371">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1372">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1374">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L1375">                            return result;</span>
                        } // if
<span class="nc" id="L1377">                        return new HitData(Mech.LOC_HEAD);</span>
                }
            }
<span class="nc bnc" id="L1380" title="All 2 branches missed.">            if (side == ToHitData.SIDE_REAR) {</span>
                // rear punch hits
<span class="nc bnc" id="L1382" title="All 7 branches missed.">                switch (roll) {</span>
                    case 1:
<span class="nc" id="L1384">                        return new HitData(Mech.LOC_LARM, true);</span>
                    case 2:
<span class="nc" id="L1386">                        return new HitData(Mech.LOC_LT, true);</span>
                    case 3:
<span class="nc" id="L1388">                        return new HitData(Mech.LOC_CT, true);</span>
                    case 4:
<span class="nc" id="L1390">                        return new HitData(Mech.LOC_RT, true);</span>
                    case 5:
<span class="nc" id="L1392">                        return new HitData(Mech.LOC_RARM, true);</span>
                    case 6:
<span class="nc bnc" id="L1394" title="All 2 branches missed.">                        if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1395" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(</span>
                                &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1397">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L1398">                            HitData result = rollHitLocation(table, side,</span>
                                                             aimedLocation, aimingMode, cover);
<span class="nc" id="L1400">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD,</span>
                                                                 true));
<span class="nc" id="L1402">                            return result;</span>
                        } // if
<span class="nc" id="L1404">                        return new HitData(Mech.LOC_HEAD, true);</span>
                }
            }
        }
<span class="nc bnc" id="L1408" title="All 2 branches missed.">        if (table == ToHitData.HIT_KICK) {</span>
<span class="nc" id="L1409">            roll = Compute.d6(1);</span>
            try {
<span class="nc" id="L1411">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1412">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1413" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1414">                    pw.print(table);</span>
<span class="nc" id="L1415">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1416">                    pw.print(side);</span>
<span class="nc" id="L1417">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1418">                    pw.println(roll);</span>
                }
<span class="nc" id="L1420">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1421">                thrown.printStackTrace();</span>
<span class="nc" id="L1422">            }</span>
<span class="nc bnc" id="L1423" title="All 4 branches missed.">            if ((side == ToHitData.SIDE_FRONT) || (side == ToHitData.SIDE_REAR)) {</span>
                // front/rear kick hits
<span class="nc bnc" id="L1425" title="All 4 branches missed.">                switch (roll) {</span>
                    case 1:
                    case 2:
<span class="nc bnc" id="L1428" title="All 2 branches missed.">                        return new HitData(Mech.LOC_RLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
                    case 3:
                    case 4:
<span class="nc bnc" id="L1432" title="All 2 branches missed.">                        return new HitData(Mech.LOC_CLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
                    case 5:
                    case 6:
<span class="nc bnc" id="L1436" title="All 2 branches missed.">                        return new HitData(Mech.LOC_LLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
                }
            }
<span class="nc bnc" id="L1440" title="All 2 branches missed.">            if (side == ToHitData.SIDE_LEFT) {</span>
<span class="nc" id="L1441">                int legRoll = Compute.d6() + 1;</span>
<span class="nc bnc" id="L1442" title="All 2 branches missed.">                if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1443">                    return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1444" title="All 2 branches missed.">                } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1445">                    return new HitData(Mech.LOC_CLEG);</span>
                } else {
<span class="nc" id="L1447">                    return new HitData(Mech.LOC_LLEG);</span>
                }
            }
<span class="nc bnc" id="L1450" title="All 2 branches missed.">            if (side == ToHitData.SIDE_RIGHT) {</span>
<span class="nc" id="L1451">                int legRoll = Compute.d6() - 1;</span>
<span class="nc bnc" id="L1452" title="All 2 branches missed.">                if (legRoll &lt;= 2) {</span>
<span class="nc" id="L1453">                    return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L1454" title="All 2 branches missed.">                } else if (legRoll &lt;= 4) {</span>
<span class="nc" id="L1455">                    return new HitData(Mech.LOC_CLEG);</span>
                } else {
<span class="nc" id="L1457">                    return new HitData(Mech.LOC_LLEG);</span>
                }
            }
        }
<span class="nc bnc" id="L1461" title="All 4 branches missed.">        if ((table == ToHitData.HIT_SWARM)</span>
            || (table == ToHitData.HIT_SWARM_CONVENTIONAL)) {
<span class="nc" id="L1463">            roll = Compute.d6(2);</span>
            int effects;
<span class="nc bnc" id="L1465" title="All 2 branches missed.">            if (table == ToHitData.HIT_SWARM_CONVENTIONAL) {</span>
<span class="nc" id="L1466">                effects = HitData.EFFECT_NONE;</span>
            } else {
<span class="nc" id="L1468">                effects = HitData.EFFECT_CRITICAL;</span>
            }
            try {
<span class="nc" id="L1471">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1472">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1473" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1474">                    pw.print(table);</span>
<span class="nc" id="L1475">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1476">                    pw.print(side);</span>
<span class="nc" id="L1477">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1478">                    pw.println(roll);</span>
                }
<span class="nc" id="L1480">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1481">                thrown.printStackTrace();</span>
<span class="nc" id="L1482">            }</span>
            // Swarm attack locations.
<span class="nc bnc" id="L1484" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc bnc" id="L1486" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1487" title="All 2 branches missed.">                        &amp;&amp; getCrew().getOptions().booleanOption(</span>
                            &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1489">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L1490">                        HitData result = rollHitLocation(table, side,</span>
                                                         aimedLocation, aimingMode, cover);
<span class="nc" id="L1492">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD,</span>
                                                             false, effects));
<span class="nc" id="L1494">                        return result;</span>
                    } // if
<span class="nc" id="L1496">                    return new HitData(Mech.LOC_HEAD, false, effects);</span>
                case 3:
<span class="nc" id="L1498">                    return new HitData(Mech.LOC_CT, true, effects);</span>
                case 4:
<span class="nc" id="L1500">                    return new HitData(Mech.LOC_RT, true, effects);</span>
                case 5:
<span class="nc" id="L1502">                    return new HitData(Mech.LOC_RT, false, effects);</span>
                case 6:
<span class="nc" id="L1504">                    return new HitData(Mech.LOC_RARM, false, effects);</span>
                case 7:
<span class="nc" id="L1506">                    return new HitData(Mech.LOC_CT, false, effects);</span>
                case 8:
<span class="nc" id="L1508">                    return new HitData(Mech.LOC_LARM, false, effects);</span>
                case 9:
<span class="nc" id="L1510">                    return new HitData(Mech.LOC_LT, false, effects);</span>
                case 10:
<span class="nc" id="L1512">                    return new HitData(Mech.LOC_LT, true, effects);</span>
                case 11:
<span class="nc" id="L1514">                    return new HitData(Mech.LOC_CT, true, effects);</span>
                case 12:
<span class="nc bnc" id="L1516" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1517" title="All 2 branches missed.">                        &amp;&amp; getCrew().getOptions().booleanOption(</span>
                            &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1519">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L1520">                        HitData result = rollHitLocation(table, side,</span>
                                                         aimedLocation, aimingMode, cover);
<span class="nc" id="L1522">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD,</span>
                                                             false, effects));
<span class="nc" id="L1524">                        return result;</span>
                    } // if
<span class="nc" id="L1526">                    return new HitData(Mech.LOC_HEAD, false, effects);</span>
            }
        }
<span class="nc bnc" id="L1529" title="All 2 branches missed.">        if (table == ToHitData.HIT_ABOVE) {</span>
<span class="nc" id="L1530">            roll = Compute.d6(1);</span>
            try {
<span class="nc" id="L1532">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1533">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1534" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1535">                    pw.print(table);</span>
<span class="nc" id="L1536">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1537">                    pw.print(side);</span>
<span class="nc" id="L1538">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1539">                    pw.println(roll);</span>
                }
<span class="nc" id="L1541">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1542">                thrown.printStackTrace();</span>
<span class="nc" id="L1543">            }</span>
            // Hits from above.
<span class="nc bnc" id="L1545" title="All 7 branches missed.">            switch (roll) {</span>
                case 1:
<span class="nc bnc" id="L1547" title="All 2 branches missed.">                    return new HitData(Mech.LOC_LARM,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 2:
<span class="nc bnc" id="L1550" title="All 2 branches missed.">                    return new HitData(Mech.LOC_LT,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 3:
<span class="nc bnc" id="L1553" title="All 2 branches missed.">                    return new HitData(Mech.LOC_CT,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 4:
<span class="nc bnc" id="L1556" title="All 2 branches missed.">                    return new HitData(Mech.LOC_RT,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 5:
<span class="nc bnc" id="L1559" title="All 2 branches missed.">                    return new HitData(Mech.LOC_RARM,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 6:
<span class="nc bnc" id="L1562" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L1563" title="All 2 branches missed.">                        &amp;&amp; getCrew().getOptions().booleanOption(</span>
                            &quot;edge_when_headhit&quot;)) {
<span class="nc" id="L1565">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L1566">                        HitData result = rollHitLocation(table, side,</span>
                                                         aimedLocation, aimingMode, cover);
<span class="nc bnc" id="L1568" title="All 2 branches missed.">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD,</span>
                                                             (side == ToHitData.SIDE_REAR)));
<span class="nc" id="L1570">                        return result;</span>
                    } // if
<span class="nc bnc" id="L1572" title="All 2 branches missed.">                    return new HitData(Mech.LOC_HEAD,</span>
                                       (side == ToHitData.SIDE_REAR));
            }
        }
<span class="nc bnc" id="L1576" title="All 2 branches missed.">        if (table == ToHitData.HIT_BELOW) {</span>
<span class="nc" id="L1577">            roll = Compute.d6(1);</span>
            try {
<span class="nc" id="L1579">                PrintWriter pw = PreferenceManager.getClientPreferences()</span>
<span class="nc" id="L1580">                                                  .getMekHitLocLog();</span>
<span class="nc bnc" id="L1581" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L1582">                    pw.print(table);</span>
<span class="nc" id="L1583">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1584">                    pw.print(side);</span>
<span class="nc" id="L1585">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L1586">                    pw.println(roll);</span>
                }
<span class="nc" id="L1588">            } catch (Throwable thrown) {</span>
<span class="nc" id="L1589">                thrown.printStackTrace();</span>
<span class="nc" id="L1590">            }</span>
            // Hits from below.
<span class="nc bnc" id="L1592" title="All 4 branches missed.">            switch (roll) {</span>
                case 1:
                case 2:
                case 5:
                case 6:
<span class="nc" id="L1597">                    int legRoll = Compute.d6();</span>
<span class="nc bnc" id="L1598" title="All 2 branches missed.">                    if (legRoll &lt;= 2) {</span>
<span class="nc bnc" id="L1599" title="All 2 branches missed.">                        return new HitData(Mech.LOC_RLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
<span class="nc bnc" id="L1601" title="All 2 branches missed.">                    } else if (legRoll &lt;= 4) {</span>
<span class="nc bnc" id="L1602" title="All 2 branches missed.">                        return new HitData(Mech.LOC_CLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
                    } else {
<span class="nc bnc" id="L1605" title="All 2 branches missed.">                        return new HitData(Mech.LOC_LLEG,</span>
                                           (side == ToHitData.SIDE_REAR));
                    }
                case 3:
<span class="nc bnc" id="L1609" title="All 2 branches missed.">                    return new HitData(Mech.LOC_LT,</span>
                                       (side == ToHitData.SIDE_REAR));
                case 4:
<span class="nc bnc" id="L1612" title="All 2 branches missed.">                    return new HitData(Mech.LOC_RT,</span>
                                       (side == ToHitData.SIDE_REAR));
            }
        }
<span class="nc" id="L1616">        return null;</span>
    }

    /**
     * Can this mech torso twist in the given direction?
     */
    @Override
    public boolean isValidSecondaryFacing(int dir) {
<span class="nc" id="L1624">        return canChangeSecondaryFacing();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>