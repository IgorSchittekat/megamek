<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Engine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">Engine.java</span></div><h1>Engine.java</h1><pre class="source lang-java linenums">/*
 * MegaMek -
 * Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

/*
 * Author: Reinhard Vicinus
 */

package megamek.common;

import java.io.Serializable;

/**
 * This class represents an engine, such as those driving mechs.
 */
public class Engine implements Serializable, ITechnology {
    /**
     *
     */
    private static final long serialVersionUID = -246032529363109609L;

<span class="fc" id="L33">    public static final double[] ENGINE_RATINGS = { 0.0, 0.25, 0.5, 0.5,</span>
            0.5, 0.5, 1.0, 1.0, 1.0, 1.0, 1.5, 1.5, 1.5, 2.0, 2.0,
            2.0, 2.5, 2.5, 3.0, 3.0, 3.0, 3.5, 3.5, 4.0, 4.0, 4.0,
            4.5, 4.5, 5.0, 5.0, 5.5, 5.5, 6.0, 6.0, 6.0, 7.0, 7.0,
            7.5, 7.5, 8.0, 8.5,

            8.5, 9.0, 9.5, 10.0, 10.0, 10.5, 11.0, 11.5, 12.0, 12.5,
            13.0, 13.5, 14.0, 14.5, 15.5, 16.0, 16.5, 17.5, 18.0,
            19.0, 19.5, 20.5, 21.5, 22.5, 23.5, 24.5, 25.5, 27.0,
            28.5, 29.5, 31.5, 33.0, 34.5, 36.5, 38.5, 41.0, 43.5,
            46.0, 49.0, 52.5,

            56.5, 61.0, 66.5, 72.5, 79.5, 87.5, 97.0, 107.5, 119.5,
            133.5, 150.0, 168.5, 190.0, 214.5, 243.0, 275.5, 313.0,
            356.0, 405.5, 462.5 };
    
  
    // flags
    public static final int CLAN_ENGINE = 0x1;
    public static final int TANK_ENGINE = 0x2;
    public static final int LARGE_ENGINE = 0x4;
    public static final int SUPERHEAVY_ENGINE = 0x8;
    public static final int SUPPORT_VEE_ENGINE = 0x10;

    // types
    public static final int COMBUSTION_ENGINE = 0;
    public static final int NORMAL_ENGINE = 1;
    public static final int XL_ENGINE = 2;
    public static final int XXL_ENGINE = 3;
    public static final int FUEL_CELL = 4;
    public static final int LIGHT_ENGINE = 5;
    public static final int COMPACT_ENGINE = 6;
    public static final int FISSION = 7;
    public static final int NONE = 8;
    public static final int MAGLEV = 9;
    public static final int STEAM = 10;
    public static final int BATTERY = 11;
    public static final int SOLAR = 12;
    public static final int EXTERNAL = 13;
    private static final int NUM_ENGINE_TYPES = 14;

    /** Keys for retrieving engine name from {@link Messages} */
<span class="fc" id="L75">    private static final String[] TYPE_KEYS = {</span>
            &quot;ICE&quot;, &quot;Fusion&quot;, &quot;XL&quot;, &quot;XXL&quot;, &quot;FuelCell&quot;, &quot;Light&quot;, &quot;Compact&quot;, &quot;Fission&quot;, &quot;None&quot;,
            &quot;MagLev&quot;, &quot;Steam&quot;, &quot;Battery&quot;, &quot;Solar&quot;, &quot;External&quot;
    };
    
    //These are the SUPPORT VEHICLE ENGINE WEIGHT MULTIPLIERS from TM PG 127
    //The other engine types are assumed to have a value of ) in the array
    //if not listed.
<span class="fc" id="L83">    private static final double[][] SV_ENGINE_RATINGS = new double[NUM_ENGINE_TYPES][6];</span>
    static { 
<span class="fc" id="L85">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_A] = 4.0;</span>
<span class="fc" id="L86">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_B] = 3.5;</span>
<span class="fc" id="L87">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_C] = 3.0;</span>
<span class="fc" id="L88">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_D] = 2.8;</span>
<span class="fc" id="L89">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_E] = 2.6;</span>
<span class="fc" id="L90">        SV_ENGINE_RATINGS[STEAM][EquipmentType.RATING_F] = 2.5;</span>
        
<span class="fc" id="L92">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L93">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_B] = 3.0;</span>
<span class="fc" id="L94">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_C] = 2.0;</span>
<span class="fc" id="L95">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_D] = 1.5;</span>
<span class="fc" id="L96">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_E] = 1.3;</span>
<span class="fc" id="L97">        SV_ENGINE_RATINGS[COMBUSTION_ENGINE][EquipmentType.RATING_F] = 1.0;</span>
        
<span class="fc" id="L99">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L100">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L101">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_C] = 1.5;</span>
<span class="fc" id="L102">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_D] = 1.2;</span>
<span class="fc" id="L103">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_E] = 1.0;</span>
<span class="fc" id="L104">        SV_ENGINE_RATINGS[BATTERY][EquipmentType.RATING_F] = 0.8;</span>
        
<span class="fc" id="L106">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L107">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L108">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_C] = 1.2;</span>
<span class="fc" id="L109">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_D] = 1.0;</span>
<span class="fc" id="L110">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_E] = 0.9;</span>
<span class="fc" id="L111">        SV_ENGINE_RATINGS[FUEL_CELL][EquipmentType.RATING_F] = 0.7;</span>
        
<span class="fc" id="L113">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L114">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L115">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_C] = 5.0;</span>
<span class="fc" id="L116">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_D] = 4.5;</span>
<span class="fc" id="L117">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_E] = 4.0;</span>
<span class="fc" id="L118">        SV_ENGINE_RATINGS[SOLAR][EquipmentType.RATING_F] = 3.5;</span>
        
<span class="fc" id="L120">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L121">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L122">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_C] = 1.75;</span>
<span class="fc" id="L123">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_D] = 1.5;</span>
<span class="fc" id="L124">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_E] = 1.4;</span>
<span class="fc" id="L125">        SV_ENGINE_RATINGS[FISSION][EquipmentType.RATING_F] = 1.3;</span>

<span class="fc" id="L127">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L128">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L129">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_C] = 1.5;</span>
<span class="fc" id="L130">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_D] = 1.0;</span>
<span class="fc" id="L131">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_E] = 0.75;</span>
<span class="fc" id="L132">        SV_ENGINE_RATINGS[NORMAL_ENGINE][EquipmentType.RATING_F] = 0.5;</span>

<span class="fc" id="L134">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L135">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_B] = 0.0;</span>
<span class="fc" id="L136">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_C] = 0.0;</span>
<span class="fc" id="L137">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_D] = 0.0;</span>
<span class="fc" id="L138">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_E] = 0.0;</span>
<span class="fc" id="L139">        SV_ENGINE_RATINGS[NONE][EquipmentType.RATING_F] = 0.0;</span>

<span class="fc" id="L141">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_A] = 0.0;</span>
<span class="fc" id="L142">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_B] = 1.4;</span>
<span class="fc" id="L143">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_C] = 1.0;</span>
<span class="fc" id="L144">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_D] = 0.8;</span>
<span class="fc" id="L145">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_E] = 0.7;</span>
<span class="fc" id="L146">        SV_ENGINE_RATINGS[EXTERNAL][EquipmentType.RATING_F] = 0.6;</span>
    }

    public boolean engineValid;
    private int engineRating;
    private int engineType;
    private int engineFlags;
<span class="fc" id="L153">    private int baseChassisHeatSinks = -1;</span>
<span class="fc" id="L154">    public StringBuffer problem = new StringBuffer(&quot;Illegal engine: &quot;);</span>

    /**
     * The constructor takes the rating of the engine, the type of engine and
     * any flags. Engine ratings are divided by the weight of the mech to get
     * they walk MP.
     *
     * @param engineRating the rating of the engine
     * @param engineType the type of the engine, either combustion or a type of
     *            fusion engine.
     * @param engineFlags Wether the engine is a tank engine, a clan engine, or
     *            large engine, or any combination of those.
     */
<span class="fc" id="L167">    public Engine(int engineRating, int engineType, int engineFlags) {</span>
<span class="fc" id="L168">        engineValid = true;</span>
<span class="fc" id="L169">        this.engineRating = engineRating;</span>
<span class="fc" id="L170">        this.engineType = engineType;</span>
<span class="fc" id="L171">        this.engineFlags = engineFlags;</span>

<span class="pc bpc" id="L173" title="1 of 2 branches missed.">        if (!isValidEngine()) {</span>
<span class="nc" id="L174">            engineValid = false;</span>
<span class="nc" id="L175">            this.engineRating = 0;</span>
<span class="nc" id="L176">            this.engineType = -1;</span>
<span class="nc" id="L177">            this.engineFlags = -1;</span>
        }
<span class="fc" id="L179">    }</span>

    /**
     * returns true if the engine has the flag set, false otherwise
     *
     * @param flag the flag to check for.
     * @return true if the flag is set.
     */
    public boolean hasFlag(int flag) {
<span class="pc bpc" id="L188" title="1 of 2 branches missed.">        return (engineFlags &amp; flag) != 0;</span>
    }

    /**
     * Sanity checks the engine, no negative ratings, and similar checks.
     *
     * @return true if the engine is useable.
     */
    private boolean isValidEngine() {
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">        if (hasFlag(~(CLAN_ENGINE | TANK_ENGINE | LARGE_ENGINE</span>
                | SUPERHEAVY_ENGINE | SUPPORT_VEE_ENGINE))) {
<span class="nc" id="L199">            problem.append(&quot;Flags:&quot;).append(engineFlags);</span>
<span class="nc" id="L200">            return false;</span>
        }
        
<span class="pc bpc" id="L203" title="21 of 22 branches missed.">        if (hasFlag(SUPPORT_VEE_ENGINE) &amp;&amp; (engineType != STEAM)</span>
                &amp;&amp; (engineType != COMBUSTION_ENGINE) &amp;&amp; (engineType != BATTERY)
                &amp;&amp; (engineType != FUEL_CELL) &amp;&amp; (engineType != SOLAR)
                &amp;&amp; (engineType != FISSION) &amp;&amp; (engineType != NORMAL_ENGINE)
                &amp;&amp; (engineType != MAGLEV) &amp;&amp; (engineType != NONE)
                &amp;&amp; (engineType != EXTERNAL)) {
<span class="nc" id="L209">            problem.append(&quot;Invalid Engine type for support vehicle engines!&quot;);</span>
<span class="nc" id="L210">            return false;</span>
        }

<span class="pc bpc" id="L213" title="2 of 4 branches missed.">        if ((((int) Math.ceil(engineRating / 5) &gt; ENGINE_RATINGS.length)</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">                || (engineRating &lt; 0)) &amp;&amp; !hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L215">            problem.append(&quot;Rating:&quot;).append(engineRating);</span>
<span class="nc" id="L216">            return false;</span>
        }
<span class="pc bpc" id="L218" title="3 of 4 branches missed.">        if ((engineRating &gt; 400) &amp;&amp; !hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L219">            engineFlags |= LARGE_ENGINE;</span>
        }

<span class="pc bpc" id="L222" title="3 of 4 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
            case NORMAL_ENGINE:
            case XL_ENGINE:
            case XXL_ENGINE:
            case FUEL_CELL:
            case NONE:
            case MAGLEV:
            case BATTERY:
            case SOLAR:
            case STEAM:
            case EXTERNAL:
<span class="fc" id="L234">                break;</span>
            case COMPACT_ENGINE:
<span class="nc bnc" id="L236" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L237">                    problem.append(Messages</span>
<span class="nc" id="L238">                            .getString(&quot;Engine.invalidCompactLarge&quot;));</span>
<span class="nc" id="L239">                    return false;</span>
                }
                break;
            case LIGHT_ENGINE:
            case FISSION:
<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (hasFlag(CLAN_ENGINE)) {</span>
<span class="nc" id="L245">                    problem.append(Messages</span>
<span class="nc" id="L246">                            .getString(&quot;Engine.invalidSphereOnly&quot;));</span>
<span class="nc" id="L247">                    return false;</span>
                }
                break;
            default:
<span class="nc" id="L251">                problem.append(&quot;Type:&quot;).append(engineType);</span>
<span class="nc" id="L252">                return false;</span>
        }

<span class="fc" id="L255">        return true;</span>
    }

    /**
     * Parses a string to find the engine type.
     *
     * @param type the string to parse
     * @return the type of the engine.
     */
    public static int getEngineTypeByString(String type) {
<span class="pc bpc" id="L265" title="1 of 2 branches missed.">        if (type.toLowerCase().contains(&quot;xxl&quot;)) {</span>
<span class="nc" id="L266">            return XXL_ENGINE;</span>
<span class="fc bfc" id="L267" title="All 2 branches covered.">        } else if (type.toLowerCase().contains(&quot;xl&quot;)) {</span>
<span class="fc" id="L268">            return XL_ENGINE;</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;light&quot;)) {</span>
<span class="nc" id="L270">            return LIGHT_ENGINE;</span>
<span class="pc bpc" id="L271" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;compact&quot;)) {</span>
<span class="nc" id="L272">            return COMPACT_ENGINE;</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;ice&quot;)) {</span>
<span class="nc" id="L274">            return COMBUSTION_ENGINE;</span>
<span class="pc bpc" id="L275" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;i.c.e.&quot;)) {</span>
<span class="nc" id="L276">            return COMBUSTION_ENGINE;</span>
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;fission&quot;)) {</span>
<span class="nc" id="L278">            return FISSION;</span>
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;fuel cell&quot;)) {</span>
<span class="nc" id="L280">            return FUEL_CELL;</span>
<span class="pc bpc" id="L281" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;fuel-cell&quot;)) {</span>
<span class="nc" id="L282">            return FUEL_CELL;</span>
<span class="pc bpc" id="L283" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;none&quot;)) {</span>
<span class="nc" id="L284">            return NONE;</span>
<span class="pc bpc" id="L285" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;maglev&quot;)) {</span>
<span class="nc" id="L286">            return MAGLEV;</span>
<span class="pc bpc" id="L287" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;steam&quot;)) {</span>
<span class="nc" id="L288">            return STEAM;</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;battery&quot;)) {</span>
<span class="nc" id="L290">            return BATTERY;</span>
<span class="pc bpc" id="L291" title="1 of 2 branches missed.">        } else if (type.toLowerCase().contains(&quot;solar&quot;)) {</span>
<span class="nc" id="L292">            return SOLAR;</span>
        } else {
<span class="fc" id="L294">            return NORMAL_ENGINE;</span>
        }
    }

    /**
     * returns true if and only if this engine is a fusion engine
     *
     * @return true if it is not an internal combustion engine.
     */
    public boolean isFusion() {
<span class="pc bpc" id="L304" title="9 of 18 branches missed.">        return (engineType != COMBUSTION_ENGINE) &amp;&amp; (engineType != FISSION) &amp;&amp; (engineType != FUEL_CELL)</span>
                &amp;&amp; (engineType != NONE) &amp;&amp; (engineType != BATTERY) &amp;&amp; (engineType != SOLAR)
                &amp;&amp; (engineType != STEAM) &amp;&amp; (engineType != MAGLEV) &amp;&amp; (engineType != EXTERNAL);
    }
 

    /**
     * Returns the weight of the engine in tons, rounded to the next highest half
     * ton.
     *
     * @return the weight of the engine.
     */
    public double getWeightEngine(Entity entity) {
<span class="fc" id="L317">        return getWeightEngine(entity, RoundWeight.STANDARD);</span>
    }

    /**
     * Returns the weight of the engine, rounded by roundWeight.
     *
     * @param roundWeight One of the rounding factors given in
     *            {@link megamek.common.verifier.TestEntity}.
     * @return the weight of the engine in tons.
     */
    public double getWeightEngine(Entity entity, RoundWeight roundWeight) {
        // Support Vehicles compute engine weight differently
<span class="pc bpc" id="L329" title="2 of 4 branches missed.">        if ((entity.isSupportVehicle() || hasFlag(SUPPORT_VEE_ENGINE))</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">                &amp;&amp; isValidEngine()) {</span>
<span class="nc" id="L331">            int mp = entity.getOriginalWalkMP();</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">            if (entity.getMovementMode().equals(EntityMovementMode.RAIL)</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">                    || entity.getMovementMode().equals(EntityMovementMode.MAGLEV)) {</span>
<span class="nc" id="L334">                mp = Math.max(0, mp - 2);</span>
            }
<span class="nc" id="L336">            double movementFactor = 4 + mp * mp;</span>
<span class="nc" id="L337">            double engineWeightMult = SV_ENGINE_RATINGS[engineType][entity</span>
<span class="nc" id="L338">                    .getEngineTechRating()];</span>
<span class="nc" id="L339">            double weight = entity.getBaseEngineValue() * movementFactor</span>
<span class="nc" id="L340">                    * engineWeightMult * entity.getWeight();</span>
            // Fusion engines have a minimum weight of 0.25t at D+ and 0.5t at C. Fission engines have
            // a minimum of 0.5t at all tech ratings.
<span class="nc bnc" id="L343" title="All 4 branches missed.">            if ((engineType == NORMAL_ENGINE) &amp;&amp; (entity.getEngineTechRating() &gt;= RATING_D)) {</span>
<span class="nc" id="L344">                weight = Math.max(weight, 0.25);</span>
<span class="nc bnc" id="L345" title="All 4 branches missed.">            } else if ((engineType == NORMAL_ENGINE) || (engineType == FISSION)) {</span>
<span class="nc" id="L346">                weight = Math.max(weight, 0.5);</span>
            }
            // Hovercraft have a minimum engine weight of 20% of the vehicle.
<span class="nc bnc" id="L349" title="All 2 branches missed.">            if (entity.getMovementMode().equals(EntityMovementMode.HOVER)) {</span>
<span class="nc" id="L350">                weight = Math.max(weight, entity.getWeight() * 0.2);</span>
            }
<span class="nc" id="L352">            return roundWeight.round(weight, entity);</span>
        }
        // Protomech engines with rating &lt; 40 use a special calculation
<span class="fc bfc" id="L355" title="All 4 branches covered.">        if (entity.hasETypeFlag(Entity.ETYPE_PROTOMECH) &amp;&amp; (engineRating &lt; 40)) {</span>
<span class="fc" id="L356">            return roundWeight.round(engineRating * 0.025, entity);</span>
        }
<span class="fc" id="L358">        double weight = ENGINE_RATINGS[(int) Math.ceil(engineRating / 5.0)];</span>
<span class="pc bpc" id="L359" title="9 of 10 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
<span class="nc" id="L361">                weight *= 2.0;</span>
<span class="nc" id="L362">                break;</span>
            case NORMAL_ENGINE:
<span class="fc" id="L364">                break;</span>
            case XL_ENGINE:
<span class="nc" id="L366">                weight *= 0.5;</span>
<span class="nc" id="L367">                break;</span>
            case LIGHT_ENGINE:
<span class="nc" id="L369">                weight *= 0.75;</span>
<span class="nc" id="L370">                break;</span>
            case XXL_ENGINE:
<span class="nc" id="L372">                weight /= 3;</span>
<span class="nc" id="L373">                break;</span>
            case COMPACT_ENGINE:
<span class="nc" id="L375">                weight *= 1.5;</span>
<span class="nc" id="L376">                break;</span>
            case FISSION:
<span class="nc" id="L378">                weight *= 1.75;</span>
<span class="nc" id="L379">                weight = Math.max(5, weight);</span>
<span class="nc" id="L380">                break;</span>
            case FUEL_CELL:
<span class="nc" id="L382">                weight *= 1.2;</span>
<span class="nc" id="L383">                break;</span>
            case NONE:
<span class="nc" id="L385">                return 0;</span>
        }
<span class="fc" id="L387">        weight = roundWeight.round(weight, entity);</span>

<span class="pc bpc" id="L389" title="5 of 6 branches missed.">        if (hasFlag(TANK_ENGINE) &amp;&amp; (isFusion() || (engineType == FISSION))) {</span>
<span class="nc" id="L390">            weight *= 1.5;</span>
        }
        
        
<span class="fc" id="L394">        double toReturn = roundWeight.round(weight, entity);</span>
        // hover have a minimum weight of 20%
<span class="pc bpc" id="L396" title="3 of 4 branches missed.">        if ((entity.getMovementMode() == EntityMovementMode.HOVER) &amp;&amp; (entity instanceof Tank)) {</span>
<span class="nc" id="L397">            toReturn = Math.max(roundWeight.round(entity.getWeight() / 5.0, entity), toReturn);</span>
        }
<span class="fc" id="L399">        return toReturn;</span>
    }

    /**
     * @return the number of heatsinks that fit weight-free into the engine
     */
    public int getWeightFreeEngineHeatSinks() {
        // Support Vee engines never provide free heat-sinks, TM pg 133
<span class="nc bnc" id="L407" title="All 2 branches missed.">        if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L408">            return 0;</span>
        }
<span class="nc bnc" id="L410" title="All 2 branches missed.">        if (isFusion()) {</span>
<span class="nc" id="L411">            return 10;</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">        } else if (engineType == FISSION) {</span>
<span class="nc" id="L413">            return 5;</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">        } else if (engineType == FUEL_CELL) {</span>
<span class="nc" id="L415">            return 1;</span>
        } else {
<span class="nc" id="L417">            return 0;</span>
        }

    }

    /**
     * Returns the number of heat sinks which can be built into the engine and
     * therefore don't require a critical slot.
     *
     * @param compact Whether this engine uses compact heat sinks or not.
     *
     * @return the maximum number of heat sinks built into the engine.
     */
    public int integralHeatSinkCapacity(boolean compact) {
<span class="pc bpc" id="L431" title="1 of 2 branches missed.">        if (compact) {</span>
<span class="nc" id="L432">            return (engineRating / 25) * 2;</span>
        }
        else {
<span class="fc" id="L435">            return engineRating / 25;</span>
        }
    }

    /**
     * Get the name of this engine, this is the localized name used in displays.
     * The name of an Engine is based on its type.
     *
     * @return the engine name.
     */
    public String getShortEngineName() {
<span class="nc bnc" id="L446" title="All 2 branches missed.">        if (engineType &lt; TYPE_KEYS.length) {</span>
<span class="nc" id="L447">            return String.format(&quot;%d%s&quot;, engineRating, Messages.getString(&quot;Engine.&quot; + TYPE_KEYS[engineType]));</span>
        } else {
<span class="nc" id="L449">            return Messages.getString(&quot;Engine.invalid&quot;);</span>
        }
    }

    /**
     * This returns a non-localized name of the engine, it's mostly used to
     * generate files.
     */
    // Don't localize the marked strings below since they are used in mech
    // file parsing.
    public String getEngineName() {
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">        if (!isValidEngine()) {</span>
<span class="nc" id="L461">            return Messages.getString(&quot;Engine.invalid&quot;);</span>
        }
<span class="fc" id="L463">        StringBuilder sb = new StringBuilder();</span>
<span class="pc bpc" id="L464" title="1 of 2 branches missed.">        if (!hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="fc" id="L465">            sb.append(engineRating);</span>
        }
<span class="pc bpc" id="L467" title="1 of 2 branches missed.">        if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L468">            sb.append(Messages.getString(&quot;Engine.Large&quot;));</span>
        }
<span class="fc" id="L470">        sb.append(Messages.getString(&quot;Engine.&quot; + TYPE_KEYS[engineType]));</span>
<span class="pc bpc" id="L471" title="1 of 2 branches missed.">        if (hasFlag(CLAN_ENGINE)) {</span>
<span class="nc" id="L472">            sb.append(Messages.getString(&quot;Engine.Clan&quot;));</span>
        }
<span class="pc bpc" id="L474" title="1 of 2 branches missed.">        if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L475">            sb.append(Messages.getString(&quot;Engine.SupportVehicle&quot;));</span>
<span class="pc bpc" id="L476" title="1 of 2 branches missed.">        } else if (hasFlag(TANK_ENGINE)) {</span>
<span class="nc" id="L477">            sb.append(Messages.getString(&quot;Engine.Vehicle&quot;));</span>
        }
<span class="fc" id="L479">        return sb.toString();</span>
    }

    /**
     * @return The rating of the engine
     */
    public int getRating() {
<span class="fc" id="L486">        return engineRating;</span>
    }

    /**
     * @return The slots taken up by the engine in the center torso.
     */
    public int[] getCenterTorsoCriticalSlots(int gyroType) {
<span class="nc bnc" id="L493" title="All 2 branches missed.">        if (engineType == COMPACT_ENGINE) {</span>
            int[] slots;
<span class="nc bnc" id="L495" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L496">                slots = new int[]{ 0, 1 };</span>
            } else {
<span class="nc" id="L498">                slots = new int[]{ 0, 1, 2 };</span>
            }
<span class="nc" id="L500">            return slots;</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">        } else if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">            if (gyroType == Mech.GYRO_COMPACT) {</span>
                int[] slots;
<span class="nc bnc" id="L504" title="All 2 branches missed.">                if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L505">                    slots = new int[]{ 0, 1, 2, 5 };</span>
                } else {
<span class="nc" id="L507">                    slots = new int[]{ 0, 1, 2, 5, 6, 7, 8, 9 };</span>
                }
<span class="nc" id="L509">                return slots;</span>
            }
            int[] slots;
<span class="nc bnc" id="L512" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L513">                slots = new int[]{ 0, 1, 2, 5 };</span>
            } else {
<span class="nc" id="L515">                slots = new int[]{ 0, 1, 2, 7, 8, 9, 10, 11 };</span>
            }
<span class="nc" id="L517">            return slots;</span>
        } else {
<span class="nc bnc" id="L519" title="All 2 branches missed.">            if (gyroType == Mech.GYRO_COMPACT) {</span>
                int[] slots;
<span class="nc bnc" id="L521" title="All 2 branches missed.">                if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L522">                    slots = new int[]{ 0, 1, 2 };</span>
                } else {
<span class="nc" id="L524">                    slots = new int[]{ 0, 1, 2, 5, 6, 7 };</span>
                }
<span class="nc" id="L526">                return slots;</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">            } else if (gyroType == Mech.GYRO_XL) {</span>
                int[] slots;
<span class="nc bnc" id="L529" title="All 2 branches missed.">                if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L530">                    slots = new int[]{ 0, 1, 2 };</span>
                } else {
<span class="nc" id="L532">                    slots = new int[]{ 0, 1, 2, 9, 10, 11 };</span>
                }
<span class="nc" id="L534">                return slots;</span>
            } else {
                int[] slots;
<span class="nc bnc" id="L537" title="All 2 branches missed.">                if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L538">                    slots = new int[]{ 0, 1, 2 };</span>
                } else {
<span class="nc" id="L540">                    slots = new int[]{ 0, 1, 2, 7, 8, 9 };</span>
                }
<span class="nc" id="L542">                return slots;</span>
            }
        }
    }

    /**
     * @return the engine criticals in the side torsos.
     */
    public int[] getSideTorsoCriticalSlots() {
<span class="nc bnc" id="L551" title="All 4 branches missed.">        if ((engineType == LIGHT_ENGINE)</span>
<span class="nc bnc" id="L552" title="All 2 branches missed.">                || ((engineType == XL_ENGINE) &amp;&amp; hasFlag(CLAN_ENGINE))) {</span>
            int[] slots;
<span class="nc bnc" id="L554" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L555">                slots = new int[]{ 0 };</span>
            } else {
<span class="nc" id="L557">                slots = new int[]{ 0, 1 };</span>
            }
<span class="nc" id="L559">            return slots;</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">        } else if (engineType == XL_ENGINE) {</span>
            int[] slots;
<span class="nc bnc" id="L562" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L563">                slots = new int[]{ 0, 1 };</span>
            } else {
<span class="nc" id="L565">                slots = new int[]{ 0, 1, 2 };</span>
            }
<span class="nc" id="L567">            return slots;</span>
<span class="nc bnc" id="L568" title="All 4 branches missed.">        } else if ((engineType == XXL_ENGINE) &amp;&amp; hasFlag(CLAN_ENGINE)) {</span>
            int[] slots;
<span class="nc bnc" id="L570" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L571">                slots = new int[]{ 0, 1 };</span>
            } else {
<span class="nc" id="L573">                slots = new int[]{ 0, 1, 2, 3 };</span>
            }
<span class="nc" id="L575">            return slots;</span>
<span class="nc bnc" id="L576" title="All 2 branches missed.">        } else if (engineType == XXL_ENGINE) {</span>
            int[] slots;
<span class="nc bnc" id="L578" title="All 2 branches missed.">            if (hasFlag(SUPERHEAVY_ENGINE)) {</span>
<span class="nc" id="L579">                slots = new int[]{ 0, 1, 2 };</span>
            } else {
<span class="nc" id="L581">                slots = new int[]{ 0, 1, 2, 3, 4, 5 };</span>
            }
<span class="nc" id="L583">            return slots;</span>
        } else {
<span class="nc" id="L585">            return new int[]{};</span>
        }
    }

    /**
     * @return the heat generated while the mech is standing still.
     */
    public int getStandingHeat() {
<span class="nc bnc" id="L593" title="All 2 branches missed.">        if (engineType == XXL_ENGINE) {</span>
<span class="nc" id="L594">            return 2;</span>
        }
<span class="nc" id="L596">        return 0;</span>
    }

    /**
     * @return the heat generated while the mech is walking.
     */
    public int getWalkHeat(Entity e) {
<span class="nc bnc" id="L603" title="All 3 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
            case FUEL_CELL:
<span class="nc" id="L606">                return 0;</span>
            case XXL_ENGINE:
<span class="nc" id="L608">                return 4;</span>
            default:
<span class="nc" id="L610">                return 1;</span>
        }
    }

    /**
     * @return the heat generated while the mech is running.
     */
    public int getRunHeat(Entity e) {
<span class="nc bnc" id="L618" title="All 3 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
            case FUEL_CELL:
<span class="nc" id="L621">                return 0;</span>
            case XXL_ENGINE:
<span class="nc" id="L623">                return 6;</span>
            default:
<span class="nc" id="L625">                return 2;</span>
        }
    }

    /**
     * @return the heat generated while the mech is sprinting.
     */
    public int getSprintHeat() {
<span class="nc bnc" id="L633" title="All 3 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
            case FUEL_CELL:
<span class="nc" id="L636">                return 0;</span>
            case XXL_ENGINE:
<span class="nc" id="L638">                return 9;</span>
            default:
<span class="nc" id="L640">                return 3;</span>
        }
    }

    /**
     * @return the heat generated while the mech is jumping.
     */
    public int getJumpHeat(int movedMP) {
<span class="nc bnc" id="L648" title="All 2 branches missed.">        if (engineType == XXL_ENGINE) {</span>
<span class="nc" id="L649">            return Math.max(6, movedMP * 2);</span>
        }
<span class="nc" id="L651">        return Math.max(3, movedMP);</span>
    }

    public double getBVMultiplier() {
<span class="nc" id="L655">        int sideCrits = getSideTorsoCriticalSlots().length;</span>
<span class="nc bnc" id="L656" title="All 2 branches missed.">        if (sideCrits &gt;= 6) {</span>
<span class="nc" id="L657">            return 0.25; // IS XXL</span>
<span class="nc bnc" id="L658" title="All 2 branches missed.">        } else if (sideCrits &gt;= 3) {</span>
<span class="nc" id="L659">            return 0.5; // IS XL, clan XXL, superheavy IS XXL, superheavy IS large XXL</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">        } else if (sideCrits &gt;= 2) {</span>
<span class="nc" id="L661">            return 0.75; // IS light, clan XL, superheavy clan XXL, superheavy clan large XXL</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">        } else if (sideCrits &gt;= 1) {</span>
<span class="nc" id="L663">            return 0.825; // superheavy IS Light, superheavy clan XL</span>
        } else {
<span class="nc" id="L665">            return 1; // standard, compact, ice, fuel cell, fission</span>
        }
    }

    public int getBaseCost() {
<span class="nc" id="L670">        int cost = 0;</span>
<span class="nc bnc" id="L671" title="All 10 branches missed.">        switch (engineType) {</span>
            case COMBUSTION_ENGINE:
<span class="nc" id="L673">                cost = 1250;</span>
<span class="nc" id="L674">                break;</span>
            case NORMAL_ENGINE:
<span class="nc" id="L676">                cost = 5000;</span>
<span class="nc" id="L677">                break;</span>
            case XL_ENGINE:
<span class="nc" id="L679">                cost = 20000;</span>
<span class="nc" id="L680">                break;</span>
            case XXL_ENGINE:
<span class="nc" id="L682">                cost = 100000;</span>
<span class="nc" id="L683">                break;</span>
            case COMPACT_ENGINE:
<span class="nc" id="L685">                cost = 10000;</span>
<span class="nc" id="L686">                break;</span>
            case LIGHT_ENGINE:
<span class="nc" id="L688">                cost = 15000;</span>
<span class="nc" id="L689">                break;</span>
            case FUEL_CELL:
<span class="nc" id="L691">                cost = 3500;</span>
<span class="nc" id="L692">                break;</span>
            case FISSION:
<span class="nc" id="L694">                cost = 7500;</span>
<span class="nc" id="L695">                break;</span>
            case NONE:
<span class="nc" id="L697">                cost = 0;</span>
                break;
            }
<span class="nc bnc" id="L700" title="All 2 branches missed.">        if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L701">            cost *= 2;</span>
        }
<span class="nc" id="L703">        return cost;</span>
    }

    /**
     * Values used for calculating the cost of a support vehicle engine. The engine cost in C-bills is
     * tonnage * 5,000 * type multiplier
     *
     * @param etype The engine type
     * @return      The type multiplier for cost
     */
    public static double getSVCostMultiplier(int etype) {
<span class="nc bnc" id="L714" title="All 8 branches missed.">        switch (etype) {</span>
            case STEAM:
<span class="nc" id="L716">                return 0.8;</span>
            case BATTERY:
<span class="nc" id="L718">                return 1.2;</span>
            case FUEL_CELL:
<span class="nc" id="L720">                return 1.4;</span>
            case SOLAR:
<span class="nc" id="L722">                return 1.6;</span>
            case MAGLEV:
<span class="nc" id="L724">                return 2.5;</span>
            case FISSION:
<span class="nc" id="L726">                return 3.0;</span>
            case NORMAL_ENGINE:
<span class="nc" id="L728">                return 2.0;</span>
            case COMBUSTION_ENGINE:
            case EXTERNAL:
            default:
<span class="nc" id="L732">                return 1.0;</span>
        }
    }

<span class="fc" id="L736">    private static final TechAdvancement STANDARD_FUSION_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L737">            .setAdvancement(DATE_ES, DATE_ES, 2300).setApproximate(false, false, true)</span>
<span class="fc" id="L738">            .setTechRating(RATING_D).setAvailability(RATING_C, RATING_E, RATING_D, RATING_D)</span>
<span class="fc" id="L739">            .setStaticTechLevel(SimpleTechLevel.INTRO);</span>
    
<span class="fc" id="L741">    private static final TechAdvancement LARGE_FUSION_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L742">            .setAdvancement(2630, 3085, 3120).setApproximate(false, true, true)</span>
<span class="fc" id="L743">            .setPrototypeFactions(F_TH).setProductionFactions(F_LC)</span>
<span class="fc" id="L744">            .setTechRating(RATING_D).setAvailability(RATING_C, RATING_E, RATING_D, RATING_D)</span>
<span class="fc" id="L745">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L747">    private static final TechAdvancement STANDARD_ICE_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L748">            .setAdvancement(DATE_ES, DATE_ES, 2300).setApproximate(false, false, true)</span>
<span class="fc" id="L749">            .setTechRating(RATING_C).setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L750">            .setStaticTechLevel(SimpleTechLevel.INTRO);</span>
    
<span class="fc" id="L752">    private static final TechAdvancement LARGE_ICE_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L753">            .setAdvancement(2630, 3085).setApproximate(false, true)</span>
<span class="fc" id="L754">            .setPrototypeFactions(F_TH)</span>
<span class="fc" id="L755">            .setProductionFactions(F_LC).setTechRating(RATING_C)</span>
<span class="fc" id="L756">            .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L757">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L759">    private static final TechAdvancement LIGHT_FUSION_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L760">            .setISAdvancement(3055, 3062, 3067).setISApproximate(true, false, false)</span>
<span class="fc" id="L761">            .setPrototypeFactions(F_MERC).setProductionFactions(F_LC).setTechRating(RATING_D)</span>
<span class="fc" id="L762">            .setAvailability(RATING_X, RATING_X, RATING_E, RATING_D)</span>
<span class="fc" id="L763">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L765">    private static final TechAdvancement LARGE_LIGHT_FUSION_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L766">            .setISAdvancement(3064, 3065).setISApproximate(true)</span>
<span class="fc" id="L767">            .setPrototypeFactions(F_LC).setProductionFactions(F_LC)</span>
<span class="fc" id="L768">            .setTechRating(RATING_D).setAvailability(RATING_X, RATING_X, RATING_E, RATING_E)</span>
<span class="fc" id="L769">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L771">    private static final TechAdvancement COMPACT_FUSION_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L772">            .setISAdvancement(3060, 3068, 3072).setISApproximate(true)</span>
<span class="fc" id="L773">            .setPrototypeFactions(F_LC).setProductionFactions(F_LC)</span>
<span class="fc" id="L774">            .setTechRating(RATING_E)</span>
<span class="fc" id="L775">            .setAvailability(RATING_X, RATING_X, RATING_E, RATING_D)</span>
<span class="fc" id="L776">            .setStaticTechLevel(SimpleTechLevel.STANDARD);            </span>
    
<span class="fc" id="L778">    private static final TechAdvancement IS_XL_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L779">            .setISAdvancement(2556, 2579, 3045, 2865, 3035)</span>
<span class="fc" id="L780">            .setPrototypeFactions(F_TH).setProductionFactions(F_TH).setReintroductionFactions(F_LC)</span>
<span class="fc" id="L781">            .setTechRating(RATING_E).setAvailability(RATING_D, RATING_F, RATING_E, RATING_D)</span>
<span class="fc" id="L782">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L784">    private static final TechAdvancement CLAN_XL_TA = new TechAdvancement(TECH_BASE_CLAN)</span>
<span class="fc" id="L785">            .setClanAdvancement(2824, 2827, 2829).setClanApproximate(true)</span>
<span class="fc" id="L786">            .setPrototypeFactions(F_CSF).setProductionFactions(F_CSF)</span>
<span class="fc" id="L787">            .setTechRating(RATING_F).setAvailability(RATING_D, RATING_E, RATING_D, RATING_D)</span>
<span class="fc" id="L788">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L790">    private static final TechAdvancement LARGE_IS_XL_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L791">            .setISAdvancement(2635, 3085, DATE_NONE, 2822, 3054).setISApproximate(true, true)</span>
<span class="fc" id="L792">            .setPrototypeFactions(F_TH).setProductionFactions(F_TH).setReintroductionFactions(F_LC, F_FS)</span>
<span class="fc" id="L793">            .setTechRating(RATING_E).setAvailability(RATING_D, RATING_F, RATING_E, RATING_E)</span>
<span class="fc" id="L794">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L796">    private static final TechAdvancement LARGE_CLAN_XL_TA = new TechAdvancement(TECH_BASE_CLAN)</span>
<span class="fc" id="L797">            .setClanAdvancement(2850, 3080).setClanApproximate(true, true)</span>
<span class="fc" id="L798">            .setPrototypeFactions(F_CIH).setProductionFactions(F_CHH)</span>
<span class="fc" id="L799">            .setTechRating(RATING_F).setAvailability(RATING_D, RATING_F, RATING_E, RATING_E)</span>
<span class="fc" id="L800">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L802">    private static final TechAdvancement IS_XXL_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L803">            .setISAdvancement(3055, 3110).setISApproximate(true, true)</span>
<span class="fc" id="L804">            .setPrototypeFactions(F_FS, F_LC).setProductionFactions(F_LC)</span>
<span class="fc" id="L805">            .setTechRating(RATING_F).setAvailability(RATING_X, RATING_X, RATING_F, RATING_E)</span>
<span class="fc" id="L806">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L808">    private static final TechAdvancement CLAN_XXL_TA = new TechAdvancement(TECH_BASE_CLAN)</span>
<span class="fc" id="L809">            .setClanAdvancement(2954, 3084).setApproximate(true, true)</span>
<span class="fc" id="L810">            .setPrototypeFactions(F_CSF).setProductionFactions(F_CSF)</span>
<span class="fc" id="L811">            .setTechRating(RATING_F).setAvailability(RATING_X, RATING_X, RATING_F, RATING_E)</span>
<span class="fc" id="L812">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L814">    private static final TechAdvancement LARGE_IS_XXL_TA = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L815">            .setISAdvancement(3058, 3130).setTechRating(RATING_F)</span>
<span class="fc" id="L816">            .setPrototypeFactions(F_FS).setProductionFactions(F_LC)</span>
<span class="fc" id="L817">            .setAvailability(RATING_X, RATING_X, RATING_F, RATING_F)</span>
<span class="fc" id="L818">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L820">    private static final TechAdvancement LARGE_CLAN_XXL_TA = new TechAdvancement(TECH_BASE_CLAN)</span>
<span class="fc" id="L821">            .setClanAdvancement(3055, 3125).setTechRating(RATING_F)</span>
<span class="fc" id="L822">            .setPrototypeFactions(F_CSF).setProductionFactions(F_CSF)</span>
<span class="fc" id="L823">            .setAvailability(RATING_X, RATING_X, RATING_F, RATING_F)</span>
<span class="fc" id="L824">            .setStaticTechLevel(SimpleTechLevel.EXPERIMENTAL);</span>
    
<span class="fc" id="L826">    private static final TechAdvancement FISSION_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L827">            .setAdvancement(2470, 2882, 3079).setTechRating(RATING_D)</span>
<span class="fc" id="L828">            .setPrototypeFactions(F_TH).setProductionFactions(F_TC)</span>
<span class="fc" id="L829">            .setAvailability(RATING_E, RATING_E, RATING_D, RATING_D)</span>
<span class="fc" id="L830">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L832">    private static final TechAdvancement FUEL_CELL_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L833">            .setAdvancement(2300, 2470, 3078).setApproximate(true).setTechRating(RATING_D)</span>
<span class="fc" id="L834">            .setPrototypeFactions(F_TA).setProductionFactions(F_TH)</span>
<span class="fc" id="L835">            .setAvailability(RATING_C, RATING_D, RATING_D, RATING_C)</span>
<span class="fc" id="L836">            .setStaticTechLevel(SimpleTechLevel.STANDARD);    </span>
    
<span class="fc" id="L838">    private static final TechAdvancement SUPPORT_STEAM_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L839">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_A)</span>
<span class="fc" id="L840">            .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L841">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L843">    private static final TechAdvancement SUPPORT_ICE_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L844">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_B)</span>
<span class="fc" id="L845">            .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L846">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L848">    private static final TechAdvancement SUPPORT_BATTERY_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L849">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS)</span>
<span class="fc" id="L850">            .setTechRating(RATING_C)</span>
<span class="fc" id="L851">            .setAvailability(RATING_A, RATING_B, RATING_A, RATING_A)</span>
<span class="fc" id="L852">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L854">    private static final TechAdvancement SUPPORT_FUEL_CELL_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L855">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_C)</span>
<span class="fc" id="L856">            .setAvailability(RATING_B, RATING_C, RATING_C, RATING_B)</span>
<span class="fc" id="L857">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L859">    private static final TechAdvancement SUPPORT_SOLAR_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L860">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS)</span>
<span class="fc" id="L861">            .setTechRating(RATING_C)</span>
<span class="fc" id="L862">            .setAvailability(RATING_C, RATING_D, RATING_C, RATING_C)</span>
<span class="fc" id="L863">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L865">    private static final TechAdvancement SUPPORT_FISSION_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L866">            .setAdvancement(DATE_ES, DATE_ES, DATE_ES).setTechRating(RATING_C)</span>
<span class="fc" id="L867">            .setAvailability(RATING_E, RATING_E, RATING_D, RATING_C)</span>
<span class="fc" id="L868">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
    
<span class="fc" id="L870">    private static final TechAdvancement SUPPORT_FUSION_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L871">            .setAdvancement(DATE_ES, DATE_ES, DATE_ES).setTechRating(RATING_C)</span>
<span class="fc" id="L872">            .setAvailability(RATING_C, RATING_E, RATING_D, RATING_C)</span>
<span class="fc" id="L873">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
   
<span class="fc" id="L875">    private static final TechAdvancement SUPPORT_MAGLEV_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L876">            .setAdvancement(DATE_ES, DATE_ES, DATE_ES).setTechRating(RATING_C)</span>
<span class="fc" id="L877">            .setAvailability(RATING_D, RATING_F, RATING_E, RATING_D)</span>
<span class="fc" id="L878">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>

<span class="fc" id="L880">    private static final TechAdvancement SUPPORT_NONE_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L881">            .setAdvancement(DATE_PS, DATE_PS, DATE_PS).setTechRating(RATING_A)</span>
<span class="fc" id="L882">            .setAvailability(RATING_A, RATING_A, RATING_A, RATING_A)</span>
<span class="fc" id="L883">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>

<span class="fc" id="L885">    private static final TechAdvancement SUPPORT_EXTERNAL_TA = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L886">            .setAdvancement(DATE_NONE, DATE_NONE, DATE_PS)</span>
<span class="fc" id="L887">            .setTechRating(RATING_B).setAvailability(RATING_C, RATING_D, RATING_C, RATING_C);</span>

    public TechAdvancement getTechAdvancement() {
<span class="pc bpc" id="L890" title="14 of 15 branches missed.">        switch(engineType) {</span>
        case COMBUSTION_ENGINE:
<span class="nc bnc" id="L892" title="All 2 branches missed.">            if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L893">                return SUPPORT_ICE_TA;              </span>
            } else {
<span class="nc bnc" id="L895" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L896">                    return LARGE_ICE_TA;</span>
                } else {
<span class="nc" id="L898">                    return STANDARD_ICE_TA;</span>
                }
            }
        case NORMAL_ENGINE:
<span class="pc bpc" id="L902" title="1 of 2 branches missed.">            if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L903">                return SUPPORT_FUSION_TA;</span>
            } else {
<span class="pc bpc" id="L905" title="1 of 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L906">                    return LARGE_FUSION_TA;</span>
                } else {
<span class="fc" id="L908">                    return STANDARD_FUSION_TA;</span>
                }
            }
        case XL_ENGINE:
<span class="nc bnc" id="L912" title="All 2 branches missed.">            if (hasFlag(CLAN_ENGINE)) {</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L914">                    return LARGE_CLAN_XL_TA;</span>
                } else {
<span class="nc" id="L916">                    return CLAN_XL_TA;</span>
                }
            } else {
<span class="nc bnc" id="L919" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L920">                    return LARGE_IS_XL_TA;</span>
                } else {
<span class="nc" id="L922">                    return IS_XL_TA;</span>
                }
            }
        case XXL_ENGINE:
<span class="nc bnc" id="L926" title="All 2 branches missed.">            if (hasFlag(CLAN_ENGINE)) {</span>
<span class="nc bnc" id="L927" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L928">                    return LARGE_CLAN_XXL_TA;</span>
                } else {
<span class="nc" id="L930">                    return CLAN_XXL_TA;</span>
                }
            } else {
<span class="nc bnc" id="L933" title="All 2 branches missed.">                if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L934">                    return LARGE_IS_XXL_TA;</span>
                } else {
<span class="nc" id="L936">                    return IS_XXL_TA;</span>
                }
            }
        case FUEL_CELL:
<span class="nc bnc" id="L940" title="All 2 branches missed.">            if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L941">                return SUPPORT_FUEL_CELL_TA;</span>
            } else {
<span class="nc" id="L943">                return FUEL_CELL_TA;</span>
            }
        case LIGHT_ENGINE:
<span class="nc bnc" id="L946" title="All 2 branches missed.">            if (hasFlag(LARGE_ENGINE)) {</span>
<span class="nc" id="L947">                return LARGE_LIGHT_FUSION_TA;</span>
            } else {
<span class="nc" id="L949">                return LIGHT_FUSION_TA;</span>
            }
        case COMPACT_ENGINE:
<span class="nc" id="L952">            return COMPACT_FUSION_TA;</span>
        case FISSION:
<span class="nc bnc" id="L954" title="All 2 branches missed.">            if (hasFlag(SUPPORT_VEE_ENGINE)) {</span>
<span class="nc" id="L955">                return SUPPORT_FISSION_TA;</span>
            } else {                
<span class="nc" id="L957">                return FISSION_TA;</span>
            }
        case MAGLEV:
<span class="nc" id="L960">            return SUPPORT_MAGLEV_TA;</span>
        case STEAM:
<span class="nc" id="L962">            return SUPPORT_STEAM_TA;</span>
        case BATTERY:
<span class="nc" id="L964">            return SUPPORT_BATTERY_TA;</span>
        case SOLAR:
<span class="nc" id="L966">            return SUPPORT_SOLAR_TA;</span>
        case NONE:
<span class="nc" id="L968">            return SUPPORT_NONE_TA;</span>
        case EXTERNAL:
<span class="nc" id="L970">            return SUPPORT_EXTERNAL_TA;</span>
        default:
<span class="nc" id="L972">            return new TechAdvancement();</span>
        }
    }
    /**
     * Return the tech type (tech level + tech base) for the current engine.
     *
     * @param year The game year
     * @return     The tech constant
     */
    public int getTechType(int year) {
<span class="nc" id="L982">        boolean isLarge = hasFlag(LARGE_ENGINE);</span>
<span class="nc" id="L983">        boolean isClan = hasFlag(CLAN_ENGINE);</span>
<span class="nc" id="L984">        boolean isSV = hasFlag(SUPPORT_VEE_ENGINE);</span>
<span class="nc bnc" id="L985" title="All 10 branches missed.">        switch (engineType) {</span>
            case NORMAL_ENGINE:
<span class="nc bnc" id="L987" title="All 4 branches missed.">                if ((isClan) &amp;&amp; (isLarge)) {</span>
<span class="nc bnc" id="L988" title="All 2 branches missed.">                    if (year &lt;= 2630) {</span>
<span class="nc" id="L989">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">                    } else if (year &lt;= 3080) {</span>
<span class="nc" id="L991">                        return TechConstants.T_CLAN_EXPERIMENTAL;</span>
<span class="nc bnc" id="L992" title="All 2 branches missed.">                    } else if (year &lt;= 3120) {</span>
<span class="nc" id="L993">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    } else {
<span class="nc" id="L995">                        return TechConstants.T_CLAN_TW;</span>
                    }
                }
<span class="nc bnc" id="L998" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L999">                    return TechConstants.T_CLAN_TW;</span>
                }
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                if (isSV) {</span>
<span class="nc" id="L1002">                    return TechConstants.T_ALLOWED_ALL;</span>
                }
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                if (year &lt;= 2285) {</span>
<span class="nc" id="L1005">                    return TechConstants.T_IS_UNOFFICIAL;</span>
                } else {
<span class="nc" id="L1007">                    return TechConstants.T_INTRO_BOXSET;</span>
                }
            case XL_ENGINE:
<span class="nc bnc" id="L1010" title="All 4 branches missed.">                if ((isClan) &amp;&amp; (isLarge)) {</span>
<span class="nc bnc" id="L1011" title="All 2 branches missed.">                    if (year &lt;= 2845) {</span>
<span class="nc" id="L1012">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
<span class="nc bnc" id="L1013" title="All 2 branches missed.">                    } else if (year &lt;= 3075) {</span>
<span class="nc" id="L1014">                        return TechConstants.T_CLAN_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1016">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    }
                }
<span class="nc bnc" id="L1019" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">                    if (year &lt;= 2819) {</span>
<span class="nc" id="L1021">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">                    } else if (year &lt;= 2827) {</span>
<span class="nc" id="L1023">                        return TechConstants.T_CLAN_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1024" title="All 2 branches missed.">                    } else if (year &lt;= 2829) {</span>
<span class="nc" id="L1025">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    } else {
<span class="nc" id="L1027">                        return TechConstants.T_CLAN_TW;</span>
                    }
                }
<span class="nc bnc" id="L1030" title="All 2 branches missed.">                if (isLarge) {</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">                    if (year &lt;= 2630) {</span>
<span class="nc" id="L1032">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">                        } else if (year &lt;= 2822) {</span>
<span class="nc" id="L1034">                        return TechConstants.T_IS_ADVANCED;</span>
<span class="nc bnc" id="L1035" title="All 2 branches missed.">                        } else if (year &lt;= 3053) {</span>
<span class="nc" id="L1036">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1037" title="All 2 branches missed.">                        } else if (year &lt;= 3080) {</span>
<span class="nc" id="L1038">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
                        } else {
<span class="nc" id="L1040">                        return TechConstants.T_IS_ADVANCED;</span>
                        }
                } else {
<span class="nc bnc" id="L1043" title="All 2 branches missed.">                    if (year &lt;= 2556) {</span>
<span class="nc" id="L1044">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1045" title="All 2 branches missed.">                        } else if (year &lt;= 2579) {</span>
<span class="nc" id="L1046">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1047" title="All 2 branches missed.">                           } else if (year &lt;= 2865) {</span>
<span class="nc" id="L1048">                        return TechConstants.T_IS_ADVANCED;</span>
<span class="nc bnc" id="L1049" title="All 2 branches missed.">                           } else if (year &lt;= 3035) {</span>
<span class="nc" id="L1050">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1051" title="All 2 branches missed.">                        } else if (year &lt;=3045){</span>
<span class="nc" id="L1052">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                        }
                }
            case XXL_ENGINE:
<span class="nc bnc" id="L1056" title="All 4 branches missed.">                if ((isClan) &amp;&amp; (isLarge)) {</span>
<span class="nc bnc" id="L1057" title="All 2 branches missed.">                    if (year &lt;= 3055) {</span>
<span class="nc" id="L1058">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
<span class="nc bnc" id="L1059" title="All 2 branches missed.">                    } else if (year &lt;= 3125) {</span>
<span class="nc" id="L1060">                        return TechConstants.T_CLAN_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1062">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    }
                }
<span class="nc bnc" id="L1065" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">                    if (year &lt;= 2949) {</span>
<span class="nc" id="L1067">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
<span class="nc bnc" id="L1068" title="All 2 branches missed.">                    } else if (year &lt;= 3079) {</span>
<span class="nc" id="L1069">                        return TechConstants.T_CLAN_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1071">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    }
                }
<span class="nc bnc" id="L1074" title="All 2 branches missed.">                if (isLarge) {</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">                    if (year &lt;= 3058) {</span>
<span class="nc" id="L1076">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">                    } else if (year &lt;= 3130) {</span>
<span class="nc" id="L1078">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1080">                        return TechConstants.T_IS_ADVANCED;</span>
                    }
                }
            case FISSION:
<span class="nc bnc" id="L1084" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L1085">                    return TechConstants.T_CLAN_UNOFFICIAL;</span>
                }
<span class="nc bnc" id="L1087" title="All 2 branches missed.">                if (isSV) {</span>
<span class="nc" id="L1088">                    return TechConstants.T_ALLOWED_ALL;</span>
                }
<span class="nc bnc" id="L1090" title="All 2 branches missed.">                if (isLarge) {</span>
<span class="nc" id="L1091">                    return TechConstants.T_IS_UNOFFICIAL;</span>
                } else {
<span class="nc bnc" id="L1093" title="All 2 branches missed.">                    if (year &lt;= 2470) {</span>
<span class="nc" id="L1094">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1095" title="All 2 branches missed.">                    } else if (year &lt;= 2882) {</span>
<span class="nc" id="L1096">                        return TechConstants.T_IS_ADVANCED;</span>
<span class="nc bnc" id="L1097" title="All 2 branches missed.">                    } else if (year &lt;= 3079) {</span>
<span class="nc" id="L1098">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                    }
                }
            case FUEL_CELL:
<span class="nc bnc" id="L1102" title="All 2 branches missed.">                if (isSV) {</span>
<span class="nc" id="L1103">                    return TechConstants.T_ALLOWED_ALL;</span>
                }
<span class="nc bnc" id="L1105" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc bnc" id="L1106" title="All 2 branches missed.">                    if (year &lt;= 3078) {</span>
<span class="nc" id="L1107">                        return TechConstants.T_CLAN_ADVANCED;</span>
                    } else {
<span class="nc" id="L1109">                        return TechConstants.T_CLAN_TW;</span>
                    }
                } else {
<span class="nc bnc" id="L1112" title="All 2 branches missed.">                    if (year &lt;= 2285) {</span>
<span class="nc" id="L1113">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1114" title="All 2 branches missed.">                    } else if (year &lt;= 2470) {</span>
<span class="nc" id="L1115">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1116" title="All 2 branches missed.">                    } else if (year &lt;= 3078) {</span>
<span class="nc" id="L1117">                        return TechConstants.T_IS_ADVANCED;</span>
                    } else {
<span class="nc" id="L1119">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                    }
                }

            case LIGHT_ENGINE:
<span class="nc bnc" id="L1124" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L1125">                    return TechConstants.T_CLAN_UNOFFICIAL;</span>
                }
<span class="nc bnc" id="L1127" title="All 2 branches missed.">                if (isLarge) {</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">                    if (year &lt; 3064) {</span>
<span class="nc" id="L1129">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1130" title="All 2 branches missed.">                    } else if (year &lt; 3065) {</span>
<span class="nc" id="L1131">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1133">                        return TechConstants.T_IS_ADVANCED;</span>
                    }
                } else {
<span class="nc bnc" id="L1136" title="All 2 branches missed.">                    if (year &lt; 3055) {</span>
<span class="nc" id="L1137">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1138" title="All 2 branches missed.">                    } else if (year &lt; 3062) {</span>
<span class="nc" id="L1139">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1140" title="All 2 branches missed.">                    } else if (year &lt; 3067) {</span>
<span class="nc" id="L1141">                        return TechConstants.T_IS_ADVANCED;</span>
                    } else {
<span class="nc" id="L1143">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                    }
                }

            case COMBUSTION_ENGINE:
<span class="nc bnc" id="L1148" title="All 2 branches missed.">                if (isSV) {</span>
<span class="nc" id="L1149">                    return TechConstants.T_ALLOWED_ALL;</span>
                }
<span class="nc bnc" id="L1151" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc bnc" id="L1152" title="All 2 branches missed.">                    if (year &lt;= 2807) {</span>
<span class="nc" id="L1153">                        return TechConstants.T_CLAN_UNOFFICIAL;</span>
                    } else {
<span class="nc" id="L1155">                        return TechConstants.T_CLAN_TW;</span>
                    }

                }
<span class="nc bnc" id="L1159" title="All 2 branches missed.">                if (isLarge) {</span>
<span class="nc bnc" id="L1160" title="All 2 branches missed.">                    if (year &lt;= 2630) {</span>
<span class="nc" id="L1161">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1162" title="All 2 branches missed.">                    } else if (year &lt;= 3080) {</span>
<span class="nc" id="L1163">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
                    } else {
<span class="nc" id="L1165">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                    }
                } else {
<span class="nc" id="L1168">                    return TechConstants.T_ALLOWED_ALL;</span>
                }
            case MAGLEV:
            case STEAM:
            case BATTERY:
            case SOLAR:
            case NONE:
            case EXTERNAL:
<span class="nc" id="L1176">                return TechConstants.T_ALLOWED_ALL;</span>
            case COMPACT_ENGINE:
<span class="nc bnc" id="L1178" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L1179">                    return TechConstants.T_CLAN_UNOFFICIAL;</span>
                } else {
<span class="nc bnc" id="L1181" title="All 2 branches missed.">                    if (year &lt;= 3060) {</span>
<span class="nc" id="L1182">                        return TechConstants.T_IS_UNOFFICIAL;</span>
<span class="nc bnc" id="L1183" title="All 2 branches missed.">                    } else if (year &lt;= 3068) {</span>
<span class="nc" id="L1184">                        return TechConstants.T_IS_EXPERIMENTAL;</span>
<span class="nc bnc" id="L1185" title="All 2 branches missed.">                    } else if (year &lt;= 3072) {</span>
<span class="nc" id="L1186">                        return TechConstants.T_IS_ADVANCED;</span>
                    } else {
<span class="nc" id="L1188">                        return TechConstants.T_IS_TW_NON_BOX;</span>
                    }
                }
        }
<span class="nc" id="L1192">        return TechConstants.T_TECH_UNKNOWN;</span>
    }
    

    public int getEngineType() {
<span class="fc" id="L1197">        return engineType;</span>
    }

    /**
     * For omnis set the base Chassies HS any variants will only use this and the reset
     * will have to be added.
     *
     * @param amount The number to set as base chassis heat sinks
     */
    public void setBaseChassisHeatSinks(int amount) {
<span class="nc" id="L1207">        baseChassisHeatSinks = amount;</span>
<span class="nc" id="L1208">    }</span>

    /**
     * Return the Base Chassies Engine heat Sinks or integralHeatSinkCapacity which ever is less.
     *
     * @param compact Whether this engine uses compact heat sinks or not.
     *
     * @return        The number of integral heat sinks in the base chassis
     */
    public int getBaseChassisHeatSinks(boolean compact) {
<span class="nc" id="L1218">        return Math.min(integralHeatSinkCapacity(compact), baseChassisHeatSinks);</span>
    }

    public int getFlags() {
<span class="nc" id="L1222">        return engineFlags;</span>
    }
    
    @Override
    public int getTechBase() {
<span class="nc" id="L1227">        return getTechAdvancement().getTechBase();</span>
    }

    @Override
    public boolean isClan() {
<span class="fc" id="L1232">        return getTechAdvancement().isClan();</span>
    }

    @Override
    public boolean isMixedTech() {
<span class="nc" id="L1237">        return getTechAdvancement().isMixedTech();</span>
    }

    @Override
    public boolean isIntroLevel() {
<span class="nc" id="L1242">        return getTechAdvancement().isIntroLevel();</span>
    }

    @Override
    public boolean isUnofficial() {
<span class="nc" id="L1247">        return getTechAdvancement().isUnofficial();</span>
    }

    @Override
    public int getIntroductionDate(boolean clan) {
<span class="nc" id="L1252">        return getTechAdvancement().getIntroductionDate(clan);</span>
    }
    
    @Override
    public int getIntroductionDate(boolean clan, int faction) {
<span class="fc" id="L1257">        return getTechAdvancement().getIntroductionDate(clan, faction);</span>
    }

    @Override
    public int getIntroductionDate() {
<span class="nc" id="L1262">        return getTechAdvancement().getIntroductionDate();</span>
    }

    @Override
    public int getPrototypeDate(boolean clan) {
<span class="nc" id="L1267">        return getTechAdvancement().getPrototypeDate(clan);</span>
    }

    @Override
    public int getPrototypeDate() {
<span class="nc" id="L1272">        return getTechAdvancement().getPrototypeDate();</span>
    }

    @Override
    public int getPrototypeDate(boolean clan, int faction) {
<span class="fc" id="L1277">        return getTechAdvancement().getPrototypeDate(clan, faction);</span>
    }

    @Override
    public int getProductionDate(boolean clan) {
<span class="nc" id="L1282">        return getTechAdvancement().getProductionDate(clan);</span>
    }

    @Override
    public int getProductionDate() {
<span class="nc" id="L1287">        return getTechAdvancement().getProductionDate();</span>
    }

    @Override
    public int getProductionDate(boolean clan, int faction) {
<span class="fc" id="L1292">        return getTechAdvancement().getProductionDate(clan, faction);</span>
    }

    @Override
    public int getCommonDate(boolean clan) {
<span class="fc" id="L1297">        return getTechAdvancement().getCommonDate(clan);</span>
    }

    @Override
    public int getCommonDate() {
<span class="nc" id="L1302">        return getTechAdvancement().getCommonDate();</span>
    }

    @Override
    public int getExtinctionDate(boolean clan) {
<span class="nc" id="L1307">        return getTechAdvancement().getExtinctionDate(clan);</span>
    }

    @Override
    public int getExtinctionDate() {
<span class="nc" id="L1312">        return getTechAdvancement().getExtinctionDate();</span>
    }

    @Override
    public int getExtinctionDate(boolean clan, int faction) {
<span class="fc" id="L1317">        return getTechAdvancement().getExtinctionDate(clan, faction);</span>
    }

    @Override
    public int getReintroductionDate(boolean clan) {
<span class="nc" id="L1322">        return getTechAdvancement().getReintroductionDate(clan);</span>
    }

    @Override
    public int getReintroductionDate() {
<span class="nc" id="L1327">        return getTechAdvancement().getReintroductionDate();</span>
    }

    @Override
    public int getReintroductionDate(boolean clan, int faction) {
<span class="fc" id="L1332">        return getTechAdvancement().getReintroductionDate(clan, faction);</span>
    }

    @Override
    public int getTechRating() {
<span class="fc" id="L1337">        return getTechAdvancement().getTechRating();</span>
    }

    @Override
    public int getBaseAvailability(int era) {
<span class="fc" id="L1342">        return getTechAdvancement().getBaseAvailability(era);</span>
    }
    
    @Override
    public SimpleTechLevel getStaticTechLevel() {
<span class="fc" id="L1347">        return getTechAdvancement().getStaticTechLevel();</span>
    }
} // End class Engine
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>