<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QuadMech.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">QuadMech.java</span></div><h1>QuadMech.java</h1><pre class="source lang-java linenums">/*
 * MegaMek -
 *  Copyright (C) 2000-2002
 *    Ben Mazur (bmazur@sev.org)
 *    Cord Awtry (kipsta@bs-interactive.com)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.common;

import java.io.PrintWriter;

import megamek.common.options.OptionsConstants;
import megamek.common.preference.PreferenceManager;

public class QuadMech extends Mech {
    /**
     *
     */
    private static final long serialVersionUID = 7183093787457804717L;

<span class="fc" id="L30">    private static final String[] LOCATION_NAMES = { &quot;Head&quot;, &quot;Center Torso&quot;, &quot;Right Torso&quot;, &quot;Left Torso&quot;, &quot;Front Right Leg&quot;, &quot;Front Left Leg&quot;, &quot;Rear Right Leg&quot;, &quot;Rear Left Leg&quot; };</span>

<span class="fc" id="L32">    private static final String[] LOCATION_ABBRS = { &quot;HD&quot;, &quot;CT&quot;, &quot;RT&quot;, &quot;LT&quot;, &quot;FRL&quot;, &quot;FLL&quot;, &quot;RRL&quot;, &quot;RLL&quot; };</span>

<span class="fc" id="L34">    private static final int[] NUM_OF_SLOTS = { 6, 12, 12, 12, 6, 6, 6, 6 };</span>

    public QuadMech(String inGyroType, String inCockpitType) {
<span class="fc" id="L37">        this(Mech.getGyroTypeForString(inGyroType), Mech.getCockpitTypeForString(inCockpitType));</span>
<span class="fc" id="L38">    }</span>

    public QuadMech() {
<span class="fc" id="L41">        this(Mech.GYRO_STANDARD, Mech.COCKPIT_STANDARD);</span>
<span class="fc" id="L42">    }</span>

    public QuadMech(int inGyroType, int inCockpitType) {
<span class="fc" id="L45">        super(inGyroType, inCockpitType);</span>

<span class="fc" id="L47">        movementMode = EntityMovementMode.QUAD;</span>
<span class="fc" id="L48">        originalMovementMode = EntityMovementMode.QUAD;</span>

<span class="fc" id="L50">        setCritical(LOC_RARM, 0, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_HIP));</span>
<span class="fc" id="L51">        setCritical(LOC_RARM, 1, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_UPPER_LEG));</span>
<span class="fc" id="L52">        setCritical(LOC_RARM, 2, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_LOWER_LEG));</span>
<span class="fc" id="L53">        setCritical(LOC_RARM, 3, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_FOOT));</span>

<span class="fc" id="L55">        setCritical(LOC_LARM, 0, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_HIP));</span>
<span class="fc" id="L56">        setCritical(LOC_LARM, 1, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_UPPER_LEG));</span>
<span class="fc" id="L57">        setCritical(LOC_LARM, 2, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_LOWER_LEG));</span>
<span class="fc" id="L58">        setCritical(LOC_LARM, 3, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, ACTUATOR_FOOT));</span>
<span class="fc" id="L59">    }</span>

    /**
     * Returns true if the Mech cannot stand up any longer.
     */
    @Override
    public boolean cannotStandUpFromHullDown() {
<span class="fc" id="L66">        int i = 0;</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">        if (isLocationBad(LOC_LARM)) {</span>
<span class="nc" id="L68">            i++;</span>
        }
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (isLocationBad(LOC_RARM)) {</span>
<span class="nc" id="L71">            i++;</span>
        }
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">        if (isLocationBad(LOC_LLEG)) {</span>
<span class="nc" id="L74">            i++;</span>
        }
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">        if (isLocationBad(LOC_RLEG)) {</span>
<span class="nc" id="L77">            i++;</span>
        }
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">        return i &gt;= 3;</span>
    }

    @Override
    public int getWalkMP(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<span class="fc" id="L84">        int wmp = getOriginalWalkMP();</span>

<span class="fc" id="L86">        int legsDestroyed = 0;</span>
<span class="fc" id="L87">        int hipHits = 0;</span>
<span class="fc" id="L88">        int actuatorHits = 0;</span>

        //A Mech using tracks has its movement reduced by 25% per leg or track destroyed.
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">        if (movementMode == EntityMovementMode.TRACKED) {</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            for (Mounted m : getMisc()) {</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                if (m.getType().hasFlag(MiscType.F_TRACKS)) {</span>
<span class="nc bnc" id="L94" title="All 4 branches missed.">                    if (m.isHit() || isLocationBad(m.getLocation())) {</span>
<span class="nc" id="L95">                        legsDestroyed++;</span>
                    }
                }
<span class="nc" id="L98">            }</span>
<span class="nc" id="L99">            wmp = (wmp * (4 - legsDestroyed)) / 4;</span>
        } else {
<span class="fc bfc" id="L101" title="All 2 branches covered.">            for (int i = 0; i &lt; locations(); i++) {</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">                if (locationIsLeg(i)) {</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">                    if (!isLocationBad(i)) {</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">                        if (legHasHipCrit(i)) {</span>
<span class="nc" id="L105">                            hipHits++;</span>
<span class="nc bnc" id="L106" title="All 4 branches missed.">                            if ((game == null) || !game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {</span>
<span class="nc" id="L107">                                continue;</span>
                            }
                        }
<span class="fc" id="L110">                        actuatorHits += countLegActuatorCrits(i);</span>
                    } else {
<span class="nc" id="L112">                        legsDestroyed++;</span>
                    }
                }
            }
            // leg damage effects
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">            if (legsDestroyed &gt; 0) {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">                if (legsDestroyed == 1) {</span>
<span class="nc" id="L119">                    wmp--;</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">                } else if (legsDestroyed == 2) {</span>
<span class="nc" id="L121">                    wmp = 1;</span>
                } else {
<span class="nc" id="L123">                    wmp = 0;</span>
                }
            }        
<span class="fc bfc" id="L126" title="All 2 branches covered.">            if (wmp &gt; 0) {</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">                if (hipHits &gt; 0) {</span>
<span class="nc bnc" id="L128" title="All 4 branches missed.">                    if ((game != null) &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {</span>
<span class="nc" id="L129">                        wmp = wmp - (2 * hipHits);</span>
                    } else {
<span class="nc bnc" id="L131" title="All 2 branches missed.">                        for (int i = 0; i &lt; hipHits; i++) {</span>
<span class="nc" id="L132">                            wmp = (int) Math.ceil(wmp / 2.0);</span>
                        }
                    }
                }
<span class="fc" id="L136">                wmp -= actuatorHits;</span>
            }
        }

<span class="pc bpc" id="L140" title="1 of 4 branches missed.">        if (!ignoremodulararmor &amp;&amp; hasModularArmor() ) {</span>
<span class="nc" id="L141">            wmp--;</span>
        }

<span class="fc bfc" id="L144" title="All 2 branches covered.">        if (!ignoreheat) {</span>
            // factor in heat
<span class="pc bpc" id="L146" title="3 of 4 branches missed.">            if ((game != null) &amp;&amp; game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_HEAT)) {</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">                if (heat &lt; 30) {</span>
<span class="nc" id="L148">                    wmp -= (heat / 5);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">                } else if (heat &gt;= 49) {</span>
<span class="nc" id="L150">                    wmp -= 9;</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">                } else if (heat &gt;= 43) {</span>
<span class="nc" id="L152">                    wmp -= 8;</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                } else if (heat &gt;= 37) {</span>
<span class="nc" id="L154">                    wmp -= 7;</span>
<span class="nc bnc" id="L155" title="All 2 branches missed.">                } else if (heat &gt;= 31) {</span>
<span class="nc" id="L156">                    wmp -= 6;</span>
                } else {
<span class="nc" id="L158">                    wmp -= 5;</span>
                }
            } else {
<span class="fc" id="L161">                wmp -= (heat / 5);</span>
            }
            // TSM negates some heat but has no benefit for 'Mechs using tracks or QuadVees in vehicle mode.
<span class="pc bpc" id="L164" title="9 of 10 branches missed.">            if ((heat &gt;= 9) &amp;&amp; hasTSM() &amp;&amp; legsDestroyed &lt; 2</span>
                    &amp;&amp; movementMode != EntityMovementMode.TRACKED
                    &amp;&amp; movementMode != EntityMovementMode.WHEELED) {
<span class="nc" id="L167">                wmp += 2;</span>
            }
        }
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">        if (null != game) {</span>
<span class="nc" id="L171">            int weatherMod = game.getPlanetaryConditions().getMovementMods(this);</span>
<span class="nc bnc" id="L172" title="All 2 branches missed.">            if (weatherMod != 0) {</span>
<span class="nc" id="L173">                wmp = Math.max(wmp + weatherMod, 0);</span>
            }
        }
        // gravity
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">        if (gravity) {</span>
<span class="fc" id="L178">            wmp = applyGravityEffectsOnMP(wmp);</span>
        }
        // For sanity sake...
<span class="fc" id="L181">        wmp = Math.max(0, wmp);</span>
<span class="fc" id="L182">        return wmp;</span>
    }

    /**
     * Returns this mech's running/flank mp modified for leg loss &amp; stuff.
     */

    @Override
    public int getRunMP(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<span class="pc bpc" id="L191" title="3 of 4 branches missed.">        if (countBadLegs() &lt;= 1</span>
<span class="nc bnc" id="L192" title="All 4 branches missed.">                || (this instanceof QuadVee &amp;&amp; getConversionMode() == QuadVee.CONV_MODE_VEHICLE</span>
                &amp;&amp; !convertingNow)) {
<span class="fc" id="L194">            return super.getRunMP(gravity, ignoreheat, ignoremodulararmor);</span>
        }
<span class="nc" id="L196">        return getWalkMP(gravity, ignoreheat, ignoremodulararmor);</span>
    }

    /**
     * Returns run MP without considering MASC modified for leg loss &amp; stuff.
     */
    @Override
    public int getRunMPwithoutMASC(boolean gravity, boolean ignoreheat, boolean ignoremodulararmor) {
<span class="pc bpc" id="L204" title="3 of 4 branches missed.">        if (countBadLegs() &lt;= 1</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">                || (this instanceof QuadVee &amp;&amp; getConversionMode() == QuadVee.CONV_MODE_VEHICLE</span>
                &amp;&amp; !convertingNow)) {
<span class="fc" id="L207">            return super.getRunMPwithoutMASC(gravity, ignoreheat, ignoremodulararmor);</span>
        }
<span class="nc" id="L209">        return getWalkMP(gravity, ignoreheat);</span>
    }

    @Override
    public boolean canChangeSecondaryFacing() {
<span class="pc bpc" id="L214" title="3 of 4 branches missed.">    	return hasQuirk(OptionsConstants.QUIRK_POS_EXT_TWIST) &amp;&amp; !isProne();</span>
    }
    
	@Override
	public boolean isValidSecondaryFacing(int dir) {
<span class="fc" id="L219">		int rotate = dir - getFacing();</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">		if (canChangeSecondaryFacing()) {</span>
<span class="nc bnc" id="L221" title="All 4 branches missed.">			return (rotate &lt;= 1) || (rotate == 5);</span>
		} else
<span class="pc bpc" id="L223" title="1 of 2 branches missed.">			return rotate == 0;</span>
	}	 

    /**
     * Returns true is the location is a leg
     */
    @Override
    public boolean locationIsLeg(int loc) {
<span class="fc bfc" id="L231" title="All 8 branches covered.">        return ((loc == Mech.LOC_RLEG) || (loc == Mech.LOC_LLEG) || (loc == Mech.LOC_RARM) || (loc == Mech.LOC_LARM));</span>
    }

    /**
     * Returns the Compute.ARC that the weapon fires into.
     */
    @Override
    public int getWeaponArc(int wn) {
<span class="fc" id="L239">        final Mounted mounted = getEquipment(wn);</span>

        // B-Pods need to be special-cased, the have 360 firing arc
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">        if ((mounted.getType() instanceof WeaponType) &amp;&amp;</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                mounted.getType().hasFlag(WeaponType.F_B_POD)) {</span>
<span class="nc" id="L244">            return Compute.ARC_360;</span>
        }
        // VGLs base arc on their facing
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        if (mounted.getType().hasFlag(WeaponType.F_VGL)) {</span>
<span class="nc" id="L248">            return Compute.firingArcFromVGLFacing(mounted.getFacing());</span>
        }
        // rear mounted?
<span class="fc bfc" id="L251" title="All 2 branches covered.">        if (mounted.isRearMounted()) {</span>
<span class="fc" id="L252">            return Compute.ARC_REAR;</span>
        }
        // front mounted
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        switch (mounted.getLocation()) {</span>
        case LOC_HEAD:
        case LOC_CT:
        case LOC_RT:
        case LOC_LT:
        case LOC_RLEG:
        case LOC_LLEG:
        case LOC_LARM:
        case LOC_RARM:
<span class="fc" id="L264">            return Compute.ARC_FORWARD;</span>
        default:
<span class="nc" id="L266">            return Compute.ARC_360;</span>
        }
    }

    /**
     * Sets the internal structure for the mech.
     *
     * @param head
     *            head
     * @param ct
     *            center torso
     * @param t
     *            right/left torso
     * @param arm
     *            right/left arm
     * @param leg
     *            right/left leg
     */
    @Override
    public void setInternal(int head, int ct, int t, int arm, int leg) {
<span class="fc" id="L286">        initializeInternal(head, LOC_HEAD);</span>
<span class="fc" id="L287">        initializeInternal(ct, LOC_CT);</span>
<span class="fc" id="L288">        initializeInternal(t, LOC_RT);</span>
<span class="fc" id="L289">        initializeInternal(t, LOC_LT);</span>
<span class="fc" id="L290">        initializeInternal(leg, LOC_RARM);</span>
<span class="fc" id="L291">        initializeInternal(leg, LOC_LARM);</span>
<span class="fc" id="L292">        initializeInternal(leg, LOC_RLEG);</span>
<span class="fc" id="L293">        initializeInternal(leg, LOC_LLEG);</span>
<span class="fc" id="L294">    }</span>

    /**
     * Returns true is the entity needs a roll to stand up
     */
    @Override
    public boolean needsRollToStand() {
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">        if (countBadLegs() == 0) {</span>
<span class="fc" id="L302">            return false;</span>
        }
<span class="nc" id="L304">        return true;</span>
    }
    
    public PilotingRollData addQuadPilotingBonus(PilotingRollData roll, int destroyedLegs) {
<span class="nc bnc" id="L308" title="All 2 branches missed.">        if (destroyedLegs == 0) {</span>
<span class="nc" id="L309">            roll.addModifier(-2, &quot;Quad bonus&quot;);</span>
        }
<span class="nc" id="L311">        return roll;</span>
    }

    /**
     * Add in any piloting skill mods
     */
    @Override
    public PilotingRollData addEntityBonuses(PilotingRollData roll) {
<span class="nc" id="L319">        int[] locsToCheck = new int[4];</span>
<span class="nc" id="L320">        int destroyedLegs = 0;</span>

<span class="nc" id="L322">        locsToCheck = new int[4];</span>
<span class="nc" id="L323">        locsToCheck[0] = Mech.LOC_RLEG;</span>
<span class="nc" id="L324">        locsToCheck[1] = Mech.LOC_LLEG;</span>
<span class="nc" id="L325">        locsToCheck[2] = Mech.LOC_RARM;</span>
<span class="nc" id="L326">        locsToCheck[3] = Mech.LOC_LARM;</span>

<span class="nc" id="L328">        destroyedLegs = countBadLegs();</span>

        // QuadVees lose the bonus when converting.
<span class="nc bnc" id="L331" title="All 4 branches missed.">        if (destroyedLegs == 0 &amp;&amp; !convertingNow) {</span>
<span class="nc" id="L332">            roll.addModifier(-2, &quot;Quad bonus&quot;);</span>
        }

<span class="nc bnc" id="L335" title="All 2 branches missed.">        if (hasAbility(OptionsConstants.PILOT_ANIMAL_MIMIC)) {</span>
<span class="nc" id="L336">            roll.addModifier(-1, &quot;Animal Mimicry&quot;);</span>
        }

<span class="nc bnc" id="L339" title="All 2 branches missed.">        if (hasFunctionalLegAES()) {</span>
<span class="nc" id="L340">            roll.addModifier(-2, &quot;AES bonus&quot;);</span>
        }

<span class="nc" id="L343">        boolean destroyedLegCounted = false;</span>
<span class="nc bnc" id="L344" title="All 2 branches missed.">        for (int loc : locsToCheck) {</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">            if (isLocationBad(loc)) {</span>
                // a quad with 2 destroyed legs acts like a biped with one leg
                // destroyed, so add the +5 only once
                // 3 or more destroyed legs are being taken care in
                // getBasePiloting
<span class="nc bnc" id="L350" title="All 4 branches missed.">                if ((destroyedLegs == 2) &amp;&amp; !destroyedLegCounted) {</span>
<span class="nc" id="L351">                    roll.addModifier(5, &quot;2 legs destroyed&quot;);</span>
<span class="nc" id="L352">                    destroyedLegCounted = true;</span>
                }
            } else {
                // check for damaged hip actuators
<span class="nc bnc" id="L356" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM, Mech.ACTUATOR_HIP, loc) &gt; 0) {</span>
<span class="nc" id="L357">                    roll.addModifier(2, getLocationName(loc) + &quot; Hip Actuator destroyed&quot;);</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">                    if (!game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_LEG_DAMAGE)) {</span>
<span class="nc" id="L359">                        continue;</span>
                    }
                }
                // upper leg actuators?
<span class="nc bnc" id="L363" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM, Mech.ACTUATOR_UPPER_LEG, loc) &gt; 0) {</span>
<span class="nc" id="L364">                    roll.addModifier(1, getLocationName(loc) + &quot; Upper Leg Actuator destroyed&quot;);</span>
                }
                // lower leg actuators?
<span class="nc bnc" id="L367" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM, Mech.ACTUATOR_LOWER_LEG, loc) &gt; 0) {</span>
<span class="nc" id="L368">                    roll.addModifier(1, getLocationName(loc) + &quot; Lower Leg Actuator destroyed&quot;);</span>
                }
                // foot actuators?
<span class="nc bnc" id="L371" title="All 2 branches missed.">                if (getBadCriticals(CriticalSlot.TYPE_SYSTEM, Mech.ACTUATOR_FOOT, loc) &gt; 0) {</span>
<span class="nc" id="L372">                    roll.addModifier(1, getLocationName(loc) + &quot; Foot Actuator destroyed&quot;);</span>
                }
            }
        }

<span class="nc" id="L377">        return super.addEntityBonuses(roll);</span>
    }

    /**
     * Returns a vector of slot counts for all locations
     */
    @Override
    protected int[] getNoOfSlots() {
<span class="fc" id="L385">        return NUM_OF_SLOTS;</span>
    }

    /**
     * Returns a vector of names for all locations
     */
    @Override
    public String[] getLocationNames() {
<span class="nc" id="L393">        return LOCATION_NAMES;</span>
    }

    /**
     * Returns a vector of abbreviations for all locations
     */
    @Override
    public String[] getLocationAbbrs() {
<span class="nc" id="L401">        return LOCATION_ABBRS;</span>
    }

    public static int restrictScore(int location) {
<span class="fc bfc" id="L405" title="All 3 branches covered.">        switch (location) {</span>
        case Mech.LOC_RT:
        case Mech.LOC_LT:
<span class="fc" id="L408">            return 1;</span>
        case Mech.LOC_CT:
<span class="fc" id="L410">            return 2;</span>
        default:
<span class="fc" id="L412">            return 3;</span>
        }
    }

    @Override
    protected double getArmActuatorCost() {
<span class="fc" id="L418">        return 0;</span>
    }

    @Override
    protected double getLegActuatorCost() {
<span class="fc" id="L423">        return (weight * 150 * 4) + (weight * 80 * 4) + (weight * 120 * 4);</span>
    }

    @Override
    public HitData rollHitLocation(int table, int side, int aimedLocation, int aimingMode, int cover) {
<span class="nc" id="L428">        int roll = -1;</span>

<span class="nc bnc" id="L430" title="All 4 branches missed.">        if ((aimedLocation != LOC_NONE) &amp;&amp; (aimingMode != IAimingModes.AIM_MODE_NONE)) {</span>
<span class="nc" id="L431">            roll = Compute.d6(2);</span>

<span class="nc bnc" id="L433" title="All 4 branches missed.">            if ((5 &lt; roll) &amp;&amp; (roll &lt; 9)) {</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">                return new HitData(aimedLocation, side == ToHitData.SIDE_REAR, true);</span>
            }
        }

<span class="nc bnc" id="L438" title="All 2 branches missed.">        if (game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_ADVANCED_MECH_HIT_LOCATIONS)) {</span>
<span class="nc bnc" id="L439" title="All 4 branches missed.">            if ((table == ToHitData.HIT_NORMAL) || (table == ToHitData.HIT_PARTIAL_COVER)) {</span>
<span class="nc" id="L440">                roll = Compute.d6(2);</span>
                try {
<span class="nc" id="L442">                    PrintWriter pw = PreferenceManager.getClientPreferences().getMekHitLocLog();</span>
<span class="nc bnc" id="L443" title="All 2 branches missed.">                    if (pw != null) {</span>
<span class="nc" id="L444">                        pw.print(table);</span>
<span class="nc" id="L445">                        pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L446">                        pw.print(side);</span>
<span class="nc" id="L447">                        pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L448">                        pw.println(roll);</span>
                    }
<span class="nc" id="L450">                } catch (Throwable thrown) {</span>
<span class="nc" id="L451">                    thrown.printStackTrace();</span>
<span class="nc" id="L452">                }</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                if (side == ToHitData.SIDE_FRONT) {</span>
                    // normal front hits
<span class="nc bnc" id="L455" title="All 10 branches missed.">                    switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L457" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L458" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L459" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L460">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L461">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L462">                            result.setUndoneLocation(tac(table, side, Mech.LOC_CT, cover, false));</span>
<span class="nc" id="L463">                            return result;</span>
                        } // if
<span class="nc" id="L465">                        return tac(table, side, Mech.LOC_CT, cover, false);</span>
                    case 3:
<span class="nc" id="L467">                        return new HitData(Mech.LOC_LLEG);</span>
                    case 4:
                    case 5:
<span class="nc" id="L470">                        return new HitData(Mech.LOC_LARM);</span>
                    case 6:
<span class="nc" id="L472">                        return new HitData(Mech.LOC_LT);</span>
                    case 7:
<span class="nc" id="L474">                        return new HitData(Mech.LOC_CT);</span>
                    case 8:
<span class="nc" id="L476">                        return new HitData(Mech.LOC_RT);</span>
                    case 9:
                    case 10:
<span class="nc" id="L479">                        return new HitData(Mech.LOC_RARM);</span>
                    case 11:
<span class="nc" id="L481">                        return new HitData(Mech.LOC_RLEG);</span>
                    case 12:
<span class="nc bnc" id="L483" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT))) {</span>
<span class="nc" id="L485">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L486">                            HitData result = rollHitLocation(table, side, aimedLocation, cover, aimingMode);</span>
<span class="nc" id="L487">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L488">                            return result;</span>
                        } // if
<span class="nc" id="L490">                        return new HitData(Mech.LOC_HEAD);</span>
                    }
<span class="nc bnc" id="L492" title="All 2 branches missed.">                } else if (side == ToHitData.SIDE_REAR) {</span>
<span class="nc bnc" id="L493" title="All 10 branches missed.">                    switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L495" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L496" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L497" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L498">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L499">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L500">                            result.setUndoneLocation(tac(table, side, Mech.LOC_CT, cover, true));</span>
<span class="nc" id="L501">                            return result;</span>
                        } // if
<span class="nc" id="L503">                        return tac(table, side, Mech.LOC_CT, cover, true);</span>
                    case 3:
<span class="nc" id="L505">                        return new HitData(Mech.LOC_LARM, true);</span>
                    case 4:
                    case 5:
<span class="nc" id="L508">                        return new HitData(Mech.LOC_LLEG, true);</span>
                    case 6:
<span class="nc" id="L510">                        return new HitData(Mech.LOC_LT, true);</span>
                    case 7:
<span class="nc" id="L512">                        return new HitData(Mech.LOC_CT, true);</span>
                    case 8:
<span class="nc" id="L514">                        return new HitData(Mech.LOC_RT, true);</span>
                    case 9:
                    case 10:
<span class="nc" id="L517">                        return new HitData(Mech.LOC_RLEG, true);</span>
                    case 11:
<span class="nc" id="L519">                        return new HitData(Mech.LOC_RARM, true);</span>
                    case 12:
<span class="nc bnc" id="L521" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT))) {</span>
<span class="nc" id="L523">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L524">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L525">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD, true));</span>
<span class="nc" id="L526">                            return result;</span>
                        } // if
<span class="nc" id="L528">                        return new HitData(Mech.LOC_HEAD, true);</span>
                    }
<span class="nc bnc" id="L530" title="All 2 branches missed.">                } else if (side == ToHitData.SIDE_LEFT) {</span>
<span class="nc bnc" id="L531" title="All 10 branches missed.">                    switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L533" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L534" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L535" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L536">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L537">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L538">                            result.setUndoneLocation(tac(table, side, Mech.LOC_LT, cover, false));</span>
<span class="nc" id="L539">                            return result;</span>
                        } // if
<span class="nc" id="L541">                        return tac(table, side, Mech.LOC_LT, cover, false);</span>
                    case 3:
<span class="nc" id="L543">                        return new HitData(Mech.LOC_RARM);</span>
                    case 4:
                    case 5:
<span class="nc" id="L546">                        return new HitData(Mech.LOC_LARM);</span>
                    case 6:
<span class="nc" id="L548">                        return new HitData(Mech.LOC_RT);</span>
                    case 7:
<span class="nc" id="L550">                        return new HitData(Mech.LOC_LT);</span>
                    case 8:
<span class="nc" id="L552">                        return new HitData(Mech.LOC_CT);</span>
                    case 9:
                    case 10:
<span class="nc" id="L555">                        return new HitData(Mech.LOC_LLEG);</span>
                    case 11:
<span class="nc" id="L557">                        return new HitData(Mech.LOC_RLEG);</span>
                    case 12:
<span class="nc bnc" id="L559" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT))) {</span>
<span class="nc" id="L561">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L562">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L563">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L564">                            return result;</span>
                        } // if
<span class="nc" id="L566">                        return new HitData(Mech.LOC_HEAD);</span>
                    }
<span class="nc bnc" id="L568" title="All 2 branches missed.">                } else if (side == ToHitData.SIDE_RIGHT) {</span>
<span class="nc bnc" id="L569" title="All 10 branches missed.">                    switch (roll) {</span>
                    case 2:
<span class="nc bnc" id="L571" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_TAC))</span>
<span class="nc bnc" id="L573" title="All 2 branches missed.">                                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVCOMBAT_NO_TAC)) {</span>
<span class="nc" id="L574">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L575">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L576">                            result.setUndoneLocation(tac(table, side, Mech.LOC_RT, cover, false));</span>
<span class="nc" id="L577">                            return result;</span>
                        } // if
<span class="nc" id="L579">                        return tac(table, side, Mech.LOC_RT, cover, false);</span>
                    case 3:
<span class="nc" id="L581">                        return new HitData(Mech.LOC_LARM);</span>
                    case 4:
                    case 5:
<span class="nc" id="L584">                        return new HitData(Mech.LOC_RARM);</span>
                    case 6:
<span class="nc" id="L586">                        return new HitData(Mech.LOC_CT);</span>
                    case 7:
<span class="nc" id="L588">                        return new HitData(Mech.LOC_RT);</span>
                    case 8:
<span class="nc" id="L590">                        return new HitData(Mech.LOC_LT);</span>
                    case 9:
                    case 10:
<span class="nc" id="L593">                        return new HitData(Mech.LOC_RLEG);</span>
                    case 11:
<span class="nc" id="L595">                        return new HitData(Mech.LOC_LLEG);</span>
                    case 12:
<span class="nc bnc" id="L597" title="All 2 branches missed.">                        if ((getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">                                &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT))) {</span>
<span class="nc" id="L599">                            getCrew().decreaseEdge();</span>
<span class="nc" id="L600">                            HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L601">                            result.setUndoneLocation(new HitData(Mech.LOC_HEAD));</span>
<span class="nc" id="L602">                            return result;</span>
                        } // if
<span class="nc" id="L604">                        return new HitData(Mech.LOC_HEAD);</span>
                    }
                }
            }
        }

<span class="nc bnc" id="L610" title="All 2 branches missed.">        if (table == ToHitData.HIT_PUNCH) {</span>
<span class="nc" id="L611">            roll = Compute.d6();</span>
            try {
<span class="nc" id="L613">                PrintWriter pw = PreferenceManager.getClientPreferences().getMekHitLocLog();</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L615">                    pw.print(table);</span>
<span class="nc" id="L616">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L617">                    pw.print(side);</span>
<span class="nc" id="L618">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L619">                    pw.println(roll);</span>
                }
<span class="nc" id="L621">            } catch (Throwable thrown) {</span>
<span class="nc" id="L622">                thrown.printStackTrace();</span>
<span class="nc" id="L623">            }</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">            if (side == ToHitData.SIDE_FRONT) {</span>
<span class="nc bnc" id="L625" title="All 7 branches missed.">                switch (roll) {</span>
                case 1:
<span class="nc" id="L627">                    return new HitData(Mech.LOC_LARM);</span>
                case 2:
<span class="nc" id="L629">                    return new HitData(Mech.LOC_LT);</span>
                case 3:
<span class="nc" id="L631">                    return new HitData(Mech.LOC_CT);</span>
                case 4:
<span class="nc" id="L633">                    return new HitData(Mech.LOC_RT);</span>
                case 5:
<span class="nc" id="L635">                    return new HitData(Mech.LOC_RARM);</span>
                case 6:
<span class="nc bnc" id="L637" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L639">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L640">                        HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L641">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD, true));</span>
<span class="nc" id="L642">                        return result;</span>
                    } // if
<span class="nc" id="L644">                    return new HitData(Mech.LOC_HEAD, true);</span>
                }
<span class="nc bnc" id="L646" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_REAR) {</span>
<span class="nc bnc" id="L647" title="All 7 branches missed.">                switch (roll) {</span>
                case 1:
<span class="nc" id="L649">                    return new HitData(Mech.LOC_LLEG, true);</span>
                case 2:
<span class="nc" id="L651">                    return new HitData(Mech.LOC_LT, true);</span>
                case 3:
<span class="nc" id="L653">                    return new HitData(Mech.LOC_CT, true);</span>
                case 4:
<span class="nc" id="L655">                    return new HitData(Mech.LOC_RT, true);</span>
                case 5:
<span class="nc" id="L657">                    return new HitData(Mech.LOC_RLEG, true);</span>
                case 6:
<span class="nc bnc" id="L659" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L661">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L662">                        HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L663">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD, true));</span>
<span class="nc" id="L664">                        return result;</span>
                    } // if
<span class="nc" id="L666">                    return new HitData(Mech.LOC_HEAD, true);</span>
                }
<span class="nc bnc" id="L668" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_LEFT) {</span>
<span class="nc bnc" id="L669" title="All 6 branches missed.">                switch (roll) {</span>
                case 1:
                case 2:
<span class="nc" id="L672">                    return new HitData(Mech.LOC_LT);</span>
                case 3:
<span class="nc" id="L674">                    return new HitData(Mech.LOC_CT);</span>
                case 4:
<span class="nc" id="L676">                    return new HitData(Mech.LOC_LARM);</span>
                case 5:
<span class="nc" id="L678">                    return new HitData(Mech.LOC_LLEG);</span>
                case 6:
<span class="nc bnc" id="L680" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L682">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L683">                        HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L684">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD, true));</span>
<span class="nc" id="L685">                        return result;</span>
                    } // if
<span class="nc" id="L687">                    return new HitData(Mech.LOC_HEAD);</span>
                }
<span class="nc bnc" id="L689" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_RIGHT) {</span>
<span class="nc bnc" id="L690" title="All 6 branches missed.">                switch (roll) {</span>
                case 1:
                case 2:
<span class="nc" id="L693">                    return new HitData(Mech.LOC_RT);</span>
                case 3:
<span class="nc" id="L695">                    return new HitData(Mech.LOC_CT);</span>
                case 4:
<span class="nc" id="L697">                    return new HitData(Mech.LOC_RARM);</span>
                case 5:
<span class="nc" id="L699">                    return new HitData(Mech.LOC_RLEG);</span>
                case 6:
<span class="nc bnc" id="L701" title="All 2 branches missed.">                    if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L702" title="All 2 branches missed.">                            &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L703">                        getCrew().decreaseEdge();</span>
<span class="nc" id="L704">                        HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L705">                        result.setUndoneLocation(new HitData(Mech.LOC_HEAD, true));</span>
<span class="nc" id="L706">                        return result;</span>
                    } // if
<span class="nc" id="L708">                    return new HitData(Mech.LOC_HEAD);</span>
                }
            }
<span class="nc bnc" id="L711" title="All 2 branches missed.">        } else if (table == ToHitData.HIT_KICK) {</span>
<span class="nc" id="L712">            roll = Compute.d6(1);</span>
            try {
<span class="nc" id="L714">                PrintWriter pw = PreferenceManager.getClientPreferences().getMekHitLocLog();</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L716">                    pw.print(table);</span>
<span class="nc" id="L717">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L718">                    pw.print(side);</span>
<span class="nc" id="L719">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L720">                    pw.println(roll);</span>
                }
<span class="nc" id="L722">            } catch (Throwable thrown) {</span>
<span class="nc" id="L723">                thrown.printStackTrace();</span>
<span class="nc" id="L724">            }</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">            boolean left = (roll &lt;= 3);</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">            if (side == ToHitData.SIDE_FRONT) {</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">                if (left) {</span>
<span class="nc" id="L728">                    return new HitData(Mech.LOC_LARM);</span>
                }
<span class="nc" id="L730">                return new HitData(Mech.LOC_RARM);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_REAR) {</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">                if (left) {</span>
<span class="nc" id="L733">                    return new HitData(Mech.LOC_LLEG);</span>
                }
<span class="nc" id="L735">                return new HitData(Mech.LOC_RLEG);</span>
<span class="nc bnc" id="L736" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_LEFT) {</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">                if (left) {</span>
<span class="nc" id="L738">                    return new HitData(Mech.LOC_LLEG);</span>
                }
<span class="nc" id="L740">                return new HitData(Mech.LOC_LARM);</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">            } else if (side == ToHitData.SIDE_RIGHT) {</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (left) {</span>
<span class="nc" id="L743">                    return new HitData(Mech.LOC_RARM);</span>
                }
<span class="nc" id="L745">                return new HitData(Mech.LOC_RLEG);</span>
            }
<span class="nc bnc" id="L747" title="All 4 branches missed.">        } else if ((table == ToHitData.HIT_SWARM) || (table == ToHitData.HIT_SWARM_CONVENTIONAL)) {</span>
            int effects;
<span class="nc bnc" id="L749" title="All 2 branches missed.">            if (table == ToHitData.HIT_SWARM_CONVENTIONAL) {</span>
<span class="nc" id="L750">                effects = HitData.EFFECT_NONE;</span>
            } else {
<span class="nc" id="L752">                effects = HitData.EFFECT_CRITICAL;</span>
            }
<span class="nc" id="L754">            roll = Compute.d6(2);</span>
            try {
<span class="nc" id="L756">                PrintWriter pw = PreferenceManager.getClientPreferences().getMekHitLocLog();</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">                if (pw != null) {</span>
<span class="nc" id="L758">                    pw.print(table);</span>
<span class="nc" id="L759">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L760">                    pw.print(side);</span>
<span class="nc" id="L761">                    pw.print(&quot;\t&quot;);</span>
<span class="nc" id="L762">                    pw.println(roll);</span>
                }
<span class="nc" id="L764">            } catch (Throwable thrown) {</span>
<span class="nc" id="L765">                thrown.printStackTrace();</span>
<span class="nc" id="L766">            }</span>
            // Swarm attack locations.
<span class="nc bnc" id="L768" title="All 12 branches missed.">            switch (roll) {</span>
            case 2:
<span class="nc bnc" id="L770" title="All 2 branches missed.">                if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L771" title="All 2 branches missed.">                        &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L772">                    getCrew().decreaseEdge();</span>
<span class="nc" id="L773">                    HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L774">                    result.setUndoneLocation(new HitData(Mech.LOC_HEAD, false, effects));</span>
<span class="nc" id="L775">                    return result;</span>
                } // if
<span class="nc" id="L777">                return new HitData(Mech.LOC_HEAD, false, effects);</span>
            case 3:
<span class="nc" id="L779">                return new HitData(Mech.LOC_RT, false, effects);</span>
            case 4:
<span class="nc" id="L781">                return new HitData(Mech.LOC_CT, true, effects);</span>
            case 5:
<span class="nc" id="L783">                return new HitData(Mech.LOC_RT, true, effects);</span>
            case 6:
<span class="nc" id="L785">                return new HitData(Mech.LOC_RT, false, effects);</span>
            case 7:
<span class="nc" id="L787">                return new HitData(Mech.LOC_CT, false, effects);</span>
            case 8:
<span class="nc" id="L789">                return new HitData(Mech.LOC_LT, false, effects);</span>
            case 9:
<span class="nc" id="L791">                return new HitData(Mech.LOC_LT, true, effects);</span>
            case 10:
<span class="nc" id="L793">                return new HitData(Mech.LOC_CT, true, effects);</span>
            case 11:
<span class="nc" id="L795">                return new HitData(Mech.LOC_LT, false, effects);</span>
            case 12:
<span class="nc bnc" id="L797" title="All 2 branches missed.">                if (getCrew().hasEdgeRemaining()</span>
<span class="nc bnc" id="L798" title="All 2 branches missed.">                        &amp;&amp; getCrew().getOptions().booleanOption(OptionsConstants.EDGE_WHEN_HEADHIT)) {</span>
<span class="nc" id="L799">                    getCrew().decreaseEdge();</span>
<span class="nc" id="L800">                    HitData result = rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
<span class="nc" id="L801">                    result.setUndoneLocation(new HitData(Mech.LOC_HEAD, false, effects));</span>
<span class="nc" id="L802">                    return result;</span>
                } // if
<span class="nc" id="L804">                return new HitData(Mech.LOC_HEAD, false, effects);</span>
            }
        }
<span class="nc" id="L807">        return super.rollHitLocation(table, side, aimedLocation, aimingMode, cover);</span>
    }

    @Override
    public boolean removePartialCoverHits(int location, int cover, int side) {
        // treat front legs like legs not arms.
        
        // Handle upper cover specially, as treating it as a bitmask will lead
        //  to every location being covered
<span class="pc bpc" id="L816" title="1 of 2 branches missed.">        if (cover  == LosEffects.COVER_UPPER) {</span>
<span class="nc bnc" id="L817" title="All 8 branches missed.">            if ((location == LOC_LLEG) || (location == LOC_RLEG)</span>
                    || (location == LOC_LARM) || (location == LOC_RARM)) {
<span class="nc" id="L819">                return false;</span>
            } else {
<span class="nc" id="L821">                return true;</span>
            }
        }
        
        // left and right cover are from attacker's POV.
        // if hitting front arc, need to swap them
<span class="pc bpc" id="L827" title="1 of 2 branches missed.">        if (side == ToHitData.SIDE_FRONT) {</span>
<span class="nc bnc" id="L828" title="All 6 branches missed.">            if (((cover &amp; LosEffects.COVER_LOWRIGHT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_LARM) ||
                     (location == Mech.LOC_LLEG))) {
<span class="nc" id="L831">                return true;</span>
            }
<span class="nc bnc" id="L833" title="All 6 branches missed.">            if (((cover &amp; LosEffects.COVER_LOWLEFT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_RARM) ||
                     (location == Mech.LOC_RLEG))) {
<span class="nc" id="L836">                return true;</span>
            }
<span class="nc bnc" id="L838" title="All 8 branches missed.">            if (((cover &amp; LosEffects.COVER_RIGHT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_LARM) ||
                     (location == Mech.LOC_LT) ||
                     (location == Mech.LOC_LLEG))) {
<span class="nc" id="L842">                return true;</span>
            }
<span class="nc bnc" id="L844" title="All 8 branches missed.">            if (((cover &amp; LosEffects.COVER_LEFT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_RARM) ||
                     (location == Mech.LOC_RT) ||
                     (location == Mech.LOC_RLEG))) {
<span class="nc" id="L848">                return true;</span>
            }
        } else {
<span class="pc bpc" id="L851" title="3 of 6 branches missed.">            if (((cover &amp; LosEffects.COVER_LOWLEFT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_LARM) ||
                     (location == Mech.LOC_LLEG))) {
<span class="nc" id="L854">                return true;</span>
            }
<span class="pc bpc" id="L856" title="5 of 6 branches missed.">            if (((cover &amp; LosEffects.COVER_LOWRIGHT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_RARM) ||
                     (location == Mech.LOC_RLEG))) {
<span class="nc" id="L859">                return true;</span>
            }
<span class="pc bpc" id="L861" title="7 of 8 branches missed.">            if (((cover &amp; LosEffects.COVER_LEFT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_LARM) ||
                     (location == Mech.LOC_LT) ||
                     (location == Mech.LOC_LLEG))) {
<span class="nc" id="L865">                return true;</span>
            }
<span class="pc bpc" id="L867" title="7 of 8 branches missed.">            if (((cover &amp; LosEffects.COVER_RIGHT) != 0) &amp;&amp;</span>
                    ((location == Mech.LOC_RARM) ||
                     (location == Mech.LOC_RT) ||
                     (location == Mech.LOC_RLEG))) {
<span class="nc" id="L871">                return true;</span>
            }
        }
<span class="fc" id="L874">        return false;</span>
    }

    /**
     * Checks for functional AES in all legs
     */
    @Override
    public boolean hasFunctionalLegAES() {
<span class="fc" id="L882">        boolean frontRightLeg = false;</span>
<span class="fc" id="L883">        boolean frontLeftLeg = false;</span>
<span class="fc" id="L884">        boolean rearRightLeg = false;</span>
<span class="fc" id="L885">        boolean rearLeftLeg = false;</span>

<span class="pc bpc" id="L887" title="1 of 2 branches missed.">        for (Mounted mounted : getMisc()) {</span>
<span class="nc bnc" id="L888" title="All 8 branches missed.">            if ((mounted.getLocation() == Mech.LOC_LLEG) || (mounted.getLocation() == Mech.LOC_RLEG) || (mounted.getLocation() == Mech.LOC_LARM) || (mounted.getLocation() == Mech.LOC_RARM)) {</span>
<span class="nc bnc" id="L889" title="All 8 branches missed.">                if (((MiscType) mounted.getType()).hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM) &amp;&amp; !mounted.isDestroyed() &amp;&amp; !mounted.isBreached() &amp;&amp; !mounted.isMissing()) {</span>
<span class="nc bnc" id="L890" title="All 2 branches missed.">                    if (mounted.getLocation() == Mech.LOC_LLEG) {</span>
<span class="nc" id="L891">                        rearLeftLeg = true;</span>
<span class="nc bnc" id="L892" title="All 2 branches missed.">                    } else if (mounted.getLocation() == Mech.LOC_RLEG) {</span>
<span class="nc" id="L893">                        rearRightLeg = true;</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">                    } else if (mounted.getLocation() == Mech.LOC_RARM) {</span>
<span class="nc" id="L895">                        frontRightLeg = true;</span>
                    } else {
<span class="nc" id="L897">                        frontLeftLeg = true;</span>
                    }

                }// AES is destroyed their for it cannot be used.
<span class="nc bnc" id="L901" title="All 2 branches missed.">                else if (((MiscType) mounted.getType()).hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)) {</span>
<span class="nc" id="L902">                    return false;</span>
                }
            }
<span class="nc" id="L905">        }</span>

<span class="pc bpc" id="L907" title="7 of 8 branches missed.">        return frontLeftLeg &amp;&amp; frontRightLeg &amp;&amp; rearRightLeg &amp;&amp; rearLeftLeg;</span>
    }

    @Override
    public boolean canGoHullDown() {
        // check the option
<span class="fc" id="L913">        boolean retVal = game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN);</span>
<span class="pc bpc" id="L914" title="1 of 2 branches missed.">        if (!retVal) {</span>
<span class="fc" id="L915">            return false;</span>
        }
        //check the locations
<span class="nc" id="L918">        int locations[] = {Mech.LOC_RARM, Mech.LOC_LARM, Mech.LOC_LLEG, Mech.LOC_RLEG};</span>
<span class="nc" id="L919">        int badLocs = 0;</span>
<span class="nc bnc" id="L920" title="All 2 branches missed.">        for ( int loc = locations.length -1; loc &gt;= 0; loc-- ) {</span>
<span class="nc bnc" id="L921" title="All 4 branches missed.">            if ( isLocationBad(locations[loc]) || isLocationDoomed(locations[loc])) {</span>
<span class="nc" id="L922">                badLocs++;</span>
            }
        }
<span class="nc bnc" id="L925" title="All 2 branches missed.">        if (!(badLocs &lt;2)) {</span>
<span class="nc" id="L926">            return false;</span>
        }
        //check the Gyro
<span class="nc bnc" id="L929" title="All 2 branches missed.">        return !isGyroDestroyed();</span>
    }

    /**
     * Is the passed in location an arm?
     * @param loc
     * @return
     */
    @Override
    public boolean isArm(int loc) {
        // quads don't have arms
<span class="nc" id="L940">        return false;</span>
    }

    @Override
    public boolean hasMPReducingHardenedArmor() {
<span class="pc bpc" id="L945" title="4 of 8 branches missed.">        return (armorType[LOC_LLEG] == EquipmentType.T_ARMOR_HARDENED)</span>
            || (armorType[LOC_RLEG] == EquipmentType.T_ARMOR_HARDENED)
            || (armorType[LOC_LARM] == EquipmentType.T_ARMOR_HARDENED)
            || (armorType[LOC_RARM] == EquipmentType.T_ARMOR_HARDENED);
    }

    @Override
    public long getEntityType(){
<span class="fc" id="L953">        return Entity.ETYPE_MECH | Entity.ETYPE_QUAD_MECH;</span>
    }

    /**
     * quad mechs can't have claws
     */
    @Override
    public boolean hasClaw(int location) {
<span class="nc" id="L961">        return false;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>