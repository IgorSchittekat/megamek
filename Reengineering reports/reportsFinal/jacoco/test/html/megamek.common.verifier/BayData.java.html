<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BayData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common.verifier</a> &gt; <span class="el_source">BayData.java</span></div><h1>BayData.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2018 - The MegaMek Team
 *
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 2 of the License, or (at your option) any later
 * version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 */
package megamek.common.verifier;

import java.util.function.BiFunction;

import megamek.common.*;
import megamek.common.annotations.Nullable;

/**
 * Construction data used by transport bays for mechs, vees, and aerospace units.
 * 
 * @author Neoancient
 *
 */
<span class="fc" id="L27">public enum BayData {</span>
<span class="fc" id="L28">    MECH (&quot;Mech&quot;, 150.0, 2, MechBay.techAdvancement(),</span>
<span class="nc" id="L29">            (size, num) -&gt; new MechBay(size, 1, num)),</span>
<span class="fc" id="L30">    PROTOMECH (&quot;Protomech&quot;, 10.0, 6, ProtomechBay.techAdvancement(),</span>
<span class="nc" id="L31">            (size, num) -&gt; new ProtomechBay(size, 1, num)),</span>
<span class="fc" id="L32">    VEHICLE_HEAVY (&quot;Heavy Vehicle&quot;, 100.0, 8, HeavyVehicleBay.techAdvancement(),</span>
<span class="nc" id="L33">            (size, num) -&gt; new HeavyVehicleBay(size, 1, num)),</span>
<span class="fc" id="L34">    VEHICLE_LIGHT (&quot;Light Vehicle&quot;, 50.0, 5, LightVehicleBay.techAdvancement(),</span>
<span class="nc" id="L35">            (size, num) -&gt; new LightVehicleBay(size, 1, num)),</span>
<span class="fc" id="L36">    VEHICLE_SH (&quot;Superheavy Vehicle&quot;, 200.0, 15, SuperHeavyVehicleBay.techAdvancement(),</span>
<span class="nc" id="L37">            (size, num) -&gt; new SuperHeavyVehicleBay(size, 1, num)),</span>
<span class="fc" id="L38">    INFANTRY_FOOT (&quot;Infantry (Foot)&quot;, 5.0, 0, InfantryBay.techAdvancement(),</span>
<span class="nc" id="L39">            (size, num) -&gt; new InfantryBay(size, 1, num, InfantryBay.PlatoonType.FOOT)),</span>
<span class="fc" id="L40">    INFANTRY_JUMP (&quot;Infantry (Jump)&quot;, 6.0, 0, InfantryBay.techAdvancement(),</span>
<span class="nc" id="L41">            (size, num) -&gt; new InfantryBay(size, 1, num, InfantryBay.PlatoonType.JUMP)),</span>
<span class="fc" id="L42">    INFANTRY_MOTORIZED (&quot;Infantry (Motorized)&quot;, 7.0, 0, InfantryBay.techAdvancement(),</span>
<span class="nc" id="L43">            (size, num) -&gt; new InfantryBay(size, 1, num, InfantryBay.PlatoonType.MOTORIZED)),</span>
<span class="fc" id="L44">    INFANTRY_MECHANIZED (&quot;Infantry (Mech. Squad)&quot;, 8.0, 0, InfantryBay.techAdvancement(),</span>
<span class="nc" id="L45">            (size, num) -&gt; new InfantryBay(size, 1, num, InfantryBay.PlatoonType.MECHANIZED)),</span>
<span class="fc" id="L46">    IS_BATTLE_ARMOR (&quot;BattleArmor (IS)&quot;, 8.0, 6, BattleArmorBay.techAdvancement(),</span>
<span class="nc" id="L47">            (size, num) -&gt; new BattleArmorBay(size, 1, num, false, false)),</span>
<span class="fc" id="L48">    CLAN_BATTLE_ARMOR (&quot;BattleArmor (Clan)&quot;, 10.0, 6, BattleArmorBay.techAdvancement(),</span>
<span class="nc" id="L49">            (size, num) -&gt; new BattleArmorBay(size, 1, num, true, false)),</span>
<span class="fc" id="L50">    CS_BATTLE_ARMOR (&quot;BattleArmor (CS)&quot;, 12.0, 6, BattleArmorBay.techAdvancement(),</span>
<span class="nc" id="L51">            (size, num) -&gt; new BattleArmorBay(size, 1, num, false, true)),</span>
<span class="fc" id="L52">    FIGHTER (&quot;Fighter&quot;, 150.0, 2, ASFBay.techAdvancement(),</span>
<span class="nc" id="L53">            (size, num) -&gt; new ASFBay(size, 1, num)),</span>
<span class="fc" id="L54">    SMALL_CRAFT (&quot;Small Craft&quot;, 200.0, 5, SmallCraftBay.techAdvancement(),</span>
<span class="nc" id="L55">            (size, num) -&gt; new SmallCraftBay(size, 1, num)),</span>
<span class="fc" id="L56">    DROPSHUTTLE (&quot;Dropshuttle&quot;, 11000.0, 0, DropshuttleBay.techAdvancement(),</span>
<span class="nc" id="L57">            (size, num) -&gt; new DropshuttleBay(1, num, 0)),</span>
<span class="fc" id="L58">    REPAIR_UNPRESSURIZED (&quot;Standard Repair Facility (Unpressurized)&quot;, 0.025, 0, NavalRepairFacility.techAdvancement(),</span>
<span class="nc" id="L59">            (size, num) -&gt; new NavalRepairFacility(size, 1, num, 0, false)),</span>
<span class="fc" id="L60">    REPAIR_PRESSURIZED (&quot;Standard Repair Facility (Pressurized)&quot;, 0.075, 0, NavalRepairFacility.techAdvancement(),</span>
<span class="nc" id="L61">            (size, num) -&gt; new NavalRepairFacility(size, 1, num, 0, true)),</span>
<span class="fc" id="L62">    REPAIR_REINFORCED (&quot;Reinforced Repair Facility&quot;, 0.1, 0, ReinforcedRepairFacility.techAdvancement(),</span>
<span class="nc" id="L63">            (size, num) -&gt; new ReinforcedRepairFacility(size, 1, num, 0)),</span>
<span class="fc" id="L64">    ARTS_FIGHTER (&quot;ARTS Fighter&quot;, 187.5, 0, Bay.artsTechAdvancement(),</span>
<span class="nc" id="L65">            (size, num) -&gt; new ASFBay(size, 1, num, true)),</span>
<span class="fc" id="L66">    ARTS_SMALL_CRAFT (&quot;ARTS Small Craft&quot;, 250.0, 0, Bay.artsTechAdvancement(),</span>
<span class="nc" id="L67">            (size, num) -&gt; new SmallCraftBay(size, 1, num, true)),</span>
<span class="fc" id="L68">    ARTS_REPAIR_UNPRESSURIZED (&quot;ARTS Standard Repair Facility (Unpressurized)&quot;, 0.03125, 0, Bay.artsTechAdvancement(),</span>
<span class="nc" id="L69">            (size, num) -&gt; new NavalRepairFacility(size, 1, num, 0, false, true)),</span>
<span class="fc" id="L70">    ARTS_REPAIR_PRESSURIZED (&quot;ARTS Standard Repair Facility (Pressurized)&quot;, 0.09375, 0, Bay.artsTechAdvancement(),</span>
<span class="nc" id="L71">            (size, num) -&gt; new NavalRepairFacility(size, 1, num, 0, true, true)),</span>
<span class="fc" id="L72">    CARGO (&quot;Cargo&quot;, 1.0, 0, CargoBay.techAdvancement(),</span>
<span class="fc" id="L73">            (size, num) -&gt; new CargoBay(size, 1, num)),</span>
<span class="fc" id="L74">    LIQUID_CARGO (&quot;Cargo (Liquid)&quot;, 1/0.91, 0, CargoBay.techAdvancement(),</span>
<span class="fc" id="L75">            (size, num) -&gt; new LiquidCargoBay(size, 1, num)),</span>
<span class="fc" id="L76">    REFRIGERATED_CARGO (&quot;Cargo (Refrigerated)&quot;, 1/0.87, 0, CargoBay.techAdvancement(),</span>
<span class="fc" id="L77">            (size, num) -&gt; new RefrigeratedCargoBay(size, 1, num)),</span>
<span class="fc" id="L78">    INSULATED_CARGO (&quot;Cargo (Insulated)&quot;, 1/0.87, 0, CargoBay.techAdvancement(),</span>
<span class="fc" id="L79">            (size, num) -&gt; new InsulatedCargoBay(size, 1, num)),</span>
<span class="fc" id="L80">    LIVESTOCK_CARGO (&quot;Cargo Livestock)&quot;, 1/0.83, 0, CargoBay.techAdvancement(),</span>
<span class="fc" id="L81">            (size, num) -&gt; new LivestockCargoBay(size, 1, num));</span>
    
    private final String name;
    private final double weight;
    private final int personnel;
    private final TechAdvancement techAdvancement;
    private final BiFunction&lt;Double,Integer,Bay&gt; init;
    
    BayData(String name, double weight, int personnel,
<span class="fc" id="L90">            TechAdvancement techAdvancement, BiFunction&lt;Double,Integer,Bay&gt; init) {</span>
<span class="fc" id="L91">        this.name = name;</span>
<span class="fc" id="L92">        this.weight = weight;</span>
<span class="fc" id="L93">        this.personnel = personnel;</span>
<span class="fc" id="L94">        this.techAdvancement = techAdvancement;</span>
<span class="fc" id="L95">        this.init = init;</span>
<span class="fc" id="L96">    }</span>
    
    /**
     * @return A String identifying the type of bay suitable for display.
     */
    public String getDisplayName() {
<span class="nc" id="L102">        return name;</span>
    }

    /**
     * The weight of a single unit of capacity. For unit transport bays this is the weight of a single
     * cubicle. For cargo this is the weight of one ton of cargo capacity. 
     * 
     * @return The weight of a single unit.
     */
    public double getWeight() {
<span class="fc" id="L112">        return weight;</span>
    }
    
    /**
     * @return The number of bay personnel normally quartered per unit capacity.
     */
    public int getPersonnel() {
<span class="nc" id="L119">        return personnel;</span>
    }

    /**
     * Creates a new bay of the type.
     * 
     * @param size    The size of bay in cubicles (units) or tons (cargo; this is bay tonnage, not capacity).
     * @param bayNum  The bay number; this should be unique for the unit.
     * @return        The new bay.
     */
    public Bay newBay(double size, int bayNum) {
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">        if (isCargoBay()) {</span>
            // Remove floating point inaccuracy
<span class="fc" id="L132">            return init.apply(RoundWeight.nearestKg(size / weight), bayNum);</span>
        } else {
<span class="nc" id="L134">            return init.apply(size, bayNum);</span>
        }
    }
    
    /**
     * @return The tech progression for the bay type.
     */
    public TechAdvancement getTechAdvancement() {
<span class="nc" id="L142">        return techAdvancement;</span>
    }

    /**
     * Identifies the type of bay.
     * 
     * @param bay A &lt;code&gt;Bay&lt;/code&gt; that is (or can be) mounted on a unit. 
     * @return    The enum value for the bay. Returns null if the bay is not a transport by
     *            (e.g. crew quarters)
     */
    public static @Nullable BayData getBayType(Bay bay) {
<span class="fc bfc" id="L153" title="All 2 branches covered.">        if (bay instanceof MechBay) {</span>
<span class="fc" id="L154">            return MECH;</span>
<span class="fc bfc" id="L155" title="All 2 branches covered.">        } else if (bay instanceof ProtomechBay) {</span>
<span class="fc" id="L156">            return PROTOMECH;</span>
<span class="fc bfc" id="L157" title="All 2 branches covered.">        } else if (bay instanceof HeavyVehicleBay) {</span>
<span class="fc" id="L158">            return VEHICLE_HEAVY;</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">        } else if (bay instanceof LightVehicleBay) {</span>
<span class="fc" id="L160">            return VEHICLE_LIGHT;</span>
<span class="fc bfc" id="L161" title="All 2 branches covered.">        } else if (bay instanceof SuperHeavyVehicleBay) {</span>
<span class="fc" id="L162">            return VEHICLE_SH;</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">        } else if (bay instanceof InfantryBay) {</span>
<span class="fc bfc" id="L164" title="All 4 branches covered.">            switch (((InfantryBay) bay).getPlatoonType()) {</span>
                case JUMP:
<span class="fc" id="L166">                    return INFANTRY_JUMP;</span>
                case MECHANIZED:
<span class="fc" id="L168">                    return INFANTRY_MECHANIZED;</span>
                case MOTORIZED:
<span class="fc" id="L170">                    return INFANTRY_MOTORIZED;</span>
                case FOOT:
                default:
<span class="fc" id="L173">                    return INFANTRY_FOOT;</span>
                
            }
<span class="fc bfc" id="L176" title="All 2 branches covered.">        } else if (bay instanceof BattleArmorBay) {</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">            if (bay.getWeight() / bay.getCapacity() == 12) {</span>
<span class="fc" id="L178">                return CS_BATTLE_ARMOR;</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            } else if (bay.getWeight() / bay.getCapacity() == 10) {</span>
<span class="fc" id="L180">                return CLAN_BATTLE_ARMOR;</span>
            }
<span class="fc" id="L182">            return IS_BATTLE_ARMOR;</span>
<span class="fc bfc" id="L183" title="All 2 branches covered.">        } else if (bay instanceof ASFBay) {</span>
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">            return ((ASFBay) bay).hasARTS() ? ARTS_FIGHTER : FIGHTER;</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">        } else if (bay instanceof DropshuttleBay) {</span>
<span class="nc" id="L186">            return DROPSHUTTLE;</span>
<span class="pc bpc" id="L187" title="1 of 2 branches missed.">        } else if (bay instanceof ReinforcedRepairFacility) {</span>
<span class="nc" id="L188">            return REPAIR_REINFORCED;</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        } else if (bay instanceof NavalRepairFacility) {</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (((NavalRepairFacility) bay).isPressurized()) {</span>
<span class="nc bnc" id="L191" title="All 2 branches missed.">                return ((NavalRepairFacility) bay).hasARTS() ? ARTS_REPAIR_PRESSURIZED : REPAIR_PRESSURIZED;</span>
            } else {
<span class="nc bnc" id="L193" title="All 2 branches missed.">                return ((NavalRepairFacility) bay).hasARTS() ? ARTS_REPAIR_UNPRESSURIZED : REPAIR_UNPRESSURIZED;</span>
            }
<span class="fc bfc" id="L195" title="All 2 branches covered.">        } else if (bay instanceof SmallCraftBay) {</span>
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">            return ((SmallCraftBay) bay).hasARTS() ? ARTS_SMALL_CRAFT : SMALL_CRAFT;</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">        } else if (bay instanceof LiquidCargoBay) {</span>
<span class="fc" id="L198">            return LIQUID_CARGO;</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">        } else if (bay instanceof LivestockCargoBay) {</span>
<span class="fc" id="L200">            return LIVESTOCK_CARGO;</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">        } else if (bay instanceof RefrigeratedCargoBay) {</span>
<span class="fc" id="L202">            return REFRIGERATED_CARGO;</span>
<span class="fc bfc" id="L203" title="All 2 branches covered.">        } else if (bay instanceof InsulatedCargoBay) {</span>
<span class="fc" id="L204">            return INSULATED_CARGO;</span>
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">        } else if (bay instanceof CargoBay) {</span>
<span class="fc" id="L206">            return CARGO;</span>
        } else {
            // Crew quarters are implemented as bays and should not be mixed with transport bays
<span class="nc" id="L209">            return null;</span>
        }
    }
    
    /**
     * @return true if the bay is a type of cargo bay rather than a unit transport bay.
     */
    public boolean isCargoBay() {
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">        return ordinal() &gt;= CARGO.ordinal();</span>
    }

    /**
     * @return true if the bay is an infantry transport bay (including battlearmor)
     */
    public boolean isInfantryBay() {
<span class="nc bnc" id="L224" title="All 2 branches missed.">        return (ordinal() &gt;= INFANTRY_FOOT.ordinal())</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                &amp;&amp; (ordinal() &lt;= CS_BATTLE_ARMOR.ordinal());</span>
    }
    
    /**
     * Determines whether the bay is legal to mount on a given &lt;code&gt;Entity&lt;/code&gt;. Whether it is
     * technically possible or practical is another matter.
     * 
     * @param en The entity
     * @return   Whether the bay is legal
     */
    public boolean isLegalFor(Entity en) {
        //TODO: Container cargo bays aren't implemented, but when added they can be carried by
        // industrial but not battlemechs.
<span class="fc bfc" id="L238" title="All 2 branches covered.">        if (en.hasETypeFlag(Entity.ETYPE_MECH)) {</span>
<span class="pc bpc" id="L239" title="1 of 4 branches missed.">            return isCargoBay() &amp;&amp; (this != LIVESTOCK_CARGO);</span>
<span class="pc bpc" id="L240" title="4 of 8 branches missed.">        } else if ((this == DROPSHUTTLE)</span>
                || (this == REPAIR_UNPRESSURIZED)
                || (this == REPAIR_PRESSURIZED)
                || (this == REPAIR_REINFORCED)) {
<span class="nc" id="L244">            return en.hasETypeFlag(Entity.ETYPE_JUMPSHIP);</span>
        } else {
<span class="fc bfc" id="L246" title="All 2 branches covered.">            return en.hasETypeFlag(Entity.ETYPE_TANK)</span>
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">                    || en.hasETypeFlag(Entity.ETYPE_AERO);</span>
        }
    }

    /**
     * @return Whether the bay type requires a designated armor facing.
     */
    public boolean requiresFacing() {
<span class="nc bnc" id="L255" title="All 12 branches missed.">        return (this == DROPSHUTTLE)</span>
                || (this == REPAIR_UNPRESSURIZED)
                || (this == REPAIR_PRESSURIZED)
                || (this == REPAIR_REINFORCED)
                || (this == ARTS_REPAIR_PRESSURIZED)
                || (this == ARTS_REPAIR_UNPRESSURIZED);
    }

    /**
     * @return Whether the bay capacity can be changed.
     */
    public boolean hasVariableSize() {
<span class="nc bnc" id="L267" title="All 2 branches missed.">        return this != DROPSHUTTLE;</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>