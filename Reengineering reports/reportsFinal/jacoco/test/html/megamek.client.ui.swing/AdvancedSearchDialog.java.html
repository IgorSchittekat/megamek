<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdvancedSearchDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">AdvancedSearchDialog.java</span></div><h1>AdvancedSearchDialog.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2002, 2003 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

/**
 * Advanced search functions for the mech selector dialog
 *
 * @author  Jay Lawson
 */
package megamek.client.ui.swing;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Frame;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.Label;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.Vector;

import javax.swing.DefaultCellEditor;
import javax.swing.DefaultComboBoxModel;
import javax.swing.DefaultRowSorter;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.ListSelectionModel;
import javax.swing.RowFilter;
import javax.swing.RowSorter.SortKey;
import javax.swing.SortOrder;
import javax.swing.SwingConstants;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.AbstractTableModel;
import javax.swing.table.TableColumn;
import javax.swing.table.TableRowSorter;

import megamek.client.ui.Messages;
import megamek.client.ui.swing.table.MegamekTable;
import megamek.common.EquipmentType;
import megamek.common.Mech;
import megamek.common.MechSearchFilter;
import megamek.common.MiscType;
import megamek.common.TechConstants;
import megamek.common.UnitType;
import megamek.common.WeaponType;

/**
 *  JDialog that allows the user to create a unit filter.
 *
 * @author Arlith
 *
 */
public class AdvancedSearchDialog extends JDialog implements ActionListener,
        ItemListener, KeyListener, ListSelectionListener {

    /**
     *
     */
    private static final long serialVersionUID = 1L;
    /**
     *
     */
<span class="nc" id="L91">    private boolean isCanceled = true;</span>
<span class="nc" id="L92">    public MechSearchFilter mechFilter = null;</span>
    private Vector&lt;FilterTokens&gt; filterToks;
<span class="nc" id="L94">    private JButton btnOkay   =</span>
<span class="nc" id="L95">        new JButton(Messages.getString(&quot;Okay&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L96">    private JButton btnCancel = new</span>
<span class="nc" id="L97">    JButton(Messages.getString(&quot;Cancel&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L99">    private JButton btnLeftParen =  new JButton(&quot;(&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L100">    private JButton btnRightParen =  new JButton(&quot;)&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L101">    private JButton btnAdd =</span>
<span class="nc" id="L102">            new JButton(Messages.getString(&quot;MechSelectorDialog.Search.add&quot;));//$NON-NLS-1$</span>
<span class="nc" id="L103">    private JButton btnAnd =</span>
<span class="nc" id="L104">        new JButton(Messages.getString(&quot;MechSelectorDialog.Search.and&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L105">    private JButton btnOr =</span>
<span class="nc" id="L106">        new JButton(Messages.getString(&quot;MechSelectorDialog.Search.or&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L107">    private JButton btnClear =</span>
<span class="nc" id="L108">        new JButton(Messages.getString(&quot;MechSelectorDialog.Reset&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L109">    private JButton btnBack =</span>
        new JButton(&quot;Back&quot;); //$NON-NLS-1$

<span class="nc" id="L112">    private JLabel  lblEqExpTxt =</span>
<span class="nc" id="L113">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.FilterExpression&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L114">    private JTextArea  txtEqExp =</span>
        new JTextArea(&quot;&quot;); //$NON-NLS-1$
<span class="nc" id="L116">    private JScrollPane expScroller = new JScrollPane(txtEqExp,</span>
            JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,
            JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);

<span class="nc" id="L120">    private JLabel lblWalk =</span>
<span class="nc" id="L121">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Walk&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L122">    private JComboBox&lt;String&gt; cWalk = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L123">    private JTextField tWalk = new JTextField(2);</span>

<span class="nc" id="L125">    private JLabel lblJump =</span>
<span class="nc" id="L126">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Jump&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L127">    private JComboBox&lt;String&gt; cJump = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L128">    private JTextField tJump = new JTextField(2);</span>

<span class="nc" id="L130">    private JLabel lblArmor =</span>
<span class="nc" id="L131">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Armor&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L132">    private JComboBox&lt;String&gt; cArmor = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L134">    private JLabel lblTableFilters = new JLabel(</span>
<span class="nc" id="L135">            Messages.getString(&quot;MechSelectorDialog.Search.TableFilters&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L136">    private JLabel lblUnitType = new JLabel(</span>
<span class="nc" id="L137">            Messages.getString(&quot;MechSelectorDialog.Search.UnitType&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L138">    private JLabel lblTechClass = new JLabel(</span>
<span class="nc" id="L139">            Messages.getString(&quot;MechSelectorDialog.Search.TechClass&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L140">    private JLabel lblTechLevel = new JLabel(</span>
<span class="nc" id="L141">            Messages.getString(&quot;MechSelectorDialog.Search.TechLevel&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L142">    private JComboBox&lt;String&gt; cboUnitType = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L143">    private JComboBox&lt;String&gt; cboTechClass = new JComboBox&lt;String&gt;();</span>
<span class="nc" id="L144">    private JComboBox&lt;String&gt; cboTechLevel = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L146">    private JLabel lblWeapons =</span>
<span class="nc" id="L147">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Weapons&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L148">    private JScrollPane scrTableWeapons = new JScrollPane();</span>
    private MegamekTable tblWeapons;
    private WeaponsTableModel weaponsModel;
    private TableRowSorter&lt;WeaponsTableModel&gt; weaponsSorter;

<span class="nc" id="L153">    private JLabel lblEquipment =</span>
<span class="nc" id="L154">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Equipment&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L155">    private JScrollPane scrTableEquipment = new JScrollPane();</span>
    private MegamekTable tblEquipment;
    private EquipmentTableModel equipmentModel;
    private TableRowSorter&lt;EquipmentTableModel&gt; equipmentSorter;

<span class="nc" id="L160">    private JLabel lblYear =</span>
<span class="nc" id="L161">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.Year&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L162">    private JTextField tStartYear = new JTextField(4);</span>
<span class="nc" id="L163">    private JTextField tEndYear = new JTextField(4);</span>

<span class="nc" id="L165">    private JCheckBox cbxEnableCockpitSearch =</span>
<span class="nc" id="L166">        new JCheckBox(Messages.getString(&quot;MechSelectorDialog.Search.Enable&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L167">    private JLabel lblCockpitType =</span>
<span class="nc" id="L168">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.CockpitType&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L169">    private JComboBox&lt;String&gt; cboCockpitType = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L171">    private JCheckBox cbxEnableInternalsSearch =</span>
<span class="nc" id="L172">        new JCheckBox(Messages.getString(&quot;MechSelectorDialog.Search.Enable&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L173">    private JLabel lblInternalsType =</span>
<span class="nc" id="L174">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.InternalsType&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L175">    private JComboBox&lt;String&gt; cboInternalsType = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L177">    private JCheckBox cbxEnableArmorSearch =</span>
<span class="nc" id="L178">        new JCheckBox(Messages.getString(&quot;MechSelectorDialog.Search.Enable&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L179">    private JLabel lblArmorType =</span>
<span class="nc" id="L180">        new JLabel(Messages.getString(&quot;MechSelectorDialog.Search.ArmorType&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L181">    private JComboBox&lt;String&gt; cboArmorType = new JComboBox&lt;String&gt;();</span>

<span class="nc" id="L183">    private JComboBox&lt;String&gt; cboQty   = new JComboBox&lt;String&gt;();</span>

    /**
     * Stores the games current year.
     */
    private int gameYear;

    /**
     * Constructs a new AdvancedSearchDialog.
     *
     * @param frame  Parent frame
     */
    public AdvancedSearchDialog(Frame frame,int yr) {
<span class="nc" id="L196">        super(frame, Messages.getString(&quot;AdvancedSearchDialog.title&quot;), true); //$NON-NLS-1$</span>

<span class="nc" id="L198">        gameYear = yr;</span>

<span class="nc" id="L200">        filterToks = new Vector&lt;FilterTokens&gt;(30);</span>

        //Initialize Items
<span class="nc" id="L203">        btnOkay.addActionListener(this);</span>
<span class="nc" id="L204">        btnCancel.addActionListener(this);</span>
<span class="nc" id="L205">        btnAnd.addActionListener(this);</span>
<span class="nc" id="L206">        btnAdd.addActionListener(this);</span>
<span class="nc" id="L207">        btnLeftParen.addActionListener(this);</span>
<span class="nc" id="L208">        btnRightParen.addActionListener(this);</span>
<span class="nc" id="L209">        btnOr.addActionListener(this);</span>
<span class="nc" id="L210">        btnClear.addActionListener(this);</span>
<span class="nc" id="L211">        btnBack.addActionListener(this);</span>

<span class="nc" id="L213">        btnBack.setEnabled(false);</span>
<span class="nc" id="L214">        btnAdd.setEnabled(false);</span>


<span class="nc" id="L217">        cWalk.addItem(Messages.getString(&quot;MechSelectorDialog.Search.AtLeast&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L218">        cWalk.addItem(Messages.getString(&quot;MechSelectorDialog.Search.EqualTo&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L219">        cWalk.addItem(Messages.getString(&quot;MechSelectorDialog.Search.NoMoreThan&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L221">        cJump.addItem(Messages.getString(&quot;MechSelectorDialog.Search.AtLeast&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L222">        cJump.addItem(Messages.getString(&quot;MechSelectorDialog.Search.EqualTo&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L223">        cJump.addItem(Messages.getString(&quot;MechSelectorDialog.Search.NoMoreThan&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L225">        cArmor.addItem(Messages.getString(&quot;MechSelectorDialog.Search.Any&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L226">        cArmor.addItem(Messages.getString(&quot;MechSelectorDialog.Search.Armor25&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L227">        cArmor.addItem(Messages.getString(&quot;MechSelectorDialog.Search.Armor50&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L228">        cArmor.addItem(Messages.getString(&quot;MechSelectorDialog.Search.Armor75&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L229">        cArmor.addItem(Messages.getString(&quot;MechSelectorDialog.Search.Armor90&quot;)); //$NON-NLS-1$</span>

<span class="nc bnc" id="L231" title="All 2 branches missed.">        for (int i = 0; i &lt; EquipmentType.armorNames.length; i++) {</span>
<span class="nc" id="L232">            cboArmorType.addItem(EquipmentType.armorNames[i]);</span>
        }
<span class="nc" id="L234">        cboArmorType.setEnabled(false);</span>
<span class="nc" id="L235">        lblArmorType.setEnabled(false);</span>

<span class="nc bnc" id="L237" title="All 2 branches missed.">        for (int i = 0; i &lt; EquipmentType.structureNames.length; i++) {</span>
<span class="nc" id="L238">            cboInternalsType.addItem(EquipmentType.structureNames[i]);</span>
        }
<span class="nc" id="L240">        cboInternalsType.setEnabled(false);</span>
<span class="nc" id="L241">        lblInternalsType.setEnabled(false);</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">        for (int i = 0; i &lt; Mech.COCKPIT_STRING.length; i++) {</span>
<span class="nc" id="L244">            cboCockpitType.addItem(Mech.COCKPIT_STRING[i]);</span>
        }
<span class="nc" id="L246">        cboCockpitType.setEnabled(false);</span>
<span class="nc" id="L247">        lblCockpitType.setEnabled(false);</span>

<span class="nc" id="L249">        cbxEnableCockpitSearch.setHorizontalTextPosition(SwingConstants.LEFT);</span>
<span class="nc" id="L250">        cbxEnableCockpitSearch.addItemListener(this);</span>
<span class="nc" id="L251">        cbxEnableInternalsSearch.setHorizontalTextPosition(SwingConstants.LEFT);</span>
<span class="nc" id="L252">        cbxEnableInternalsSearch.addItemListener(this);</span>
<span class="nc" id="L253">        cbxEnableArmorSearch.setHorizontalTextPosition(SwingConstants.LEFT);</span>
<span class="nc" id="L254">        cbxEnableArmorSearch.addItemListener(this);</span>


<span class="nc bnc" id="L257" title="All 2 branches missed.">        for (int i = 1; i &lt;= 20; i++) {</span>
<span class="nc" id="L258">            cboQty.addItem(Integer.toString(i));</span>
        }
<span class="nc" id="L260">        cboQty.setSelectedIndex(0);</span>

        //Setup table filter combo boxes
<span class="nc" id="L263">        DefaultComboBoxModel&lt;String&gt; unitTypeModel = new DefaultComboBoxModel&lt;String&gt;();</span>
<span class="nc" id="L264">        unitTypeModel.addElement(Messages.getString(&quot;MechSelectorDialog.All&quot;));</span>
<span class="nc" id="L265">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.MEK));</span>
<span class="nc" id="L266">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.TANK));</span>
<span class="nc" id="L267">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.BATTLE_ARMOR));</span>
<span class="nc" id="L268">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.INFANTRY));</span>
<span class="nc" id="L269">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.PROTOMEK));</span>
<span class="nc" id="L270">        unitTypeModel.addElement(UnitType.getTypeDisplayableName(UnitType.AERO));</span>
<span class="nc" id="L271">        unitTypeModel.setSelectedItem(Messages.getString(&quot;MechSelectorDialog.All&quot;));</span>

<span class="nc" id="L273">        cboUnitType.setModel(unitTypeModel);</span>
<span class="nc" id="L274">        cboUnitType.addActionListener(this);</span>

<span class="nc" id="L276">        DefaultComboBoxModel&lt;String&gt; techLevelModel = new DefaultComboBoxModel&lt;String&gt;();</span>
<span class="nc bnc" id="L277" title="All 2 branches missed.">        for (int i = 0; i &lt; TechConstants.SIZE; i++) {</span>
<span class="nc" id="L278">            techLevelModel.addElement(TechConstants.getLevelDisplayableName(i));</span>
        }
<span class="nc" id="L280">        techLevelModel.setSelectedItem(TechConstants.getLevelDisplayableName(TechConstants.SIZE-1));</span>
<span class="nc" id="L281">        cboTechLevel.setModel(techLevelModel);</span>
<span class="nc" id="L282">        cboTechLevel.addActionListener(this);</span>

<span class="nc" id="L284">        DefaultComboBoxModel&lt;String&gt; techClassModel = new DefaultComboBoxModel&lt;String&gt;();</span>
<span class="nc" id="L285">        techClassModel.addElement(&quot;All&quot;);</span>
<span class="nc" id="L286">        techClassModel.addElement(&quot;Inner Sphere&quot;);</span>
<span class="nc" id="L287">        techClassModel.addElement(&quot;Clan&quot;);</span>
<span class="nc" id="L288">        techClassModel.addElement(&quot;IS/Clan&quot;);</span>
<span class="nc" id="L289">        techClassModel.addElement(&quot;(Unknown Technology Base)&quot;);</span>
<span class="nc" id="L290">        techClassModel.setSelectedItem(&quot;All&quot;);</span>
<span class="nc" id="L291">        cboTechClass.setModel(techClassModel);</span>
<span class="nc" id="L292">        cboTechClass.addActionListener(this);</span>


        //Setup Weapons Table
<span class="nc" id="L296">        scrTableWeapons.setMinimumSize(new Dimension(850, 150));</span>
<span class="nc" id="L297">        scrTableWeapons.setPreferredSize(new Dimension(850, 150));</span>
<span class="nc" id="L298">        weaponsModel = new WeaponsTableModel();</span>
<span class="nc" id="L299">        tblWeapons = new MegamekTable(weaponsModel,WeaponsTableModel.COL_NAME);</span>
<span class="nc" id="L300">        TableColumn wpsCol = tblWeapons.getColumnModel().getColumn(</span>
                WeaponsTableModel.COL_QTY);
<span class="nc" id="L302">        wpsCol.setCellEditor(new DefaultCellEditor(cboQty));</span>
<span class="nc" id="L303">        tblWeapons.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L304">        weaponsSorter = new TableRowSorter&lt;WeaponsTableModel&gt;(weaponsModel);</span>
<span class="nc" id="L305">        tblWeapons.setRowSorter(weaponsSorter);</span>
<span class="nc" id="L306">        tblWeapons.addKeyListener(this);</span>
<span class="nc" id="L307">        TableColumn column = null;</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">        for (int i = 0; i &lt; WeaponsTableModel.N_COL; i++) {</span>
<span class="nc" id="L309">            column = tblWeapons.getColumnModel().getColumn(i);</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">            if((i == WeaponsTableModel.COL_QTY)) {</span>
<span class="nc" id="L311">                column.setPreferredWidth(40);</span>
            }
<span class="nc bnc" id="L313" title="All 2 branches missed.">            else if( i == WeaponsTableModel.COL_IS_CLAN) {</span>
<span class="nc" id="L314">                column.setPreferredWidth(75);</span>
            }
<span class="nc bnc" id="L316" title="All 2 branches missed.">            else if( i == WeaponsTableModel.COL_NAME) {</span>
<span class="nc" id="L317">                column.setPreferredWidth(310);</span>
            }
<span class="nc bnc" id="L319" title="All 2 branches missed.">            else if( i == WeaponsTableModel.COL_LEVEL) {</span>
<span class="nc" id="L320">                column.setPreferredWidth(100);</span>
            }
<span class="nc bnc" id="L322" title="All 10 branches missed.">            else if((i == WeaponsTableModel.COL_DMG)   ||</span>
                    (i == WeaponsTableModel.COL_HEAT)  ||
                    (i == WeaponsTableModel.COL_SHORT) ||
                    (i == WeaponsTableModel.COL_MED)   ||
                    (i == WeaponsTableModel.COL_LONG)) {
<span class="nc" id="L327">                column.setPreferredWidth(50);</span>
            }
            else {
<span class="nc" id="L330">                column.setPreferredWidth(25);</span>
            }
        }
<span class="nc" id="L333">        tblWeapons.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 12)); //$NON-NLS-1$</span>
<span class="nc" id="L334">        tblWeapons.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L335">        scrTableWeapons.setViewportView(tblWeapons);</span>

        //Setup Equipment Table
<span class="nc" id="L338">        scrTableEquipment.setMinimumSize(new java.awt.Dimension(850, 150));</span>
<span class="nc" id="L339">        scrTableEquipment.setPreferredSize(new java.awt.Dimension(850, 150));</span>
<span class="nc" id="L340">        equipmentModel = new EquipmentTableModel();</span>
<span class="nc" id="L341">        tblEquipment = new MegamekTable(equipmentModel,</span>
                EquipmentTableModel.COL_NAME);
<span class="nc" id="L343">        TableColumn eqCol = tblEquipment.getColumnModel().getColumn(</span>
                EquipmentTableModel.COL_QTY);
<span class="nc" id="L345">        eqCol.setCellEditor(new DefaultCellEditor(cboQty));</span>
<span class="nc" id="L346">        tblEquipment.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L347">        equipmentSorter =</span>
                new TableRowSorter&lt;EquipmentTableModel&gt;(equipmentModel);
<span class="nc" id="L349">        tblEquipment.setRowSorter(equipmentSorter);</span>
<span class="nc" id="L350">        tblEquipment.addKeyListener(this);</span>
<span class="nc" id="L351">        column = null;</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">        for (int i = 0; i &lt; EquipmentTableModel.N_COL; i++) {</span>
<span class="nc" id="L353">            column = tblEquipment.getColumnModel().getColumn(i);</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">            if(i == EquipmentTableModel.COL_NAME) {</span>
<span class="nc" id="L355">                column.setPreferredWidth(400);</span>
            }
<span class="nc bnc" id="L357" title="All 2 branches missed.">            else if(i == EquipmentTableModel.COL_COST) {</span>
<span class="nc" id="L358">                    column.setPreferredWidth(175);</span>
            }
<span class="nc bnc" id="L360" title="All 2 branches missed.">            else if(i == EquipmentTableModel.COL_LEVEL) {</span>
<span class="nc" id="L361">                column.setPreferredWidth(100);</span>
            }
<span class="nc bnc" id="L363" title="All 2 branches missed.">            else if((i == EquipmentTableModel.COL_QTY)) {</span>
<span class="nc" id="L364">                column.setPreferredWidth(40);</span>
            }
<span class="nc bnc" id="L366" title="All 2 branches missed.">            else if( i == EquipmentTableModel.COL_IS_CLAN) {</span>
<span class="nc" id="L367">                column.setPreferredWidth(75);</span>
            }
            else {
<span class="nc" id="L370">                column.setPreferredWidth(25);</span>
            }
        }
<span class="nc" id="L373">        tblEquipment.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 12)); //$NON-NLS-1$</span>
<span class="nc" id="L374">        tblEquipment.getSelectionModel().addListSelectionListener(this);</span>
<span class="nc" id="L375">        scrTableEquipment.setViewportView(tblEquipment);</span>

        //Populate Tables
<span class="nc" id="L378">        populateWeaponsAndEquipmentChoices();</span>

        //initialize with the weapons sorted alphabetically by name
<span class="nc" id="L381">        ArrayList&lt;SortKey&gt; sortlist = new ArrayList&lt;SortKey&gt;();</span>
<span class="nc" id="L382">        sortlist.add(new SortKey(WeaponsTableModel.COL_NAME,SortOrder.ASCENDING));</span>
<span class="nc" id="L383">        tblWeapons.getRowSorter().setSortKeys(sortlist);</span>
<span class="nc" id="L384">        ((DefaultRowSorter&lt;?, ?&gt;)tblWeapons.getRowSorter()).sort();</span>
<span class="nc" id="L385">        tblWeapons.invalidate(); // force re-layout of window</span>

        //initialize with the equipment sorted alphabetically by chassis
<span class="nc" id="L388">        sortlist = new ArrayList&lt;SortKey&gt;();</span>
<span class="nc" id="L389">        sortlist.add(new SortKey(EquipmentTableModel.COL_NAME,SortOrder.ASCENDING));</span>
<span class="nc" id="L390">        tblEquipment.getRowSorter().setSortKeys(sortlist);</span>
<span class="nc" id="L391">        ((DefaultRowSorter&lt;?, ?&gt;)tblEquipment.getRowSorter()).sort();</span>
<span class="nc" id="L392">        tblEquipment.invalidate(); // force re-layout of window</span>

<span class="nc" id="L394">        tWalk.setText(&quot;&quot;);</span>
<span class="nc" id="L395">        tJump.setText(&quot;&quot;);</span>

<span class="nc" id="L397">        txtEqExp.setEditable(false);</span>
<span class="nc" id="L398">        txtEqExp.setLineWrap(true);</span>
<span class="nc" id="L399">        txtEqExp.setWrapStyleWord(true);</span>
<span class="nc" id="L400">        Dimension size = new Dimension(325,50);</span>
<span class="nc" id="L401">        txtEqExp.setPreferredSize(size);</span>
<span class="nc" id="L402">        expScroller.setPreferredSize(size);</span>
<span class="nc" id="L403">        expScroller.setMaximumSize(size);</span>

        // Layout
<span class="nc" id="L406">        GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L407">        setLayout(new GridBagLayout());</span>

<span class="nc" id="L409">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L410">        c.insets = new Insets(0,0,0,0);</span>

<span class="nc" id="L412">        c.insets = new Insets(0,10,0,0);</span>
<span class="nc" id="L413">        c.gridx = 0; c.gridy = 0;</span>
<span class="nc" id="L414">        this.add(lblWalk,c);</span>
<span class="nc" id="L415">        c.gridx = 1; c.gridy = 0;</span>
<span class="nc" id="L416">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L417">        c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L418">        JPanel panWalk = new JPanel();</span>
<span class="nc" id="L419">        panWalk.add(cWalk);</span>
<span class="nc" id="L420">        panWalk.add(tWalk);</span>
<span class="nc" id="L421">        this.add(panWalk,c);</span>
<span class="nc" id="L422">        c.gridx = 3; c.gridy = 0;</span>
<span class="nc" id="L423">        c.insets = new Insets(0,40,0,0);</span>
<span class="nc" id="L424">        c.weighty = 1;</span>
<span class="nc" id="L425">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L426">        JPanel cockpitPanel = new JPanel();</span>
<span class="nc" id="L427">        cockpitPanel.add(cbxEnableCockpitSearch,BorderLayout.WEST);</span>
<span class="nc" id="L428">        cockpitPanel.add(lblCockpitType,BorderLayout.WEST);</span>
<span class="nc" id="L429">        cockpitPanel.add(cboCockpitType,BorderLayout.EAST);</span>
<span class="nc" id="L430">        this.add(cockpitPanel,c);</span>
<span class="nc" id="L431">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L432">        c.weighty = 0;</span>


<span class="nc" id="L435">        c.gridx = 0; c.gridy = 1;</span>
<span class="nc" id="L436">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L437">        c.insets = new Insets(0,10,0,0);</span>
<span class="nc" id="L438">        this.add(lblJump,c);</span>
<span class="nc" id="L439">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L440">        c.gridx = 1; c.gridy = 1;</span>
<span class="nc" id="L441">        c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L442">        JPanel panJump = new JPanel();</span>
<span class="nc" id="L443">        panJump.add(cJump);</span>
<span class="nc" id="L444">        panJump.add(tJump);</span>
<span class="nc" id="L445">        this.add(panJump,c);</span>
<span class="nc" id="L446">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L447">        c.gridx = 3; c.gridy = 1;</span>
<span class="nc" id="L448">        c.weighty = 1;</span>
<span class="nc" id="L449">        c.insets = new Insets(0,40,0,0);</span>
<span class="nc" id="L450">        JPanel internalsPanel = new JPanel();</span>
<span class="nc" id="L451">        internalsPanel.add(cbxEnableInternalsSearch);</span>
<span class="nc" id="L452">        internalsPanel.add(lblInternalsType);</span>
<span class="nc" id="L453">        internalsPanel.add(cboInternalsType,BorderLayout.EAST);</span>
<span class="nc" id="L454">        this.add(internalsPanel,c);</span>
<span class="nc" id="L455">        c.weighty = 0;</span>
<span class="nc" id="L456">        c.insets = new Insets(0,0,0,0);</span>

<span class="nc" id="L458">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L459">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L460">        c.insets = new Insets(0,10,0,0);</span>
<span class="nc" id="L461">        this.add(lblArmor,c);</span>
<span class="nc" id="L462">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L463">        c.gridx = 1;</span>
<span class="nc" id="L464">        this.add(cArmor,c);</span>
<span class="nc" id="L465">        c.gridx = 3;</span>
<span class="nc" id="L466">        c.weighty = 1;</span>
<span class="nc" id="L467">        c.insets = new Insets(0,40,0,0);</span>
<span class="nc" id="L468">        JPanel armorPanel = new JPanel();</span>
<span class="nc" id="L469">        armorPanel.add(cbxEnableArmorSearch);</span>
<span class="nc" id="L470">        armorPanel.add(lblArmorType);</span>
<span class="nc" id="L471">        armorPanel.add(cboArmorType,BorderLayout.EAST);</span>
<span class="nc" id="L472">        this.add(armorPanel,c);</span>
<span class="nc" id="L473">        c.weighty = 0;</span>

<span class="nc" id="L475">        c.anchor = GridBagConstraints.CENTER;</span>

<span class="nc" id="L477">        c.insets = new Insets(16,0,0,0);</span>
<span class="nc" id="L478">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L479">        this.add(lblTableFilters,c);</span>
<span class="nc" id="L480">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L481">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L482">        c.gridwidth = 4;</span>
<span class="nc" id="L483">        JPanel cboPanel = new JPanel();</span>
<span class="nc" id="L484">        cboPanel.add(lblUnitType);</span>
<span class="nc" id="L485">        cboPanel.add(cboUnitType);</span>
<span class="nc" id="L486">        cboPanel.add(lblTechClass);</span>
<span class="nc" id="L487">        cboPanel.add(cboTechClass);</span>
<span class="nc" id="L488">        cboPanel.add(lblTechLevel,c);</span>
<span class="nc" id="L489">        cboPanel.add(cboTechLevel,c);</span>
<span class="nc" id="L490">        this.add(cboPanel,c);</span>
<span class="nc" id="L491">        c.gridwidth = 1;</span>

<span class="nc" id="L493">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L494">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L495">        this.add(lblWeapons,c);</span>


<span class="nc" id="L498">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L499">        c.gridwidth = 4;</span>
<span class="nc" id="L500">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L501">        this.add(scrTableWeapons,c);</span>
<span class="nc" id="L502">        c.gridwidth = 1;</span>


<span class="nc" id="L505">        c.gridwidth = 1;</span>
<span class="nc" id="L506">        c.insets = new Insets(16,0,0,0);</span>
<span class="nc" id="L507">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L508">        this.add(lblEquipment,c);</span>


<span class="nc" id="L511">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L512">        c.gridwidth = 4;</span>
<span class="nc" id="L513">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L514">        this.add(scrTableEquipment,c);</span>
<span class="nc" id="L515">        c.gridwidth = 1;</span>

<span class="nc" id="L517">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L518">        c.gridwidth = 4;</span>
<span class="nc" id="L519">        JPanel btnPanel = new JPanel();</span>
<span class="nc" id="L520">        btnPanel.add(btnAdd,c);</span>
<span class="nc" id="L521">        btnPanel.add(btnLeftParen,c);</span>
<span class="nc" id="L522">        btnPanel.add(btnRightParen,c);</span>
<span class="nc" id="L523">        btnPanel.add(btnAnd,c);</span>
<span class="nc" id="L524">        btnPanel.add(btnOr,c);</span>
<span class="nc" id="L525">        btnPanel.add(btnBack,c);</span>
<span class="nc" id="L526">        btnPanel.add(btnClear,c);</span>
<span class="nc" id="L527">        this.add(btnPanel,c);</span>
<span class="nc" id="L528">        c.gridwidth = 1;</span>

        // Filter Expression
        //c.insets = new Insets(50,0,0,0);
<span class="nc" id="L532">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L533">        this.add(lblEqExpTxt,c);</span>
<span class="nc" id="L534">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L535">        c.gridwidth = 4;</span>
<span class="nc" id="L536">        c.gridx = 1;</span>
<span class="nc" id="L537">        this.add(expScroller,c);</span>
<span class="nc" id="L538">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L539">        c.insets = new Insets(0,0,0,0);</span>

<span class="nc" id="L541">        c.gridwidth  = 1;</span>
<span class="nc" id="L542">        c.gridx = 0; c.gridy++;</span>
<span class="nc" id="L543">        this.add(lblYear,c);</span>
<span class="nc" id="L544">        c.gridx = 1;</span>
<span class="nc" id="L545">        JPanel designYearPanel = new JPanel();</span>
<span class="nc" id="L546">        designYearPanel.add(tStartYear);</span>
<span class="nc" id="L547">        designYearPanel.add(new Label(&quot;-&quot;));</span>
<span class="nc" id="L548">        designYearPanel.add(tEndYear);</span>
<span class="nc" id="L549">        add(designYearPanel,c);</span>


<span class="nc" id="L552">        c.gridwidth = 1;</span>
<span class="nc" id="L553">        c.gridx = 2; c.gridy++;</span>
<span class="nc" id="L554">        c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L555">        c.insets = new Insets(0,20,10,0);</span>
<span class="nc" id="L556">        this.add(btnOkay,c);</span>
<span class="nc" id="L557">        c.gridx = 3;</span>
<span class="nc" id="L558">        c.insets = new Insets(0,20,10,0);</span>
<span class="nc" id="L559">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L560">        this.add(btnCancel,c);</span>

<span class="nc" id="L562">        addWindowListener(new WindowAdapter() {</span>
            @Override
            public void windowClosing(WindowEvent e) {
<span class="nc" id="L565">                setVisible(false);</span>
<span class="nc" id="L566">            }</span>
        });

<span class="nc" id="L569">        pack();</span>
<span class="nc" id="L570">        int x = Math.max(0,</span>
<span class="nc" id="L571">                (frame.getLocation().x + (frame.getSize().width / 2)) -</span>
<span class="nc" id="L572">                (getSize().width / 2));</span>
<span class="nc" id="L573">        int y = Math.max(0,</span>
<span class="nc" id="L574">                (frame.getLocation().y + (frame.getSize().height / 2)) -</span>
<span class="nc" id="L575">                (getSize().height / 2));</span>
<span class="nc" id="L576">        setLocation(x, y);</span>
<span class="nc" id="L577">    }</span>


    /**
     * Listener for check box state changes
     *
     */
    public void itemStateChanged(ItemEvent e) {
<span class="nc bnc" id="L585" title="All 2 branches missed.">        if (e.getSource().equals(cbxEnableCockpitSearch)){</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">            cboCockpitType.setEnabled(!cboCockpitType.isEnabled());</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">            lblCockpitType.setEnabled(!lblCockpitType.isEnabled());</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">        } else if (e.getSource().equals(cbxEnableInternalsSearch)){</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">            cboInternalsType.setEnabled(!cboInternalsType.isEnabled());</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">            lblInternalsType.setEnabled(!lblInternalsType.isEnabled());</span>
<span class="nc bnc" id="L591" title="All 2 branches missed.">        } else if (e.getSource().equals(cbxEnableArmorSearch)){</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">            cboArmorType.setEnabled(!cboArmorType.isEnabled());</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">            lblArmorType.setEnabled(!lblArmorType.isEnabled());</span>
        }
<span class="nc" id="L595">    }</span>


    /**
     * Selection Listener for Weapons and Equipment tables.  Checks to see if
     * a row is selected and if it is, enables the corresponding the add button.
     */
    @Override
    public void valueChanged(ListSelectionEvent evt) {
        boolean lastTokIsOperation;
<span class="nc" id="L605">        int tokSize = filterToks.size();</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">        lastTokIsOperation = ((tokSize == 0) ||</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">                (filterToks.elementAt(tokSize-1) instanceof OperationFT));</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">        if (evt.getSource().equals(tblWeapons.getSelectionModel())){</span>
<span class="nc bnc" id="L609" title="All 4 branches missed.">            if ((tblWeapons.getSelectedRow() &gt;= 0) &amp;&amp; lastTokIsOperation){</span>
<span class="nc" id="L610">                tblEquipment.clearSelection();</span>
<span class="nc" id="L611">                btnAdd.setEnabled(true);</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">            } else if (tblWeapons.getSelectedRow() &gt;= 0) {</span>
<span class="nc" id="L613">                tblEquipment.clearSelection();</span>
            }
<span class="nc bnc" id="L615" title="All 2 branches missed.">        }else if (evt.getSource().equals(tblEquipment.getSelectionModel())){</span>
<span class="nc bnc" id="L616" title="All 4 branches missed.">            if ((tblEquipment.getSelectedRow() &gt;= 0) &amp;&amp; lastTokIsOperation){</span>
<span class="nc" id="L617">                tblWeapons.clearSelection();</span>
<span class="nc" id="L618">                btnAdd.setEnabled(true);</span>
<span class="nc bnc" id="L619" title="All 2 branches missed.">            } else if (tblEquipment.getSelectedRow() &gt;= 0) {</span>
<span class="nc" id="L620">                tblWeapons.clearSelection();</span>
            }
        }
<span class="nc" id="L623">    }</span>

    /**
     * Convenience method for enabling the buttons related to weapon/equipment
     * selection for filtering (btnAddEquipment, btnAddWeapon, etc)
     */
    private void enableSelectionButtons(){
<span class="nc bnc" id="L630" title="All 2 branches missed.">        if ((tblWeapons.getSelectedRow() != -1) ||</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">                (tblEquipment.getSelectedRow() != -1)) {</span>
<span class="nc" id="L632">            btnAdd.setEnabled(true);</span>
        }
<span class="nc" id="L634">        btnLeftParen.setEnabled(true);</span>
<span class="nc" id="L635">    }</span>

    /**
     * Convenience method for disabling the buttons related to weapon/equipment
     * selection for filtering (btnAddEquipment, btnAddWeapon, etc)
     */
    private void disableSelectionButtons(){
<span class="nc" id="L642">        btnAdd.setEnabled(false);</span>
<span class="nc" id="L643">        btnLeftParen.setEnabled(false);</span>
<span class="nc" id="L644">    }</span>

    /**
     * Convenience method for enabling the buttons related to filter operations
     * for filtering (btnAnd, btnOr, etc)
     */
    private void enableOperationButtons(){
<span class="nc" id="L651">        btnOr.setEnabled(true);</span>
<span class="nc" id="L652">        btnAnd.setEnabled(true);</span>
<span class="nc" id="L653">        btnRightParen.setEnabled(true);</span>
<span class="nc" id="L654">    }</span>

    /**
     * Convenience method for disabling the buttons related to filter operations
     * for filtering (btnAnd, btnOr, etc)
     */
    private void disableOperationButtons(){
<span class="nc" id="L661">        btnOr.setEnabled(false);</span>
<span class="nc" id="L662">        btnAnd.setEnabled(false);</span>
<span class="nc" id="L663">        btnRightParen.setEnabled(false);</span>
<span class="nc" id="L664">    }</span>

    /**
     *  Listener for button presses.
     */
    public void actionPerformed(java.awt.event.ActionEvent ev) {
        //Okay Button Clicked
<span class="nc bnc" id="L671" title="All 2 branches missed.">        if (ev.getSource().equals(btnOkay)) {</span>
<span class="nc" id="L672">            isCanceled = false;</span>
            try{
<span class="nc" id="L674">                mechFilter.createFilterExpressionFromTokens(filterToks);</span>
<span class="nc" id="L675">                setVisible(false);</span>
<span class="nc" id="L676">            }catch (MechSearchFilter.FilterParsingException e){</span>
<span class="nc" id="L677">                JOptionPane.showMessageDialog(this,</span>
                        &quot;Error parsing filter expression!\n\n&quot; + e.msg,
                        &quot;Filter Expression Parsing Error&quot;,
                        JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L681">            }</span>
        }
        //Cancel Button Clicked
<span class="nc bnc" id="L684" title="All 2 branches missed.">        else if (ev.getSource().equals(btnCancel)) {</span>
<span class="nc" id="L685">            isCanceled = true;</span>
<span class="nc" id="L686">            setVisible(false);</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">        }else if (ev.getSource().equals(cboUnitType)</span>
<span class="nc bnc" id="L688" title="All 2 branches missed.">                || ev.getSource().equals(cboTechLevel)</span>
<span class="nc bnc" id="L689" title="All 2 branches missed.">                || ev.getSource().equals(cboTechClass)) {</span>
<span class="nc" id="L690">            filterTables();</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnAdd)){</span>
<span class="nc" id="L692">            int row = tblEquipment.getSelectedRow();</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">            if (row &gt;= 0){</span>
<span class="nc" id="L694">                String internalName = (String)</span>
<span class="nc" id="L695">                        tblEquipment.getModel().getValueAt(</span>
<span class="nc" id="L696">                                tblEquipment.convertRowIndexToModel(row),</span>
                                EquipmentTableModel.COL_INTERNAL_NAME);
<span class="nc" id="L698">                String fullName = (String)</span>
<span class="nc" id="L699">                        tblEquipment.getValueAt(</span>
                                row, EquipmentTableModel.COL_NAME);
<span class="nc" id="L701">                int qty = Integer.parseInt((String)</span>
<span class="nc" id="L702">                    tblEquipment.getValueAt(row, EquipmentTableModel.COL_QTY));</span>
<span class="nc" id="L703">                filterToks.add(new EquipmentFT(internalName,fullName,qty));</span>
<span class="nc" id="L704">                txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L705">                btnBack.setEnabled(true);</span>
<span class="nc" id="L706">                enableOperationButtons();</span>
<span class="nc" id="L707">                disableSelectionButtons();</span>
            }
<span class="nc" id="L709">            row = tblWeapons.getSelectedRow();</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">            if (row &gt;= 0){</span>
<span class="nc" id="L711">                String internalName = (String)</span>
<span class="nc" id="L712">                        tblWeapons.getModel().getValueAt(</span>
<span class="nc" id="L713">                                tblWeapons.convertRowIndexToModel(row),</span>
                                WeaponsTableModel.COL_INTERNAL_NAME);
<span class="nc" id="L715">                String fullName = (String)</span>
<span class="nc" id="L716">                        tblWeapons.getValueAt(</span>
                                row, WeaponsTableModel.COL_NAME);
<span class="nc" id="L718">                int qty = Integer.parseInt((String)</span>
<span class="nc" id="L719">                    tblWeapons.getValueAt(row, WeaponsTableModel.COL_QTY));</span>
<span class="nc" id="L720">                filterToks.add(new EquipmentFT(internalName,fullName,qty));</span>
<span class="nc" id="L721">                txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L722">                btnBack.setEnabled(true);</span>
<span class="nc" id="L723">                enableOperationButtons();</span>
<span class="nc" id="L724">                disableSelectionButtons();</span>
            }
<span class="nc bnc" id="L726" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnLeftParen)){</span>
<span class="nc" id="L727">            filterToks.add(new ParensFT(&quot;(&quot;));</span>
<span class="nc" id="L728">            txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L729">            btnBack.setEnabled(true);</span>
<span class="nc" id="L730">            disableOperationButtons();</span>
<span class="nc" id="L731">            enableSelectionButtons();</span>
<span class="nc" id="L732">            btnLeftParen.setEnabled(false);</span>
<span class="nc" id="L733">            btnRightParen.setEnabled(false);</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnRightParen)){</span>
<span class="nc" id="L735">            filterToks.add(new ParensFT(&quot;)&quot;));</span>
<span class="nc" id="L736">            txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L737">            btnBack.setEnabled(true);</span>
<span class="nc" id="L738">            enableOperationButtons();</span>
<span class="nc" id="L739">            disableSelectionButtons();</span>
<span class="nc" id="L740">            btnLeftParen.setEnabled(false);</span>
<span class="nc" id="L741">            btnRightParen.setEnabled(false);</span>
<span class="nc bnc" id="L742" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnAnd)){</span>
<span class="nc" id="L743">            filterToks.add(new OperationFT(MechSearchFilter.BoolOp.AND));</span>
<span class="nc" id="L744">            txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L745">            btnBack.setEnabled(true);</span>
<span class="nc" id="L746">            disableOperationButtons();</span>
<span class="nc" id="L747">            enableSelectionButtons();</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnOr)){</span>
<span class="nc" id="L749">            filterToks.add(new OperationFT(MechSearchFilter.BoolOp.OR));</span>
<span class="nc" id="L750">            txtEqExp.setText(filterExpressionString());</span>
<span class="nc" id="L751">            btnBack.setEnabled(true);</span>
<span class="nc" id="L752">            disableOperationButtons();</span>
<span class="nc" id="L753">            enableSelectionButtons();</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">        }else if (ev.getSource().equals(btnBack)){</span>
<span class="nc bnc" id="L755" title="All 2 branches missed.">            if (filterToks.size() &gt; 0){</span>
<span class="nc" id="L756">                filterToks.remove(filterToks.size()-1);</span>
<span class="nc" id="L757">                txtEqExp.setText(filterExpressionString());</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">                if (filterToks.size() == 0) {</span>
<span class="nc" id="L759">                    btnBack.setEnabled(false);</span>
                }
<span class="nc bnc" id="L761" title="All 2 branches missed.">                if ((filterToks.size() == 0) ||</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">                        (filterToks.lastElement() instanceof OperationFT)){</span>
<span class="nc" id="L763">                    disableOperationButtons();</span>
<span class="nc" id="L764">                    enableSelectionButtons();</span>
                }else{
<span class="nc" id="L766">                    enableOperationButtons();</span>
<span class="nc" id="L767">                    disableSelectionButtons();</span>
                }
            }
<span class="nc bnc" id="L770" title="All 2 branches missed.">        } else if (ev.getSource().equals(btnClear)){</span>
<span class="nc" id="L771">            filterToks.clear();</span>
<span class="nc" id="L772">            txtEqExp.setText(&quot;&quot;);</span>
<span class="nc" id="L773">            btnBack.setEnabled(false);</span>
<span class="nc" id="L774">            disableOperationButtons();</span>
<span class="nc" id="L775">            enableSelectionButtons();</span>
        }
<span class="nc" id="L777">    }</span>

    private boolean matchTechLvl(int t1, int t2){
<span class="nc bnc" id="L780" title="All 40 branches missed.">        return ((t1 == TechConstants.T_ALL)</span>
                || (t1 == t2)
                || ((t1 == TechConstants.T_IS_TW_ALL)
                    &amp;&amp; ((t2 &lt;= TechConstants.T_IS_TW_NON_BOX)
                     || ((t2) == TechConstants.T_INTRO_BOXSET))))
                || ((t1 == TechConstants.T_TW_ALL)
                    &amp;&amp; ((t2 &lt;= TechConstants.T_IS_TW_NON_BOX)
                     || (t2 &lt;= TechConstants.T_INTRO_BOXSET)
                     || (t2 &lt;= TechConstants.T_CLAN_TW)))
                || ((t1 == TechConstants.T_ALL_IS)
                    &amp;&amp; ((t2 &lt;= TechConstants.T_IS_TW_NON_BOX)
                     || (t2 == TechConstants.T_INTRO_BOXSET)
                     || (t2 == TechConstants.T_IS_ADVANCED)
                     || (t2 == TechConstants.T_IS_EXPERIMENTAL)
                     || (t2 == TechConstants.T_IS_UNOFFICIAL)))
                || ((t1 == TechConstants.T_ALL_CLAN)
                    &amp;&amp; ((t2 == TechConstants.T_CLAN_TW)
                     || (t2 == TechConstants.T_CLAN_ADVANCED)
                     || (t2 == TechConstants.T_CLAN_EXPERIMENTAL)
                     || (t2 == TechConstants.T_CLAN_UNOFFICIAL)));
    }

    private boolean matchTechClass(String t1, String t2){
<span class="nc bnc" id="L803" title="All 2 branches missed.">        if (t1.equals(&quot;All&quot;)){</span>
<span class="nc" id="L804">            return true;</span>
<span class="nc bnc" id="L805" title="All 2 branches missed.">        } else if (t1.equals(&quot;IS/Clan&quot;)){</span>
<span class="nc bnc" id="L806" title="All 4 branches missed.">            if (t2.equals(&quot;Inner Sphere&quot;) || t2.equals(&quot;Clan&quot;) ||</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">                    t1.equals(t2)) {</span>
<span class="nc" id="L808">                return true;</span>
            }
<span class="nc bnc" id="L810" title="All 2 branches missed.">        } else if (t1.equals(t2)) {</span>
<span class="nc" id="L811">            return true;</span>
        }
<span class="nc" id="L813">        return false;</span>
    }

    private boolean matchUnitType(int unitTypeFilter, EquipmentType eq){
        // All is selected
<span class="nc bnc" id="L818" title="All 2 branches missed.">        if (unitTypeFilter &lt; 0){</span>
<span class="nc" id="L819">            return true;</span>
        }
<span class="nc bnc" id="L821" title="All 7 branches missed.">        switch (unitTypeFilter) {</span>
        case 5: //UnitType.AERO: the aero index is out of order
<span class="nc bnc" id="L823" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_AERO_WEAPON)</span>
<span class="nc bnc" id="L824" title="All 2 branches missed.">                    || eq.hasFlag(MiscType.F_FIGHTER_EQUIPMENT)) {</span>
<span class="nc" id="L825">                return true;</span>
            }
            break;
        case UnitType.BATTLE_ARMOR:
<span class="nc bnc" id="L829" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_BA_WEAPON)</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">                    || eq.hasFlag(MiscType.F_BA_EQUIPMENT)) {</span>
<span class="nc" id="L831">                return true;</span>
            }
            break;
        case UnitType.INFANTRY:
<span class="nc bnc" id="L835" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_INFANTRY)) {</span>
<span class="nc" id="L836">                return true;</span>
            }
            break;
        case UnitType.MEK:
<span class="nc bnc" id="L840" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_MECH_WEAPON)</span>
<span class="nc bnc" id="L841" title="All 2 branches missed.">                    || eq.hasFlag(MiscType.F_MECH_EQUIPMENT)) {</span>
<span class="nc" id="L842">                return true;</span>
            }
            break;
        case UnitType.TANK:
<span class="nc bnc" id="L846" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_TANK_WEAPON)</span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">                    || eq.hasFlag(MiscType.F_TANK_EQUIPMENT)) {</span>
<span class="nc" id="L848">                return true;</span>
            }
            break;
        case UnitType.PROTOMEK:
<span class="nc bnc" id="L852" title="All 2 branches missed.">            if (eq.hasFlag(WeaponType.F_PROTO_WEAPON)</span>
<span class="nc bnc" id="L853" title="All 2 branches missed.">                    || eq.hasFlag(MiscType.F_PROTOMECH_EQUIPMENT)) {</span>
<span class="nc" id="L854">                return true;</span>
            }
            break;
        default:
<span class="nc" id="L858">            return false;</span>
        }
<span class="nc" id="L860">        return false;</span>
    }

    void filterTables() {
<span class="nc" id="L864">        RowFilter&lt;WeaponsTableModel, Integer&gt; weaponFilter = null;</span>
<span class="nc" id="L865">        RowFilter&lt;EquipmentTableModel, Integer&gt; equipmentFilter = null;</span>
<span class="nc" id="L866">        final int techLevel = cboTechLevel.getSelectedIndex();</span>
<span class="nc" id="L867">        final String techClass = (String)cboTechClass.getSelectedItem();</span>
<span class="nc" id="L868">        final int unitType = cboUnitType.getSelectedIndex() - 1;</span>
        //If current expression doesn't parse, don't update.
        try {
<span class="nc" id="L871">            weaponFilter = new RowFilter&lt;WeaponsTableModel,Integer&gt;() {</span>
                @Override
                public boolean include(Entry&lt;? extends WeaponsTableModel, ? extends Integer&gt; entry) {
<span class="nc" id="L874">                    WeaponsTableModel weapModel = entry.getModel();</span>
<span class="nc" id="L875">                    WeaponType wp = weapModel.getWeaponTypeAt(entry.getIdentifier());</span>
<span class="nc" id="L876">                    String currTechClass =</span>
<span class="nc" id="L877">                           TechConstants.getTechName(wp.getTechLevel(gameYear));</span>

<span class="nc" id="L879">                    boolean techLvlMatch =</span>
<span class="nc" id="L880">                            matchTechLvl(techLevel,wp.getTechLevel(gameYear));</span>
<span class="nc" id="L881">                    boolean techClassMatch =</span>
<span class="nc" id="L882">                            matchTechClass(techClass,currTechClass);</span>
<span class="nc" id="L883">                    boolean unitTypeMatch = matchUnitType(unitType,wp);</span>
<span class="nc bnc" id="L884" title="All 6 branches missed.">                    if (techLvlMatch &amp;&amp; techClassMatch &amp;&amp; unitTypeMatch){</span>
<span class="nc" id="L885">                        return true;</span>
                    }else{
<span class="nc" id="L887">                        return false;</span>
                    }
                }
            };
<span class="nc" id="L891">        } catch (java.util.regex.PatternSyntaxException e) {</span>
<span class="nc" id="L892">            return;</span>
<span class="nc" id="L893">        }</span>
<span class="nc" id="L894">        weaponsSorter.setRowFilter(weaponFilter);</span>

        try {
<span class="nc" id="L897">            equipmentFilter = new RowFilter&lt;EquipmentTableModel, Integer&gt;() {</span>
                @Override
                public boolean include(Entry&lt;? extends EquipmentTableModel, ? extends Integer&gt; entry) {
<span class="nc" id="L900">                    EquipmentTableModel eqModel = entry.getModel();</span>
<span class="nc" id="L901">                    EquipmentType eq =</span>
<span class="nc" id="L902">                            eqModel.getEquipmentTypeAt(entry.getIdentifier());</span>
<span class="nc" id="L903">                    String currTechClass =</span>
<span class="nc" id="L904">                           TechConstants.getTechName(eq.getTechLevel(gameYear));</span>
<span class="nc" id="L905">                    boolean techLvlMatch =</span>
<span class="nc" id="L906">                            matchTechLvl(techLevel,eq.getTechLevel(gameYear));</span>
<span class="nc" id="L907">                    boolean techClassMatch =</span>
<span class="nc" id="L908">                            matchTechClass(techClass,currTechClass);</span>
<span class="nc" id="L909">                    boolean unitTypeMatch = matchUnitType(unitType,eq);</span>
<span class="nc bnc" id="L910" title="All 6 branches missed.">                    if (techLvlMatch &amp;&amp; techClassMatch &amp;&amp; unitTypeMatch){</span>
<span class="nc" id="L911">                        return true;</span>
                    }else{
<span class="nc" id="L913">                        return false;</span>
                    }
                }
            };
<span class="nc" id="L917">        } catch (java.util.regex.PatternSyntaxException e) {</span>
<span class="nc" id="L918">            return;</span>
<span class="nc" id="L919">        }</span>
<span class="nc" id="L920">        equipmentSorter.setRowFilter(equipmentFilter);</span>
<span class="nc" id="L921">    }</span>

    private String filterExpressionString(){
        //Build the string representation of the new expression
<span class="nc" id="L925">        StringBuilder filterExp = new StringBuilder();</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">        for (int i = 0; i &lt; filterToks.size(); i++){</span>
<span class="nc" id="L927">            filterExp.append(&quot; &quot; + filterToks.elementAt(i).toString() + &quot; &quot;);</span>
        }
<span class="nc" id="L929">        return filterExp.toString();</span>
    }

    /**
     * Show the dialog.  setVisible(true) blocks until setVisible(false).
     *
     * @return Return the filter that was created with this dialog.
     */
    public MechSearchFilter showDialog() {
        //We need to save a copy since the user can alter the filter state
        // and then click on the cancel button.  We want to make sure the
        // original filter state is saved.
<span class="nc" id="L941">        MechSearchFilter currFilter = mechFilter;</span>
<span class="nc" id="L942">        mechFilter = new MechSearchFilter(currFilter);</span>
<span class="nc" id="L943">        txtEqExp.setText(mechFilter.getEquipmentExpression());</span>
<span class="nc bnc" id="L944" title="All 4 branches missed.">        if ((filterToks == null) || (filterToks.size() == 0)</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">                || (filterToks.lastElement() instanceof OperationFT)) {</span>
<span class="nc" id="L946">            disableOperationButtons();</span>
<span class="nc" id="L947">            enableSelectionButtons();</span>
        }else{
<span class="nc" id="L949">            enableOperationButtons();</span>
<span class="nc" id="L950">            disableSelectionButtons();</span>
        }
<span class="nc" id="L952">        setVisible(true);</span>
<span class="nc bnc" id="L953" title="All 2 branches missed.">        if (isCanceled){</span>
<span class="nc" id="L954">            mechFilter = currFilter;</span>
        }else{
<span class="nc" id="L956">            updateMechSearchFilter();</span>
        }
<span class="nc" id="L958">        return mechFilter;</span>
    }

    /**
     *  Clear the filter.
     */
    public void clearValues() {
<span class="nc" id="L965">        cWalk.setSelectedIndex(0);</span>
<span class="nc" id="L966">        tWalk.setText(&quot;&quot;);</span>
<span class="nc" id="L967">        cJump.setSelectedIndex(0);</span>
<span class="nc" id="L968">        tJump.setText(&quot;&quot;);</span>
<span class="nc" id="L969">        cArmor.setSelectedIndex(0);</span>
<span class="nc" id="L970">        tblWeapons.clearSelection();</span>
<span class="nc" id="L971">        tblEquipment.clearSelection();</span>
<span class="nc" id="L972">        txtEqExp.setText(&quot;&quot;);</span>
<span class="nc" id="L973">        cbxEnableArmorSearch.setSelected(false);</span>
<span class="nc" id="L974">        cbxEnableCockpitSearch.setSelected(false);</span>
<span class="nc" id="L975">        cbxEnableInternalsSearch.setSelected(false);</span>
<span class="nc" id="L976">        cboArmorType.setSelectedIndex(0);</span>
<span class="nc" id="L977">        cboCockpitType.setSelectedIndex(0);</span>
<span class="nc" id="L978">        cboInternalsType.setSelectedIndex(0);</span>
<span class="nc" id="L979">        mechFilter = null;</span>
<span class="nc" id="L980">        filterToks.clear();</span>
<span class="nc" id="L981">        btnBack.setEnabled(false);</span>
<span class="nc" id="L982">        disableOperationButtons();</span>
<span class="nc" id="L983">        enableSelectionButtons();</span>
<span class="nc" id="L984">    }</span>

    /**
     * Creates collections for all of the possible &lt;code&gt;WeaponType&lt;/code&gt;s and
     * &lt;code&gt;EquipmentType&lt;/code&gt;s.  These are used to populate the weapons
     * and equipment tables.
     */
    private void populateWeaponsAndEquipmentChoices() {
<span class="nc" id="L992">        Vector&lt;WeaponType&gt; weapons = new Vector&lt;WeaponType&gt;();</span>
<span class="nc" id="L993">        Vector&lt;EquipmentType&gt; equipment = new Vector&lt;EquipmentType&gt;();</span>

<span class="nc" id="L995">        for (Enumeration&lt;EquipmentType&gt; e = EquipmentType.getAllTypes();</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">                 e.hasMoreElements();) {</span>
<span class="nc" id="L997">            EquipmentType et = e.nextElement();</span>
<span class="nc bnc" id="L998" title="All 2 branches missed.">            if ((et instanceof WeaponType)) {</span>
<span class="nc" id="L999">                weapons.add((WeaponType)et);</span>
                //Check for C3+Tag and C3 Master Booster
<span class="nc bnc" id="L1001" title="All 2 branches missed.">                if (et.hasFlag(WeaponType.F_C3M) ||</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">                        et.hasFlag(WeaponType.F_C3MBS)) {</span>
<span class="nc" id="L1003">                    equipment.add(et);</span>
                }
            }
<span class="nc bnc" id="L1006" title="All 2 branches missed.">            if ((et instanceof MiscType)) {</span>
<span class="nc" id="L1007">                equipment.add(et);</span>
            }
<span class="nc" id="L1009">        }</span>
<span class="nc" id="L1010">        weaponsModel.setData(weapons);</span>
<span class="nc" id="L1011">        equipmentModel.setData(equipment);</span>
<span class="nc" id="L1012">    }</span>


    public MechSearchFilter getMechSearchFilter()
    {
<span class="nc" id="L1017">        return mechFilter;</span>
    }

    /**
     * Update the search fields that aren't automatically updated.
     */
    protected void updateMechSearchFilter() {
<span class="nc" id="L1024">        mechFilter.isDisabled = false;</span>
<span class="nc" id="L1025">        mechFilter.sWalk = tWalk.getText();</span>
<span class="nc" id="L1026">        mechFilter.iWalk = cWalk.getSelectedIndex();</span>

<span class="nc" id="L1028">        mechFilter.sJump = tJump.getText();</span>
<span class="nc" id="L1029">        mechFilter.iJump = cJump.getSelectedIndex();</span>

<span class="nc" id="L1031">        mechFilter.iArmor = cArmor.getSelectedIndex();</span>


<span class="nc" id="L1034">        mechFilter.sStartYear = tStartYear.getText();</span>
<span class="nc" id="L1035">        mechFilter.sEndYear = tEndYear.getText();</span>

<span class="nc" id="L1037">        mechFilter.checkArmorType = cbxEnableArmorSearch.isSelected();</span>
<span class="nc bnc" id="L1038" title="All 2 branches missed.">        if (cbxEnableArmorSearch.isSelected()){</span>
<span class="nc" id="L1039">            mechFilter.armorType = cboArmorType.getSelectedIndex();</span>
        }

<span class="nc" id="L1042">        mechFilter.checkInternalsType = cbxEnableInternalsSearch.isSelected();</span>
<span class="nc bnc" id="L1043" title="All 2 branches missed.">        if (cbxEnableInternalsSearch.isSelected()){</span>
<span class="nc" id="L1044">            mechFilter.internalsType = cboInternalsType.getSelectedIndex();</span>
        }

<span class="nc" id="L1047">        mechFilter.checkCockpitType = cbxEnableCockpitSearch.isSelected();</span>
<span class="nc bnc" id="L1048" title="All 2 branches missed.">        if (cbxEnableCockpitSearch.isSelected()){</span>
<span class="nc" id="L1049">            mechFilter.cockpitType = cboCockpitType.getSelectedIndex();</span>
        }
<span class="nc" id="L1051">    }</span>



    /**
     * A table model for displaying weapons
     */
<span class="nc" id="L1058">    public class WeaponsTableModel extends AbstractTableModel {</span>

        /**
         *
         */
        private static final long serialVersionUID = 1L;

        private static final int COL_QTY = 0;
        private static final int COL_NAME = 1;
        private static final int COL_DMG = 2;
        private static final int COL_HEAT = 3;
        private static final int COL_SHORT = 4;
        private static final int COL_MED = 5;
        private static final int COL_LONG = 6;
        private static final int COL_IS_CLAN = 7;
        private static final int COL_LEVEL = 8;
        private static final int N_COL = 9;
        private static final int COL_INTERNAL_NAME = 9;


        private int[] qty;

<span class="nc" id="L1080">        private Vector&lt;WeaponType&gt; weapons = new Vector&lt;WeaponType&gt;();</span>

        public int getRowCount() {
<span class="nc" id="L1083">            return weapons.size();</span>
        }

        public int getColumnCount() {
<span class="nc" id="L1087">            return N_COL;</span>
        }

        @Override
        public String getColumnName(int column) {
<span class="nc bnc" id="L1092" title="All 10 branches missed.">            switch (column) {</span>
            case COL_QTY:
<span class="nc" id="L1094">                return &quot;Qty&quot;;</span>
            case COL_NAME:
<span class="nc" id="L1096">                return &quot;Weapon Name&quot;;</span>
            case COL_IS_CLAN:
<span class="nc" id="L1098">                return &quot;IS/Clan&quot;;</span>
            case COL_DMG:
<span class="nc" id="L1100">                return &quot;DMG&quot;;</span>
            case COL_HEAT:
<span class="nc" id="L1102">                return &quot;Heat&quot;;</span>
            case COL_SHORT:
<span class="nc" id="L1104">                return &quot;Short&quot;;</span>
            case COL_MED:
<span class="nc" id="L1106">                return &quot;Med&quot;;</span>
            case COL_LONG:
<span class="nc" id="L1108">                return &quot;Long&quot;;</span>
            case COL_LEVEL:
<span class="nc" id="L1110">                return &quot;Lvl&quot;;</span>
            default:
<span class="nc" id="L1112">                return &quot;?&quot;;</span>
            }
        }

        @Override
        public Class&lt;?&gt; getColumnClass(int c) {
<span class="nc" id="L1118">            return getValueAt(0, c).getClass();</span>
        }

        @Override
        public boolean isCellEditable(int row, int col) {
<span class="nc bnc" id="L1123" title="All 2 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1125">                return true;</span>
            default:
<span class="nc" id="L1127">                return false;</span>
            }
        }

        // fill table with values
        public void setData(Vector&lt;WeaponType&gt; wps) {
<span class="nc" id="L1133">            weapons = wps;</span>
<span class="nc" id="L1134">            qty = new int[wps.size()];</span>
<span class="nc bnc" id="L1135" title="All 2 branches missed.">            for (int i = 0; i &lt; qty.length; i++) {</span>
<span class="nc" id="L1136">                qty[i] = 1;</span>
            }
<span class="nc" id="L1138">            fireTableDataChanged();</span>
<span class="nc" id="L1139">        }</span>

        public WeaponType getWeaponTypeAt(int row){
<span class="nc" id="L1142">            return weapons.elementAt(row);</span>
        }

        public Object getValueAt(int row, int col) {
<span class="nc bnc" id="L1146" title="All 2 branches missed.">            if (row &gt;= weapons.size()) {</span>
<span class="nc" id="L1147">                return null;</span>
            }
<span class="nc" id="L1149">            WeaponType wp = weapons.elementAt(row);</span>
<span class="nc bnc" id="L1150" title="All 11 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1152">                return qty[row] + &quot;&quot;;</span>
            case COL_NAME:
<span class="nc" id="L1154">                return wp.getName();</span>
            case COL_IS_CLAN:
<span class="nc" id="L1156">                return TechConstants.getTechName(wp.getTechLevel(gameYear));</span>
            case COL_DMG:
<span class="nc" id="L1158">                return wp.getDamage();</span>
            case COL_HEAT:
<span class="nc" id="L1160">                return wp.getHeat();</span>
            case COL_SHORT:
<span class="nc" id="L1162">                return wp.getShortRange();</span>
            case COL_MED:
<span class="nc" id="L1164">                return wp.getMediumRange();</span>
            case COL_LONG:
<span class="nc" id="L1166">                return wp.getLongRange();</span>
            case COL_LEVEL:
<span class="nc" id="L1168">                    return TechConstants.getSimpleLevelName(TechConstants</span>
<span class="nc" id="L1169">                            .convertFromNormalToSimple(wp</span>
<span class="nc" id="L1170">                                    .getTechLevel(gameYear)));</span>
            case COL_INTERNAL_NAME:
<span class="nc" id="L1172">                return wp.getInternalName();</span>
            default:
<span class="nc" id="L1174">                return &quot;?&quot;;</span>
            }
        }

        @Override
        public void setValueAt(Object value, int row, int col) {
<span class="nc bnc" id="L1180" title="All 2 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1182">                qty[row] = Integer.parseInt((String) value);</span>
<span class="nc" id="L1183">                fireTableCellUpdated(row, col);</span>
<span class="nc" id="L1184">                break;</span>
            default:
                break;
            }
<span class="nc" id="L1188">        }</span>

    }

    /**
     * A table model for displaying equipment
     */
<span class="nc" id="L1195">    public class EquipmentTableModel extends AbstractTableModel {</span>

        /**
         *
         */
        private static final long serialVersionUID = 1L;

        private static final int COL_QTY = 0;
        private static final int COL_NAME = 1;
        private static final int COL_COST = 2;
        private static final int COL_IS_CLAN = 3;
        private static final int COL_LEVEL = 4;
        private static final int N_COL = 5;
        private static final int COL_INTERNAL_NAME = 5;

        private int[] qty;
<span class="nc" id="L1211">        private Vector&lt;EquipmentType&gt; equipment = new Vector&lt;EquipmentType&gt;();</span>

        public int getRowCount() {
<span class="nc" id="L1214">            return equipment.size();</span>
        }

        public int getColumnCount() {
<span class="nc" id="L1218">            return N_COL;</span>
        }

        @Override
        public String getColumnName(int column) {
<span class="nc bnc" id="L1223" title="All 6 branches missed.">            switch (column) {</span>
            case COL_QTY:
<span class="nc" id="L1225">                return &quot;Qty&quot;;</span>
            case COL_NAME:
<span class="nc" id="L1227">                return &quot;Name&quot;;</span>
            case COL_IS_CLAN:
<span class="nc" id="L1229">                return &quot;IS/Clan&quot;;</span>
            case COL_COST:
<span class="nc" id="L1231">                return &quot;Cost&quot;;</span>
            case COL_LEVEL:
<span class="nc" id="L1233">                return &quot;Lvl&quot;;</span>
            default:
<span class="nc" id="L1235">                return &quot;?&quot;;</span>
            }
        }

        @Override
        public Class&lt;?&gt; getColumnClass(int c) {
<span class="nc" id="L1241">            return getValueAt(0, c).getClass();</span>
        }

        @Override
        public boolean isCellEditable(int row, int col) {
<span class="nc bnc" id="L1246" title="All 2 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1248">                return true;</span>
            default:
<span class="nc" id="L1250">                return false;</span>
            }
        }

        // fill table with values
        public void setData(Vector&lt;EquipmentType&gt; eq) {
<span class="nc" id="L1256">            equipment = eq;</span>
<span class="nc" id="L1257">            qty = new int[eq.size()];</span>
<span class="nc bnc" id="L1258" title="All 2 branches missed.">            for (int i = 0; i &lt; qty.length; i++) {</span>
<span class="nc" id="L1259">                qty[i] = 1;</span>
            }
<span class="nc" id="L1261">            fireTableDataChanged();</span>
<span class="nc" id="L1262">        }</span>

        public EquipmentType getEquipmentTypeAt(int row){
<span class="nc" id="L1265">            return equipment.elementAt(row);</span>
        }

        public Object getValueAt(int row, int col) {
<span class="nc bnc" id="L1269" title="All 2 branches missed.">            if (row &gt;= equipment.size()) {</span>
<span class="nc" id="L1270">                return null;</span>
            }
<span class="nc" id="L1272">            EquipmentType eq = equipment.elementAt(row);</span>
<span class="nc bnc" id="L1273" title="All 7 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1275">                return qty[row] + &quot;&quot;;</span>
            case COL_NAME:
<span class="nc" id="L1277">                return eq.getName();</span>
            case COL_IS_CLAN:
<span class="nc" id="L1279">                return TechConstants.getTechName(eq.getTechLevel(gameYear));</span>
            case COL_COST:
<span class="nc" id="L1281">                return eq.getRawCost();</span>
            case COL_LEVEL:
<span class="nc" id="L1283">                    return TechConstants.getSimpleLevelName(TechConstants</span>
<span class="nc" id="L1284">                            .convertFromNormalToSimple(eq</span>
<span class="nc" id="L1285">                                    .getTechLevel(gameYear)));</span>
            case COL_INTERNAL_NAME:
<span class="nc" id="L1287">                return eq.getInternalName();</span>
            default:
<span class="nc" id="L1289">                return &quot;?&quot;;</span>
            }
        }

        @Override
        public void setValueAt(Object value, int row, int col) {
<span class="nc bnc" id="L1295" title="All 2 branches missed.">            switch (col) {</span>
            case COL_QTY:
<span class="nc" id="L1297">                qty[row] = Integer.parseInt((String) value);</span>
<span class="nc" id="L1298">                fireTableCellUpdated(row, col);</span>
<span class="nc" id="L1299">                break;</span>
            default:
                break;
            }
<span class="nc" id="L1303">        }</span>
    }

    @Override
    public void keyPressed(KeyEvent evt) {

<span class="nc" id="L1309">    }</span>

    @Override
    public void keyReleased(KeyEvent evt) {
<span class="nc" id="L1313">    }</span>

    @Override
    public void keyTyped(KeyEvent evt) {
<span class="nc" id="L1317">        char keyChar = evt.getKeyChar();</span>
        //Ensure we've got a number or letter pressed
<span class="nc bnc" id="L1319" title="All 10 branches missed.">        if (!(((keyChar &gt;= '0') &amp;&amp; (keyChar &lt;= '9')) ||</span>
             ((keyChar &gt;= 'a') &amp;&amp; (keyChar &lt;='z')) || (keyChar == ' '))){
<span class="nc" id="L1321">            return;</span>
        }

<span class="nc bnc" id="L1324" title="All 2 branches missed.">        if  (evt.getComponent().equals(tblWeapons)){</span>
<span class="nc" id="L1325">            tblWeapons.keyTyped(evt);</span>
<span class="nc bnc" id="L1326" title="All 2 branches missed.">        }else if (evt.getComponent().equals(tblEquipment)){</span>
<span class="nc" id="L1327">            tblEquipment.keyTyped(evt);</span>
        }
<span class="nc" id="L1329">    }</span>


    /**
     * Base class for different tokens that can be in a filter expression.
     *
     * @author Arlith
     *
     */
<span class="nc" id="L1338">    public class FilterTokens{</span>
    }

    /**
     * FilterTokens subclass that represents parenthesis.
     * @author Arlith
     *
     */
    public class ParensFT extends FilterTokens{
        public String parens;

<span class="nc" id="L1349">        public ParensFT(String p){</span>
<span class="nc" id="L1350">            parens = p;</span>
<span class="nc" id="L1351">        }</span>

        @Override
        public String toString(){
<span class="nc" id="L1355">            return parens;</span>
        }
    }

    /**
     * FilterTokens subclass that represents equipment.
     * @author Arlith
     *
     */
    public class EquipmentFT extends FilterTokens{
        public String internalName;
        public String fullName;
        public int qty;

<span class="nc" id="L1369">        public EquipmentFT(String in, String fn, int q){</span>
<span class="nc" id="L1370">            internalName = in;</span>
<span class="nc" id="L1371">            fullName = fn;</span>
<span class="nc" id="L1372">            qty = q;</span>
<span class="nc" id="L1373">        }</span>

        @Override
        public String toString(){
<span class="nc bnc" id="L1377" title="All 2 branches missed.">            if (qty == 1) {</span>
<span class="nc" id="L1378">                return qty + &quot; &quot; + fullName;</span>
            } else {
<span class="nc" id="L1380">                return qty + &quot; &quot; + fullName + &quot;s&quot;;</span>
            }
        }
    }

    /**
     * FilterTokens subclass that represents a boolean operation.
     * @author Arlith
     *
     */
    public class OperationFT extends FilterTokens{
        public MechSearchFilter.BoolOp op;

<span class="nc" id="L1393">        public OperationFT(MechSearchFilter.BoolOp o){</span>
<span class="nc" id="L1394">            op = o;</span>
<span class="nc" id="L1395">        }</span>

        @Override
        public String toString(){
<span class="nc bnc" id="L1399" title="All 2 branches missed.">            if (op == MechSearchFilter.BoolOp.AND) {</span>
<span class="nc" id="L1400">                return &quot;And&quot;;</span>
<span class="nc bnc" id="L1401" title="All 2 branches missed.">            } else if (op == MechSearchFilter.BoolOp.OR) {</span>
<span class="nc" id="L1402">                return &quot;Or&quot;;</span>
            } else {
<span class="nc" id="L1404">                return &quot;&quot;;</span>
            }
        }
    }

}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>