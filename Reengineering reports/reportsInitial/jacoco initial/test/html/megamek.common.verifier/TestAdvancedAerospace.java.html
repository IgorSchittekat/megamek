<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TestAdvancedAerospace.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common.verifier</a> &gt; <span class="el_source">TestAdvancedAerospace.java</span></div><h1>TestAdvancedAerospace.java</h1><pre class="source lang-java linenums">/*
 * MegaMek -
 * Copyright (C) 2018 - The MegaMek Team
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.common.verifier;

import java.math.BigInteger;
import java.util.*;

import megamek.common.*;
import megamek.common.util.StringUtil;
import megamek.common.weapons.bayweapons.BayWeapon;
import megamek.common.weapons.capitalweapons.ScreenLauncherWeapon;

/**
 * Validation and construction data for advanced aerospace units (jumpships, warships, space stations)
 * 
 * @author Neoancient
 *
 */
public class TestAdvancedAerospace extends TestAero {
    
    private final Jumpship vessel;

<span class="nc" id="L35">    public enum CapitalArmor{</span>
<span class="nc" id="L36">        PRIMITIVE(EquipmentType.T_ARMOR_PRIMITIVE_AERO, false),   </span>
<span class="nc" id="L37">        STANDARD(EquipmentType.T_ARMOR_AEROSPACE, false),   </span>
<span class="nc" id="L38">        CLAN_STANDARD(EquipmentType.T_ARMOR_AEROSPACE, true),</span>
<span class="nc" id="L39">        IS_IMP_FERRO_ALUM(EquipmentType.T_ARMOR_LC_FERRO_IMP, false),</span>
<span class="nc" id="L40">        CLAN_IMP_FERRO_ALUM(EquipmentType.T_ARMOR_LC_FERRO_IMP, true),</span>
<span class="nc" id="L41">        IS_FERRO_CARBIDE(EquipmentType.T_ARMOR_LC_FERRO_CARBIDE, false),</span>
<span class="nc" id="L42">        CLAN_FERRO_CARBIDE(EquipmentType.T_ARMOR_LC_FERRO_CARBIDE, true),</span>
<span class="nc" id="L43">        IS_LAMELLOR(EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE, false),</span>
<span class="nc" id="L44">        CLAN_LAMELLOR(EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE, true);</span>

        /**
         * The type, corresponding to types defined in 
         * &lt;code&gt;EquipmentType&lt;/code&gt;.
         */
        public int type;
                
        /**
         * Denotes whether this armor is Clan or not.
         */
        public boolean isClan;
        
<span class="nc" id="L57">        CapitalArmor(int t, boolean c){</span>
<span class="nc" id="L58">            type = t;</span>
<span class="nc" id="L59">            isClan = c;</span>
<span class="nc" id="L60">        }</span>
        
        /**
         * Given an armor type, return the &lt;code&gt;AerospaceArmor&lt;/code&gt; instance that
         * represents that type.
         * 
         * @param t  The armor type.
         * @param c  Whether this armor type is Clan or not.
         * @return   The &lt;code&gt;AeroArmor&lt;/code&gt; that corresponds to the given 
         *              type or null if no match was found.
         */
        public static CapitalArmor getArmor(int t, boolean c){
<span class="nc bnc" id="L72" title="All 2 branches missed.">            for (CapitalArmor a : values()){</span>
<span class="nc bnc" id="L73" title="All 4 branches missed.">                if (a.type == t &amp;&amp; a.isClan == c){</span>
<span class="nc" id="L74">                    return a;</span>
                }
            }
<span class="nc" id="L77">            return null;</span>
        }
        
        /**
         * Calculates and returns the points per ton of the armor type given the
         * weight of the ship. 
         * 
         * @param vessel The ship
         * @return       The number of points of capital armor per ton
         */
        public double pointsPerTon(Jumpship vessel) {
<span class="nc" id="L88">            double ppt = 0.8;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">            if (type == EquipmentType.T_ARMOR_LC_FERRO_IMP) {</span>
<span class="nc" id="L90">                ppt += 0.2;</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">            } else if (type == EquipmentType.T_ARMOR_LC_FERRO_CARBIDE) {</span>
<span class="nc" id="L92">                ppt += 0.4;</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">            } else if (type == EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE) {</span>
<span class="nc" id="L94">                ppt += 0.6;</span>
            }
<span class="nc bnc" id="L96" title="All 2 branches missed.">            if (vessel.getWeight() &gt;= 250000) {</span>
<span class="nc" id="L97">                ppt -= 0.4;</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L99">                    ppt += 0.1;</span>
                }
<span class="nc bnc" id="L101" title="All 2 branches missed.">            } else if (vessel.getWeight() &gt;= 150000) {</span>
<span class="nc" id="L102">                ppt -= 0.2;</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                if (isClan) {</span>
<span class="nc" id="L104">                    ppt += 0.1;</span>
                }
<span class="nc bnc" id="L106" title="All 2 branches missed.">            } else if (isClan) {</span>
<span class="nc" id="L107">                ppt += 0.2;</span>
            }
            // Deal with potential rounding errors
<span class="nc" id="L110">            ppt = Math.round(ppt * 10.0) / 10.0;</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            if (type == EquipmentType.T_ARMOR_PRIMITIVE_AERO) {</span>
<span class="nc" id="L112">                ppt *= EquipmentType.armorPointMultipliers[EquipmentType.T_ARMOR_PRIMITIVE_AERO];</span>
            }
<span class="nc" id="L114">            return ppt;</span>
        }
        
        /**
         * @return The &lt;code&gt;MiscType&lt;/code&gt; for this armor.
         */
        public EquipmentType getArmorEqType() {
<span class="nc" id="L121">            String name = EquipmentType.getArmorTypeName(type, isClan);</span>
<span class="nc" id="L122">            return EquipmentType.get(name);</span>
        }
    }

    /**
     * Filters all capital armor according to given tech constraints
     * 
     * @param techManager Constraints used to filter the possible armor types
     * @return A list of all armors that meet the tech constraints
     */
    public static List&lt;EquipmentType&gt; legalArmorsFor(ITechManager techManager, boolean primitive) {
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (primitive) {</span>
<span class="nc" id="L134">            return Collections.singletonList(CapitalArmor.PRIMITIVE.getArmorEqType());</span>
        }
<span class="nc" id="L136">        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        for (CapitalArmor armor : CapitalArmor.values()) {</span>
<span class="nc" id="L138">            final EquipmentType eq = armor.getArmorEqType();</span>
<span class="nc bnc" id="L139" title="All 4 branches missed.">            if ((null != eq) &amp;&amp; techManager.isLegal(eq)) {</span>
<span class="nc" id="L140">                retVal.add(eq);</span>
            }
        }
<span class="nc" id="L143">        return retVal;</span>
    }
    
    public static int maxArmorPoints(Jumpship vessel) {
<span class="nc" id="L147">        CapitalArmor a = CapitalArmor.getArmor(vessel.getArmorType(0),</span>
<span class="nc" id="L148">                TechConstants.isClan(vessel.getArmorTechLevel(0)));</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (null == a) {</span>
<span class="nc" id="L150">            return 0;</span>
        }
        // The ship gets a number of armor points equal to 10% of the SI, rounded normally, per facing.
<span class="nc" id="L153">        double freeSI = Math.round(vessel.get0SI() / 10.0) * 6;</span>
        // Primitive jumpships multiply the armor by a factor of 0.66. Per errata, the armor is calculated
        // based on standard armor then rounded down, and the free SI armor is rounded down separately.
<span class="nc bnc" id="L156" title="All 2 branches missed.">        if (vessel.isPrimitive()) {</span>
<span class="nc" id="L157">            return (int) (Math.floor(CapitalArmor.STANDARD.pointsPerTon(vessel)</span>
<span class="nc" id="L158">                    * maxArmorWeight(vessel) * 0.66)</span>
<span class="nc" id="L159">                + Math.floor(freeSI * 0.66));</span>
        }
<span class="nc" id="L161">        return (int) Math.floor(a.pointsPerTon(vessel) * maxArmorWeight(vessel) + freeSI);</span>
    }
    
    /**
     *  Computes the maximum number armor level in tons
     *   
     */
    public static double maxArmorWeight(Jumpship vessel){
        // max armor tonnage is based on SI weight
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</span>
            // SI weight (SI/1000) / 50
<span class="nc" id="L172">            return floor(vessel.get0SI() * vessel.getWeight() / 50000.0, Ceil.HALFTON);</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
            // SI weight (SI/100) / 3 + 60
<span class="nc" id="L175">            return floor(vessel.get0SI() * vessel.getWeight() / 300.0 + 60, Ceil.HALFTON);</span>
        } else {
            // SI weight (SI/150) / 12
<span class="nc" id="L178">            return floor(vessel.get0SI() * vessel.getWeight() / 1800.0, Ceil.HALFTON);</span>
        }
    }
    
    public static double armorPointsPerTon(Jumpship vessel, int at, boolean clan) {
<span class="nc" id="L183">        CapitalArmor arm = CapitalArmor.getArmor(at, clan);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (null != arm) {</span>
<span class="nc" id="L185">            return arm.pointsPerTon(vessel);</span>
        } else {
<span class="nc" id="L187">            return 0;</span>
        }
    }
    
    /**
     * Computes the amount of weight required for fire control systems and power distribution
     * systems for exceeding the base limit of weapons per firing arc.
     * 
     * @param vessel The advanced aerospace unit in question
     * @return   Returns a &lt;code&gt;double&lt;/code&gt; array, where each element corresponds to a 
     *           location and the value is the extra tonnage required by exceeding the base
     *           allotment
     */
    public static double[] extraSlotCost(Jumpship vessel) {
<span class="nc" id="L201">        int slotsPerArc = 12;</span>
<span class="nc" id="L202">        int arcs = vessel.locations();</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</span>
<span class="nc" id="L204">            slotsPerArc = 20;</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L206">            slotsPerArc = 20;</span>
        }
<span class="nc" id="L208">        int weaponsPerArc[] = new int[arcs];</span>
<span class="nc" id="L209">        double weaponTonnage[] = new double[arcs];</span>
<span class="nc" id="L210">        boolean hasNC3 = vessel.hasWorkingMisc(MiscType.F_NAVAL_C3);</span>

<span class="nc bnc" id="L212" title="All 2 branches missed.">        for (Mounted m : vessel.getEquipment()) {</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">            if (usesWeaponSlot(vessel, m.getType())) {</span>
<span class="nc" id="L214">                int arc = m.getLocation();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (arc &lt; 0) {</span>
<span class="nc" id="L216">                    continue;</span>
                }
<span class="nc bnc" id="L218" title="All 2 branches missed.">                if ((m.getType() instanceof WeaponType)</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">                        &amp;&amp; m.getType().hasFlag(WeaponType.F_MASS_DRIVER)) {</span>
<span class="nc" id="L220">                    weaponsPerArc[arc] += 10;</span>
                } else {
<span class="nc" id="L222">                    weaponsPerArc[arc]++;</span>
                }
<span class="nc" id="L224">                weaponTonnage[arc] += m.getTonnage();</span>
            }
<span class="nc" id="L226">        }</span>
<span class="nc" id="L227">        double[] retVal = new double[arcs];</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">        for (int arc = 0; arc &lt; arcs; arc++) {</span>
<span class="nc" id="L229">            int excess = (weaponsPerArc[arc] - 1) / slotsPerArc;</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">            if (excess &gt; 0) {</span>
<span class="nc" id="L231">                retVal[arc] = ceil(excess * weaponTonnage[arc] / 10.0, Ceil.HALFTON);</span>
            }
<span class="nc bnc" id="L233" title="All 2 branches missed.">            if (hasNC3) {</span>
<span class="nc" id="L234">                retVal[arc] *= 2;</span>
            }
        }
<span class="nc" id="L237">        return retVal;</span>
    }
    
    public static int getMinTonnage(Jumpship vessel) {
<span class="nc bnc" id="L241" title="All 4 branches missed.">        switch (vessel.getDriveCoreType()) {</span>
            case Jumpship.DRIVE_CORE_COMPACT:
<span class="nc" id="L243">                return 100000;</span>
            case Jumpship.DRIVE_CORE_SUBCOMPACT:
<span class="nc" id="L245">                return 5000;</span>
            case Jumpship.DRIVE_CORE_NONE:
<span class="nc" id="L247">                return 2000;</span>
            case Jumpship.DRIVE_CORE_STANDARD:
            case Jumpship.DRIVE_CORE_PRIMITIVE:
            default:
<span class="nc" id="L251">                return 50000;</span>
        }
    }
    
    public static int getWeightIncrement(Jumpship vessel) {
<span class="nc bnc" id="L256" title="All 4 branches missed.">        switch (vessel.getDriveCoreType()) {</span>
            case Jumpship.DRIVE_CORE_COMPACT:
<span class="nc" id="L258">                return 10000;</span>
            case Jumpship.DRIVE_CORE_SUBCOMPACT:
<span class="nc" id="L260">                return 100;</span>
            case Jumpship.DRIVE_CORE_NONE:
<span class="nc" id="L262">                return 500;</span>
            case Jumpship.DRIVE_CORE_STANDARD:
            case Jumpship.DRIVE_CORE_PRIMITIVE:
            default:
<span class="nc" id="L266">                return 1000;</span>
        }
    }
    
    /**
     * Computes the weight of the engine.
     * 
     * @param vessel  The ship
     * @return        The weight of the engine in tons
     */
    public static double calculateEngineTonnage(Jumpship vessel) {
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (vessel.hasStationKeepingDrive()) {</span>
<span class="nc" id="L278">            return round(vessel.getWeight() * 0.012, Ceil.HALFTON);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">        } else if (vessel.isPrimitive()) {</span>
<span class="nc" id="L280">            return round(vessel.getWeight() * vessel.getOriginalWalkMP()</span>
<span class="nc" id="L281">                    * primitiveEngineMultiplier(vessel.getOriginalBuildYear()), Ceil.HALFTON);</span>
        } else {
<span class="nc" id="L283">            return round(vessel.getWeight() * vessel.getOriginalWalkMP() * 0.06, Ceil.HALFTON);</span>
        }
    }
    
    /**
     * @param year The original construction year of the jumpship chassis
     * @return     The engine weight multiplier for the primitive jumpship.
     */
    public static double primitiveEngineMultiplier(int year) {
<span class="nc bnc" id="L292" title="All 2 branches missed.">        if (year &gt;= 2300) {</span>
<span class="nc" id="L293">            return 0.06;</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        } else if (year &gt;= 2251) {</span>
<span class="nc" id="L295">            return 0.066;</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">        } else if (year &gt;= 2201) {</span>
<span class="nc" id="L297">            return 0.084;</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        } else if (year &gt;= 2151) {</span>
<span class="nc" id="L299">            return 0.102;</span>
        } else {
<span class="nc" id="L301">            return 0.12;</span>
        }
    }
    
    /**
     * @param vessel An advanced aerospace unit
     * @return       The number of heat sinks that are accounted for in the engine weight.
     */
    public static int weightFreeHeatSinks(Jumpship vessel) {
<span class="nc" id="L310">        return (int) Math.floor(45 + Math.sqrt(calculateEngineTonnage(vessel)</span>
<span class="nc bnc" id="L311" title="All 2 branches missed.">                * (vessel.isPrimitive()?  1 : 2)));</span>
    }
    
    /**
     * The maximum number of docking hardpoints (collars) depends on the tonnage of the vessel. Naval
     * Repair Facilities and Dropshuttle bays count against the total and reduce the maximum number
     * by two each.
     * 
     * @param vessel The ship
     * @return       The maximum number of docking hardpoints (collars) that can be mounted on the ship.
     */
    public static int getMaxDockingHardpoints(Jumpship vessel) {
        // minimum of 50ktons
<span class="nc bnc" id="L324" title="All 2 branches missed.">        if (vessel.getWeight() &lt; 50000) {</span>
<span class="nc" id="L325">            return 0;</span>
        }
<span class="nc" id="L327">        int max = (int) Math.ceil(vessel.getWeight() / 50000);</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">        for (Bay bay : vessel.getTransportBays()) {</span>
<span class="nc" id="L329">            max -= bay.hardpointCost();</span>
<span class="nc" id="L330">        }</span>
<span class="nc" id="L331">        return Math.max(max, 0);</span>
    }
    
    /**
     * @param vessel The ship
     * @return       The maximum number of gravity decks that can be mounted on the ship.
     */
    public static int getMaxGravDecks(Jumpship vessel) {
<span class="nc" id="L339">        return 3 + (int) Math.ceil(vessel.getWeight() / 100000);</span>
    }
    
    /**
     * @param vessel The ship
     * @return       The maximum diameter (in meters) for a grav deck mounted on the unit.
     */
    public static int getMaxGravDeckDiameter(Jumpship vessel) {
        // TacOps, p. 314 says that space stations can mount grav decks up to 1500 m, but the
        // weight breakdown gives the largest category as 250-1000 m. I went with the larger
        // size here.
<span class="nc bnc" id="L350" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L351">            return 1500;</span>
        }
<span class="nc" id="L353">        return 250;</span>
    }
    
    /**
     * @return Minimum crew requirements based on unit type and equipment crew requirements.
     */
    public static int minimumBaseCrew(Jumpship vessel) {
        int crew;
<span class="nc bnc" id="L361" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">                || vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L363">            crew = 45 + (int) Math.ceil(vessel.getWeight() / 5000);</span>
        } else {
<span class="nc" id="L365">            crew = 6 + (int) Math.ceil(vessel.getWeight() / 20000);</span>
        }
<span class="nc bnc" id="L367" title="All 2 branches missed.">        for (Mounted m : vessel.getMisc()) {</span>
<span class="nc" id="L368">            crew += equipmentCrewRequirements(m);</span>
<span class="nc" id="L369">        }</span>
<span class="nc" id="L370">        return crew;</span>
    }
        
    /**
     * One gunner is required for each capital weapon and each six standard scale weapons, rounding up
     * @return The vessel's minimum gunner requirements.
     */
    public static int requiredGunners(Jumpship vessel) {
<span class="nc" id="L378">        int capitalWeapons = 0;</span>
<span class="nc" id="L379">        int stdWeapons = 0;</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">        for (Mounted m : vessel.getTotalWeaponList()) {</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">            if ((m.getType() instanceof BayWeapon)</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">                    || (((WeaponType)m.getType()).getLongRange() &lt;= 1)) {</span>
<span class="nc" id="L383">                continue;</span>
            }
<span class="nc bnc" id="L385" title="All 2 branches missed.">            if (m.getType().hasFlag(WeaponType.F_MASS_DRIVER)) {</span>
<span class="nc" id="L386">                capitalWeapons += 10;</span>
<span class="nc bnc" id="L387" title="All 2 branches missed.">            } else if (((WeaponType)m.getType()).isCapital()</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">                    || (m.getType() instanceof ScreenLauncherWeapon)) {</span>
<span class="nc" id="L389">                capitalWeapons++;</span>
            } else {
<span class="nc" id="L391">                stdWeapons++;</span>
            }
<span class="nc" id="L393">        }</span>
<span class="nc" id="L394">        return capitalWeapons + (int)Math.ceil(stdWeapons / 6.0);</span>
    }
    
    public TestAdvancedAerospace(Jumpship vessel, TestEntityOption option, String fs) {
<span class="fc" id="L398">        super(vessel, option, fs);</span>
        
<span class="fc" id="L400">        this.vessel = vessel;</span>
<span class="fc" id="L401">    }</span>

    @Override
    public Entity getEntity() {
<span class="nc" id="L405">        return vessel;</span>
    }

    @Override
    public boolean isTank() {
<span class="nc" id="L410">        return false;</span>
    }

    @Override
    public boolean isMech() {
<span class="nc" id="L415">        return false;</span>
    }
    
    @Override
    public boolean isAero() {
<span class="nc" id="L420">        return true;</span>
    }
    
    @Override
    public boolean isSmallCraft() {
<span class="nc" id="L425">        return false;</span>
    }
    
    @Override
    public boolean isAdvancedAerospace() {
<span class="nc" id="L430">        return true;</span>
    }

    @Override
    public double getWeightControls() {
<span class="nc bnc" id="L435" title="All 2 branches missed.">        if (vessel.isPrimitive()) {</span>
<span class="nc" id="L436">            return ceil(vessel.getWeight()</span>
<span class="nc" id="L437">                    * primitiveControlMultiplier(vessel.getOriginalBuildYear()), Ceil.TON);</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L439">            return ceil(vessel.getWeight() * 0.001, Ceil.TON);</span>
        } else {
<span class="nc" id="L441">            return ceil(vessel.getWeight() * 0.0025, Ceil.TON);</span>
        }
    }

    /**
     * @param year The original construction year of the jumpship chassis
     * @return     The control weight multiplier for the primitive jumpship.
     */
    public static double primitiveControlMultiplier(int year) {
<span class="nc bnc" id="L450" title="All 2 branches missed.">        if (year &gt;= 2300) {</span>
<span class="nc" id="L451">            return 0.0025;</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">        } else if (year &gt;= 2251) {</span>
<span class="nc" id="L453">            return 0.00275;</span>
<span class="nc bnc" id="L454" title="All 2 branches missed.">        } else if (year &gt;= 2201) {</span>
<span class="nc" id="L455">            return 0.0035;</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">        } else if (year &gt;= 2151) {</span>
<span class="nc" id="L457">            return 0.005;</span>
        } else {
<span class="nc" id="L459">            return 0.00625;</span>
        }
    }
    
    @Override
    public double getWeightEngine() {
<span class="nc" id="L465">        return calculateEngineTonnage(vessel);</span>
    }
    
    @Override
    public String printWeightEngine() {
<span class="nc" id="L470">        return StringUtil.makeLength(&quot;Engine: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L471">                + TestEntity.makeWeightString(getWeightEngine()) + &quot;\n&quot;;</span>
    }
    
    public double getWeightKFDrive() {
<span class="nc" id="L475">        return vessel.getJumpDriveWeight();</span>
    }

    public String printWeightKFDrive() {
<span class="nc" id="L479">        return StringUtil.makeLength(&quot;K/F Drive Core: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L480">                + TestEntity.makeWeightString(getWeightKFDrive()) + &quot;\n&quot;;</span>
    }
    
    public double getWeightSail() {
<span class="nc bnc" id="L484" title="All 2 branches missed.">        if (!vessel.hasSail()) {</span>
<span class="nc" id="L485">            return 0;</span>
        }
<span class="nc bnc" id="L487" title="All 2 branches missed.">        if (vessel.isPrimitive()) {</span>
<span class="nc bnc" id="L488" title="All 2 branches missed.">            if (vessel.getOriginalBuildYear() &lt; 2230) {</span>
<span class="nc" id="L489">                return Math.ceil(vessel.getWeight() / 2000) + 300;</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">            } else if (vessel.getOriginalBuildYear() &lt; 2260) {</span>
<span class="nc" id="L491">                return Math.ceil(vessel.getWeight() / 4000) + 150;</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">            } else if (vessel.getOriginalBuildYear() &lt; 2300) {</span>
<span class="nc" id="L493">                return Math.ceil(vessel.getWeight() / 8000) + 75;</span>
            } else {
<span class="nc" id="L495">                return Math.ceil(vessel.getWeight() / 20000) + 30;</span>
            }
<span class="nc bnc" id="L497" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</span>
<span class="nc" id="L498">            return Math.ceil(vessel.getWeight() / 20000) + 30;</span>
        } else {
            // Space stations with energy collection sail use jumpship formula.
<span class="nc" id="L501">            return Math.ceil(vessel.getWeight() / 7500) + 30;</span>
        }
    }

    public String printWeightSail() {
<span class="nc" id="L506">        return StringUtil.makeLength(&quot;Jump Sail: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L507">                + TestEntity.makeWeightString(getWeightSail()) + &quot;\n&quot;;</span>
    }
    
    @Override
    public double getWeightFuel() {
        // Fuel tanks and pumps add an additional 2%, rounded to the nearest ton
<span class="nc" id="L513">        double pumpWeight = RoundWeight.nextTon(vessel.getFuelTonnage() * 0.02);</span>
<span class="nc" id="L514">        return vessel.getFuelTonnage() + pumpWeight;</span>
    }

    @Override
    public int getCountHeatSinks() {
<span class="nc" id="L519">        return vessel.getHeatSinks();</span>
    }

    @Override
    public double getWeightHeatSinks() {
<span class="nc" id="L524">        return Math.max(vessel.getHeatSinks() - weightFreeHeatSinks(vessel), 0);        </span>
    }

    // Bays can store multiple tons of ammo in a single slot.
    @Override
    public double getWeightAmmo() {
<span class="nc" id="L530">        double weight = 0.0;</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">        for (Mounted m : getEntity().getAmmo()) {</span>

            // One Shot Ammo
<span class="nc bnc" id="L534" title="All 2 branches missed.">            if (m.getLocation() == Entity.LOC_NONE) {</span>
<span class="nc" id="L535">                continue;</span>
            }

<span class="nc" id="L538">            AmmoType mt = (AmmoType) m.getType();</span>
<span class="nc" id="L539">            int slots = (int) Math.ceil((double) m.getBaseShotsLeft() / mt.getShots());</span>
<span class="nc" id="L540">            weight += ceil(m.getTonnage() * slots, Ceil.HALFTON);</span>
<span class="nc" id="L541">        }</span>
<span class="nc" id="L542">        return weight;</span>
    }
    
    /**
     * @return The combined weight of grav decks mounted on the vessel
     */
    public double getWeightGravDecks() {
<span class="nc" id="L549">        return vessel.getGravDeck() * 50</span>
<span class="nc" id="L550">            + vessel.getGravDeckLarge() * 100</span>
<span class="nc" id="L551">            + vessel.getGravDeckHuge() * 500;</span>
    }
    
    public String printWeightGravDecks() {
<span class="nc" id="L555">        return StringUtil.makeLength(&quot;Gravity Decks: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L556">                + TestEntity.makeWeightString(getWeightGravDecks()) + &quot;\n&quot;;</span>
    }
    
    /**
     * @return The combined weight of all lifeboats and escape pods
     */
    public double getWeightLifeBoats() {
        // 7 tons each for life boats and escape pods, which includes the 5-ton vehicle and a
        // 2-ton launch mechanism
<span class="nc" id="L565">        return (vessel.getLifeBoats() + vessel.getEscapePods()) * 7;</span>
    }
    
    public String printWeightLifeBoats() {
<span class="nc" id="L569">        return StringUtil.makeLength(&quot;Life Boats/Escape Pods: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L570">                + TestEntity.makeWeightString(getWeightLifeBoats()) + &quot;\n&quot;;</span>
    }
    
    /**
     * 
     * @return Extra fire control system weight for exceeding base slot limit per firing arc
     */
    public double getWeightFireControl() {
<span class="nc" id="L578">        double weight = 0.0;</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">        for (double extra : extraSlotCost(vessel)) {</span>
<span class="nc" id="L580">            weight += extra;</span>
        }
<span class="nc" id="L582">        return weight;</span>
    }

    public String printWeightFireControl() {
<span class="nc" id="L586">        return StringUtil.makeLength(&quot;Extra Fire Control: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L587">                + TestEntity.makeWeightString(getWeightFireControl()) + &quot;\n&quot;;</span>
    }
    
    /**
     * 
     * @return The weight of the lithium fusion battery (0 if not present).
     */
    public double getWeightLFBattery() {
<span class="nc bnc" id="L595" title="All 2 branches missed.">        if (vessel.hasLF()) {</span>
<span class="nc" id="L596">            return vessel.getWeight() * 0.01;</span>
        }
<span class="nc" id="L598">        return 0.0;</span>
    }

    public String printWeightLFBattery() {
<span class="nc" id="L602">        return StringUtil.makeLength(&quot;LF Battery: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L603">                + TestEntity.makeWeightString(getWeightLFBattery()) + &quot;\n&quot;;</span>
    }
    
    public double getWeightHardpoints() {
<span class="nc" id="L607">        return 1000 * vessel.getDockingCollars().size();</span>
    }
    
    public String printWeightHardpoints() {
<span class="nc" id="L611">        return StringUtil.makeLength(&quot;Docking Hardpoints: &quot;, getPrintSize() - 5)</span>
<span class="nc" id="L612">                + TestEntity.makeWeightString(getWeightHardpoints()) + &quot;\n&quot;;</span>
    }
    
    @Override
    public StringBuffer printWeapon() {
<span class="nc bnc" id="L617" title="All 2 branches missed.">        if (!getEntity().usesWeaponBays()) {</span>
<span class="nc" id="L618">            return super.printWeapon();</span>
        }
<span class="nc" id="L620">        StringBuffer buffer = new StringBuffer();</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">        for (Mounted m : getEntity().getWeaponBayList()) {</span>
<span class="nc" id="L622">            buffer.append(m.getName()).append(&quot; &quot;)</span>
<span class="nc" id="L623">                .append(getLocationAbbr(m.getLocation()));</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">            if (m.isRearMounted()) {</span>
<span class="nc" id="L625">                buffer.append(&quot; (R)&quot;);</span>
            }
<span class="nc" id="L627">            buffer.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L628" title="All 2 branches missed.">            for (Integer wNum : m.getBayWeapons()) {</span>
<span class="nc" id="L629">                final Mounted w = getEntity().getEquipment(wNum);</span>
<span class="nc" id="L630">                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(w.getName(),</span>
<span class="nc" id="L631">                        getPrintSize() - 25)).append(w.getTonnage())</span>
<span class="nc" id="L632">                    .append(&quot;\n&quot;);</span>
<span class="nc" id="L633">            }</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">            for (Integer aNum : m.getBayAmmo()) {</span>
<span class="nc" id="L635">                final Mounted a = getEntity().getEquipment(aNum);</span>
<span class="nc" id="L636">                double weight = ceil(a.getTonnage()</span>
<span class="nc" id="L637">                        * a.getBaseShotsLeft() / ((AmmoType)a.getType()).getShots(), Ceil.HALFTON);</span>
<span class="nc" id="L638">                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(a.getName(),</span>
<span class="nc" id="L639">                        getPrintSize() - 25)).append(weight).append(&quot;\n&quot;);</span>
<span class="nc" id="L640">            }</span>
<span class="nc" id="L641">        }</span>
<span class="nc" id="L642">        return buffer;</span>
    }

    @Override
    public StringBuffer printAmmo() {
<span class="nc bnc" id="L647" title="All 2 branches missed.">        if (!vessel.usesWeaponBays()) {</span>
<span class="nc" id="L648">            return super.printAmmo();</span>
        }
<span class="nc" id="L650">        return new StringBuffer();</span>
    }

    @Override
    public boolean hasDoubleHeatSinks() {
<span class="nc bnc" id="L655" title="All 2 branches missed.">        return vessel.getHeatType() == Aero.HEAT_DOUBLE;</span>
    }

    @Override
    public String printWeightControls() {
<span class="nc" id="L660">        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</span>
<span class="nc" id="L661">                &quot;Control Systems:&quot;, getPrintSize() - 5));</span>
<span class="nc" id="L662">        retVal.append(makeWeightString(getWeightControls()));</span>
<span class="nc" id="L663">        retVal.append(&quot;\n&quot;);</span>
<span class="nc" id="L664">        return retVal.toString();</span>
    }
        
    @Override
    public String printWeightFuel() {
<span class="nc" id="L669">        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</span>
<span class="nc" id="L670">                &quot;Fuel: &quot;, getPrintSize() - 5));</span>
<span class="nc" id="L671">        retVal.append(makeWeightString(getWeightFuel()));</span>
<span class="nc" id="L672">        retVal.append(&quot;\n&quot;);</span>
<span class="nc" id="L673">        return retVal.toString();</span>
    }

    @Override
    public Aero getAero() {
<span class="nc" id="L678">        return vessel;</span>
    }
    
    public Jumpship getAdvancedAerospace() {
<span class="nc" id="L682">        return vessel;</span>
    }

    @Override
    public String printArmorLocProp(int loc, int wert) {
<span class="nc" id="L687">        return &quot; is greater than &quot; + Integer.toString(wert) + &quot;!&quot;;</span>
    }

    /**
     * Checks to see if this unit has valid armor assignment.
     * 
     * @param buff
     * @return
     */
    @Override
    public boolean correctArmor(StringBuffer buff) {
<span class="nc" id="L698">        boolean correct = true;</span>
<span class="nc" id="L699">        double maxArmor = maxArmorWeight(vessel);</span>
<span class="nc bnc" id="L700" title="All 2 branches missed.">        if (vessel.getLabArmorTonnage() &gt; maxArmor) {</span>
<span class="nc" id="L701">            buff.append(&quot;Total armor, &quot;)</span>
<span class="nc" id="L702">                    .append(vessel.getLabArmorTonnage())</span>
<span class="nc" id="L703">                    .append(&quot; tons, is greater than the maximum: &quot;)</span>
<span class="nc" id="L704">                    .append(maxArmor).append(&quot;\n&quot;);</span>
<span class="nc" id="L705">            correct = false;</span>
        }

<span class="nc" id="L708">        return correct ;</span>
    }
    
    /**
     * Checks that the heatsink type is a legal value.
     * 
     * @param buff
     * @return
     */
    @Override
    public boolean correctHeatSinks(StringBuffer buff) {
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if ((vessel.getHeatType() != Aero.HEAT_SINGLE) </span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">                &amp;&amp; (vessel.getHeatType() != Aero.HEAT_DOUBLE)) {</span>
<span class="nc" id="L721">            buff.append(&quot;Invalid heatsink type!  Valid types are &quot;</span>
                    + Aero.HEAT_SINGLE + &quot; and &quot; + Aero.HEAT_DOUBLE
<span class="nc" id="L723">                    + &quot;.  Found &quot; + vessel.getHeatType() + &quot;.&quot;);</span>
<span class="nc" id="L724">            return false;</span>
        }
<span class="nc" id="L726">        return true;</span>
    }

    @Override
    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<span class="nc" id="L731">        boolean correct = true;</span>
        
<span class="nc bnc" id="L733" title="All 2 branches missed.">        if (skip()) {</span>
<span class="nc" id="L734">            return true;</span>
        }
<span class="nc bnc" id="L736" title="All 2 branches missed.">        if (!correctWeight(buff)) {</span>
<span class="nc" id="L737">            buff.insert(0, printTechLevel() + printShortMovement());</span>
<span class="nc" id="L738">            buff.append(printWeightCalculation());</span>
<span class="nc" id="L739">            correct = false;</span>
        }
<span class="nc bnc" id="L741" title="All 2 branches missed.">        if (getCountHeatSinks() &lt; weightFreeHeatSinks(vessel)) {</span>
<span class="nc" id="L742">            buff.append(&quot;Heat Sinks:\n&quot;);</span>
<span class="nc" id="L743">            buff.append(&quot; Total     &quot; + getCountHeatSinks() + &quot;\n&quot;);</span>
<span class="nc" id="L744">            buff.append(&quot; Required  &quot; + weightFreeHeatSinks(vessel)</span>
                    + &quot;\n&quot;);
<span class="nc" id="L746">            correct = false;</span>
        }                
        
<span class="nc bnc" id="L749" title="All 4 branches missed.">        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</span>
<span class="nc" id="L750">            correct = false;</span>
        }
<span class="nc bnc" id="L752" title="All 4 branches missed.">        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</span>
<span class="nc" id="L753">            correct = false;</span>
        }
        
<span class="nc bnc" id="L756" title="All 2 branches missed.">        correct &amp;= !hasIllegalTechLevels(buff, ammoTechLvl);</span>
<span class="nc bnc" id="L757" title="All 2 branches missed.">        correct &amp;= !hasIllegalEquipmentCombinations(buff);</span>
<span class="nc" id="L758">        correct &amp;= correctHeatSinks(buff);</span>
<span class="nc" id="L759">        correct &amp;= correctCrew(buff);</span>
<span class="nc" id="L760">        correct &amp;= correctGravDecks(buff);</span>
<span class="nc" id="L761">        correct &amp;= correctBays(buff);</span>
<span class="nc" id="L762">        correct &amp;= correctCriticals(buff);</span>

<span class="nc" id="L764">        return correct;</span>
    }

    @Override
    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<span class="nc" id="L769">        boolean illegal = false;</span>
        
        // Make sure all bays have at least one weapon and that there are at least
        // ten shots of ammo for each ammo-using weapon in the bay.
<span class="nc bnc" id="L773" title="All 2 branches missed.">        for (Mounted bay : vessel.getWeaponBayList()) {</span>
<span class="nc bnc" id="L774" title="All 2 branches missed.">            if (bay.getBayWeapons().size() == 0) {</span>
<span class="nc" id="L775">                buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has no weapons\n&quot;);</span>
<span class="nc" id="L776">                illegal = true;</span>
            }
<span class="nc" id="L778">            Map&lt;Integer,Integer&gt; ammoWeaponCount = new HashMap&lt;&gt;();</span>
<span class="nc" id="L779">            Map&lt;Integer,Integer&gt; ammoTypeCount = new HashMap&lt;&gt;();</span>
<span class="nc bnc" id="L780" title="All 2 branches missed.">            for (Integer wNum : bay.getBayWeapons()) {</span>
<span class="nc" id="L781">                final Mounted w = vessel.getEquipment(wNum);</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">                if (w.isOneShotWeapon()) {</span>
<span class="nc" id="L783">                    continue;</span>
                }
<span class="nc bnc" id="L785" title="All 2 branches missed.">                if (w.getType() instanceof WeaponType) {</span>
<span class="nc" id="L786">                    ammoWeaponCount.merge(((WeaponType)w.getType()).getAmmoType(), 1, Integer::sum);</span>
                } else {
<span class="nc" id="L788">                    buff.append(w.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not a weapon\n&quot;);</span>
<span class="nc" id="L789">                    illegal = true;</span>
                }
<span class="nc" id="L791">            }</span>
<span class="nc bnc" id="L792" title="All 2 branches missed.">            for (Integer aNum : bay.getBayAmmo()) {</span>
<span class="nc" id="L793">                final Mounted a = vessel.getEquipment(aNum);</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">                if (a.getType() instanceof AmmoType) {</span>
<span class="nc" id="L795">                    ammoTypeCount.merge(((AmmoType)a.getType()).getAmmoType(), a.getUsableShotsLeft(),</span>
                            Integer::sum);
                } else {
<span class="nc" id="L798">                    buff.append(a.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not ammo\n&quot;);</span>
<span class="nc" id="L799">                    illegal = true;</span>
                }
<span class="nc" id="L801">            }</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">            for (Integer at : ammoWeaponCount.keySet()) {</span>
<span class="nc bnc" id="L803" title="All 2 branches missed.">                if (at != AmmoType.T_NA) {</span>
<span class="nc" id="L804">                    int needed = ammoWeaponCount.get(at) * 10;</span>
<span class="nc bnc" id="L805" title="All 4 branches missed.">                    if ((at == AmmoType.T_AC_ULTRA) || (at == AmmoType.T_AC_ULTRA_THB)) {</span>
<span class="nc" id="L806">                        needed *= 2;</span>
<span class="nc bnc" id="L807" title="All 2 branches missed.">                    } else if ((at == AmmoType.T_AC_ROTARY)) {</span>
<span class="nc" id="L808">                        needed *= 6;</span>
                    }
<span class="nc bnc" id="L810" title="All 2 branches missed.">                    if (!ammoTypeCount.containsKey(at)</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">                            || ammoTypeCount.get(at) &lt; needed) {</span>
<span class="nc" id="L812">                        buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; does not have the minimum 10 shots of ammo for each weapon\n&quot;);</span>
<span class="nc" id="L813">                        illegal = true;</span>
<span class="nc" id="L814">                        break;</span>
                    }
                }
<span class="nc" id="L817">            }</span>
<span class="nc bnc" id="L818" title="All 2 branches missed.">            for (Integer at : ammoTypeCount.keySet()) {</span>
<span class="nc bnc" id="L819" title="All 2 branches missed.">                if (!ammoWeaponCount.containsKey(at)) {</span>
<span class="nc" id="L820">                    buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has ammo for a weapon not in the bay\n&quot;);</span>
<span class="nc" id="L821">                    illegal = true;</span>
<span class="nc" id="L822">                    break;</span>
                }
<span class="nc" id="L824">            }</span>
<span class="nc" id="L825">        }</span>
        
        // Count lateral weapons to make sure both sides match
<span class="nc" id="L828">        Map&lt;EquipmentType,Integer&gt; leftFwd = new HashMap&lt;&gt;();</span>
<span class="nc" id="L829">        Map&lt;EquipmentType,Integer&gt; leftAft = new HashMap&lt;&gt;();</span>
<span class="nc" id="L830">        Map&lt;EquipmentType,Integer&gt; leftBroad = new HashMap&lt;&gt;();</span>
<span class="nc" id="L831">        Map&lt;EquipmentType,Integer&gt; rightFwd = new HashMap&lt;&gt;();</span>
<span class="nc" id="L832">        Map&lt;EquipmentType,Integer&gt; rightAft = new HashMap&lt;&gt;();</span>
<span class="nc" id="L833">        Map&lt;EquipmentType,Integer&gt; rightBroad = new HashMap&lt;&gt;();</span>
<span class="nc" id="L834">        Map&lt;Integer,Integer&gt; massDriversPerArc = new HashMap&lt;&gt;();</span>
        
<span class="nc" id="L836">        BigInteger typeFlag = MiscType.F_JS_EQUIPMENT;</span>
<span class="nc bnc" id="L837" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</span>
<span class="nc" id="L838">            typeFlag = MiscType.F_WS_EQUIPMENT;</span>
<span class="nc bnc" id="L839" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L840">            typeFlag = MiscType.F_SS_EQUIPMENT;</span>
        }
<span class="nc bnc" id="L842" title="All 2 branches missed.">        for (Mounted m : vessel.getEquipment()) {</span>
<span class="nc bnc" id="L843" title="All 2 branches missed.">            if (m.getType() instanceof MiscType) {</span>
<span class="nc bnc" id="L844" title="All 2 branches missed.">                if (!m.getType().hasFlag(typeFlag)) {</span>
<span class="nc" id="L845">                    buff.append(&quot;Cannot mount &quot; + m.getType().getName() + &quot;\n&quot;);</span>
<span class="nc" id="L846">                    illegal = true;</span>
                }
<span class="nc bnc" id="L848" title="All 2 branches missed.">            } else if (m.getType() instanceof WeaponType) {</span>
<span class="nc bnc" id="L849" title="All 2 branches missed.">                if (m.getType().hasFlag(WeaponType.F_MASS_DRIVER)</span>
<span class="nc bnc" id="L850" title="All 2 branches missed.">                        &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</span>
<span class="nc bnc" id="L851" title="All 2 branches missed.">                        &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L852">                    buff.append(&quot;A mass driver may not be mounted on a Jumpship.\n&quot;);</span>
<span class="nc" id="L853">                    illegal = true;</span>
                }
<span class="nc bnc" id="L855" title="All 7 branches missed.">                switch (m.getLocation()) {</span>
                    case Jumpship.LOC_FLS:
<span class="nc" id="L857">                        leftFwd.merge(m.getType(), 1, Integer::sum);</span>
<span class="nc" id="L858">                        break;</span>
                    case Jumpship.LOC_FRS:
<span class="nc" id="L860">                        rightFwd.merge(m.getType(), 1, Integer::sum);</span>
<span class="nc" id="L861">                        break;</span>
                    case Jumpship.LOC_ALS:
<span class="nc" id="L863">                        leftAft.merge(m.getType(), 1, Integer::sum);</span>
<span class="nc" id="L864">                        break;</span>
                    case Jumpship.LOC_ARS:
<span class="nc" id="L866">                        rightAft.merge(m.getType(), 1, Integer::sum);</span>
<span class="nc" id="L867">                        break;</span>
                    case Warship.LOC_LBS:
<span class="nc" id="L869">                        leftBroad.merge(m.getType(), 1, Integer::sum);</span>
<span class="nc" id="L870">                        break;</span>
                    case Warship.LOC_RBS:
<span class="nc" id="L872">                        rightBroad.merge(m.getType(), 1, Integer::sum);</span>
                        break;
                }
<span class="nc bnc" id="L875" title="All 2 branches missed.">                if (!isAeroWeapon(m.getType(), vessel)) {</span>
<span class="nc" id="L876">                    buff.append(&quot;Cannot mount &quot; + m.getType().getName() + &quot;\n&quot;);</span>
<span class="nc" id="L877">                    illegal = true;</span>
                }
<span class="nc bnc" id="L879" title="All 2 branches missed.">                if ((m.getType().hasFlag(WeaponType.F_MASS_DRIVER)</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">                        &amp;&amp; !(m.getType() instanceof BayWeapon))) {</span>
<span class="nc" id="L881">                    massDriversPerArc.merge(m.getLocation(), 1, Integer::sum);</span>
<span class="nc" id="L882">                    int at = ((WeaponType) m.getType()).getAmmoType();</span>
<span class="nc bnc" id="L883" title="All 4 branches missed.">                    if ((at == AmmoType.T_HMASS) &amp;&amp; vessel.getWeight() &lt; 2000000) {</span>
<span class="nc" id="L884">                        buff.append(&quot;Minimum vessel tonnage for &quot;)</span>
<span class="nc" id="L885">                            .append(m.getType().getName()).append(&quot; is 2,000,000 tons\n&quot;);</span>
<span class="nc" id="L886">                        illegal = true;</span>
<span class="nc bnc" id="L887" title="All 4 branches missed.">                    } else if ((at == AmmoType.T_MMASS) &amp;&amp; vessel.getWeight() &lt; 1500000) {</span>
<span class="nc" id="L888">                        buff.append(&quot;Minimum vessel tonnage for &quot;)</span>
<span class="nc" id="L889">                            .append(m.getType().getName()).append(&quot; is 1,500,000 tons\n&quot;);</span>
<span class="nc" id="L890">                        illegal = true;</span>
<span class="nc bnc" id="L891" title="All 4 branches missed.">                    } else if((at == AmmoType.T_LMASS) &amp;&amp; vessel.getWeight() &lt; 750000) {</span>
<span class="nc" id="L892">                        buff.append(&quot;Minimum vessel tonnage for &quot;)</span>
<span class="nc" id="L893">                            .append(m.getType().getName()).append(&quot; is 750,000 tons\n&quot;);</span>
<span class="nc" id="L894">                        illegal = true;</span>
                    }
                }
            }
<span class="nc" id="L898">        }</span>
<span class="nc" id="L899">        boolean lateralMatch = true;</span>
        // Forward weapons
<span class="nc bnc" id="L901" title="All 2 branches missed.">        for (EquipmentType eq : leftFwd.keySet()) {</span>
<span class="nc bnc" id="L902" title="All 4 branches missed.">            if (!rightFwd.containsKey(eq) || !leftFwd.get(eq).equals(rightFwd.get(eq))) {</span>
<span class="nc" id="L903">                lateralMatch = false;</span>
<span class="nc" id="L904">                break;</span>
            }
<span class="nc" id="L906">        }</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">        if (lateralMatch) {</span>
            //We've already checked counts, so in the reverse direction we only need to see if there's
            //anything not found on the other side.
<span class="nc bnc" id="L910" title="All 2 branches missed.">            for (EquipmentType eq : rightFwd.keySet()) {</span>
<span class="nc bnc" id="L911" title="All 2 branches missed.">                if (!leftFwd.containsKey(eq)) {</span>
<span class="nc" id="L912">                    lateralMatch = false;</span>
<span class="nc" id="L913">                    break;</span>
                }
<span class="nc" id="L915">            }</span>
        }
        // Aft weapons
<span class="nc bnc" id="L918" title="All 2 branches missed.">        if (lateralMatch) {</span>
<span class="nc bnc" id="L919" title="All 2 branches missed.">            for (EquipmentType eq : leftAft.keySet()) {</span>
<span class="nc bnc" id="L920" title="All 4 branches missed.">                if (!rightAft.containsKey(eq) || !leftAft.get(eq).equals(rightAft.get(eq))) {</span>
<span class="nc" id="L921">                    lateralMatch = false;</span>
<span class="nc" id="L922">                    break;</span>
                }
<span class="nc" id="L924">            }</span>
        }
<span class="nc bnc" id="L926" title="All 2 branches missed.">        if (lateralMatch) {</span>
<span class="nc bnc" id="L927" title="All 2 branches missed.">            for (EquipmentType eq : rightAft.keySet()) {</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">                if (!leftAft.containsKey(eq)) {</span>
<span class="nc" id="L929">                    lateralMatch = false;</span>
<span class="nc" id="L930">                    break;</span>
                }
<span class="nc" id="L932">            }</span>
        }
        // Broadside (warships)
<span class="nc bnc" id="L935" title="All 2 branches missed.">        if (lateralMatch) {</span>
<span class="nc bnc" id="L936" title="All 2 branches missed.">            for (EquipmentType eq : leftBroad.keySet()) {</span>
<span class="nc bnc" id="L937" title="All 4 branches missed.">                if (!rightBroad.containsKey(eq) || !leftBroad.get(eq).equals(rightBroad.get(eq))) {</span>
<span class="nc" id="L938">                    lateralMatch = false;</span>
<span class="nc" id="L939">                    break;</span>
                }
<span class="nc" id="L941">            }</span>
        }
<span class="nc bnc" id="L943" title="All 2 branches missed.">        if (lateralMatch) {</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">            for (EquipmentType eq : rightBroad.keySet()) {</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">                if (!leftBroad.containsKey(eq)) {</span>
<span class="nc" id="L946">                    lateralMatch = false;</span>
<span class="nc" id="L947">                    break;</span>
                }
<span class="nc" id="L949">            }</span>
        }
<span class="nc bnc" id="L951" title="All 2 branches missed.">        if (!lateralMatch) {</span>
<span class="nc" id="L952">            buff.append(&quot;Left and right side weapon loads do not match.\n&quot;);</span>
<span class="nc" id="L953">            illegal = true;</span>
        }
        
<span class="nc bnc" id="L956" title="All 2 branches missed.">        for (Map.Entry&lt;Integer, Integer&gt; entry : massDriversPerArc.entrySet()) {</span>
<span class="nc bnc" id="L957" title="All 2 branches missed.">            if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</span>
<span class="nc bnc" id="L958" title="All 2 branches missed.">                    &amp;&amp; (entry.getKey() != Warship.LOC_NOSE)</span>
<span class="nc bnc" id="L959" title="All 2 branches missed.">                    &amp;&amp; (entry.getValue() &gt; 0)) {</span>
<span class="nc" id="L960">                buff.append(&quot;A warship may only mount a mass driver in the nose firing arc.\n&quot;);</span>
<span class="nc" id="L961">                illegal = true;</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">            } else if (entry.getValue() &gt; 1) {</span>
<span class="nc" id="L963">                buff.append(&quot;A ship may not mount more than one mass driver in a firing arc.\n&quot;);</span>
<span class="nc" id="L964">                illegal = true;</span>
            }
<span class="nc" id="L966">        }</span>

<span class="nc" id="L968">        int bayDoors = 0;</span>
<span class="nc bnc" id="L969" title="All 2 branches missed.">        for (Bay bay : vessel.getTransportBays()) {</span>
<span class="nc" id="L970">            bayDoors += bay.getDoors();</span>
<span class="nc bnc" id="L971" title="All 2 branches missed.">            if (bay.getDoors() == 0) {</span>
<span class="nc" id="L972">                BayData data = BayData.getBayType(bay);</span>
<span class="nc bnc" id="L973" title="All 6 branches missed.">                if ((data != null) &amp;&amp; !data.isCargoBay() &amp;&amp; !data.isInfantryBay()) {</span>
<span class="nc" id="L974">                    buff.append(&quot;Transport bays other than cargo and infantry require at least one door.\n&quot;);</span>
<span class="nc" id="L975">                    illegal = true;</span>
                }
            }
<span class="nc" id="L978">        }</span>
<span class="nc bnc" id="L979" title="All 2 branches missed.">        if (bayDoors &gt; maxBayDoors(vessel)) {</span>
<span class="nc" id="L980">            buff.append(&quot;Exceeds maximum number of bay doors.\n&quot;);</span>
<span class="nc" id="L981">            illegal = true;</span>
        }

<span class="nc" id="L984">        return illegal;</span>
    }
    
    /**
     * Checks that the unit meets minimum crew and quarters requirements.
     * @param buffer Where to write messages explaining failures.
     * @return  true if the crew data is valid.
     */
    public boolean correctCrew(StringBuffer buffer) {
<span class="nc" id="L993">        boolean illegal = false;</span>
<span class="nc" id="L994">        int crewSize = vessel.getNCrew() - vessel.getBayPersonnel();</span>
<span class="nc" id="L995">        int reqCrew = minimumBaseCrew(vessel) + requiredGunners(vessel);</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">        if (crewSize &lt; reqCrew) {</span>
<span class="nc" id="L997">            buffer.append(&quot;Requires &quot; + reqCrew + &quot; crew and only has &quot; + crewSize + &quot;\n&quot;);</span>
<span class="nc" id="L998">            illegal = true;</span>
        }
<span class="nc bnc" id="L1000" title="All 2 branches missed.">        if (vessel.getNOfficers() &lt; Math.ceil(reqCrew / 6.0)) {</span>
<span class="nc" id="L1001">            buffer.append(&quot;Requires at least &quot; + (int)Math.ceil(reqCrew / 6.0) + &quot; officers\n&quot;);</span>
<span class="nc" id="L1002">            illegal = true;</span>
        }
<span class="nc" id="L1004">        crewSize += vessel.getNPassenger();</span>
<span class="nc" id="L1005">        crewSize += vessel.getNMarines();</span>
<span class="nc" id="L1006">        crewSize += vessel.getNBattleArmor();</span>
<span class="nc" id="L1007">        int quarters = 0;</span>
<span class="nc bnc" id="L1008" title="All 2 branches missed.">        for (Bay bay : vessel.getTransportBays()) {</span>
<span class="nc" id="L1009">            Quarters q = Quarters.getQuartersForBay(bay);</span>
<span class="nc bnc" id="L1010" title="All 2 branches missed.">            if (null != q) {</span>
<span class="nc" id="L1011">                quarters += bay.getCapacity();</span>
            }
<span class="nc" id="L1013">        }</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">        if (quarters &lt; crewSize) {</span>
<span class="nc" id="L1015">            buffer.append(&quot;Requires quarters for &quot; + crewSize + &quot; crew but only has &quot; + quarters + &quot;\n&quot;);</span>
<span class="nc" id="L1016">            illegal = true;</span>
        }
<span class="nc bnc" id="L1018" title="All 2 branches missed.">        return !illegal;</span>
    }

    /**
     * Checks that the unit does not exceed the maximum number or size of gravity decks.
     * @param buffer Where to write messages explaining failures.
     * @return  true if the crew data is valid.
     */
    public boolean correctGravDecks(StringBuffer buffer) {
<span class="nc" id="L1027">        boolean illegal = false;</span>
<span class="nc bnc" id="L1028" title="All 2 branches missed.">        if (vessel.getGravDecks().size() &gt; getMaxGravDecks(vessel)) {</span>
<span class="nc" id="L1029">            buffer.append(&quot;Exceeds maximum &quot; + getMaxGravDecks(vessel) + &quot; gravity decks.\n&quot;);</span>
<span class="nc" id="L1030">            illegal = true;</span>
        }
<span class="nc" id="L1032">        int maxSize = Jumpship.GRAV_DECK_LARGE_MAX;</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="nc" id="L1034">            maxSize = Jumpship.GRAV_DECK_HUGE_MAX;</span>
        }
<span class="nc bnc" id="L1036" title="All 2 branches missed.">        for (Integer dia : vessel.getGravDecks()) {</span>
<span class="nc bnc" id="L1037" title="All 2 branches missed.">            if (dia &gt; maxSize) {</span>
<span class="nc" id="L1038">                buffer.append(&quot;Maximum grav deck diameter is &quot; + maxSize + &quot;\n&quot;);</span>
<span class="nc" id="L1039">                illegal = true;</span>
<span class="nc" id="L1040">                break;</span>
            }
<span class="nc" id="L1042">        }</span>
<span class="nc bnc" id="L1043" title="All 2 branches missed.">        return !illegal;</span>
    }
    
    /**
     * Checks that the unit does not have more than one naval repair facility or dropshuttle bay
     * per facing, all are assigned a facing, and non-stations have no more than one repair facility.
     * 
     * @param buffer Where to write messages explaining failures.
     * @return  true if the bay data is valid
     */
    public boolean correctBays(StringBuffer buffer) {
<span class="fc" id="L1054">        boolean legal = true;</span>
        
<span class="fc" id="L1056">        Set&lt;Integer&gt; facings = new HashSet&lt;&gt;();</span>
<span class="fc" id="L1057">        int repairCount = 0;</span>
<span class="fc bfc" id="L1058" title="All 2 branches covered.">        for (Bay bay : vessel.getTransportBays()) {</span>
<span class="pc bpc" id="L1059" title="1 of 2 branches missed.">            if (bay.hardpointCost() &gt; 0) {</span>
<span class="pc bpc" id="L1060" title="1 of 4 branches missed.">                if ((bay.getFacing() &lt; 0) || (bay.getFacing() &gt;= Warship.LOC_LBS)) {</span>
<span class="fc" id="L1061">                    buffer.append(bay.getType() + &quot; is not assigned a legal armor facing.\n&quot;);</span>
<span class="fc" id="L1062">                    legal = false;</span>
<span class="fc bfc" id="L1063" title="All 2 branches covered.">                } else if (facings.contains(bay.getFacing())) {</span>
<span class="fc" id="L1064">                    buffer.append(&quot;Exceeds maximum of one repair facility or dropshuttle bay per armor facing.\n&quot;);</span>
<span class="fc" id="L1065">                    legal = false;</span>
                }
<span class="fc" id="L1067">                facings.add(bay.getFacing());</span>
<span class="pc bpc" id="L1068" title="1 of 2 branches missed.">                if (bay instanceof NavalRepairFacility) {</span>
<span class="fc" id="L1069">                    repairCount++;</span>
                }
            }
<span class="fc" id="L1072">        }</span>
<span class="fc bfc" id="L1073" title="All 4 branches covered.">        if ((repairCount &gt; 1) &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</span>
<span class="fc" id="L1074">            buffer.append(&quot;Only a space station may mount multiple naval repair facilities.\n&quot;);</span>
<span class="fc" id="L1075">            legal = false;</span>
        }
        
<span class="fc" id="L1078">        return legal;</span>
    }
    
    @Override
    public StringBuffer printEntity() {
<span class="nc" id="L1083">        StringBuffer buff = new StringBuffer();</span>
<span class="nc" id="L1084">        buff.append(&quot;Advanced Aerospace: &quot;).append(vessel.getDisplayName()).append(&quot;\n&quot;);</span>
<span class="nc" id="L1085">        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);        </span>
<span class="nc" id="L1086">        buff.append(printTechLevel());</span>
<span class="nc" id="L1087">        buff.append(&quot;Intro year: &quot;).append(getEntity().getYear()).append(&quot;\n&quot;);</span>
<span class="nc" id="L1088">        buff.append(printSource());</span>
<span class="nc" id="L1089">        buff.append(printShortMovement());</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">        if (correctWeight(buff, true, true)) {</span>
<span class="nc" id="L1091">            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;)</span>
<span class="nc" id="L1092">                    .append(calculateWeight()).append(&quot;)\n&quot;);</span>
        }
<span class="nc" id="L1094">        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</span>
<span class="nc" id="L1095">        buff.append(printArmorPlacement());</span>
<span class="nc" id="L1096">        correctArmor(buff);</span>
<span class="nc" id="L1097">        buff.append(printLocations());</span>
<span class="nc" id="L1098">        correctCriticals(buff);</span>

        // printArmor(buff);
<span class="nc" id="L1101">        printFailedEquipment(buff);</span>
<span class="nc" id="L1102">        return buff;</span>
    }
    
    @Override
    public double calculateWeight() {
<span class="nc" id="L1107">        double weight = 0;</span>
<span class="nc" id="L1108">        weight += getWeightStructure();</span>
<span class="nc" id="L1109">        weight += getWeightEngine();</span>
<span class="nc" id="L1110">        weight += getWeightKFDrive();</span>
<span class="nc" id="L1111">        weight += getWeightLFBattery();</span>
<span class="nc" id="L1112">        weight += getWeightSail();</span>
<span class="nc" id="L1113">        weight += getWeightControls();</span>
<span class="nc" id="L1114">        weight += getWeightFuel();</span>
<span class="nc" id="L1115">        weight += getWeightHeatSinks();</span>
<span class="nc" id="L1116">        weight += getWeightArmor();</span>
<span class="nc" id="L1117">        weight += getWeightFireControl();</span>

<span class="nc" id="L1119">        weight += getWeightMiscEquip();</span>
<span class="nc" id="L1120">        weight += getWeightWeapon();</span>
<span class="nc" id="L1121">        weight += getWeightAmmo();</span>

<span class="nc" id="L1123">        weight += getWeightCarryingSpace();</span>
<span class="nc" id="L1124">        weight += getWeightHardpoints();</span>
<span class="nc" id="L1125">        weight += getWeightQuarters();</span>
<span class="nc" id="L1126">        weight += getWeightGravDecks();</span>
<span class="nc" id="L1127">        weight += getWeightLifeBoats();</span>

<span class="nc" id="L1129">        return weight;</span>
    }

    @Override
    public String printWeightCalculation() {
<span class="nc" id="L1134">        return printWeightStructure() + printWeightEngine()</span>
<span class="nc" id="L1135">                + printWeightKFDrive() + printWeightLFBattery()</span>
<span class="nc" id="L1136">                + printWeightSail() + printWeightControls()</span>
<span class="nc" id="L1137">                + printWeightFuel() + printWeightHeatSinks()</span>
<span class="nc" id="L1138">                + printWeightArmor() + printWeightFireControl()</span>
<span class="nc" id="L1139">                + printWeightCarryingSpace() + printWeightHardpoints()</span>
<span class="nc" id="L1140">                + printWeightQuarters() + printWeightGravDecks()</span>
<span class="nc" id="L1141">                + printWeightLifeBoats()</span>
                + &quot;Equipment:\n&quot;
<span class="nc" id="L1143">                + printMiscEquip() + printWeapon() + printAmmo();</span>
    }
    
    @Override
    public String printLocations() {
<span class="nc" id="L1148">        StringBuilder buff = new StringBuilder();</span>
<span class="nc bnc" id="L1149" title="All 2 branches missed.">        for (int i = 0; i &lt; getEntity().locations(); i++) {</span>
<span class="nc" id="L1150">            String locationName = getEntity().getLocationName(i);</span>
<span class="nc" id="L1151">            buff.append(locationName).append(&quot;:&quot;).append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L1152" title="All 2 branches missed.">            for (int j = 0; j &lt; getEntity().getNumberOfCriticals(i); j++) {</span>
<span class="nc" id="L1153">                CriticalSlot slot = getEntity().getCritical(i, j);</span>
<span class="nc bnc" id="L1154" title="All 2 branches missed.">                if (slot == null) {</span>
<span class="nc" id="L1155">                    j = getEntity().getNumberOfCriticals(i);                    </span>
<span class="nc bnc" id="L1156" title="All 2 branches missed.">                } else if (slot.getType() == CriticalSlot.TYPE_SYSTEM) {</span>
<span class="nc" id="L1157">                        buff.append(j).append(&quot;. UNKNOWN SYSTEM NAME&quot;);</span>
<span class="nc" id="L1158">                        buff.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L1159" title="All 2 branches missed.">                } else if (slot.getType() == CriticalSlot.TYPE_EQUIPMENT) {</span>
<span class="nc" id="L1160">                    EquipmentType e = getEntity().getEquipmentType(slot);</span>
<span class="nc" id="L1161">                    buff.append(j).append(&quot;. &quot;).append(e.getInternalName());</span>
<span class="nc" id="L1162">                    buff.append(&quot;\n&quot;);</span>
                }
            }
        }

<span class="nc" id="L1167">        double[] extra = extraSlotCost(vessel);</span>
<span class="nc bnc" id="L1168" title="All 2 branches missed.">        for (int i = 0; i &lt; extra.length; i++) {</span>
<span class="nc bnc" id="L1169" title="All 2 branches missed.">            if (extra[i] &gt; 0) {</span>
<span class="nc bnc" id="L1170" title="All 2 branches missed.">                if (i &lt; getEntity().locations()) {</span>
<span class="nc" id="L1171">                    buff.append(getLocationAbbr(i));</span>
                } else {
<span class="nc" id="L1173">                    buff.append(getLocationAbbr(i - 3)).append(&quot; (R)&quot;);</span>
                }
<span class="nc" id="L1175">                buff.append(&quot; requires &quot;).append(extra[i]).append(&quot; tons of additional fire control.\n&quot;);</span>
            }
        }

<span class="nc" id="L1179">        return buff.toString();</span>
    }
    
    @Override
    public String getName() {
<span class="nc bnc" id="L1184" title="All 2 branches missed.">        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</span>
<span class="nc" id="L1185">            return &quot;Warship: &quot; + vessel.getDisplayName();</span>
<span class="nc bnc" id="L1186" title="All 2 branches missed.">        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)){</span>
<span class="nc" id="L1187">            return &quot;Space Station: &quot; + vessel.getDisplayName();</span>
        } else {
<span class="nc" id="L1189">            return &quot;Jumpship: &quot; + vessel.getDisplayName();</span>
        }
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>