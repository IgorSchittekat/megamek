<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PlanetaryConditions.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">PlanetaryConditions.java</span></div><h1>PlanetaryConditions.java</h1><pre class="source lang-java linenums">/*
* MegaMek -
* Copyright (C) 2005 Ben Mazur (bmazur@sev.org)
* Copyright (C) 2018 The MegaMek Team
*
* This program is free software; you can redistribute it and/or modify it under
* the terms of the GNU General Public License as published by the Free Software
* Foundation; either version 2 of the License, or (at your option) any later
* version.
*
* This program is distributed in the hope that it will be useful, but WITHOUT
* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
* FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
* details.
*/

package megamek.common;

import java.io.Serializable;

/**
 * This class will hold all the information on planetary conditions and a variety of helper functions
 * for those conditions
 */
public class PlanetaryConditions implements Serializable {

    private static final long serialVersionUID = 6838624193286089781L;

    //light
    public static final int L_DAY          = 0;
    public static final int L_DUSK         = 1;
    public static final int L_FULL_MOON    = 2;
    public static final int L_MOONLESS     = 3;
    public static final int L_PITCH_BLACK  = 4;
<span class="fc" id="L35">    private static String[] lightNames = { &quot;Daylight&quot;, &quot;Dusk&quot;, &quot;Full Moon Night&quot;, &quot;Moonless Night&quot;,</span>
                                           &quot;Pitch Black&quot;};
<span class="fc" id="L37">    public static final int L_SIZE = lightNames.length;</span>

    //Weather
    public static final int WE_NONE             = 0;
    public static final int WE_LIGHT_RAIN       = 1;
    public static final int WE_MOD_RAIN         = 2;
    public static final int WE_HEAVY_RAIN       = 3;
    public static final int WE_GUSTING_RAIN     = 4;
    public static final int WE_DOWNPOUR         = 5;
    public static final int WE_LIGHT_SNOW       = 6;
    public static final int WE_MOD_SNOW         = 7;
    public static final int WE_SNOW_FLURRIES    = 8;
    public static final int WE_HEAVY_SNOW       = 9;
    public static final int WE_SLEET            = 10;
    public static final int WE_BLIZZARD         = 11;
    public static final int WE_ICE_STORM        = 12;
    public static final int WE_LIGHT_HAIL       = 13;
    public static final int WE_HEAVY_HAIL       = 14;
<span class="fc" id="L55">    private static String[] weatherNames = { &quot;Clear&quot;, &quot;Light Rain&quot;, &quot;Moderate Rain&quot;, &quot;Heavy Rain&quot;, &quot;Gusting Rain&quot;, &quot;Torrential Downpour&quot;,</span>
                                             &quot;Light Snowfall&quot;, &quot;Moderate Snowfall&quot;, &quot;Snow Flurries&quot;, &quot;Heavy Snowfall&quot;, &quot;Sleet&quot;, &quot;Blizzard&quot;,
                                             &quot;Ice Storm&quot;};//, &quot;Light Hail&quot;, &quot;Heavy Hail&quot;};
<span class="fc" id="L58">    public static final int WE_SIZE = weatherNames.length;</span>

    //Wind
    public static final int WI_NONE        = 0;
    public static final int WI_LIGHT_GALE  = 1;
    public static final int WI_MOD_GALE    = 2;
    public static final int WI_STRONG_GALE = 3;
    public static final int WI_STORM       = 4;
    public static final int WI_TORNADO_F13 = 5;
    public static final int WI_TORNADO_F4  = 6;

<span class="fc" id="L69">    private static String[] windNames = { &quot;Calm&quot;, &quot;Light Gale&quot;, &quot;Moderate Gale&quot;, &quot;Strong Gale&quot;, &quot;Storm&quot;, &quot;Tornado F1-F3&quot;, &quot;Tornado F4&quot;};</span>
<span class="fc" id="L70">    public static final int WI_SIZE = windNames.length;</span>

    //wind direction
<span class="fc" id="L73">    private static String[] dirNames = { &quot;North&quot;, &quot;Northeast&quot;, &quot;Southeast&quot;, &quot;South&quot;, &quot;Southwest&quot;, &quot;Northwest&quot;, &quot;RandomWindDirection&quot; };</span>
<span class="fc" id="L74">    public static final int DIR_SIZE = dirNames.length;</span>
    public static final int DIR_RANDOM = 6;
    

    //atmospheric pressure
    public static final int ATMO_VACUUM   = 0;
    public static final int ATMO_TRACE    = 1;
    public static final int ATMO_THIN     = 2;
    public static final int ATMO_STANDARD = 3;
    public static final int ATMO_HIGH     = 4;
    public static final int ATMO_VHIGH    = 5;

<span class="fc" id="L86">    public static String[] atmoNames = {&quot;Vacuum&quot;, &quot;Trace&quot;, &quot;Thin&quot;, &quot;Standard&quot;, &quot;High&quot;, &quot;Very High&quot; };</span>
<span class="fc" id="L87">    public static final int ATMO_SIZE = atmoNames.length;</span>

    //fog
    public static final int FOG_NONE  = 0;
    public static final int FOG_LIGHT = 1;
    public static final int FOG_HEAVY = 2;

<span class="fc" id="L94">    private static String[] fogNames = {&quot;None&quot;, &quot;Light Fog&quot;, &quot;Heavy Fog&quot; };</span>
<span class="fc" id="L95">    public static final int FOG_SIZE = fogNames.length;</span>

    //misc
<span class="pc" id="L98">    private boolean blowingSand = false;</span>
<span class="pc" id="L99">    private boolean sandStorm = false;</span>
<span class="pc" id="L100">    private boolean runOnce = false;</span>

    //set up the specific conditions
<span class="pc" id="L103">    private int lightConditions = L_DAY;</span>
<span class="pc" id="L104">    private int weatherConditions = WE_NONE;</span>
<span class="pc" id="L105">    private int oldWeatherConditions = WE_NONE;</span>
<span class="pc" id="L106">    private int windStrength = WI_NONE;</span>
<span class="pc" id="L107">    private int windDirection = DIR_RANDOM;</span>
<span class="pc" id="L108">    private boolean shiftWindDirection = false;</span>
<span class="pc" id="L109">    private boolean shiftWindStrength = false;</span>
<span class="pc" id="L110">    private boolean isSleeting = false;</span>
<span class="pc" id="L111">    private int atmosphere = ATMO_STANDARD;</span>
<span class="pc" id="L112">    private int fog = FOG_NONE;</span>
<span class="pc" id="L113">    private int temperature = 25;</span>
<span class="pc" id="L114">    private int oldTemperature = 25;</span>
<span class="pc" id="L115">    private float gravity = (float)1.0;</span>
<span class="pc" id="L116">    private boolean emi = false;</span>
<span class="pc" id="L117">    private boolean terrainAffected = true;</span>
<span class="pc" id="L118">    private int maxWindStrength = PlanetaryConditions.WI_TORNADO_F4;</span>
<span class="pc" id="L119">    private int minWindStrength = PlanetaryConditions.WI_NONE;</span>

    /**
     * Constructor
     */
<span class="fc" id="L124">    public PlanetaryConditions() {</span>

<span class="fc" id="L126">    }</span>

    /** Creates new PlanetaryConditions that is a duplicate of another */
<span class="nc" id="L129">    public PlanetaryConditions(PlanetaryConditions other) {</span>
<span class="nc" id="L130">        lightConditions = other.lightConditions;</span>
<span class="nc" id="L131">        weatherConditions = other.weatherConditions;</span>
<span class="nc" id="L132">        windStrength = other.windStrength;</span>
<span class="nc" id="L133">        windDirection = other.windDirection;</span>
<span class="nc" id="L134">        shiftWindDirection = other.shiftWindDirection;</span>
<span class="nc" id="L135">        shiftWindStrength = other.shiftWindStrength;</span>
<span class="nc" id="L136">        minWindStrength = other.minWindStrength;</span>
<span class="nc" id="L137">        maxWindStrength = other.maxWindStrength;</span>
<span class="nc" id="L138">        atmosphere = other.atmosphere;</span>
<span class="nc" id="L139">        temperature = other.temperature;</span>
<span class="nc" id="L140">        gravity = other.gravity;</span>
<span class="nc" id="L141">        emi = other.emi;</span>
<span class="nc" id="L142">        fog = other.fog;</span>
<span class="nc" id="L143">        terrainAffected = other.terrainAffected;</span>
<span class="nc" id="L144">        blowingSand = other.blowingSand;</span>
<span class="nc" id="L145">        runOnce = other.runOnce;</span>
<span class="nc" id="L146">    }</span>

    /** clone! */
    @Override
    public Object clone() {
<span class="nc" id="L151">        return new PlanetaryConditions(this);</span>
    }

    public static String getLightDisplayableName(int type) {
<span class="nc bnc" id="L155" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; L_SIZE)) {</span>
<span class="nc" id="L156">            return Messages.getString(&quot;PlanetaryConditions.&quot; + lightNames[type]);</span>
        }
<span class="nc" id="L158">        throw new IllegalArgumentException(&quot;Unknown light condition&quot;);</span>
    }

    public static String getWeatherDisplayableName(int type) {
<span class="nc bnc" id="L162" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; WE_SIZE)) {</span>
<span class="nc" id="L163">            return Messages.getString(&quot;PlanetaryConditions.&quot; + weatherNames[type]);</span>
        }
<span class="nc" id="L165">        throw new IllegalArgumentException(&quot;Unknown weather condition&quot;);</span>
    }

    public static String getTemperatureDisplayableName(int temp) {
<span class="fc bfc" id="L169" title="All 4 branches covered.">        if (isExtremeTemperature(temp) &amp;&amp; (temp &gt; 0)) {</span>
<span class="fc" id="L170">            return String.format(&quot;%d (%s)&quot;, temp, Messages.getString(&quot;PlanetaryConditions.ExtremeHeat&quot;));</span>
<span class="pc bpc" id="L171" title="1 of 4 branches missed.">        } else if (isExtremeTemperature(temp) &amp;&amp; (temp &lt;= 0)) {</span>
<span class="fc" id="L172">            return String.format(&quot;%d (%s)&quot;, temp,  Messages.getString(&quot;PlanetaryConditions.ExtremeCold&quot;));</span>
        } else {
<span class="fc" id="L174">            return String.valueOf(temp);</span>
        }
    }

    public static String getWindDirDisplayableName(int type) {
<span class="nc bnc" id="L179" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; DIR_SIZE)) {</span>
<span class="nc" id="L180">            return Messages.getString(&quot;PlanetaryConditions.&quot; + dirNames[type]);</span>
        }
<span class="nc" id="L182">        throw new IllegalArgumentException(&quot;Unknown wind direction&quot;);</span>
    }

    public static String getWindDisplayableName(int type) {
<span class="nc bnc" id="L186" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; WI_SIZE)) {</span>
<span class="nc" id="L187">            return Messages.getString(&quot;PlanetaryConditions.&quot; + windNames[type]);</span>
        }
<span class="nc" id="L189">        throw new IllegalArgumentException(&quot;Unknown wind condition&quot;);</span>
    }

    public static String getAtmosphereDisplayableName(int type) {
<span class="nc bnc" id="L193" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; ATMO_SIZE)) {</span>
<span class="nc" id="L194">            return Messages.getString(&quot;PlanetaryConditions.&quot; + atmoNames[type]);</span>
        }
<span class="nc" id="L196">        throw new IllegalArgumentException(&quot;Unknown atmospheric pressure condition&quot;);</span>
    }

    public static String getFogDisplayableName(int type) {
<span class="nc bnc" id="L200" title="All 4 branches missed.">        if ((type &gt;= 0) &amp;&amp; (type &lt; FOG_SIZE)) {</span>
<span class="nc" id="L201">            return Messages.getString(&quot;PlanetaryConditions.&quot; + fogNames[type]);</span>
        }
<span class="nc" id="L203">        throw new IllegalArgumentException(&quot;Unknown fog condition&quot;);</span>
    }

    public String getWindDirDisplayableName() {
<span class="nc" id="L207">        return getWindDirDisplayableName(windDirection);</span>
    }

    public String getLightDisplayableName() {
<span class="nc" id="L211">        return getLightDisplayableName(lightConditions);</span>
    }

    public String getWeatherDisplayableName() {
<span class="nc" id="L215">        return getWeatherDisplayableName(weatherConditions);</span>
    }

    public String getWindDisplayableName() {
<span class="nc" id="L219">        return getWindDisplayableName(windStrength);</span>
    }

    public String getAtmosphereDisplayableName() {
<span class="nc" id="L223">        return getAtmosphereDisplayableName(atmosphere);</span>
    }

    public String getFogDisplayableName() {
<span class="nc" id="L227">        return getFogDisplayableName(fog);</span>
    }

    /**
     * to-hit penalty for light
     */
    public int getLightHitPenalty(boolean isWeapon) {
<span class="nc" id="L234">        int penalty = 0;</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">        if(isWeapon) {</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if(lightConditions == L_DUSK) {</span>
<span class="nc" id="L237">                penalty = 1;</span>
            }
<span class="nc bnc" id="L239" title="All 2 branches missed.">            else if(lightConditions == L_FULL_MOON) {</span>
<span class="nc" id="L240">                penalty = 2;</span>
            }
<span class="nc bnc" id="L242" title="All 2 branches missed.">            else if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L243">                penalty = 3;</span>
            }
<span class="nc bnc" id="L245" title="All 2 branches missed.">            else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L246">                penalty = 4;</span>
            }
        }
        else {
<span class="nc bnc" id="L250" title="All 2 branches missed.">            if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L251">                penalty = 1;</span>
            }
<span class="nc bnc" id="L253" title="All 2 branches missed.">            else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L254">                penalty = 2;</span>
            }
        }

<span class="nc" id="L258">        return penalty;</span>
    }

    /**
     * heat bonus to hit for being overheated in darkness
     */
    public int getLightHeatBonus(int heat) {
<span class="nc" id="L265">        double divisor = 10000.0;</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if(lightConditions == L_DUSK) {</span>
<span class="nc" id="L267">            divisor = 25.0;</span>
        }
<span class="nc bnc" id="L269" title="All 2 branches missed.">        else if(lightConditions == L_FULL_MOON) {</span>
<span class="nc" id="L270">            divisor = 20.0;</span>
        }
<span class="nc bnc" id="L272" title="All 2 branches missed.">        else if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L273">            divisor = 15.0;</span>
        }
<span class="nc bnc" id="L275" title="All 2 branches missed.">        else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L276">            divisor = 10.0;</span>
        }
<span class="nc" id="L278">        return (-1 * (int)Math.floor(heat / divisor));</span>
    }

    /**
     * piloting penalty for running/flanking/etc for light
     */
    public int getLightPilotPenalty() {
<span class="nc bnc" id="L285" title="All 2 branches missed.">        if(lightConditions == L_MOONLESS) {</span>
<span class="nc" id="L286">            return 1;</span>
        }
<span class="nc bnc" id="L288" title="All 2 branches missed.">        else if(lightConditions == L_PITCH_BLACK) {</span>
<span class="nc" id="L289">            return 2;</span>
        }
<span class="nc" id="L291">        return 0;</span>
    }

    /**
     * to-hit penalty for weather
     */
    public int getWeatherHitPenalty(Entity en) {
<span class="nc bnc" id="L298" title="All 4 branches missed.">        if (((weatherConditions == WE_LIGHT_RAIN) || (weatherConditions == WE_LIGHT_SNOW))</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">                &amp;&amp; en.isConventionalInfantry()) {</span>
<span class="nc" id="L300">            return 1;</span>
        }
<span class="nc bnc" id="L302" title="All 16 branches missed.">        else if((weatherConditions == WE_MOD_RAIN) || (weatherConditions == WE_HEAVY_RAIN)</span>
                || (weatherConditions == WE_MOD_SNOW) || (weatherConditions == WE_HEAVY_SNOW)
                || (weatherConditions == WE_SLEET) || (weatherConditions == WE_GUSTING_RAIN)
                || (weatherConditions == WE_SNOW_FLURRIES) || (weatherConditions == WE_BLIZZARD)) {
<span class="nc" id="L306">            return 1;</span>
        }
<span class="nc bnc" id="L308" title="All 2 branches missed.">        else if(weatherConditions == WE_DOWNPOUR) {</span>
<span class="nc" id="L309">            return 2;</span>
        }
        else  {
<span class="nc" id="L312">            return 0;</span>
        }
    }

    /**
     * piloting penalty for weather
     */
    public int getWeatherPilotPenalty() {
<span class="nc bnc" id="L320" title="All 8 branches missed.">        if((weatherConditions == WE_HEAVY_RAIN) || (weatherConditions == WE_HEAVY_SNOW)</span>
                || (weatherConditions == WE_GUSTING_RAIN) || (weatherConditions == WE_BLIZZARD)) {
<span class="nc" id="L322">            return 1;</span>
        }
<span class="nc bnc" id="L324" title="All 2 branches missed.">        else if(weatherConditions == WE_DOWNPOUR) {</span>
<span class="nc" id="L325">            return 2;</span>
        }
        else  {
<span class="nc" id="L328">            return 0;</span>
        }
    }


    /**
     * gravity penalties to PSRs
     * According to email from TPTB, you apply a penalty for every 0.5 gravities above or below 1 (rounding up)
     */
    public int getGravityPilotPenalty() {
<span class="nc" id="L338">        return (int)Math.floor(Math.abs(gravity - 1.0) / 0.5);</span>
    }

    /**
     * piloting penalty for wind
     */
    public int getWindPilotPenalty(Entity en) {
<span class="nc" id="L345">        int penalty = 0;</span>

<span class="nc bnc" id="L347" title="All 6 branches missed.">        switch(windStrength) {</span>
        case (WI_MOD_GALE):
<span class="nc bnc" id="L349" title="All 4 branches missed.">            if((en instanceof VTOL) || (en.getMovementMode() == EntityMovementMode.WIGE)) {</span>
<span class="nc" id="L350">                penalty = 1;</span>
            }
            break;
        case (WI_STRONG_GALE):
<span class="nc bnc" id="L354" title="All 4 branches missed.">            if((en instanceof VTOL) || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.HOVER)) {</span>
<span class="nc" id="L356">                penalty = 2;</span>
            }
<span class="nc bnc" id="L358" title="All 4 branches missed.">            else if((en instanceof Mech) || (en.isAirborne())) {</span>
<span class="nc" id="L359">                penalty = 1;</span>
            }
            break;
        case (WI_STORM):
<span class="nc bnc" id="L363" title="All 6 branches missed.">            if((en instanceof VTOL) || (en instanceof Mech) || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L364" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.HOVER)) {</span>
<span class="nc" id="L365">                penalty = 3;</span>
            }
<span class="nc bnc" id="L367" title="All 2 branches missed.">            else if(en.isAirborne()) {</span>
<span class="nc" id="L368">                penalty = 2;</span>
            }
            break;
        case (WI_TORNADO_F13):
<span class="nc" id="L372">            penalty = 3;</span>
<span class="nc" id="L373">            break;</span>
        case (WI_TORNADO_F4):
<span class="nc" id="L375">            penalty = 5;</span>
<span class="nc" id="L376">            break;</span>
        default:
<span class="nc" id="L378">            penalty = 0;</span>
        }
<span class="nc" id="L380">        return penalty;</span>
    }

    public void determineWind() {
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if (windDirection == DIR_RANDOM) {</span>
            // Initial wind direction. If using level 2 rules, this
            // will be the wind direction for the whole battle.
<span class="nc" id="L387">            windDirection = Compute.d6(1) - 1;</span>
<span class="nc bnc" id="L388" title="All 2 branches missed.">        } else if (shiftWindDirection) {</span>
            // Wind direction changes on a roll of 1 or 6
<span class="nc bnc" id="L390" title="All 3 branches missed.">            switch (Compute.d6()) {</span>
                case 1: // rotate clockwise
<span class="nc" id="L392">                    windDirection = (windDirection + 1) % 6;</span>
<span class="nc" id="L393">                    break;</span>
                case 6: // rotate counter-clockwise
<span class="nc" id="L395">                    windDirection = (windDirection + 5) % 6;</span>
            }
        }
<span class="nc bnc" id="L398" title="All 2 branches missed.">        if (shiftWindStrength) {</span>
            // Wind strength changes on a roll of 1 or 6
<span class="nc bnc" id="L400" title="All 3 branches missed.">            switch (Compute.d6()) {</span>
            case 1: // weaker
<span class="nc" id="L402">                windStrength = Math.max(minWindStrength, --windStrength);</span>
<span class="nc" id="L403">                doSleetCheck();</span>
<span class="nc" id="L404">                doSandStormCheck();</span>
<span class="nc" id="L405">                break;</span>
            case 6: // stronger
<span class="nc" id="L407">                windStrength = Math.min(maxWindStrength, ++windStrength);</span>
<span class="nc" id="L408">                doSleetCheck();</span>
<span class="nc" id="L409">                doSandStormCheck();</span>
                break;
            }
        }

        //atmospheric pressure may limit wind strength
<span class="nc bnc" id="L415" title="All 4 branches missed.">        if((atmosphere == ATMO_TRACE) &amp;&amp; (windStrength &gt; WI_STORM)) {</span>
<span class="nc" id="L416">            windStrength = WI_STORM;</span>
        }

<span class="nc bnc" id="L419" title="All 4 branches missed.">        if((atmosphere ==ATMO_THIN) &amp;&amp; (windStrength &gt; WI_TORNADO_F13)) {</span>
<span class="nc" id="L420">            windStrength = WI_TORNADO_F13;</span>
        }
<span class="nc" id="L422">    }</span>

    /**
     * modifiers for fire ignition
     */
    public int getIgniteModifiers() {
<span class="nc" id="L428">        int mod = 0;</span>

<span class="nc bnc" id="L430" title="All 4 branches missed.">        if((weatherConditions == WE_LIGHT_RAIN) || (weatherConditions == WE_MOD_RAIN)) {</span>
<span class="nc" id="L431">            mod += 1;</span>
        }
<span class="nc bnc" id="L433" title="All 12 branches missed.">        if((weatherConditions == WE_HEAVY_RAIN) || (weatherConditions == WE_DOWNPOUR)</span>
                || (weatherConditions == WE_LIGHT_SNOW) || (weatherConditions == WE_MOD_SNOW)
                || (weatherConditions == WE_GUSTING_RAIN) || (weatherConditions == WE_SNOW_FLURRIES)) {
<span class="nc" id="L436">            mod += 2;</span>
        }
<span class="nc bnc" id="L438" title="All 8 branches missed.">        if((weatherConditions == WE_HEAVY_SNOW) || (weatherConditions == WE_BLIZZARD)</span>
                || (weatherConditions == WE_LIGHT_HAIL) || (weatherConditions == WE_HEAVY_HAIL)) {
<span class="nc" id="L440">            mod += 3;</span>
        }
<span class="nc bnc" id="L442" title="All 4 branches missed.">        if((windStrength == WI_LIGHT_GALE) || (windStrength == WI_MOD_GALE)) {</span>
<span class="nc" id="L443">            mod += 2;</span>
        }
<span class="nc bnc" id="L445" title="All 6 branches missed.">        if((windStrength == WI_STRONG_GALE) || (windStrength == WI_STORM) || (weatherConditions == WE_ICE_STORM)) {</span>
<span class="nc" id="L446">            mod += 4;</span>
        }
<span class="nc bnc" id="L448" title="All 2 branches missed.">        if (getTemperature() &gt; 30) {</span>
<span class="nc" id="L449">            mod -= getTemperatureDifference(30,-30);</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">        } else if (getTemperature() &lt; 30) {</span>
<span class="nc" id="L451">            mod += getTemperatureDifference(30, -30);</span>
        }

<span class="nc" id="L454">        return mod;</span>
    }

    /**
     * Do a roll for these weather conditions putting out fire
     * return boolean
     */
    public boolean putOutFire() {
<span class="nc" id="L462">        int roll = Compute.d6(2);</span>
<span class="nc bnc" id="L463" title="All 5 branches missed.">        switch(weatherConditions) {</span>
        case (WE_LIGHT_HAIL):
        case (WE_LIGHT_RAIN):
        case (WE_LIGHT_SNOW):
<span class="nc" id="L467">            roll = roll + 1;</span>
<span class="nc" id="L468">            break;</span>
        case (WE_HEAVY_HAIL):
        case (WE_MOD_RAIN):
        case (WE_MOD_SNOW):
        case WE_SNOW_FLURRIES:
<span class="nc" id="L473">            roll = roll + 2;</span>
<span class="nc" id="L474">            break;</span>
        case (WE_HEAVY_RAIN):
        case (WE_GUSTING_RAIN):
        case (WE_HEAVY_SNOW):
        case WE_BLIZZARD:
<span class="nc" id="L479">            roll = roll + 3;</span>
<span class="nc" id="L480">            break;</span>
        case (WE_DOWNPOUR):
<span class="nc" id="L482">            roll = roll + 4;</span>
<span class="nc" id="L483">            break;</span>
        default:
<span class="nc" id="L485">            roll = -1;</span>
        }

<span class="nc bnc" id="L488" title="All 2 branches missed.">        if(roll &gt; 10) {</span>
<span class="nc" id="L489">            return true;</span>
        }

<span class="nc" id="L492">          return false;</span>
    }

    /**
     * Returns how much higher or lower than a given range, divided by
     * ten, rounded up, the temperature is
     */

    public int getTemperatureDifference(int high, int low) {
<span class="nc" id="L501">        int i = 0;</span>
        //if the low is more than the high, reverse
<span class="nc bnc" id="L503" title="All 2 branches missed.">        if(low &gt; high) {</span>
<span class="nc" id="L504">            int tempLow = low;</span>
<span class="nc" id="L505">            low = high;</span>
<span class="nc" id="L506">            high = tempLow;</span>

        }
<span class="nc bnc" id="L509" title="All 2 branches missed.">        if ((getTemperature() &gt;= low)</span>
<span class="nc bnc" id="L510" title="All 2 branches missed.">                &amp;&amp; (getTemperature() &lt;= high)) {</span>
<span class="nc" id="L511">            return i;</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">        } else if (getTemperature() &lt; low) {</span>
            do {
<span class="nc" id="L514">                i++;</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">            } while ((getTemperature() + (i * 10)) &lt; low);</span>
<span class="nc" id="L516">            return i;</span>
        } else {
            do {
<span class="nc" id="L519">                i++;</span>
<span class="nc bnc" id="L520" title="All 2 branches missed.">            } while ((getTemperature() - (i * 10)) &gt; high);</span>
        }
<span class="nc" id="L522">        return i;</span>
    }

    /**
     *
     * @return a &lt;code&gt;String&lt;/code&gt; with the reason why you cannot start a fire here
     */
    public String cannotStartFire() {
<span class="nc bnc" id="L530" title="All 2 branches missed.">        if(atmosphere &lt; ATMO_THIN) {</span>
<span class="nc" id="L531">            return &quot;atmosphere this thin&quot;;</span>
        }
<span class="nc bnc" id="L533" title="All 2 branches missed.">        if(windStrength &gt; WI_STORM) {</span>
<span class="nc" id="L534">            return &quot;a tornado&quot;;</span>
        }

<span class="nc" id="L537">        return null;</span>
    }

    /**
     * Planetary conditions on movement, except for gravity
     * @param en - the entity in question
     * @return an &lt;code&gt;int&lt;/code&gt; with the modifier to movement
     */
    public int getMovementMods(Entity en) {
<span class="nc" id="L546">        int mod = 0;</span>

        // weather mods are calculated based on conditional effects ie extreme temperatures, wind

        // wind mods
<span class="nc bnc" id="L551" title="All 5 branches missed.">        switch(windStrength) {</span>
        case(WI_LIGHT_GALE):
<span class="nc bnc" id="L553" title="All 2 branches missed.">            if(!(en instanceof BattleArmor)</span>
<span class="nc bnc" id="L554" title="All 2 branches missed.">                    &amp;&amp; ((en.getMovementMode() == EntityMovementMode.INF_LEG)</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">                            || (en.getMovementMode() == EntityMovementMode.INF_JUMP))) {</span>
<span class="nc" id="L556">                mod -= 1;</span>
            }
            break;
        case (WI_MOD_GALE):
<span class="nc bnc" id="L560" title="All 2 branches missed.">            if (en.isConventionalInfantry()) {</span>
<span class="nc" id="L561">                mod -= 1;</span>
            }
            break;
        case (WI_STRONG_GALE):
        case (WI_STORM):
<span class="nc bnc" id="L566" title="All 2 branches missed.">            if(en instanceof BattleArmor) {</span>
<span class="nc" id="L567">                mod -= 1;</span>
            }
<span class="nc bnc" id="L569" title="All 2 branches missed.">            else if(en instanceof Infantry) {</span>
<span class="nc" id="L570">                mod -= 2;</span>
            }
            break;
        case (WI_TORNADO_F13):
<span class="nc bnc" id="L574" title="All 2 branches missed.">            if(en.isAirborne()) {</span>
<span class="nc" id="L575">                mod -= 1;</span>
            }
            else {
<span class="nc" id="L578">                mod -= 2;</span>
            }
            break;
        }

        // atmospheric pressure mods
<span class="nc bnc" id="L584" title="All 3 branches missed.">        switch(atmosphere) {</span>
        case(ATMO_THIN):
<span class="nc bnc" id="L586" title="All 2 branches missed.">            if((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.VTOL)) {</span>
<span class="nc" id="L589">                mod -= 2;</span>
            }
            break;
        case(ATMO_HIGH):
        case(ATMO_VHIGH):
<span class="nc bnc" id="L594" title="All 2 branches missed.">            if((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="nc bnc" id="L595" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">                    || (en.getMovementMode() == EntityMovementMode.VTOL)) {</span>
<span class="nc" id="L597">                mod += 1;</span>
            }
            break;
        }

        // temperature difference
<span class="nc bnc" id="L603" title="All 8 branches missed.">        if((en instanceof Tank) || ((en instanceof Infantry) &amp;&amp; !((Infantry)en).isXCT()) || (en instanceof Protomech)) {</span>
<span class="nc" id="L604">            mod -= Math.abs(getTemperatureDifference(50,-30));</span>
        }

<span class="nc" id="L607">        return mod;</span>
    }

    /**
     * is the given entity type doomed in these conditions?
     * @return a string given the reason for being doomed, null if not doomed
     */
    public String whyDoomed(Entity en, IGame game) {
<span class="fc bfc" id="L615" title="All 4 branches covered.">        if ((atmosphere &lt; ATMO_THIN) &amp;&amp; en.doomedInVacuum()) {</span>
<span class="fc" id="L616">            return &quot;vacuum&quot;;</span>
        }
<span class="fc bfc" id="L618" title="All 4 branches covered.">        if ((windStrength == WI_TORNADO_F4) &amp;&amp; !(en instanceof Mech)) {</span>
<span class="fc" id="L619">            return &quot;tornado&quot;;</span>
        }
<span class="fc bfc" id="L621" title="All 4 branches covered.">        if ((windStrength == WI_TORNADO_F13) &amp;&amp; (en.isConventionalInfantry()</span>
<span class="fc bfc" id="L622" title="All 2 branches covered.">            || ((en.getMovementMode() == EntityMovementMode.HOVER)</span>
<span class="fc bfc" id="L623" title="All 2 branches covered.">            || (en.getMovementMode() == EntityMovementMode.WIGE)</span>
<span class="fc bfc" id="L624" title="All 2 branches covered.">            || (en.getMovementMode() == EntityMovementMode.VTOL)))) {</span>
<span class="fc" id="L625">            return &quot;tornado&quot;;</span>
        }
<span class="fc bfc" id="L627" title="All 4 branches covered.">        if((windStrength == WI_STORM) &amp;&amp; en.isConventionalInfantry()) {</span>
<span class="fc" id="L628">            return &quot;storm&quot;;</span>
        }
<span class="pc bpc" id="L630" title="1 of 6 branches missed.">        if (isExtremeTemperature() &amp;&amp; en.doomedInExtremeTemp() &amp;&amp; !Compute.isInBuilding(game, en)) {</span>
<span class="fc" id="L631">            return &quot;extreme temperature&quot;;</span>
        }
<span class="fc" id="L633">        return null;</span>
    }

    /**
     * visual range based on conditions
     *
     */
    public int getVisualRange(Entity en, boolean targetIlluminated) {

<span class="nc" id="L642">        boolean Spotlight = false;</span>

<span class="nc" id="L644">        boolean isMechVee = false;</span>
<span class="nc" id="L645">        boolean isLargeCraft = false;</span>
<span class="nc" id="L646">        boolean isAero = false;</span>

        //Needed for MekWars for Maximum Visual Range.
<span class="nc bnc" id="L649" title="All 2 branches missed.">        if ( en == null ) {</span>
<span class="nc" id="L650">            isMechVee = true;</span>
<span class="nc" id="L651">            Spotlight = targetIlluminated;</span>
        }else {
<span class="nc" id="L653">            Spotlight = en.isUsingSpotlight();</span>
<span class="nc bnc" id="L654" title="All 6 branches missed.">            isMechVee = (en instanceof Mech &amp;&amp; !en.isAero()) || (en instanceof Tank);</span>
<span class="nc bnc" id="L655" title="All 4 branches missed.">            isLargeCraft = (en instanceof Dropship) || (en instanceof Jumpship);</span>
<span class="nc bnc" id="L656" title="All 4 branches missed.">            isAero = (en.isAero()) &amp;&amp; !isLargeCraft;</span>
        }
        //anything else is infantry
        
        //Beyond altitude 9, Aeros can't see. No need to repeat this test.
<span class="nc bnc" id="L661" title="All 4 branches missed.">        if (isAero &amp;&amp; (en.getAltitude() &gt; 9)) {</span>
<span class="nc" id="L662">            return 0;</span>
        }
        
        //New rulings per v3.02 errata. Spotlights are easier, yay!
        //Illuminated?  Flat 45 hex distance
<span class="nc bnc" id="L667" title="All 4 branches missed.">        if (targetIlluminated &amp;&amp; (lightConditions &gt; L_DAY)) {</span>
<span class="nc" id="L668">            return 45;</span>
<span class="nc bnc" id="L669" title="All 4 branches missed.">        } else if (Spotlight &amp;&amp; (lightConditions &gt; L_DAY)) {</span>
            //Using a searchlight?  Flat 30 hex range
<span class="nc bnc" id="L671" title="All 6 branches missed.">            if (isMechVee || isAero || isLargeCraft) {</span>
<span class="nc" id="L672">                return 30;</span>
            }
            //Except infantry/handheld, 10 hexes
<span class="nc" id="L675">            return 10;</span>
<span class="nc bnc" id="L676" title="All 2 branches missed.">        } else if (lightConditions == L_PITCH_BLACK) {</span>
<span class="nc bnc" id="L677" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L678">                return 3;</span>
            }
<span class="nc bnc" id="L680" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L681">                return 5;</span>
            }
<span class="nc bnc" id="L683" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L684">                return 4;</span>
            }
<span class="nc" id="L686">            return 1;</span>
<span class="nc bnc" id="L687" title="All 4 branches missed.">        } else if ((lightConditions == L_MOONLESS)</span>
                || (fog == FOG_HEAVY)) {
<span class="nc bnc" id="L689" title="All 6 branches missed.">            if(isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L690">                return 5;</span>
            }
<span class="nc bnc" id="L692" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L693">                return 10;</span>
            }
<span class="nc bnc" id="L695" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L696">                return 8;</span>
            }
<span class="nc" id="L698">            return 2;</span>
<span class="nc bnc" id="L699" title="All 20 branches missed.">        } else if ((weatherConditions == WE_HEAVY_HAIL)</span>
                || (weatherConditions == WE_SLEET)
                || (weatherConditions == WE_HEAVY_SNOW)
                || (blowingSand &amp;&amp; (windStrength &gt;= WI_MOD_GALE))
                || (lightConditions == L_FULL_MOON)
                || (weatherConditions == WE_GUSTING_RAIN)
                || (weatherConditions == WE_BLIZZARD)
                || (weatherConditions == WE_ICE_STORM)
                || (weatherConditions == WE_DOWNPOUR)) {
<span class="nc bnc" id="L708" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L709">                return 10;</span>
            }
<span class="nc bnc" id="L711" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L712">                return 20;</span>
            }
<span class="nc bnc" id="L714" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L715">                return 15;</span>
            }
<span class="nc" id="L717">            return 5;</span>
<span class="nc bnc" id="L718" title="All 10 branches missed.">        } else if ((lightConditions == L_DUSK)</span>
                || (weatherConditions == WE_HEAVY_RAIN)
                || (weatherConditions == WE_SNOW_FLURRIES)
                || (weatherConditions == WE_MOD_SNOW) &amp;&amp; (windStrength &gt;= WI_MOD_GALE)) {
<span class="nc bnc" id="L722" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L723">                return 15;</span>
            }
<span class="nc bnc" id="L725" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L726">                return 30;</span>
            }
<span class="nc bnc" id="L728" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L729">                return 20;</span>
            }
<span class="nc" id="L731">            return 8;</span>
<span class="nc bnc" id="L732" title="All 4 branches missed.">        } else if ((weatherConditions == WE_MOD_SNOW)</span>
                || (weatherConditions == WE_MOD_RAIN)) {
<span class="nc bnc" id="L734" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L735">                return 20;</span>
            }
<span class="nc bnc" id="L737" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L738">                return 50;</span>
            }
<span class="nc bnc" id="L740" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L741">                return 25;</span>
            }
<span class="nc" id="L743">            return 10;</span>
<span class="nc bnc" id="L744" title="All 10 branches missed.">        } else if ((lightConditions &gt; L_DAY)</span>
                || (weatherConditions == WE_LIGHT_SNOW)
                || (weatherConditions == WE_LIGHT_RAIN)
                || (weatherConditions == WE_LIGHT_HAIL) 
                || (fog == FOG_LIGHT)) {
<span class="nc bnc" id="L749" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L750">                return 30;</span>
            }
<span class="nc bnc" id="L752" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L753">                return 60;</span>
            }
<span class="nc bnc" id="L755" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L756">                return 35;</span>
            }
<span class="nc" id="L758">            return 15;</span>
        } else {
<span class="nc bnc" id="L760" title="All 6 branches missed.">            if (isMechVee || (isAero &amp;&amp; (en.getAltitude() &lt; 2))) {</span>
<span class="nc" id="L761">                return 60;</span>
            }
<span class="nc bnc" id="L763" title="All 2 branches missed.">            if (isAero) {</span>
<span class="nc" id="L764">                return 120;</span>
            }
<span class="nc bnc" id="L766" title="All 2 branches missed.">            if (isLargeCraft) {</span>
<span class="nc" id="L767">                return 70;</span>
            }
<span class="nc" id="L769">            return 30;</span>
        }
    }

    public int getDropRate() {

        //atmospheric pressure mods
<span class="nc bnc" id="L776" title="All 5 branches missed.">        switch(atmosphere) {</span>
        case(ATMO_TRACE):
<span class="nc" id="L778">            return 8;</span>
        case(ATMO_THIN):
<span class="nc" id="L780">            return 5;</span>
        case(ATMO_HIGH):
<span class="nc" id="L782">            return 2;</span>
        case(ATMO_VHIGH):
<span class="nc" id="L784">            return 1;</span>
        default:
<span class="nc" id="L786">            return 3;</span>
        }
    }

    public void setLight(int type) {
<span class="nc" id="L791">        lightConditions = type;</span>
<span class="nc" id="L792">    }</span>


    /** @return The time of day lighting conditions (one of PlanetaryConditions.L_*). */
    public int getLight() {
<span class="nc" id="L797">        return lightConditions;</span>
    }

    public void setWeather(int type) {
<span class="nc" id="L801">        weatherConditions = type;</span>
<span class="nc" id="L802">    }</span>

    public int getWeather() {
<span class="nc" id="L805">        return weatherConditions;</span>
    }

    public void setWindStrength(int type) {
<span class="fc" id="L809">        windStrength = type;</span>
<span class="fc" id="L810">    }</span>

    public int getWindStrength() {
<span class="nc" id="L813">        return windStrength;</span>
    }

    public void setWindDirection(int type) {
<span class="nc" id="L817">        windDirection = type;</span>
<span class="nc" id="L818">    }</span>

    public int getWindDirection() {
<span class="nc" id="L821">        return windDirection;</span>
    }

    public void setShiftingWindDirection(boolean b) {
<span class="nc" id="L825">        shiftWindDirection = b;</span>
<span class="nc" id="L826">    }</span>

    public boolean shiftingWindDirection() {
<span class="nc" id="L829">        return shiftWindDirection;</span>
    }

    public void setShiftingWindStrength(boolean b) {
<span class="nc" id="L833">        shiftWindStrength = b;</span>
<span class="nc" id="L834">    }</span>

    public boolean shiftingWindStrength() {
<span class="nc" id="L837">        return shiftWindStrength;</span>
    }

    public void setAtmosphere(int a) {
<span class="fc" id="L841">        atmosphere = a;</span>
<span class="fc" id="L842">    }</span>

    public int getAtmosphere() {
<span class="nc" id="L845">        return atmosphere;</span>
    }

    public void setTemperature(int tem) {
<span class="fc" id="L849">        temperature = tem;</span>
<span class="fc" id="L850">    }</span>

    public int getTemperature() {
<span class="nc" id="L853">        return temperature;</span>
    }

    public boolean isVacuum() {
<span class="nc bnc" id="L857" title="All 4 branches missed.">        return (atmosphere == ATMO_VACUUM) || (atmosphere == ATMO_TRACE);</span>
    }

    public static boolean isExtremeTemperature(int temperature) {
<span class="fc bfc" id="L861" title="All 4 branches covered.">        return (temperature &gt; 50) || (temperature &lt; -30);</span>
    }

    public boolean isExtremeTemperature() {
<span class="fc" id="L865">        return isExtremeTemperature(temperature);</span>
    }

    public void setGravity(float f) {
<span class="nc" id="L869">        gravity = f;</span>
<span class="nc" id="L870">    }</span>

    public float getGravity() {
<span class="nc" id="L873">        return gravity;</span>
    }

    public void setEMI(boolean b) {
<span class="nc" id="L877">        emi = b;</span>
<span class="nc" id="L878">    }</span>

    public boolean hasEMI() {
<span class="nc" id="L881">        return emi;</span>
    }

    public int getFog() {
<span class="nc" id="L885">        return fog;</span>
    }

    public void setFog(int fog) {
<span class="nc" id="L889">        this.fog = fog;</span>
<span class="nc" id="L890">    }</span>

    public void setTerrainAffected(boolean b) {
<span class="nc" id="L893">        terrainAffected = b;</span>
<span class="nc" id="L894">    }</span>

    //can weather alter the terrain (add snow, mud, etc.)
    public boolean isTerrainAffected() {
<span class="nc" id="L898">        return terrainAffected;</span>
    }

    public boolean isRecklessConditions() {
<span class="nc bnc" id="L902" title="All 4 branches missed.">        return (fog &gt; FOG_NONE) || (lightConditions &gt; L_DUSK);</span>
    }

    public int getMaxWindStrength(){
<span class="nc" id="L906">        return maxWindStrength;</span>
    }

    public void setMaxWindStrength(int strength){
<span class="nc" id="L910">        maxWindStrength = strength;</span>
<span class="nc" id="L911">    }</span>

    public int getMinWindStrength(){
<span class="nc" id="L914">        return minWindStrength;</span>
    }

    public void setMinWindStrength(int strength){
<span class="nc" id="L918">        minWindStrength = strength;</span>
<span class="nc" id="L919">    }</span>

    public boolean isSandBlowing() {
<span class="nc" id="L922">        return blowingSand;</span>
    }

    public void setBlowingSand(boolean b) {
<span class="nc" id="L926">        blowingSand = b;</span>
<span class="nc" id="L927">    }</span>

    public void alterConditions(PlanetaryConditions conditions) {
<span class="nc" id="L930">        lightConditions = conditions.lightConditions;</span>
<span class="nc" id="L931">        weatherConditions = conditions.weatherConditions;</span>
<span class="nc" id="L932">        windStrength = conditions.windStrength;</span>
<span class="nc" id="L933">        windDirection = conditions.windDirection;</span>
<span class="nc" id="L934">        shiftWindDirection = conditions.shiftWindDirection;</span>
<span class="nc" id="L935">        shiftWindStrength = conditions.shiftWindStrength;</span>
<span class="nc" id="L936">        minWindStrength = conditions.minWindStrength;</span>
<span class="nc" id="L937">        maxWindStrength = conditions.maxWindStrength;</span>
<span class="nc" id="L938">        atmosphere = conditions.atmosphere;</span>
<span class="nc" id="L939">        temperature = conditions.temperature;</span>
<span class="nc" id="L940">        gravity = conditions.gravity;</span>
<span class="nc" id="L941">        emi = conditions.emi;</span>
<span class="nc" id="L942">        fog = conditions.fog;</span>
<span class="nc" id="L943">        terrainAffected = conditions.terrainAffected;</span>
<span class="nc" id="L944">        blowingSand = conditions.blowingSand;</span>
<span class="nc" id="L945">        runOnce = conditions.runOnce;</span>

<span class="nc bnc" id="L947" title="All 2 branches missed.">        if (!runOnce) {</span>
<span class="nc" id="L948">            setTempFromWeather();</span>
<span class="nc" id="L949">            setWindFromWeather();</span>
<span class="nc" id="L950">            setSandStorm();</span>
<span class="nc" id="L951">            runOnce = true;</span>
        }

<span class="nc" id="L954">    }</span>

    private void setTempFromWeather() {
<span class="nc bnc" id="L957" title="All 4 branches missed.">        switch (weatherConditions) {</span>
            case WE_SLEET:
            case WE_LIGHT_SNOW:
<span class="nc" id="L960">                temperature = -40;</span>
<span class="nc" id="L961">                break;</span>
            case WE_MOD_SNOW:
            case WE_SNOW_FLURRIES:
            case WE_HEAVY_SNOW:
            case WE_BLIZZARD:
<span class="nc" id="L966">                temperature = -50;</span>
<span class="nc" id="L967">                break;</span>
            case WE_ICE_STORM:
<span class="nc" id="L969">                temperature = -60;</span>
                break;
        }
<span class="nc" id="L972">    }</span>

    private void setWindFromWeather() {
<span class="nc bnc" id="L975" title="All 4 branches missed.">        switch (weatherConditions) {</span>
            case WE_SLEET:
<span class="nc" id="L977">                setSleet(true);</span>
<span class="nc" id="L978">                break;</span>
            case WE_ICE_STORM:
            case WE_SNOW_FLURRIES:
<span class="nc" id="L981">                windStrength = WI_MOD_GALE;</span>
<span class="nc" id="L982">                shiftWindStrength = false;</span>
<span class="nc" id="L983">                break;</span>
            case WE_GUSTING_RAIN:
            case WE_BLIZZARD:
<span class="nc" id="L986">                windStrength = WI_STRONG_GALE;</span>
<span class="nc" id="L987">                shiftWindStrength = false;</span>
                break;
        }
<span class="nc" id="L990">    }</span>

    public boolean isSleeting() {
<span class="nc" id="L993">        return isSleeting;</span>
    }

    public void setSleet(boolean sleet) {
<span class="nc" id="L997">        isSleeting = sleet;</span>
<span class="nc" id="L998">    }</span>

    private void doSleetCheck() {
<span class="nc bnc" id="L1001" title="All 4 branches missed.">        if (isSleeting &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L1002">            setSleet(false);</span>
<span class="nc" id="L1003">            weatherConditions = WE_NONE;</span>
<span class="nc" id="L1004">            oldWeatherConditions = WE_SLEET;</span>
<span class="nc" id="L1005">            oldTemperature = temperature;</span>
<span class="nc" id="L1006">            temperature = 25;</span>
        }
<span class="nc bnc" id="L1008" title="All 4 branches missed.">        if (isSleeting() &amp;&amp; windStrength &gt; WI_MOD_GALE) {</span>
<span class="nc" id="L1009">            shiftWindStrength = false;</span>
<span class="nc" id="L1010">            windStrength = WI_MOD_GALE;</span>
        }
<span class="nc bnc" id="L1012" title="All 4 branches missed.">        if ((oldWeatherConditions == WE_SLEET)</span>
                &amp;&amp; (windStrength == WI_MOD_GALE)
<span class="nc bnc" id="L1014" title="All 2 branches missed.">                &amp;&amp; !isSleeting() ) {</span>
<span class="nc" id="L1015">            setSleet(true);</span>
<span class="nc" id="L1016">            temperature = oldTemperature;</span>
<span class="nc" id="L1017">            oldWeatherConditions = WE_NONE;</span>
<span class="nc" id="L1018">            oldTemperature = 25;</span>
<span class="nc" id="L1019">            weatherConditions = WE_SLEET;</span>
        }
<span class="nc" id="L1021">    }</span>

    private void setSandStorm() {
<span class="nc bnc" id="L1024" title="All 4 branches missed.">        if (blowingSand &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L1025">            windStrength = WI_MOD_GALE;</span>
<span class="nc" id="L1026">            sandStorm = true;</span>
        }
<span class="nc" id="L1028">    }</span>

    private void doSandStormCheck() {
<span class="nc bnc" id="L1031" title="All 4 branches missed.">        if (blowingSand &amp;&amp; windStrength &lt; WI_MOD_GALE) {</span>
<span class="nc" id="L1032">            sandStorm = blowingSand;</span>
<span class="nc" id="L1033">            blowingSand = false;</span>
        }
<span class="nc bnc" id="L1035" title="All 4 branches missed.">        if (sandStorm &amp;&amp; windStrength &gt; WI_LIGHT_GALE) {</span>
<span class="nc" id="L1036">            sandStorm = blowingSand;</span>
<span class="nc" id="L1037">            blowingSand = true;</span>
        }
<span class="nc" id="L1039">    }</span>

    public void setRunOnce(boolean run) {
<span class="nc" id="L1042">        runOnce = run;</span>
<span class="nc" id="L1043">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>