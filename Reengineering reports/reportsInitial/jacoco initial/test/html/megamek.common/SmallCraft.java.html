<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SmallCraft.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.common</a> &gt; <span class="el_source">SmallCraft.java</span></div><h1>SmallCraft.java</h1><pre class="source lang-java linenums">/*
 * MegaAero - Copyright (C) 2007 Jay Lawson This program is free software; you
 * can redistribute it and/or modify it under the terms of the GNU General
 * Public License as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 */
/*
 * Created on Jun 17, 2007
 */
package megamek.common;

import java.util.HashMap;
import java.util.Map;

import megamek.common.options.OptionsConstants;

/**
 * @author Jay Lawson
 */
<span class="nc" id="L25">public class SmallCraft extends Aero {</span>

    private static final long serialVersionUID = 6708788176436555036L;
    
    public static final int LOC_HULL = 4;
    
<span class="fc" id="L31">    private static String[] LOCATION_ABBRS =</span>
        { &quot;NOS&quot;, &quot;LS&quot;, &quot;RS&quot;, &quot;AFT&quot;, &quot;HULL&quot; };
<span class="fc" id="L33">    private static String[] LOCATION_NAMES =</span>
        { &quot;Nose&quot;, &quot;Left Side&quot;, &quot;Right Side&quot;, &quot;Aft&quot;, &quot;Hull&quot; };

    // crew and passengers
<span class="nc" id="L37">    private int nOfficers = 0;</span>
<span class="nc" id="L38">    private int nGunners = 0;</span>
<span class="nc" id="L39">    private int nBattleArmor = 0;</span>
<span class="nc" id="L40">    private int nOtherPassenger = 0;</span>
    
    // Maps transported crew,passengers,marines to a host ship so we can match them up again post-game
<span class="nc" id="L43">    private Map&lt;String,Integer&gt; nOtherCrew = new HashMap&lt;&gt;();</span>
<span class="nc" id="L44">    private Map&lt;String,Integer&gt; passengers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L45">    private Map&lt;Integer,Integer&gt; nOtherMarines = new HashMap&lt;&gt;();</span>
    
    // escape pods and lifeboats
<span class="nc" id="L48">    private int escapePods = 0;</span>
<span class="nc" id="L49">    private int lifeBoats = 0;</span>
<span class="nc" id="L50">    private int escapePodsLaunched = 0;</span>
<span class="nc" id="L51">    private int lifeBoatsLaunched = 0;</span>
    
<span class="fc" id="L53">    private static final TechAdvancement TA_SM_CRAFT = new TechAdvancement(TECH_BASE_ALL)</span>
<span class="fc" id="L54">            .setAdvancement(DATE_NONE, 2350, 2400).setISApproximate(false, true, false)</span>
<span class="fc" id="L55">            .setProductionFactions(F_TH).setTechRating(RATING_D)</span>
<span class="fc" id="L56">            .setAvailability(RATING_D, RATING_E, RATING_D, RATING_D)</span>
<span class="fc" id="L57">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>
<span class="fc" id="L58">    private static final TechAdvancement TA_SM_CRAFT_PRIMITIVE = new TechAdvancement(TECH_BASE_IS)</span>
<span class="fc" id="L59">            .setISAdvancement(DATE_ES, 2200, DATE_NONE, 2400)</span>
<span class="fc" id="L60">            .setISApproximate(false, true, false, false)</span>
<span class="fc" id="L61">            .setProductionFactions(F_TA).setTechRating(RATING_D)</span>
<span class="fc" id="L62">            .setAvailability(RATING_D, RATING_X, RATING_F, RATING_F)</span>
<span class="fc" id="L63">            .setStaticTechLevel(SimpleTechLevel.STANDARD);</span>

    @Override
    public int getUnitType() {
<span class="nc" id="L67">        return UnitType.SMALL_CRAFT;</span>
    }

    @Override
    public TechAdvancement getConstructionTechAdvancement() {
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (isPrimitive()) {</span>
<span class="nc" id="L73">            return TA_SM_CRAFT_PRIMITIVE;</span>
        } else {
<span class="nc" id="L75">            return TA_SM_CRAFT;</span>
        }
    }
    
    /**
     * @return Returns the autoEject setting (always off for large craft)
     */
    @Override
    public boolean isAutoEject() {
<span class="nc" id="L84">        return false;</span>
    }
    
    @Override
    public boolean isPrimitive() {
<span class="nc bnc" id="L89" title="All 2 branches missed.">        return getArmorType(LOC_NOSE) == EquipmentType.T_ARMOR_PRIMITIVE_AERO;</span>
    }
    
    @Override
    public void setNCrew(int crew) {
<span class="nc" id="L94">        nCrew = crew;</span>
<span class="nc" id="L95">    }</span>
    
    public void setNOfficers(int officer) {
<span class="nc" id="L98">        nOfficers = officer;</span>
<span class="nc" id="L99">    }</span>
    
    public void setNGunners(int gunners) {
<span class="nc" id="L102">        nGunners = gunners;</span>
<span class="nc" id="L103">    }</span>
    
    @Override
    public void setNPassenger(int pass) {
<span class="nc" id="L107">        nPassenger = pass;</span>
<span class="nc" id="L108">    }</span>

    public void setNBattleArmor(int ba) {
<span class="nc" id="L111">        nBattleArmor = ba;</span>
<span class="nc" id="L112">    }</span>

    @Override
    public void setNMarines(int marines) {
<span class="nc" id="L116">        nMarines = marines;</span>
<span class="nc" id="L117">    }</span>

    public void setNOtherPassenger(int other) {
<span class="nc" id="L120">        nOtherPassenger = other;</span>
<span class="nc" id="L121">    }</span>

    @Override
    public int getNCrew() {
<span class="nc" id="L125">        return nCrew;</span>
    }

    @Override
    public int getNPassenger() {
<span class="nc" id="L130">        return nPassenger;</span>
    }
    
    @Override
    public int getNOfficers() {
<span class="nc" id="L135">        return nOfficers;</span>
    }
    
    @Override
    public int getNGunners() {
<span class="nc" id="L140">        return nGunners;</span>
    }
    
    @Override
    public int getNBattleArmor() {
<span class="nc" id="L145">        return nBattleArmor;</span>
    }

    @Override
    public int getNMarines() {
<span class="nc" id="L150">        return nMarines;</span>
    }

    public int getNOtherPassenger() {
<span class="nc" id="L154">        return nOtherPassenger;</span>
    }
    
    /**
     * Returns a mapping of how many crewmembers from other units this unit is carrying
     * and what ship they're from by external ID 
     */
    public Map&lt;String,Integer&gt; getNOtherCrew() {
<span class="nc" id="L162">        return nOtherCrew;</span>
    }
    
    /**
     * Convenience method to return all crew from other craft aboard from the above Map
     * @return
     */
    public int getTotalOtherCrew() {
<span class="nc" id="L170">        int toReturn = 0;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        for (String name : getNOtherCrew().keySet()) {</span>
<span class="nc" id="L172">            toReturn += getNOtherCrew().get(name);</span>
<span class="nc" id="L173">        }</span>
<span class="nc" id="L174">        return toReturn;</span>
    }
    
    /**
     * Adds a number of crewmembers from another ship keyed by that ship's external ID
     * @param id The external ID of the ship these crew came from
     * @param n The number to add
     */
    public void addNOtherCrew(String id, int n) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">       if (nOtherCrew.containsKey(id)) {</span>
<span class="nc" id="L184">           nOtherCrew.replace(id, nOtherCrew.get(id) + n);</span>
       } else {
<span class="nc" id="L186">           nOtherCrew.put(id, n);</span>
       }
<span class="nc" id="L188">    }</span>
    
    /**
     * Returns a mapping of how many passengers from other units this unit is carrying
     * and what ship they're from by external ID 
     */
    public Map&lt;String,Integer&gt; getPassengers() {
<span class="nc" id="L195">        return passengers;</span>
    }
    
    /**
     * Convenience method to return all passengers aboard from the above Map
     * @return
     */
    public int getTotalPassengers() {
<span class="nc" id="L203">        int toReturn = 0;</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">        for (String name : getPassengers().keySet()) {</span>
<span class="nc" id="L205">            toReturn += getPassengers().get(name);</span>
<span class="nc" id="L206">        }</span>
<span class="nc" id="L207">        return toReturn;</span>
    }
    
    /**
     * Adds a number of passengers from another ship keyed by that ship's external ID
     * @param id The external ID of the ship these passengers came from
     * @param n The number to add
     */
    public void addPassengers(String id, int n) {
<span class="nc bnc" id="L216" title="All 2 branches missed.">       if (passengers.containsKey(id)) {</span>
<span class="nc" id="L217">           passengers.replace(id, passengers.get(id) + n);</span>
       } else {
<span class="nc" id="L219">           passengers.put(id, n);</span>
       }
<span class="nc" id="L221">    }</span>
    
    public void setEscapePods(int n) {
<span class="nc" id="L224">        escapePods = n;</span>
<span class="nc" id="L225">    }</span>

    @Override
    public int getEscapePods() {
<span class="nc" id="L229">        return escapePods;</span>
    }
    
    /**
     * Returns the total number of escape pods launched so far
     */
    @Override
    public int getLaunchedEscapePods() {
<span class="nc" id="L237">        return escapePodsLaunched;</span>
    }
    
    /**
     * Updates the total number of escape pods launched so far
     * @param n The number to change
     */
    @Override
    public void setLaunchedEscapePods(int n) {
<span class="nc" id="L246">        escapePodsLaunched = n;</span>
<span class="nc" id="L247">    }</span>

    public void setLifeBoats(int n) {
<span class="nc" id="L250">        lifeBoats = n;</span>
<span class="nc" id="L251">    }</span>

    @Override
    public int getLifeBoats() {
<span class="nc" id="L255">        return lifeBoats;</span>
    }
    
    /**
     * Returns the total number of life boats launched so far
     */
    @Override
    public int getLaunchedLifeBoats() {
<span class="nc" id="L263">        return lifeBoatsLaunched;</span>
    }
    
    /**
     * Updates the total number of life boats launched so far
     * @param n The number to change
     */
    @Override
    public void setLaunchedLifeBoats(int n) {
<span class="nc" id="L272">        lifeBoatsLaunched = n;</span>
<span class="nc" id="L273">    }</span>
    
    @Override
    public double getStrategicFuelUse() {
<span class="nc bnc" id="L277" title="All 2 branches missed.">        if (isPrimitive()) {</span>
<span class="nc" id="L278">            return 1.84 * primitiveFuelFactor();</span>
        }
<span class="nc" id="L280">    	return 1.84;</span>
    }

    @Override
    public double primitiveFuelFactor() {
<span class="nc" id="L285">        int year = getOriginalBuildYear();</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        if (year &gt;= 2500) {</span>
<span class="nc" id="L287">            return 1.0;</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">        } else if (year &gt;= 2400) {</span>
<span class="nc" id="L289">            return 1.2;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">        } else if (year &gt;= 2300) {</span>
<span class="nc" id="L291">            return 1.4;</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">        } else if (year &gt;= 2251) {</span>
<span class="nc" id="L293">            return 1.5;</span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">        } else if (year &gt;= 2201) {</span>
<span class="nc" id="L295">            return 1.7;</span>
<span class="nc bnc" id="L296" title="All 2 branches missed.">        } else if (year &gt;= 2151) {</span>
<span class="nc" id="L297">            return 1.9;</span>
        } else {
<span class="nc" id="L299">            return 2.2;</span>
        }
    }

    @Override
    public String[] getLocationAbbrs() {
<span class="nc" id="L305">        return LOCATION_ABBRS;</span>
    }

    @Override
    public String[] getLocationNames() {
<span class="nc" id="L310">        return LOCATION_NAMES;</span>
    }

    @Override
    public int locations() {
<span class="nc" id="L315">        return 5;</span>
    }

    @Override
    public int getBodyLocation() {
<span class="nc" id="L320">        return LOC_HULL;</span>
    }

    // what is different - hit table is about it
    @Override
    public HitData rollHitLocation(int table, int side) {

        /*
         * Unlike other units, ASFs determine potential crits based on the to-hit roll
         * so I need to set this potential value as well as return the to hit data
         */

<span class="nc" id="L332">        int roll = Compute.d6(2);</span>

        // special rules for spheroids in atmosphere
        // http://www.classicbattletech.com/forums/index.php/topic,54077.0.html
<span class="nc bnc" id="L336" title="All 4 branches missed.">        if (isSpheroid() &amp;&amp; table != ToHitData.HIT_SPHEROID_CRASH &amp;&amp; </span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                !game.getBoard().inSpace()) {</span>
<span class="nc" id="L338">            int preroll = Compute.d6(1);</span>
<span class="nc bnc" id="L339" title="All 4 branches missed.">            if ((table == ToHitData.HIT_ABOVE) &amp;&amp; (preroll &lt; 4)) {</span>
<span class="nc" id="L340">                side = ToHitData.SIDE_FRONT;</span>
<span class="nc bnc" id="L341" title="All 4 branches missed.">            } else if ((table == ToHitData.HIT_BELOW) &amp;&amp; (preroll &lt; 4)) {</span>
<span class="nc" id="L342">                side = ToHitData.SIDE_REAR;</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">            } else if (preroll == 1) {</span>
<span class="nc" id="L344">                side = ToHitData.SIDE_FRONT;</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">            } else if (preroll == 6) {</span>
<span class="nc" id="L346">                side = ToHitData.SIDE_REAR;</span>
            }
        }

<span class="nc bnc" id="L350" title="All 4 branches missed.">        if ((table == ToHitData.HIT_ABOVE) || (table == ToHitData.HIT_BELOW)) {</span>

            // have to decide which wing
<span class="nc" id="L353">            int wingloc = LOC_RWING;</span>
<span class="nc" id="L354">            int wingroll = Compute.d6(1);</span>
<span class="nc bnc" id="L355" title="All 2 branches missed.">            if (wingroll &gt; 3) {</span>
<span class="nc" id="L356">                wingloc = LOC_LWING;</span>
            }
<span class="nc bnc" id="L358" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc" id="L360">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L361">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 3:
<span class="nc" id="L363">                    setPotCrit(CRIT_FCS);</span>
<span class="nc" id="L364">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 4:
<span class="nc" id="L366">                    setPotCrit(CRIT_SENSOR);</span>
<span class="nc" id="L367">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 5:
<span class="nc" id="L369">                    setPotCrit(CRIT_RIGHT_THRUSTER);</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">                    if (wingroll &gt; 3) {</span>
<span class="nc" id="L371">                        setPotCrit(CRIT_LEFT_THRUSTER);</span>
                    }
<span class="nc" id="L373">                    return new HitData(wingloc, false, HitData.EFFECT_NONE);</span>
                case 6:
<span class="nc" id="L375">                    setPotCrit(CRIT_CARGO);</span>
<span class="nc" id="L376">                    return new HitData(wingloc, false, HitData.EFFECT_NONE);</span>
                case 7:
<span class="nc" id="L378">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L379">                    return new HitData(wingloc, false, HitData.EFFECT_NONE);</span>
                case 8:
<span class="nc" id="L381">                    setPotCrit(CRIT_DOOR);</span>
<span class="nc" id="L382">                    return new HitData(wingloc, false, HitData.EFFECT_NONE);</span>
                case 9:
<span class="nc" id="L384">                    setPotCrit(CRIT_RIGHT_THRUSTER);</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">                    if (wingroll &gt; 3) {</span>
<span class="nc" id="L386">                        setPotCrit(CRIT_LEFT_THRUSTER);</span>
                    }
<span class="nc" id="L388">                    return new HitData(wingloc, false, HitData.EFFECT_NONE);</span>
                case 10:
<span class="nc" id="L390">                    setPotCrit(CRIT_AVIONICS);</span>
<span class="nc" id="L391">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 11:
<span class="nc" id="L393">                    setPotCrit(CRIT_ENGINE);</span>
<span class="nc" id="L394">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 12:
<span class="nc" id="L396">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L397">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
            }
        }

<span class="nc bnc" id="L401" title="All 2 branches missed.">        if (side == ToHitData.SIDE_FRONT) {</span>
            // normal front hits
<span class="nc bnc" id="L403" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc" id="L405">                    setPotCrit(CRIT_CREW);</span>
<span class="nc" id="L406">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 3:
<span class="nc" id="L408">                    setPotCrit(CRIT_AVIONICS);</span>
<span class="nc" id="L409">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 4:
<span class="nc" id="L411">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L412">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 5:
<span class="nc" id="L414">                    setPotCrit(CRIT_RIGHT_THRUSTER);</span>
<span class="nc" id="L415">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 6:
<span class="nc" id="L417">                    setPotCrit(CRIT_FCS);</span>
<span class="nc" id="L418">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 7:
<span class="nc" id="L420">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L421">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 8:
<span class="nc" id="L423">                    setPotCrit(CRIT_CONTROL);</span>
<span class="nc" id="L424">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 9:
<span class="nc" id="L426">                    setPotCrit(CRIT_LEFT_THRUSTER);</span>
<span class="nc" id="L427">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 10:
<span class="nc" id="L429">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L430">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 11:
<span class="nc" id="L432">                    setPotCrit(CRIT_SENSOR);</span>
<span class="nc" id="L433">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 12:
<span class="nc" id="L435">                    setPotCrit(CRIT_KF_BOOM);</span>
                    // Primitve dropships without kf-boom take avionics hit instead (IO, p. 119).
<span class="nc bnc" id="L437" title="All 2 branches missed.">                    if ((this instanceof Dropship)</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">                            &amp;&amp; (((Dropship)this).getCollarType() == Dropship.COLLAR_NO_BOOM)) {</span>
<span class="nc" id="L439">                        setPotCrit(CRIT_AVIONICS);</span>
                    }
<span class="nc" id="L441">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
            }
<span class="nc bnc" id="L443" title="All 2 branches missed.">        } else if (side == ToHitData.SIDE_LEFT) {</span>
            // normal left-side hits
<span class="nc bnc" id="L445" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc" id="L447">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L448">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 3:
<span class="nc" id="L450">                    setPotCrit(CRIT_FCS);</span>
<span class="nc" id="L451">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 4:
<span class="nc" id="L453">                    setPotCrit(CRIT_SENSOR);</span>
<span class="nc" id="L454">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 5:
<span class="nc" id="L456">                    setPotCrit(CRIT_LEFT_THRUSTER);</span>
<span class="nc" id="L457">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 6:
<span class="nc" id="L459">                    setPotCrit(CRIT_CARGO);</span>
<span class="nc" id="L460">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 7:
<span class="nc" id="L462">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L463">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 8:
<span class="nc" id="L465">                    setPotCrit(CRIT_DOOR);</span>
<span class="nc" id="L466">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 9:
<span class="nc" id="L468">                    setPotCrit(CRIT_LEFT_THRUSTER);</span>
<span class="nc" id="L469">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 10:
<span class="nc" id="L471">                    setPotCrit(CRIT_AVIONICS);</span>
<span class="nc" id="L472">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 11:
<span class="nc" id="L474">                    setPotCrit(CRIT_ENGINE);</span>
<span class="nc" id="L475">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 12:
<span class="nc" id="L477">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L478">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
            }
<span class="nc bnc" id="L480" title="All 2 branches missed.">        } else if (side == ToHitData.SIDE_RIGHT) {</span>
            // normal right-side hits
<span class="nc bnc" id="L482" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc" id="L484">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L485">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 3:
<span class="nc" id="L487">                    setPotCrit(CRIT_FCS);</span>
<span class="nc" id="L488">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 4:
<span class="nc" id="L490">                    setPotCrit(CRIT_SENSOR);</span>
<span class="nc" id="L491">                    return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
                case 5:
<span class="nc" id="L493">                    setPotCrit(CRIT_RIGHT_THRUSTER);</span>
<span class="nc" id="L494">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 6:
<span class="nc" id="L496">                    setPotCrit(CRIT_CARGO);</span>
<span class="nc" id="L497">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 7:
<span class="nc" id="L499">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L500">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 8:
<span class="nc" id="L502">                    setPotCrit(CRIT_DOOR);</span>
<span class="nc" id="L503">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 9:
<span class="nc" id="L505">                    setPotCrit(CRIT_RIGHT_THRUSTER);</span>
<span class="nc" id="L506">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 10:
<span class="nc" id="L508">                    setPotCrit(CRIT_AVIONICS);</span>
<span class="nc" id="L509">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 11:
<span class="nc" id="L511">                    setPotCrit(CRIT_ENGINE);</span>
<span class="nc" id="L512">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 12:
<span class="nc" id="L514">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L515">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
            }
<span class="nc bnc" id="L517" title="All 2 branches missed.">        } else if (side == ToHitData.SIDE_REAR) {</span>
            // normal aft hits
<span class="nc bnc" id="L519" title="All 12 branches missed.">            switch (roll) {</span>
                case 2:
<span class="nc" id="L521">                    setPotCrit(CRIT_LIFE_SUPPORT);</span>
<span class="nc" id="L522">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 3:
<span class="nc" id="L524">                    setPotCrit(CRIT_CONTROL);</span>
<span class="nc" id="L525">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 4:
<span class="nc" id="L527">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L528">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 5:
<span class="nc" id="L530">                    setPotCrit(CRIT_DOOR);</span>
<span class="nc" id="L531">                    return new HitData(LOC_RWING, false, HitData.EFFECT_NONE);</span>
                case 6:
<span class="nc" id="L533">                    setPotCrit(CRIT_ENGINE);</span>
<span class="nc" id="L534">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 7:
<span class="nc" id="L536">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L537">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 8:
<span class="nc" id="L539">                    setPotCrit(CRIT_DOCK_COLLAR);</span>
<span class="nc" id="L540">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 9:
<span class="nc" id="L542">                    setPotCrit(CRIT_DOOR);</span>
<span class="nc" id="L543">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 10:
<span class="nc" id="L545">                    setPotCrit(CRIT_WEAPON);</span>
<span class="nc" id="L546">                    return new HitData(LOC_LWING, false, HitData.EFFECT_NONE);</span>
                case 11:
<span class="nc" id="L548">                    setPotCrit(CRIT_GEAR);</span>
<span class="nc" id="L549">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
                case 12:
<span class="nc" id="L551">                    setPotCrit(CRIT_FUEL_TANK);</span>
<span class="nc" id="L552">                    return new HitData(LOC_AFT, false, HitData.EFFECT_NONE);</span>
            }
        }
<span class="nc" id="L555">        return new HitData(LOC_NOSE, false, HitData.EFFECT_NONE);</span>
    }

    // weapon arcs
    @Override
    public int getWeaponArc(int wn) {
<span class="nc" id="L561">        final Mounted mounted = getEquipment(wn);</span>

<span class="nc" id="L563">        int arc = Compute.ARC_NOSE;</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">        if (!isSpheroid()) {</span>
<span class="nc bnc" id="L565" title="All 5 branches missed.">            switch (mounted.getLocation()) {</span>
                case LOC_NOSE:
<span class="nc bnc" id="L567" title="All 2 branches missed.">                    if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L568">                        arc = Compute.ARC_NOSE_WPL;</span>
<span class="nc" id="L569">                        break;</span>
                    }
<span class="nc" id="L571">                    arc = Compute.ARC_NOSE;</span>
<span class="nc" id="L572">                    break;</span>
                case LOC_RWING:
<span class="nc bnc" id="L574" title="All 2 branches missed.">                    if (mounted.isRearMounted()) {</span>
<span class="nc bnc" id="L575" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L576">                            arc = Compute.ARC_RWINGA_WPL;</span>
<span class="nc" id="L577">                            break;</span>
                        }
<span class="nc" id="L579">                        arc = Compute.ARC_RWINGA;</span>
                    } else {
<span class="nc bnc" id="L581" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L582">                            arc = Compute.ARC_RWING_WPL;</span>
<span class="nc" id="L583">                            break;</span>
                        }
<span class="nc" id="L585">                        arc = Compute.ARC_RWING;</span>
                    }
<span class="nc" id="L587">                    break;</span>
                case LOC_LWING:
<span class="nc bnc" id="L589" title="All 2 branches missed.">                    if (mounted.isRearMounted()) {</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L591">                            arc = Compute.ARC_LWINGA_WPL;</span>
<span class="nc" id="L592">                            break;</span>
                        }
<span class="nc" id="L594">                        arc = Compute.ARC_LWINGA;</span>
                    } else {
<span class="nc bnc" id="L596" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L597">                            arc = Compute.ARC_LWING_WPL;</span>
<span class="nc" id="L598">                            break;</span>
                        }
<span class="nc" id="L600">                        arc = Compute.ARC_LWING;</span>
                    }
<span class="nc" id="L602">                    break;</span>
                case LOC_AFT:
<span class="nc bnc" id="L604" title="All 2 branches missed.">                    if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L605">                        arc = Compute.ARC_AFT_WPL;</span>
<span class="nc" id="L606">                        break;</span>
                    }
<span class="nc" id="L608">                    arc = Compute.ARC_AFT;</span>
<span class="nc" id="L609">                    break;</span>
                default:
<span class="nc" id="L611">                    arc = Compute.ARC_360;</span>
            }
        } else {
<span class="nc bnc" id="L614" title="All 4 branches missed.">            if ((game != null) &amp;&amp; game.getBoard().inSpace()) {</span>
<span class="nc bnc" id="L615" title="All 5 branches missed.">                switch (mounted.getLocation()) {</span>
                    case LOC_NOSE:
<span class="nc bnc" id="L617" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L618">                            arc = Compute.ARC_NOSE_WPL;</span>
<span class="nc" id="L619">                            break;</span>
                        }
<span class="nc" id="L621">                        arc = Compute.ARC_NOSE;</span>
<span class="nc" id="L622">                        break;</span>
                    case LOC_RWING:
<span class="nc bnc" id="L624" title="All 2 branches missed.">                        if (mounted.isRearMounted()) {</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">                            if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L626">                                arc = Compute.ARC_RIGHTSIDEA_SPHERE_WPL;</span>
<span class="nc" id="L627">                                break;</span>
                            }
<span class="nc" id="L629">                            arc = Compute.ARC_RIGHTSIDEA_SPHERE;</span>
                        } else {
<span class="nc bnc" id="L631" title="All 2 branches missed.">                            if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L632">                                arc = Compute.ARC_RIGHTSIDE_SPHERE_WPL;</span>
<span class="nc" id="L633">                                break;</span>
                            }
<span class="nc" id="L635">                            arc = Compute.ARC_RIGHTSIDE_SPHERE;</span>
                        }
<span class="nc" id="L637">                        break;</span>
                    case LOC_LWING:
<span class="nc bnc" id="L639" title="All 2 branches missed.">                        if (mounted.isRearMounted()) {</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">                            if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L641">                                arc = Compute.ARC_LEFTSIDEA_SPHERE_WPL;</span>
<span class="nc" id="L642">                                break;</span>
                            }
<span class="nc" id="L644">                            arc = Compute.ARC_LEFTSIDEA_SPHERE;</span>
                        } else {
<span class="nc bnc" id="L646" title="All 2 branches missed.">                            if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L647">                                arc = Compute.ARC_LEFTSIDE_SPHERE_WPL;</span>
<span class="nc" id="L648">                                break;</span>
                            }
<span class="nc" id="L650">                            arc = Compute.ARC_LEFTSIDE_SPHERE;</span>
                        }
<span class="nc" id="L652">                        break;</span>
                    case LOC_AFT:
<span class="nc bnc" id="L654" title="All 2 branches missed.">                        if (mounted.isInWaypointLaunchMode()) {</span>
<span class="nc" id="L655">                            arc = Compute.ARC_AFT_WPL;</span>
<span class="nc" id="L656">                            break;</span>
                        }
<span class="nc" id="L658">                        arc = Compute.ARC_AFT;</span>
<span class="nc" id="L659">                        break;</span>
                    default:
<span class="nc" id="L661">                        arc = Compute.ARC_360;</span>
                }
            } else {
<span class="nc bnc" id="L664" title="All 5 branches missed.">                switch (mounted.getLocation()) {</span>
                    case LOC_NOSE:
<span class="nc" id="L666">                        arc = Compute.ARC_360;</span>
<span class="nc" id="L667">                        break;</span>
                    case LOC_RWING:
<span class="nc" id="L669">                        arc = Compute.ARC_RIGHT_SPHERE_GROUND;</span>
<span class="nc" id="L670">                        break;</span>
                    case LOC_LWING:
<span class="nc" id="L672">                        arc = Compute.ARC_LEFT_SPHERE_GROUND;</span>
<span class="nc" id="L673">                        break;</span>
                    case LOC_AFT:
<span class="nc" id="L675">                        arc = Compute.ARC_360;</span>
<span class="nc" id="L676">                        break;</span>
                    default:
<span class="nc" id="L678">                        arc = Compute.ARC_360;</span>
                }
            }

        }

<span class="nc" id="L684">        return rollArcs(arc);</span>

    }

    public int getArcswGuns() {
        // return the number
<span class="nc" id="L690">        int nArcs = 0;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">        for (int i = 0; i &lt; locations(); i++) {</span>
<span class="nc bnc" id="L692" title="All 2 branches missed.">            if (hasWeaponInArc(i, false)) {</span>
<span class="nc" id="L693">                nArcs++;</span>
            }
            // check for rear locations
<span class="nc bnc" id="L696" title="All 2 branches missed.">            if (hasWeaponInArc(i, true)) {</span>
<span class="nc" id="L697">                nArcs++;</span>
            }
        }
<span class="nc" id="L700">        return nArcs;</span>
    }

    public boolean hasWeaponInArc(int loc, boolean rearMount) {
<span class="nc" id="L704">        boolean hasWeapons = false;</span>
<span class="nc bnc" id="L705" title="All 2 branches missed.">        for (Mounted weap : getWeaponList()) {</span>
<span class="nc bnc" id="L706" title="All 4 branches missed.">            if ((weap.getLocation() == loc) &amp;&amp; (weap.isRearMounted() == rearMount)) {</span>
<span class="nc" id="L707">                hasWeapons = true;</span>
            }
<span class="nc" id="L709">        }</span>
<span class="nc" id="L710">        return hasWeapons;</span>
    }

    @Override
    public double getArmorWeight() {
        // first I need to subtract SI bonus from total armor. We need to retain the fractional part
        //  for primitive craft because the primitive multiplier is applied to both before rounding.
<span class="nc" id="L717">        double armorPoints = getTotalOArmor();</span>
<span class="nc" id="L718">        int freeSI = getSI() * (locations() - 1); // no armor in hull location</span>
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if (isPrimitive()) {</span>
<span class="nc" id="L720">            armorPoints -= freeSI * 0.66;</span>
        } else {
<span class="nc" id="L722">            armorPoints -= freeSI;</span>
        }
<span class="nc" id="L724">        double armorPerTon = SmallCraft.armorPointsPerTon(getWeight(), isSpheroid(),</span>
<span class="nc" id="L725">                getArmorType(0), TechConstants.isClan(getArmorTechLevel(0)));</span>

<span class="nc" id="L727">        return RoundWeight.nextHalfTon(armorPoints / armorPerTon);</span>
    }
    
    public static double armorPointsPerTon(double craftWeight, boolean spheroid, int at, boolean isClan) {
<span class="nc" id="L731">        double base = 16.0;</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">        if (spheroid) {</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">            if (craftWeight &gt;= 65000) {</span>
<span class="nc" id="L734">                base = 6.0;</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">            } else if (craftWeight &gt;= 50000) {</span>
<span class="nc" id="L736">                base = 8.0;</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">            } else if (craftWeight &gt;= 35000) {</span>
<span class="nc" id="L738">                base = 10.0;</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">            } else if (craftWeight &gt;= 20000) {</span>
<span class="nc" id="L740">                base = 12.0;</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">            } else if (craftWeight &gt;= 12500) {</span>
<span class="nc" id="L742">                base = 14.0;</span>
            }
        } else {
<span class="nc bnc" id="L745" title="All 2 branches missed.">            if (craftWeight &gt;= 25000) {</span>
<span class="nc" id="L746">                base = 6.0;</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">            } else if (craftWeight &gt;= 17500) {</span>
<span class="nc" id="L748">                base = 8.0;</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">            } else if (craftWeight &gt;= 12500) {</span>
<span class="nc" id="L750">                base = 10.0;</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">            } else if (craftWeight &gt;= 9500) {</span>
<span class="nc" id="L752">                base = 12.0;</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">            } else if (craftWeight &gt;= 6000) {</span>
<span class="nc" id="L754">                base = 14.0;</span>
            }
        }
<span class="nc bnc" id="L757" title="All 2 branches missed.">        if (isClan) {</span>
<span class="nc bnc" id="L758" title="All 2 branches missed.">            if (base &gt; 14) {</span>
<span class="nc" id="L759">                base += 4;</span>
<span class="nc bnc" id="L760" title="All 2 branches missed.">            } else if (base &gt; 12) {</span>
<span class="nc" id="L761">                base += 3;</span>
<span class="nc bnc" id="L762" title="All 2 branches missed.">            } else if (base &gt; 6) {</span>
<span class="nc" id="L763">                base += 2;</span>
            } else {
<span class="nc" id="L765">                base += 1;</span>
            }
        }

<span class="nc" id="L769">        return base * EquipmentType.getArmorPointMultiplier(at, isClan);</span>
    }

    /**
     * There is a mistake in some of the AT2r costs for some reason they added
     * ammo twice for a lot of the level 2 designs, leading to costs that are
     * too high
     */
    @Override
    public double getCost(boolean ignoreAmmo) {

<span class="nc" id="L780">        double cost = 0;</span>

        // add in controls
        // bridge
<span class="nc" id="L784">        cost += 200000 + (10 * weight);</span>
        // computer
<span class="nc" id="L786">        cost += 200000;</span>
        // life support
<span class="nc" id="L788">        cost += 5000 * (getNCrew() + getNPassenger());</span>
        // sensors
<span class="nc" id="L790">        cost += 80000;</span>
        // fcs
<span class="nc" id="L792">        cost += 100000;</span>
        // gunnery/control systems
<span class="nc" id="L794">        cost += 10000 * getArcswGuns();</span>

        // structural integrity
<span class="nc" id="L797">        cost += 100000 * getSI();</span>

        // additional flight systems (attitude thruster and landing gear)
<span class="nc" id="L800">        cost += 25000 + (10 * getWeight());</span>

        // engine
<span class="nc" id="L803">        double engineMultiplier = 0.065;</span>
<span class="nc bnc" id="L804" title="All 2 branches missed.">        if (isClan()) {</span>
<span class="nc" id="L805">            engineMultiplier = 0.061;</span>
        }
<span class="nc" id="L807">        double engineWeight = getOriginalWalkMP() * weight * engineMultiplier;</span>
<span class="nc" id="L808">        cost += engineWeight * 1000;</span>
        // drive unit
<span class="nc" id="L810">        cost += (500 * getOriginalWalkMP() * weight) / 100.0;</span>

        // fuel tanks
<span class="nc" id="L813">        cost += (200 * getFuel()) / 80.0 * 1.02;</span>

        // armor
<span class="nc" id="L816">        cost += getArmorWeight() * EquipmentType.getArmorCost(armorType[0]);</span>

        // heat sinks
<span class="nc" id="L819">        int sinkCost = 2000 + (4000 * getHeatType());// == HEAT_DOUBLE ? 6000:</span>
        // 2000;
<span class="nc" id="L821">        cost += sinkCost * getHeatSinks();</span>

        // weapons
<span class="nc" id="L824">        cost += getWeaponsAndEquipmentCost(ignoreAmmo);</span>

<span class="nc" id="L826">        return Math.round(cost * getPriceMultiplier());</span>

    }

    @Override
    public double getPriceMultiplier() {
<span class="nc" id="L832">        return 1 + (weight / 50f);</span>
    }

    @Override
    public int getMaxEngineHits() {
<span class="nc" id="L837">        return 6;</span>
    }

    @Override
    public double getBVTypeModifier() {
<span class="nc" id="L842">        return 1.0;</span>
    }

    /**
     * need to check bay location before loading ammo
     */
    @Override
    public boolean loadWeapon(Mounted mounted, Mounted mountedAmmo) {
<span class="nc" id="L850">        boolean success = false;</span>
<span class="nc" id="L851">        WeaponType wtype = (WeaponType) mounted.getType();</span>
<span class="nc" id="L852">        AmmoType atype = (AmmoType) mountedAmmo.getType();</span>

<span class="nc bnc" id="L854" title="All 2 branches missed.">        if (mounted.getLocation() != mountedAmmo.getLocation()) {</span>
<span class="nc" id="L855">            return success;</span>
        }

<span class="nc bnc" id="L858" title="All 8 branches missed.">        if (mountedAmmo.isAmmoUsable() &amp;&amp; !wtype.hasFlag(WeaponType.F_ONESHOT) &amp;&amp; (atype.getAmmoType() == wtype.getAmmoType()) &amp;&amp; (atype.getRackSize() == wtype.getRackSize())) {</span>
<span class="nc" id="L859">            mounted.setLinked(mountedAmmo);</span>
<span class="nc" id="L860">            success = true;</span>
        }
<span class="nc" id="L862">        return success;</span>
    }

    /*
     * (non-Javadoc)
     * @see megamek.common.Entity#getTotalCommGearTons()
     */
    @Override
    public int getTotalCommGearTons() {
<span class="nc" id="L871">        return 3 + getExtraCommGearTons();</span>
    }

    /**
     * All military small craft automatically have ECM if in space
     */
    @Override
    public boolean hasActiveECM() {
<span class="nc bnc" id="L879" title="All 4 branches missed.">        if (!game.getOptions().booleanOption(OptionsConstants.ADVAERORULES_STRATOPS_ECM) || !game.getBoard().inSpace()) {</span>
<span class="nc" id="L880">            return super.hasActiveECM();</span>
        }
<span class="nc bnc" id="L882" title="All 2 branches missed.">        return getECMRange() &gt;= 0;</span>
    }

    /**
     * What's the range of the ECM equipment?
     *
     * @return the &lt;code&gt;int&lt;/code&gt; range of this unit's ECM. This value will be
     *         &lt;code&gt;Entity.NONE&lt;/code&gt; if no ECM is active.
     */
    @Override
    public int getECMRange() {
<span class="nc bnc" id="L893" title="All 2 branches missed.">        if (!game.getOptions().booleanOption(OptionsConstants.ADVAERORULES_STRATOPS_ECM)</span>
<span class="nc bnc" id="L894" title="All 2 branches missed.">                || !game.getBoard().inSpace()) {</span>
<span class="nc" id="L895">            return super.getECMRange();</span>
        }
<span class="nc bnc" id="L897" title="All 2 branches missed.">        if (!isMilitary()) {</span>
<span class="nc" id="L898">            return Entity.NONE;</span>
        }
<span class="nc" id="L900">        int range = -1;</span>
        // if the unit has an ECM unit, then the range might be extended by one
<span class="nc bnc" id="L902" title="All 2 branches missed.">        if (!isShutDown()) {</span>
<span class="nc bnc" id="L903" title="All 2 branches missed.">            for (Mounted m : getMisc()) {</span>
<span class="nc" id="L904">                EquipmentType type = m.getType();</span>
<span class="nc bnc" id="L905" title="All 6 branches missed.">                if ((type instanceof MiscType) &amp;&amp; type.hasFlag(MiscType.F_ECM) &amp;&amp; !m.isInoperable()) {</span>
<span class="nc bnc" id="L906" title="All 2 branches missed.">                    if (type.hasFlag(MiscType.F_SINGLE_HEX_ECM)) {</span>
<span class="nc" id="L907">                        range += 1;</span>
                    } else {
<span class="nc" id="L909">                        range += 2;</span>
                    }
<span class="nc" id="L911">                    break;</span>
                }
<span class="nc" id="L913">            }</span>
        }
        // the range might be affected by sensor/FCS damage
<span class="nc" id="L916">        range = range - getFCSHits() - getSensorHits();</span>
<span class="nc" id="L917">        return range;</span>
    }

    /**
     * @return is the crew of this vessel protected from gravitational effects,
     *         see StratOps, pg. 36
     */
    @Override
    public boolean isCrewProtected() {
<span class="nc bnc" id="L926" title="All 4 branches missed.">        return isMilitary() &amp;&amp; (getOriginalWalkMP() &gt; 4);</span>
    }

    /**
     * Return the height of this small craft above the terrain.
     */
    @Override
    public int height() {
<span class="nc bnc" id="L934" title="All 2 branches missed.">        if (isAirborne()) {</span>
<span class="nc" id="L935">            return 0;</span>
        }
<span class="nc" id="L937">        return 1;</span>
    }

    @Override
    public int getBattleForceSize() {
        //The tables are on page 356 of StartOps
<span class="nc bnc" id="L943" title="All 2 branches missed.">        if (getWeight() &lt; 2500) {</span>
<span class="nc" id="L944">            return 1;</span>
        }
<span class="nc bnc" id="L946" title="All 2 branches missed.">        if (getWeight() &lt; 10000) {</span>
<span class="nc" id="L947">            return 2;</span>
        }
<span class="nc" id="L949">        return 3;</span>
    }
    
    @Override
    public int getNumBattleForceWeaponsLocations() {
<span class="nc" id="L954">        return 4;</span>
    }
    
    @Override
    public String getBattleForceLocationName(int index) {
<span class="nc" id="L959">        return getLocationAbbrs()[index];</span>
    }
    
    @Override
    public double getBattleForceLocationMultiplier(int index, int location, boolean rearMounted) {
<span class="nc bnc" id="L964" title="All 4 branches missed.">        switch (index) {</span>
        case LOC_NOSE:
<span class="nc bnc" id="L966" title="All 2 branches missed.">            if (location == LOC_NOSE) {</span>
<span class="nc" id="L967">                return 1.0;</span>
            }
<span class="nc bnc" id="L969" title="All 8 branches missed.">            if (isSpheroid() &amp;&amp; (location == LOC_LWING || location == LOC_RWING)</span>
                    &amp;&amp; !rearMounted) {
<span class="nc" id="L971">                return 0.5;</span>
            }
            break;
        case LOC_LWING:
        case LOC_RWING:
<span class="nc bnc" id="L976" title="All 2 branches missed.">            if (index == location) {</span>
<span class="nc bnc" id="L977" title="All 2 branches missed.">                if (isSpheroid()) {</span>
<span class="nc" id="L978">                    return 0.5;</span>
                }
<span class="nc bnc" id="L980" title="All 2 branches missed.">                if (!rearMounted) {</span>
<span class="nc" id="L981">                    return 1.0;</span>
                }
            }
            break;
        case LOC_AFT:
<span class="nc bnc" id="L986" title="All 2 branches missed.">            if (location == LOC_AFT) {</span>
<span class="nc" id="L987">                return 1.0;</span>
            }
<span class="nc bnc" id="L989" title="All 6 branches missed.">            if (rearMounted &amp;&amp; (location == LOC_LWING || location == LOC_RWING)) {</span>
<span class="nc bnc" id="L990" title="All 2 branches missed.">                return isSpheroid()? 0.5 : 1.0;</span>
            }
            break;
        }
<span class="nc" id="L994">        return 0;</span>
    }

    @Override
    public void addBattleForceSpecialAbilities(Map&lt;BattleForceSPA,Integer&gt; specialAbilities) {
<span class="nc" id="L999">        super.addBattleForceSpecialAbilities(specialAbilities);</span>
<span class="nc" id="L1000">        specialAbilities.put(BattleForceSPA.LG, null);</span>
<span class="nc" id="L1001">    }</span>

    public long getEntityType(){
<span class="nc" id="L1004">        return Entity.ETYPE_AERO | Entity.ETYPE_SMALL_CRAFT;</span>
    }
    
    @Override
    public boolean isFighter() {
<span class="nc" id="L1009">        return false;</span>
    }

    /**
     * Do not recalculate walkMP when adding engine.
     */
    @Override
    protected int calculateWalk() {
<span class="nc" id="L1017">    	return walkMP;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>