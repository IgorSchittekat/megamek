<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RandomArmyDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">RandomArmyDialog.java</span></div><h1>RandomArmyDialog.java</h1><pre class="source lang-java linenums">/*
 * MegaMek -
 * Copyright (C) 2006 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */
package megamek.client.ui.swing;

import java.awt.BorderLayout;
import java.awt.CardLayout;
import java.awt.Cursor;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.Iterator;
import java.util.List;

import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSplitPane;
import javax.swing.JTabbedPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.JTree;
import javax.swing.ListSelectionModel;
import javax.swing.SwingConstants;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.table.AbstractTableModel;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.TreeNode;
import javax.swing.tree.TreePath;
import javax.swing.tree.TreeSelectionModel;

import megamek.client.Client;
import megamek.client.generator.RandomGenderGenerator;
import megamek.client.generator.RandomNameGenerator;
import megamek.client.generator.RandomUnitGenerator;
import megamek.client.ratgenerator.FactionRecord;
import megamek.client.ratgenerator.FormationType;
import megamek.client.ratgenerator.MissionRole;
import megamek.client.ratgenerator.ModelRecord;
import megamek.client.ratgenerator.UnitTable;
import megamek.client.ui.Messages;
import megamek.common.Entity;
import megamek.common.EntityMovementMode;
import megamek.common.IGame.Phase;
import megamek.common.IPlayer;
import megamek.common.enums.Gender;
import megamek.common.event.GameListener;
import megamek.common.event.GameListenerAdapter;
import megamek.common.event.GameSettingsChangeEvent;
import megamek.common.LAMPilot;
import megamek.common.MechFileParser;
import megamek.common.MechSearchFilter;
import megamek.common.MechSummary;
import megamek.common.TechConstants;
import megamek.common.UnitType;
import megamek.common.loaders.EntityLoadingException;
import megamek.common.options.OptionsConstants;
import megamek.common.preference.IClientPreferences;
import megamek.common.preference.PreferenceManager;
import megamek.common.util.RandomArmyCreator;

public class RandomArmyDialog extends JDialog implements ActionListener, WindowListener, TreeSelectionListener {
    private static final long serialVersionUID = 4072453002423681675L;
    
    @SuppressWarnings(&quot;unused&quot;)
    private static final int TAB_BV_MATCHING       = 0;
    private static final int TAB_RAT               = 1;
    private static final int TAB_RAT_GENERATOR     = 2;
    private static final int TAB_FORMATION_BUILDER = 3;
    private static final int TAB_FORCE_GENERATOR   = 4;
    
    private static final String CARD_PREVIEW    = &quot;card_preview&quot;; //$NON-NLS-1$
    private static final String CARD_FORCE_TREE = &quot;card_force_tree&quot;; // $NON-NLS-1$
    
    private ClientGUI m_clientgui;
    private Client m_client;
    AdvancedSearchDialog asd;

    private MechSearchFilter searchFilter;

<span class="nc" id="L108">    private JLabel m_labelPlayer = new JLabel(Messages</span>
<span class="nc" id="L109">            .getString(&quot;RandomArmyDialog.Player&quot;), SwingConstants.RIGHT);</span>

<span class="nc" id="L111">    private JComboBox&lt;String&gt; m_chPlayer = new JComboBox&lt;&gt;();</span>
<span class="nc" id="L112">    private JComboBox&lt;String&gt; m_chType = new JComboBox&lt;&gt;();</span>

<span class="nc" id="L114">    private JTree m_treeRAT = new JTree();</span>
<span class="nc" id="L115">    private JTabbedPane m_pMain = new JTabbedPane();</span>
<span class="nc" id="L116">    private JPanel m_pRAT = new JPanel();</span>
<span class="nc" id="L117">    private JPanel m_pRATGen = new JPanel();</span>
<span class="nc" id="L118">    private JPanel m_pFormations = new JPanel();</span>
    private ForceGeneratorViewUi m_pForceGen;
    private ForceGenerationOptionsPanel m_pRATGenOptions;
<span class="nc" id="L121">    private JPanel m_pUnitTypeOptions = new JPanel(new CardLayout());</span>
    private ForceGenerationOptionsPanel m_pFormationOptions;
<span class="nc" id="L123">    private JPanel m_pParameters = new JPanel();</span>
<span class="nc" id="L124">    private JPanel m_pPreview = new JPanel();</span>
<span class="nc" id="L125">    private JPanel m_pButtons = new JPanel();</span>
<span class="nc" id="L126">    private JPanel m_pAdvSearch = new JPanel();</span>
<span class="nc" id="L127">    private JButton m_bOK = new JButton(Messages.getString(&quot;Okay&quot;));</span>
<span class="nc" id="L128">    private JButton m_bCancel = new JButton(Messages.getString(&quot;Cancel&quot;));</span>
<span class="nc" id="L129">    private JButton m_bRandomSkills = new JButton(Messages.getString(&quot;RandomSkillDialog.title&quot;));</span>
<span class="nc" id="L130">    private JButton m_bAdvSearch = new JButton(Messages.getString(&quot;RandomArmyDialog.AdvancedSearch&quot;));</span>
<span class="nc" id="L131">    private JButton m_bAdvSearchClear = new JButton(Messages.getString(&quot;RandomArmyDialog.AdvancedSearchClear&quot;));</span>
<span class="nc" id="L132">    private JButton m_bGenerate = new JButton(Messages.getString(&quot;RandomArmyDialog.Generate&quot;));</span>
<span class="nc" id="L133">    private JButton m_bAddToForce = new JButton(Messages.getString(&quot;RandomArmyDialog.AddToForce&quot;));</span>

<span class="nc" id="L135">    private CardLayout m_lRightCards = new CardLayout();</span>
<span class="nc" id="L136">    private JPanel m_pRightPane = new JPanel(m_lRightCards);</span>
    private JSplitPane m_pSplit;

<span class="nc" id="L139">    private JButton m_bAddAll = new JButton(Messages.getString(&quot;RandomArmyDialog.AddAll&quot;));</span>
<span class="nc" id="L140">    private JButton m_bAdd = new JButton(Messages.getString(&quot;RandomArmyDialog.AddSelected&quot;));</span>
<span class="nc" id="L141">    private JButton m_bRoll = new JButton(Messages.getString(&quot;RandomArmyDialog.Roll&quot;));</span>
<span class="nc" id="L142">    private JButton m_bClear = new JButton(Messages.getString(&quot;RandomArmyDialog.Clear&quot;));</span>

    private JTable m_lArmy;
    private JTable m_lUnits;
    private JTable m_lRAT;

    private UnitTableModel armyModel;
    private UnitTableModel unitsModel;
    private RATTableModel ratModel;

<span class="nc" id="L152">    private JLabel m_labBV = new JLabel(Messages</span>
<span class="nc" id="L153">            .getString(&quot;RandomArmyDialog.BV&quot;));</span>
<span class="nc" id="L154">    private JLabel m_labYear = new JLabel(Messages</span>
<span class="nc" id="L155">            .getString(&quot;RandomArmyDialog.Year&quot;));</span>
<span class="nc" id="L156">    private JLabel m_labMechs = new JLabel(Messages</span>
<span class="nc" id="L157">            .getString(&quot;RandomArmyDialog.Mechs&quot;));</span>
<span class="nc" id="L158">    private JLabel m_labVees = new JLabel(Messages</span>
<span class="nc" id="L159">            .getString(&quot;RandomArmyDialog.Vees&quot;));</span>
<span class="nc" id="L160">    private JLabel m_labBA = new JLabel(Messages</span>
<span class="nc" id="L161">            .getString(&quot;RandomArmyDialog.BA&quot;));</span>
<span class="nc" id="L162">    private JLabel m_labInfantry = new JLabel(Messages</span>
<span class="nc" id="L163">            .getString(&quot;RandomArmyDialog.Infantry&quot;));</span>
<span class="nc" id="L164">    private JLabel m_labTech = new JLabel(Messages</span>
<span class="nc" id="L165">            .getString(&quot;RandomArmyDialog.Tech&quot;));</span>
<span class="nc" id="L166">    private JLabel m_labUnits = new JLabel(Messages</span>
<span class="nc" id="L167">            .getString(&quot;RandomArmyDialog.Unit&quot;));</span>
    private JLabel m_ratStatus;

<span class="nc" id="L170">    private JTextField m_tBVmin = new JTextField(6);</span>
<span class="nc" id="L171">    private JTextField m_tBVmax = new JTextField(6);</span>
<span class="nc" id="L172">    private JTextField m_tMinYear = new JTextField(4);</span>
<span class="nc" id="L173">    private JTextField m_tMaxYear = new JTextField(4);</span>
<span class="nc" id="L174">    private JTextField m_tMechs = new JTextField(3);</span>
<span class="nc" id="L175">    private JTextField m_tVees = new JTextField(3);</span>
<span class="nc" id="L176">    private JTextField m_tBA = new JTextField(3);</span>
<span class="nc" id="L177">    private JTextField m_tInfantry = new JTextField(3);</span>
<span class="nc" id="L178">    private JTextField m_tUnits = new JTextField(3);</span>
<span class="nc" id="L179">    private JCheckBox m_chkPad = new JCheckBox(Messages</span>
<span class="nc" id="L180">            .getString(&quot;RandomArmyDialog.Pad&quot;));</span>
<span class="nc" id="L181">    private JCheckBox m_chkCanon = new JCheckBox(Messages</span>
<span class="nc" id="L182">            .getString(&quot;RandomArmyDialog.Canon&quot;));</span>
    
    private RandomUnitGenerator rug;
    private UnitTable generatedRAT;

    public RandomArmyDialog(ClientGUI cl) {
<span class="nc" id="L188">        super(cl.frame, Messages.getString(&quot;RandomArmyDialog.title&quot;), true); //$NON-NLS-1$</span>
<span class="nc" id="L189">        m_clientgui = cl;</span>
<span class="nc" id="L190">        m_client = cl.getClient();</span>
<span class="nc" id="L191">        rug = RandomUnitGenerator.getInstance();</span>
<span class="nc" id="L192">        rug.registerListener(this);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (rug.isInitialized()){</span>
<span class="nc" id="L194">            m_ratStatus = new JLabel(Messages</span>
<span class="nc" id="L195">                    .getString(&quot;RandomArmyDialog.ratStatusDoneLoading&quot;));            </span>
        } else {
<span class="nc" id="L197">            m_ratStatus = new JLabel(Messages</span>
<span class="nc" id="L198">                    .getString(&quot;RandomArmyDialog.ratStatusLoading&quot;));</span>
        }
<span class="nc" id="L200">        updatePlayerChoice();</span>
<span class="nc" id="L201">        asd = new AdvancedSearchDialog(m_clientgui.frame,</span>
<span class="nc" id="L202">                m_client.getGame().getOptions().intOption(OptionsConstants.ALLOWED_YEAR));</span>
        
<span class="nc" id="L204">        GUIPreferences guip = GUIPreferences.getInstance();</span>
        // set defaults
<span class="nc" id="L206">        m_tMechs.setText(guip.getRATNumMechs());</span>
<span class="nc" id="L207">        m_tBVmin.setText(guip.getRATBVMin());</span>
<span class="nc" id="L208">        m_tBVmax.setText(guip.getRATBVMax());</span>
<span class="nc" id="L209">        m_tVees.setText(guip.getRATNumVees());</span>
<span class="nc" id="L210">        m_tBA.setText(guip.getRATNumBA());</span>
<span class="nc" id="L211">        m_tMinYear.setText(guip.getRATYearMin());</span>
<span class="nc" id="L212">        m_tMaxYear.setText(guip.getRATYearMax());</span>
<span class="nc" id="L213">        m_tInfantry.setText(guip.getRATNumInf());</span>
<span class="nc" id="L214">        m_chkPad.setSelected(guip.getRATPadBV());</span>
<span class="nc" id="L215">        m_chkCanon.setSelected(m_client.getGame().getOptions().booleanOption(</span>
        OptionsConstants.ALLOWED_CANON_ONLY));
<span class="nc" id="L217">        updateTechChoice();</span>

        // construct the buttons panel
<span class="nc" id="L220">        m_pButtons.setLayout(new FlowLayout(FlowLayout.CENTER));</span>
<span class="nc" id="L221">        m_pButtons.add(m_bOK);</span>
<span class="nc" id="L222">        m_bOK.addActionListener(this);</span>
<span class="nc" id="L223">        m_pButtons.add(m_bCancel);</span>
<span class="nc" id="L224">        m_bCancel.addActionListener(this);</span>
<span class="nc" id="L225">        m_bRandomSkills.addActionListener(this);</span>
<span class="nc" id="L226">        m_pButtons.add(m_labelPlayer);</span>
<span class="nc" id="L227">        m_pButtons.add(m_chPlayer);</span>
<span class="nc" id="L228">        m_pButtons.add(m_bRandomSkills);</span>

        // construct the Adv Search Panel
<span class="nc" id="L231">        m_pAdvSearch.setLayout(new FlowLayout(FlowLayout.LEADING));</span>
<span class="nc" id="L232">        m_pAdvSearch.add(m_bAdvSearch);</span>
<span class="nc" id="L233">        m_pAdvSearch.add(m_bAdvSearchClear);</span>
<span class="nc" id="L234">        m_bAdvSearchClear.setEnabled(false);</span>
<span class="nc" id="L235">        m_bAdvSearch.addActionListener(this);</span>
<span class="nc" id="L236">        m_bAdvSearchClear.addActionListener(this);</span>

        // construct the parameters panel
<span class="nc" id="L239">        GridBagLayout layout = new GridBagLayout();</span>
<span class="nc" id="L240">        m_pParameters.setLayout(layout);</span>
<span class="nc" id="L241">        GridBagConstraints constraints = new GridBagConstraints();</span>
<span class="nc" id="L242">        constraints.weightx = 0.0;</span>
<span class="nc" id="L243">        constraints.weighty = 0.0;</span>
<span class="nc" id="L244">        constraints.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L245">        layout.setConstraints(m_labTech, constraints);</span>
<span class="nc" id="L246">        m_pParameters.add(m_labTech);</span>
<span class="nc" id="L247">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L248">        constraints.weightx = 1.0;</span>
<span class="nc" id="L249">        layout.setConstraints(m_chType, constraints);</span>
<span class="nc" id="L250">        m_pParameters.add(m_chType);</span>
<span class="nc" id="L251">        constraints.gridwidth = 1;</span>
<span class="nc" id="L252">        constraints.weightx = 0.0;</span>
<span class="nc" id="L253">        layout.setConstraints(m_labBV, constraints);</span>
<span class="nc" id="L254">        m_pParameters.add(m_labBV);</span>
<span class="nc" id="L255">        m_pParameters.add(m_tBVmin);</span>
<span class="nc" id="L256">        JLabel dash = new JLabel(&quot;-&quot;);</span>
<span class="nc" id="L257">        layout.setConstraints(dash, constraints);</span>
<span class="nc" id="L258">        m_pParameters.add(dash);</span>
<span class="nc" id="L259">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L260">        constraints.weightx = 1.0;</span>
<span class="nc" id="L261">        layout.setConstraints(m_tBVmax, constraints);</span>
<span class="nc" id="L262">        m_pParameters.add(m_tBVmax);</span>
<span class="nc" id="L263">        constraints.gridwidth = 1;</span>
<span class="nc" id="L264">        constraints.weightx = 0.0;</span>
<span class="nc" id="L265">        layout.setConstraints(m_labMechs, constraints);</span>
<span class="nc" id="L266">        m_pParameters.add(m_labMechs);</span>
<span class="nc" id="L267">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L268">        constraints.weightx = 1.0;</span>
<span class="nc" id="L269">        layout.setConstraints(m_tMechs, constraints);</span>
<span class="nc" id="L270">        m_pParameters.add(m_tMechs);</span>
<span class="nc" id="L271">        constraints.gridwidth = 1;</span>
<span class="nc" id="L272">        constraints.weightx = 0.0;</span>
<span class="nc" id="L273">        layout.setConstraints(m_labVees, constraints);</span>
<span class="nc" id="L274">        m_pParameters.add(m_labVees);</span>
<span class="nc" id="L275">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L276">        constraints.weightx = 1.0;</span>
<span class="nc" id="L277">        layout.setConstraints(m_tVees, constraints);</span>
<span class="nc" id="L278">        m_pParameters.add(m_tVees);</span>
<span class="nc" id="L279">        constraints.gridwidth = 1;</span>
<span class="nc" id="L280">        constraints.weightx = 0.0;</span>
<span class="nc" id="L281">        layout.setConstraints(m_labBA, constraints);</span>
<span class="nc" id="L282">        m_pParameters.add(m_labBA);</span>
<span class="nc" id="L283">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L284">        constraints.weightx = 1.0;</span>
<span class="nc" id="L285">        layout.setConstraints(m_tBA, constraints);</span>
<span class="nc" id="L286">        m_pParameters.add(m_tBA);</span>
<span class="nc" id="L287">        constraints.gridwidth = 1;</span>
<span class="nc" id="L288">        constraints.weightx = 0.0;</span>
<span class="nc" id="L289">        layout.setConstraints(m_labInfantry, constraints);</span>
<span class="nc" id="L290">        m_pParameters.add(m_labInfantry);</span>
<span class="nc" id="L291">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L292">        constraints.weightx = 1.0;</span>
<span class="nc" id="L293">        layout.setConstraints(m_tInfantry, constraints);</span>
<span class="nc" id="L294">        m_pParameters.add(m_tInfantry);</span>
<span class="nc" id="L295">        constraints.gridwidth = 1;</span>
<span class="nc" id="L296">        constraints.weightx = 0.0;</span>
<span class="nc" id="L297">        layout.setConstraints(m_labYear, constraints);</span>
<span class="nc" id="L298">        m_pParameters.add(m_labYear);</span>
<span class="nc" id="L299">        layout.setConstraints(m_tMinYear, constraints);</span>
<span class="nc" id="L300">        m_pParameters.add(m_tMinYear);</span>
<span class="nc" id="L301">        dash = new JLabel(&quot;-&quot;);</span>
<span class="nc" id="L302">        layout.setConstraints(dash, constraints);</span>
<span class="nc" id="L303">        m_pParameters.add(dash);</span>
<span class="nc" id="L304">        constraints.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L305">        constraints.weightx = 1.0;</span>
<span class="nc" id="L306">        layout.setConstraints(m_tMaxYear, constraints);</span>
<span class="nc" id="L307">        m_pParameters.add(m_tMaxYear);</span>
<span class="nc" id="L308">        layout.setConstraints(m_chkPad, constraints);</span>
<span class="nc" id="L309">        m_pParameters.add(m_chkPad);</span>
<span class="nc" id="L310">        layout.setConstraints(m_chkCanon, constraints);</span>
<span class="nc" id="L311">        m_pParameters.add(m_chkCanon);</span>
<span class="nc" id="L312">        constraints.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L313">        constraints.weighty = 1.0;</span>
<span class="nc" id="L314">        layout.setConstraints(m_pAdvSearch, constraints);</span>
<span class="nc" id="L315">        m_pParameters.add(m_pAdvSearch);</span>

        //construct the RAT panel
<span class="nc" id="L318">        m_pRAT.setLayout(new GridBagLayout());</span>
<span class="nc" id="L319">        m_tUnits.setText(&quot;4&quot;);</span>

<span class="nc" id="L321">        GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L322">        c.gridx = 0;</span>
<span class="nc" id="L323">        c.gridy = 0;</span>
<span class="nc" id="L324">        c.gridwidth = 1;</span>
<span class="nc" id="L325">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L326">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L327">        c.weightx = 0.0;</span>
<span class="nc" id="L328">        c.weighty = 0.0;</span>
<span class="nc" id="L329">        m_pRAT.add(m_labUnits, c);</span>

<span class="nc" id="L331">        c = new GridBagConstraints();</span>
<span class="nc" id="L332">        c.gridx = 1;</span>
<span class="nc" id="L333">        c.gridy = 0;</span>
<span class="nc" id="L334">        c.gridwidth = 1;</span>
<span class="nc" id="L335">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L336">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L337">        c.weightx = 0.0;</span>
<span class="nc" id="L338">        c.weighty = 0.0;</span>
<span class="nc" id="L339">        m_pRAT.add(m_tUnits, c);</span>
        
<span class="nc" id="L341">        c = new GridBagConstraints();</span>
<span class="nc" id="L342">        c.gridx = 2;</span>
<span class="nc" id="L343">        c.gridy = 0;</span>
<span class="nc" id="L344">        c.gridwidth = 1;</span>
<span class="nc" id="L345">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L346">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L347">        c.weightx = 0.0;</span>
<span class="nc" id="L348">        c.weighty = 0.0;</span>
<span class="nc" id="L349">        c.insets = new Insets(0,10,0,0);</span>
<span class="nc" id="L350">        m_pRAT.add(m_ratStatus,c);</span>

<span class="nc" id="L352">        c = new GridBagConstraints();</span>
<span class="nc" id="L353">        c.gridx = 0;</span>
<span class="nc" id="L354">        c.gridy = 1;</span>
<span class="nc" id="L355">        c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L356">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L357">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L358">        c.weightx = 1.0;</span>
<span class="nc" id="L359">        c.weighty = 1.0;</span>
<span class="nc" id="L360">        c.insets = new java.awt.Insets(5, 5, 5, 5);</span>


<span class="nc" id="L363">        m_treeRAT.setRootVisible(false);</span>
<span class="nc" id="L364">        m_treeRAT.getSelectionModel().setSelectionMode</span>
<span class="nc" id="L365">        (TreeSelectionModel.SINGLE_TREE_SELECTION);</span>
<span class="nc" id="L366">        m_treeRAT.addTreeSelectionListener(this);</span>
        //m_treeRAT.setPreferredSize(new Dimension(200, 100));

<span class="nc" id="L369">        JScrollPane treeViewRAT = new JScrollPane(m_treeRAT);</span>
<span class="nc" id="L370">        treeViewRAT.setPreferredSize(new Dimension(300, 200));</span>
<span class="nc" id="L371">        m_pRAT.add(treeViewRAT, c);</span>

        //construct the RAT Generator panel
<span class="nc" id="L374">        m_pRATGen.setLayout(new GridBagLayout());</span>
        //put the general options and the unit-specific options into a single panel so they scroll together.
<span class="nc" id="L376">        JPanel pRATGenTop = new JPanel(new GridBagLayout());</span>

<span class="nc" id="L378">        c = new GridBagConstraints();</span>
<span class="nc" id="L379">        c.gridx = 0;</span>
<span class="nc" id="L380">        c.gridy = 0;</span>
<span class="nc" id="L381">        c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L382">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L383">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L384">        c.weightx = 1.0;</span>
<span class="nc" id="L385">        c.weighty = 0.5;</span>
<span class="nc" id="L386">        m_pRATGen.add(new JScrollPane(pRATGenTop), c);</span>
        
<span class="nc" id="L388">        m_pRATGenOptions = new ForceGenerationOptionsPanel(ForceGenerationOptionsPanel.Use.RAT_GENERATOR);</span>
<span class="nc" id="L389">        m_pFormationOptions = new ForceGenerationOptionsPanel(ForceGenerationOptionsPanel.Use.FORMATION_BUILDER);</span>
        
<span class="nc" id="L391">        c = new GridBagConstraints();</span>
<span class="nc" id="L392">        c.gridx = 0;</span>
<span class="nc" id="L393">        c.gridy = 0;</span>
<span class="nc" id="L394">        c.gridwidth = 1;</span>
<span class="nc" id="L395">        c.fill = GridBagConstraints.EAST;</span>
<span class="nc" id="L396">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L397">        c.weightx = 1.0;</span>
<span class="nc" id="L398">        c.weighty = 0.0;</span>
<span class="nc" id="L399">        pRATGenTop.add(m_pRATGenOptions, c);</span>
<span class="nc" id="L400">        m_pRATGenOptions.setYear(m_clientgui.getClient().getGame().getOptions()</span>
<span class="nc" id="L401">                .intOption(&quot;year&quot;));</span>
        
<span class="nc" id="L403">        c = new GridBagConstraints();</span>
<span class="nc" id="L404">        c.gridx = 0;</span>
<span class="nc" id="L405">        c.gridy = 1;</span>
<span class="nc" id="L406">        c.gridwidth = 1;</span>
<span class="nc" id="L407">        c.fill = GridBagConstraints.EAST;</span>
<span class="nc" id="L408">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L409">        c.weightx = 1.0;</span>
<span class="nc" id="L410">        c.weighty = 0.0;</span>
<span class="nc" id="L411">        pRATGenTop.add(m_pUnitTypeOptions, c);</span>

<span class="nc" id="L413">        c = new GridBagConstraints();</span>
<span class="nc" id="L414">        c.gridx = 0;</span>
<span class="nc" id="L415">        c.gridy = 1;</span>
<span class="nc" id="L416">        c.gridwidth = 1;</span>
<span class="nc" id="L417">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L418">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L419">        c.weightx = 0.0;</span>
<span class="nc" id="L420">        c.weighty = 0.0;</span>
<span class="nc" id="L421">        m_pRATGen.add(m_bGenerate, c);</span>
<span class="nc" id="L422">        m_bGenerate.setToolTipText(Messages.getString(&quot;RandomArmyDialog.Generate.tooltip&quot;));</span>
<span class="nc" id="L423">        m_bGenerate.addActionListener(this);</span>
        
<span class="nc" id="L425">        c = new GridBagConstraints();</span>
<span class="nc" id="L426">        c.gridx = 1;</span>
<span class="nc" id="L427">        c.gridy = 1;</span>
<span class="nc" id="L428">        c.gridwidth = 1;</span>
<span class="nc" id="L429">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L430">        c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L431">        c.weightx = 0.0;</span>
<span class="nc" id="L432">        c.weighty = 0.0;</span>
<span class="nc" id="L433">        m_pRATGen.add(m_bAddToForce, c);</span>
<span class="nc" id="L434">        m_bAddToForce.setToolTipText(Messages.getString(&quot;RandomArmyDialog.AddToForce.tooltip&quot;));</span>
<span class="nc" id="L435">        m_bAddToForce.addActionListener(this);</span>
        
<span class="nc" id="L437">        ratModel = new RATTableModel();</span>
<span class="nc" id="L438">        m_lRAT = new JTable();</span>
<span class="nc" id="L439">        m_lRAT.setModel(ratModel);</span>
<span class="nc" id="L440">        m_lRAT.setIntercellSpacing(new Dimension(5, 0));</span>
<span class="nc" id="L441">        m_lRAT.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
<span class="nc bnc" id="L442" title="All 2 branches missed.">        for (int i = 0; i &lt; ratModel.getColumnCount(); i++) {</span>
<span class="nc" id="L443">        	m_lRAT.getColumnModel().getColumn(i).setPreferredWidth(ratModel.getPreferredWidth(i));</span>
        }
<span class="nc" id="L445">		DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();</span>
<span class="nc" id="L446">		rightRenderer.setHorizontalAlignment(JLabel.RIGHT);</span>
<span class="nc" id="L447">		m_lRAT.getColumnModel().getColumn(RATTableModel.COL_BV).setCellRenderer(rightRenderer);</span>
<span class="nc" id="L448">        c = new GridBagConstraints();</span>
<span class="nc" id="L449">        c.gridx = 0;</span>
<span class="nc" id="L450">        c.gridy = 2;</span>
<span class="nc" id="L451">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L452">        c.gridwidth = GridBagConstraints.REMAINDER;</span>
<span class="nc" id="L453">        c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L454">        c.weightx = 1.0;</span>
<span class="nc" id="L455">        c.weighty = 0.5;</span>
<span class="nc" id="L456">        m_pRATGen.add(new JScrollPane(m_lRAT), c);</span>

        // formation builder tab
<span class="nc" id="L459">        m_pFormations.setLayout(new BorderLayout());</span>

<span class="nc" id="L461">        m_pFormations.add(new JScrollPane(m_pFormationOptions), BorderLayout.CENTER);</span>
<span class="nc" id="L462">        m_pFormationOptions.setYear(m_clientgui.getClient().getGame().getOptions()</span>
<span class="nc" id="L463">                .intOption(&quot;year&quot;));</span>
        
<span class="nc" id="L465">        m_pForceGen = new ForceGeneratorViewUi(cl);</span>

        // construct the preview panel
<span class="nc" id="L468">        m_pPreview.setLayout(new GridBagLayout());</span>
<span class="nc" id="L469">        unitsModel = new UnitTableModel();</span>
<span class="nc" id="L470">        m_lUnits = new JTable();</span>
<span class="nc" id="L471">        m_lUnits.setModel(unitsModel);</span>
<span class="nc" id="L472">        m_lUnits.setIntercellSpacing(new Dimension(0, 0));</span>
<span class="nc" id="L473">        m_lUnits.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
<span class="nc" id="L474">        JScrollPane scroll = new JScrollPane(m_lUnits);</span>
<span class="nc" id="L475">        scroll.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;RandomArmyDialog.SelectedUnits&quot;)));</span>
<span class="nc" id="L476">        c = new GridBagConstraints();</span>
<span class="nc" id="L477">        c.gridx = 0;</span>
<span class="nc" id="L478">        c.gridy = 0;</span>
<span class="nc" id="L479">        c.gridwidth = 4;</span>
<span class="nc" id="L480">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L481">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L482">        c.weightx = 1.0;</span>
<span class="nc" id="L483">        c.weighty = 1.0;</span>
<span class="nc" id="L484">        m_pPreview.add(scroll, c);</span>
<span class="nc" id="L485">        c = new GridBagConstraints();</span>
<span class="nc" id="L486">        c.gridx = 0;</span>
<span class="nc" id="L487">        c.gridy = 1;</span>
<span class="nc" id="L488">        c.gridwidth = 1;</span>
<span class="nc" id="L489">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L490">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L491">        c.weightx = 0.0;</span>
<span class="nc" id="L492">        c.weighty = 0.0;</span>
<span class="nc" id="L493">        m_bRoll.addActionListener(this);</span>
<span class="nc" id="L494">        m_pPreview.add(m_bRoll,c);</span>
<span class="nc" id="L495">        c.gridx = 1;</span>
<span class="nc" id="L496">        m_bAddAll.addActionListener(this);</span>
<span class="nc" id="L497">        m_pPreview.add(m_bAddAll,c);</span>
<span class="nc" id="L498">        c.gridx = 2;</span>
<span class="nc" id="L499">        m_bAdd.addActionListener(this);</span>
<span class="nc" id="L500">        m_pPreview.add(m_bAdd,c);</span>
<span class="nc" id="L501">        c.gridx = 3;</span>
<span class="nc" id="L502">        m_bClear.addActionListener(this);</span>
<span class="nc" id="L503">        m_pPreview.add(m_bClear,c);</span>
<span class="nc" id="L504">        armyModel = new UnitTableModel();</span>
<span class="nc" id="L505">        m_lArmy = new JTable();</span>
<span class="nc" id="L506">        m_lArmy.setModel(armyModel);</span>
<span class="nc" id="L507">        m_lArmy.setIntercellSpacing(new Dimension(0, 0));</span>
<span class="nc" id="L508">        m_lArmy.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</span>
<span class="nc" id="L509">        scroll = new JScrollPane(m_lArmy);</span>
<span class="nc" id="L510">        scroll.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;RandomArmyDialog.Army&quot;)));</span>
<span class="nc" id="L511">        c = new GridBagConstraints();</span>
<span class="nc" id="L512">        c.gridx = 0;</span>
<span class="nc" id="L513">        c.gridy = 2;</span>
<span class="nc" id="L514">        c.gridwidth = 4;</span>
<span class="nc" id="L515">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L516">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L517">        c.weightx = 1.0;</span>
<span class="nc" id="L518">        c.weighty = 1.0;</span>
<span class="nc" id="L519">        m_pPreview.add(scroll, c);</span>

<span class="nc" id="L521">        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.BVtab&quot;), m_pParameters);</span>
<span class="nc" id="L522">        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.RATtab&quot;), m_pRAT);</span>
<span class="nc" id="L523">        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.RATGentab&quot;), m_pRATGen);</span>
<span class="nc" id="L524">        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.Formationtab&quot;), m_pFormations);</span>
<span class="nc" id="L525">        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.Forcetab&quot;), m_pForceGen.getLeftPanel());</span>
<span class="nc" id="L526">        m_pMain.addChangeListener(ev -&gt; {</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">            if (m_pMain.getSelectedIndex() == TAB_FORCE_GENERATOR) {</span>
<span class="nc" id="L528">                m_lRightCards.show(m_pRightPane, CARD_FORCE_TREE);</span>
<span class="nc" id="L529">                this.m_bRandomSkills.setEnabled(false);</span>
            } else {
<span class="nc" id="L531">                m_lRightCards.show(m_pRightPane, CARD_PREVIEW);</span>
<span class="nc" id="L532">                this.m_bRandomSkills.setEnabled(true);</span>
            }
<span class="nc" id="L534">        });</span>
        
<span class="nc" id="L536">        m_pRightPane.add(m_pPreview, CARD_PREVIEW);</span>
<span class="nc" id="L537">        m_pRightPane.add(m_pForceGen.getRightPanel(), CARD_FORCE_TREE);</span>
        
<span class="nc" id="L539">        m_pSplit = new javax.swing.JSplitPane(javax.swing.JSplitPane.HORIZONTAL_SPLIT,m_pMain, m_pRightPane);</span>
<span class="nc" id="L540">        m_pSplit.setOneTouchExpandable(false);</span>
<span class="nc" id="L541">        m_pSplit.setResizeWeight(0.5);</span>

        // construct the main dialog
<span class="nc" id="L544">        setLayout(new BorderLayout());</span>
<span class="nc" id="L545">        this.setPreferredSize(new Dimension(800,500));</span>
<span class="nc" id="L546">        add(m_pButtons, BorderLayout.SOUTH);</span>
<span class="nc" id="L547">        add(m_pSplit, BorderLayout.CENTER);</span>
<span class="nc" id="L548">        validate();</span>
<span class="nc" id="L549">        pack();</span>
<span class="nc" id="L550">        setLocationRelativeTo(cl.frame);</span>
        
<span class="nc" id="L552">        m_client.getGame().addGameListener(gameListener);</span>
<span class="nc" id="L553">    }</span>

    public void valueChanged(TreeSelectionEvent ev) {
<span class="nc bnc" id="L556" title="All 2 branches missed.">        if (ev.getSource().equals(m_treeRAT)) {</span>
<span class="nc" id="L557">            DefaultMutableTreeNode node = (DefaultMutableTreeNode)m_treeRAT.getLastSelectedPathComponent();</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">            if (node == null) {</span>
<span class="nc" id="L559">                return;</span>
            }

<span class="nc" id="L562">            Object nodeInfo = node.getUserObject();</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">            if (node.isLeaf()) {</span>
<span class="nc" id="L564">                String ratName = (String)nodeInfo;</span>
<span class="nc" id="L565">                rug.setChosenRAT(ratName);</span>
            }
        }
<span class="nc" id="L568">    }</span>

    public void actionPerformed(ActionEvent ev) {
<span class="nc bnc" id="L571" title="All 2 branches missed.">        if (ev.getSource().equals(m_bOK)) {</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">            if (m_pMain.getSelectedIndex() == TAB_FORCE_GENERATOR) {</span>
<span class="nc" id="L573">                m_pForceGen.addChosenUnits((String) m_chPlayer.getSelectedItem());</span>
            } else {
<span class="nc" id="L575">                ArrayList&lt;Entity&gt; entities = new ArrayList&lt;&gt;(</span>
<span class="nc" id="L576">                        armyModel.getAllUnits().size());</span>
<span class="nc" id="L577">                Client c = null;</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">                if (m_chPlayer.getSelectedIndex() &gt; 0) {</span>
<span class="nc" id="L579">                    String name = (String) m_chPlayer.getSelectedItem();</span>
<span class="nc" id="L580">                    c = m_clientgui.getBots().get(name);</span>
                }
<span class="nc bnc" id="L582" title="All 2 branches missed.">                if (c == null) {</span>
<span class="nc" id="L583">                    c = m_client;</span>
                }
<span class="nc bnc" id="L585" title="All 2 branches missed.">                for (MechSummary ms : armyModel.getAllUnits()) {</span>
                    try {
<span class="nc" id="L587">                        Entity e = new MechFileParser(ms.getSourceFile(), </span>
<span class="nc" id="L588">                                ms.getEntryName()).getEntity();</span>
      
<span class="nc" id="L590">                        autoSetSkillsAndName(e);</span>
<span class="nc" id="L591">                        e.setOwner(c.getLocalPlayer());</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">                        if (c.getGame().getPhase() != Phase.PHASE_LOUNGE){</span>
<span class="nc" id="L593">                            e.setDeployRound(c.getGame().getRoundCount()+1);</span>
<span class="nc" id="L594">                            e.setGame(c.getGame());</span>
                            // Set these to true, otherwise units reinforced in
                            // the movement turn are considered selectable
<span class="nc" id="L597">                            e.setDone(true);</span>
<span class="nc" id="L598">                            e.setUnloaded(true);</span>
                        }
<span class="nc" id="L600">                        entities.add(e);</span>
<span class="nc" id="L601">                    } catch (EntityLoadingException ex) {</span>
<span class="nc" id="L602">                        System.out.println(&quot;Unable to load mech: &quot; + //$NON-NLS-1$ </span>
<span class="nc" id="L603">                                ms.getSourceFile() + &quot;: &quot; + ms.getEntryName() + //$NON-NLS-1$</span>
<span class="nc" id="L604">                                &quot;: &quot; + ex.getMessage()); //$NON-NLS-1$ </span>
<span class="nc" id="L605">                        ex.printStackTrace();</span>
<span class="nc" id="L606">                        return;</span>
<span class="nc" id="L607">                    }</span>
<span class="nc" id="L608">                }</span>
<span class="nc" id="L609">                c.sendAddEntity(entities);</span>
<span class="nc" id="L610">                armyModel.clearData();</span>
<span class="nc" id="L611">                unitsModel.clearData();</span>
            }
            
            // Save preferences
<span class="nc" id="L615">            GUIPreferences guip = GUIPreferences.getInstance();</span>
<span class="nc" id="L616">            guip.setRATBVMin(m_tBVmin.getText());</span>
<span class="nc" id="L617">            guip.setRATBVMax(m_tBVmax.getText());</span>
<span class="nc" id="L618">            guip.setRATNumMechs(m_tMechs.getText());</span>
<span class="nc" id="L619">            guip.setRATNumVees(m_tVees.getText());</span>
<span class="nc" id="L620">            guip.setRATNumBA(m_tBA.getText());</span>
<span class="nc" id="L621">            guip.setRATNumInf(m_tInfantry.getText());</span>
<span class="nc" id="L622">            guip.setRATYearMin(m_tMinYear.getText());</span>
<span class="nc" id="L623">            guip.setRATYearMax(m_tMaxYear.getText());</span>
<span class="nc" id="L624">            guip.setRATPadBV(m_chkPad.isSelected());</span>
<span class="nc" id="L625">            guip.setRATTechLevel(m_chType.getSelectedIndex());</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">            if (m_treeRAT.getSelectionPath() != null) {</span>
<span class="nc" id="L627">                guip.setRATSelectedRAT(m_treeRAT.getSelectionPath().toString());</span>
            } else {
<span class="nc" id="L629">                guip.setRATSelectedRAT(&quot;&quot;);</span>
            }
            
<span class="nc" id="L632">            setVisible(false);</span>
<span class="nc bnc" id="L633" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bClear)) {</span>
<span class="nc" id="L634">            armyModel.clearData();</span>
<span class="nc" id="L635">            unitsModel.clearData();</span>
<span class="nc bnc" id="L636" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bCancel)) {</span>
<span class="nc" id="L637">             armyModel.clearData();</span>
<span class="nc" id="L638">             unitsModel.clearData();</span>
<span class="nc" id="L639">            setVisible(false);</span>
<span class="nc bnc" id="L640" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bAddAll)) {</span>
<span class="nc bnc" id="L641" title="All 2 branches missed.">            for (MechSummary m : unitsModel.getAllUnits()) {</span>
<span class="nc" id="L642">                armyModel.addUnit(m);</span>
<span class="nc" id="L643">            }</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bAdd)) {</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">            for(int sel : m_lUnits.getSelectedRows()) {</span>
<span class="nc" id="L646">                MechSummary m = unitsModel.getUnitAt(sel);</span>
<span class="nc" id="L647">                armyModel.addUnit(m);</span>
            }
<span class="nc bnc" id="L649" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bAdvSearch)){</span>
<span class="nc" id="L650">            searchFilter=asd.showDialog();</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">            m_bAdvSearchClear.setEnabled(searchFilter!=null);</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bAdvSearchClear)){</span>
<span class="nc" id="L653">            searchFilter=null;</span>
<span class="nc" id="L654">            m_bAdvSearchClear.setEnabled(false);</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bRoll)) {</span>
<span class="nc" id="L656">            setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));</span>
            try {
<span class="nc bnc" id="L658" title="All 2 branches missed.">                if(m_pMain.getSelectedIndex() == TAB_RAT) {</span>
<span class="nc" id="L659">                    int units = Integer.parseInt(m_tUnits.getText());</span>
<span class="nc bnc" id="L660" title="All 2 branches missed.">                    if(units &gt; 0) {</span>
<span class="nc" id="L661">                        unitsModel.setData(RandomUnitGenerator.getInstance().generate(units));</span>
                    }
<span class="nc bnc" id="L663" title="All 2 branches missed.">                } else if (m_pMain.getSelectedIndex() == TAB_RAT_GENERATOR) {</span>
<span class="nc" id="L664">                	int units = m_pRATGenOptions.getNumUnits();</span>
<span class="nc bnc" id="L665" title="All 6 branches missed.">                	if (units &gt; 0 &amp;&amp; generatedRAT != null &amp;&amp; generatedRAT.getNumEntries() &gt; 0) {</span>
<span class="nc" id="L666">                		unitsModel.setData(generatedRAT.generateUnits(units));</span>
                	}
                	//generateUnits removes salvage entries that have no units meeting criteria
<span class="nc" id="L669">                	ratModel.refreshData();</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">                } else if (m_pMain.getSelectedIndex() == TAB_FORMATION_BUILDER) {</span>
<span class="nc" id="L671">                    ArrayList&lt;MechSummary&gt; unitList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L672">                    FactionRecord fRec = m_pFormationOptions.getFaction();</span>
<span class="nc" id="L673">                    FormationType ft = FormationType.getFormationType(m_pFormationOptions.getStringOption(&quot;formationType&quot;));</span>
<span class="nc" id="L674">                    List&lt;UnitTable.Parameters&gt; params = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L675">                    params.add(new UnitTable.Parameters(fRec,</span>
<span class="nc" id="L676">                            m_pFormationOptions.getUnitType(),</span>
<span class="nc" id="L677">                            m_pFormationOptions.getYear(),</span>
<span class="nc" id="L678">                            m_pFormationOptions.getRating(), null,</span>
                            ModelRecord.NETWORK_NONE,
<span class="nc" id="L680">                            java.util.EnumSet.noneOf(EntityMovementMode.class),</span>
<span class="nc" id="L681">                            java.util.EnumSet.noneOf(MissionRole.class), 0, fRec));</span>
<span class="nc" id="L682">                    List&lt;Integer&gt; numUnits = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L683">                    numUnits.add(m_pFormationOptions.getNumUnits());</span>
                    
<span class="nc bnc" id="L685" title="All 2 branches missed.">                    if (m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;) &gt; 0) {</span>
<span class="nc bnc" id="L686" title="All 2 branches missed.">                        if (m_pFormationOptions.getIntegerOption(&quot;otherUnitType&quot;) &gt;= 0) {</span>
<span class="nc" id="L687">                            params.add(new UnitTable.Parameters(fRec,</span>
<span class="nc" id="L688">                                    m_pFormationOptions.getIntegerOption(&quot;otherUnitType&quot;),</span>
<span class="nc" id="L689">                                    m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</span>
                                    ModelRecord.NETWORK_NONE,
<span class="nc" id="L691">                                    java.util.EnumSet.noneOf(EntityMovementMode.class),</span>
<span class="nc" id="L692">                                    java.util.EnumSet.noneOf(MissionRole.class), 0, fRec));</span>
<span class="nc" id="L693">                            numUnits.add(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">                        } else if (m_pFormationOptions.getBooleanOption(&quot;mechBA&quot;)) {</span>
                            // Make sure at least a number units equals to the number of BA points/squads are omni
<span class="nc" id="L696">                            numUnits.set(0, Math.min(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;),</span>
<span class="nc" id="L697">                                    m_pFormationOptions.getNumUnits()));</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">                            if (m_pFormationOptions.getNumUnits() &gt; m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;)) {</span>
<span class="nc" id="L699">                                params.add(params.get(0).copy());</span>
<span class="nc" id="L700">                                numUnits.add(m_pFormationOptions.getNumUnits() - m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</span>
                            }
<span class="nc" id="L702">                            params.get(0).getRoles().add(MissionRole.MECHANIZED_BA);</span>
                            //BA do not count for formation rules; add as a separate formation
                        }
                    }
                    
<span class="nc bnc" id="L707" title="All 2 branches missed.">                    if (ft != null) {</span>
<span class="nc" id="L708">                        unitList.addAll(ft.generateFormation(params,</span>
<span class="nc" id="L709">                                numUnits, m_pFormationOptions.getIntegerOption(&quot;network&quot;), false));</span>
<span class="nc bnc" id="L710" title="All 4 branches missed.">                        if (unitList.size() &gt; 0 &amp;&amp; m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;) &gt; 0) {</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">                            if (m_pFormationOptions.getBooleanOption(&quot;mechBA&quot;)) {</span>
                                /* Try to generate the BA portion using the same formation type as the
                                 * parent, otherwise generate randomly.
                                 */
<span class="nc" id="L715">                                UnitTable.Parameters p = new UnitTable.Parameters(fRec, UnitType.BATTLE_ARMOR,</span>
<span class="nc" id="L716">                                        m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</span>
                                        ModelRecord.NETWORK_NONE,
<span class="nc" id="L718">                                        java.util.EnumSet.noneOf(EntityMovementMode.class),</span>
<span class="nc" id="L719">                                        java.util.EnumSet.of(MissionRole.MECHANIZED_BA), 0, fRec);</span>
<span class="nc" id="L720">                                List&lt;MechSummary&gt; ba = ft.generateFormation(p,</span>
<span class="nc" id="L721">                                        m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;),</span>
                                        ModelRecord.NETWORK_NONE, true);
<span class="nc bnc" id="L723" title="All 2 branches missed.">                                if (ba.isEmpty()) {</span>
<span class="nc" id="L724">                                    ba = UnitTable.findTable(p).generateUnits(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</span>
                                }
<span class="nc" id="L726">                                unitList.addAll(ba);</span>
<span class="nc bnc" id="L727" title="All 2 branches missed.">                            } else if (m_pFormationOptions.getBooleanOption(&quot;airLance&quot;)) {</span>
<span class="nc" id="L728">                                UnitTable t = UnitTable.findTable(fRec, UnitType.AERO,</span>
<span class="nc" id="L729">                                        m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</span>
                                        ModelRecord.NETWORK_NONE,
<span class="nc" id="L731">                                        java.util.EnumSet.noneOf(EntityMovementMode.class),</span>
<span class="nc" id="L732">                                        java.util.EnumSet.noneOf(MissionRole.class), 0, fRec);</span>
<span class="nc" id="L733">                                MechSummary unit = t.generateUnit();</span>
<span class="nc bnc" id="L734" title="All 2 branches missed.">                                if (unit != null) {</span>
<span class="nc" id="L735">                                    unitList.add(unit);</span>
<span class="nc" id="L736">                                    MechSummary unit2 = t.generateUnit(ms -&gt; ms.getChassis().equals(unit.getChassis()));</span>
<span class="nc bnc" id="L737" title="All 2 branches missed.">                                    if (unit2 != null) {</span>
<span class="nc" id="L738">                                        unitList.add(unit2);</span>
                                    } else {
<span class="nc" id="L740">                                        unitList.add(unit);</span>
                                    }
                                }
<span class="nc" id="L743">                            }</span>
                        }
                    } else {
<span class="nc" id="L746">                        System.err.println(&quot;Could not find formation type &quot; + m_pFormationOptions.getStringOption(&quot;formationType&quot;));</span>
                    }                      
<span class="nc" id="L748">                    unitsModel.setData(unitList);</span>
<span class="nc" id="L749">                    m_pFormationOptions.updateGeneratedUnits(unitList);</span>
<span class="nc" id="L750">                } else {</span>
<span class="nc" id="L751">                    RandomArmyCreator.Parameters p = new RandomArmyCreator.Parameters();</span>
<span class="nc" id="L752">                    p.advancedSearchFilter=searchFilter;</span>
<span class="nc" id="L753">                    p.mechs = Integer.parseInt(m_tMechs.getText());</span>
<span class="nc" id="L754">                    p.tanks = Integer.parseInt(m_tVees.getText());</span>
<span class="nc" id="L755">                    p.ba = Integer.parseInt(m_tBA.getText());</span>
<span class="nc" id="L756">                    p.infantry = Integer.parseInt(m_tInfantry.getText());</span>
<span class="nc" id="L757">                    p.canon = m_chkCanon.isSelected();</span>
<span class="nc" id="L758">                    p.maxBV = Integer.parseInt(m_tBVmax.getText());</span>
<span class="nc" id="L759">                    p.minBV = Integer.parseInt(m_tBVmin.getText());</span>
<span class="nc" id="L760">                    p.padWithInfantry = m_chkPad.isSelected();</span>
<span class="nc" id="L761">                    p.tech = m_chType.getSelectedIndex();</span>
<span class="nc" id="L762">                    p.minYear = Integer.parseInt(m_tMinYear.getText());</span>
<span class="nc" id="L763">                    p.maxYear = Integer.parseInt(m_tMaxYear.getText());</span>
<span class="nc" id="L764">                    unitsModel.setData(RandomArmyCreator.generateArmy(p));</span>
                }
<span class="nc" id="L766">            } catch (NumberFormatException ignored) {</span>
            } finally {
<span class="nc" id="L768">                setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));</span>
<span class="nc" id="L769">            }</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bGenerate)) {</span>
<span class="nc" id="L771">        	generateRAT();</span>
<span class="nc bnc" id="L772" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bAddToForce)) {</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">            for (int sel : m_lRAT.getSelectedRows()) {</span>
<span class="nc" id="L774">                MechSummary ms = generatedRAT.getMechSummary(sel);</span>
<span class="nc bnc" id="L775" title="All 2 branches missed.">                if (ms != null) {</span>
<span class="nc" id="L776">                	armyModel.addUnit(ms);</span>
                }
            }
<span class="nc bnc" id="L779" title="All 2 branches missed.">        } else if (ev.getSource().equals(rug)) {</span>
<span class="nc" id="L780">            m_ratStatus.setText(Messages.getString(&quot;RandomArmyDialog.ratStatusDoneLoading&quot;));</span>
<span class="nc" id="L781">            updateRATs();</span>
<span class="nc bnc" id="L782" title="All 2 branches missed.">        } else if (ev.getSource().equals(m_bRandomSkills)) {</span>
<span class="nc" id="L783">            m_clientgui.getRandomSkillDialog().showDialog();</span>
        }
<span class="nc" id="L785">    }</span>

    public void windowActivated(WindowEvent arg0) {
        //ignored
<span class="nc" id="L789">    }</span>

    public void windowClosed(WindowEvent arg0) {
        //ignored
<span class="nc" id="L793">    }</span>

    public void windowClosing(WindowEvent arg0) {
<span class="nc" id="L796">        setVisible(false);</span>
<span class="nc" id="L797">    }</span>

    public void windowDeactivated(WindowEvent arg0) {
        //ignored
<span class="nc" id="L801">    }</span>

    public void windowDeiconified(WindowEvent arg0) {
        //ignored
<span class="nc" id="L805">    }</span>

    public void windowIconified(WindowEvent arg0) {
        //ignored
<span class="nc" id="L809">    }</span>

    public void windowOpened(WindowEvent arg0) {
        //ignored
<span class="nc" id="L813">    }</span>

	private void updatePlayerChoice() {
<span class="nc" id="L816">        String lastChoice = (String) m_chPlayer.getSelectedItem();</span>
<span class="nc" id="L817">        String clientName = m_clientgui.getClient().getName();</span>
<span class="nc" id="L818">        m_chPlayer.removeAllItems();</span>
<span class="nc" id="L819">        m_chPlayer.setEnabled(true);</span>
<span class="nc" id="L820">        m_chPlayer.addItem(clientName);</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">        for (Client client : m_clientgui.getBots().values()) {</span>
<span class="nc" id="L822">            IPlayer player = m_client.getGame().getPlayer(client.getLocalPlayerNumber());</span>

<span class="nc bnc" id="L824" title="All 2 branches missed.">            if (!player.isObserver()) {</span>
<span class="nc" id="L825">                m_chPlayer.addItem(client.getName());</span>
            }
<span class="nc" id="L827">        }</span>
<span class="nc bnc" id="L828" title="All 2 branches missed.">        if (m_chPlayer.getItemCount() == 1) {</span>
<span class="nc" id="L829">            m_chPlayer.setEnabled(false);</span>
        }
<span class="nc" id="L831">        m_chPlayer.setSelectedItem(lastChoice);</span>
<span class="nc bnc" id="L832" title="All 2 branches missed.">        if (m_chPlayer.getSelectedIndex() &lt; 0) {</span>
<span class="nc" id="L833">            m_chPlayer.setSelectedIndex(0);</span>
        }
<span class="nc" id="L835">    }</span>

    private void updateTechChoice() {
<span class="nc" id="L838">        final int gameTL = TechConstants.getSimpleLevel(m_client.getGame()</span>
<span class="nc" id="L839">                .getOptions().stringOption(OptionsConstants.ALLOWED_TECHLEVEL));</span>
        final int maxTech;
<span class="nc bnc" id="L841" title="All 6 branches missed.">        switch (gameTL) {</span>
            case TechConstants.T_SIMPLE_INTRO:
<span class="nc" id="L843">                maxTech = TechConstants.T_INTRO_BOXSET;</span>
<span class="nc" id="L844">                break;</span>
            case TechConstants.T_SIMPLE_STANDARD:
<span class="nc" id="L846">                maxTech = TechConstants.T_TW_ALL;</span>
<span class="nc" id="L847">                break;</span>
            case TechConstants.T_SIMPLE_ADVANCED:
<span class="nc" id="L849">                maxTech = TechConstants.T_CLAN_ADVANCED;</span>
<span class="nc" id="L850">                break;</span>
            case TechConstants.T_SIMPLE_EXPERIMENTAL:
<span class="nc" id="L852">                maxTech = TechConstants.T_CLAN_EXPERIMENTAL;</span>
<span class="nc" id="L853">                break;</span>
            case TechConstants.T_SIMPLE_UNOFFICIAL:
<span class="nc" id="L855">                maxTech = TechConstants.T_ALL;</span>
<span class="nc" id="L856">                break;</span>
            default:
<span class="nc" id="L858">                maxTech = TechConstants.T_TW_ALL;</span>
                break;
        }

<span class="nc" id="L862">        m_chType.removeAllItems();</span>
<span class="nc bnc" id="L863" title="All 2 branches missed.">        for (int i = 0; i &lt;= maxTech; i++) {</span>
<span class="nc" id="L864">            m_chType.addItem(TechConstants.getLevelDisplayableName(i));</span>
        }
<span class="nc" id="L866">        m_chType.setSelectedIndex(Math.min(GUIPreferences.getInstance().getRATTechLevel(), maxTech));</span>
<span class="nc" id="L867">    }</span>

    private void updateRATs() {
<span class="nc" id="L870">        Iterator&lt;String&gt; rats = rug.getRatList();</span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">        if (null == rats) {</span>
<span class="nc" id="L872">            return;</span>
        }  
        
<span class="nc" id="L875">        RandomUnitGenerator.RatTreeNode ratTree = rug.getRatTree();</span>
<span class="nc" id="L876">        DefaultMutableTreeNode root = new DefaultMutableTreeNode(ratTree.name);</span>
<span class="nc" id="L877">        createRatTreeNodes(root, ratTree);</span>
<span class="nc" id="L878">        m_treeRAT.setModel(new DefaultTreeModel(root));</span>
        
        String selectedRATPath = 
<span class="nc" id="L881">                GUIPreferences.getInstance().getRATSelectedRAT();</span>
<span class="nc bnc" id="L882" title="All 2 branches missed.">        if (!selectedRATPath.equals(&quot;&quot;)) {</span>
<span class="nc" id="L883">            String[] nodes = selectedRATPath.replace('[', ' ')</span>
<span class="nc" id="L884">                    .replace(']', ' ').split(&quot;,&quot;);</span>
<span class="nc" id="L885">            TreePath path = findPathByName(nodes);</span>
<span class="nc" id="L886">            m_treeRAT.setSelectionPath(path);</span>
        }
<span class="nc" id="L888">    }</span>
    
    private void updateRATYear() {
<span class="nc" id="L891">        int gameYear = m_clientgui.getClient().getGame().getOptions().intOption(&quot;year&quot;);</span>
        
<span class="nc" id="L893">        m_pRATGenOptions.setYear(gameYear);</span>
<span class="nc" id="L894">        m_pFormationOptions.setYear(gameYear);</span>
<span class="nc" id="L895">        m_pForceGen.setYear(gameYear);</span>
<span class="nc" id="L896">    }</span>

    private void createRatTreeNodes(DefaultMutableTreeNode parentNode, RandomUnitGenerator.RatTreeNode ratTreeNode) {
<span class="nc bnc" id="L899" title="All 2 branches missed.">        for (RandomUnitGenerator.RatTreeNode child : ratTreeNode.children) {</span>
<span class="nc" id="L900">            DefaultMutableTreeNode newNode = new DefaultMutableTreeNode(child.name);</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">            if (child.children.size() &gt; 0) {</span>
<span class="nc" id="L902">                createRatTreeNodes(newNode, child);</span>
            }
<span class="nc" id="L904">            parentNode.add(newNode);</span>
<span class="nc" id="L905">        }</span>
<span class="nc" id="L906">    }</span>
    
    private TreePath findPathByName(String[] nodeNames) {
<span class="nc" id="L909">        TreeNode root = (TreeNode)m_treeRAT.getModel().getRoot();</span>
<span class="nc" id="L910">        return findNextNode(new TreePath(root), nodeNames, 0);</span>
    }
    
    private TreePath findNextNode(TreePath parent, String[] nodes, int depth) {
<span class="nc" id="L914">        TreeNode node = (TreeNode)parent.getLastPathComponent();</span>
<span class="nc" id="L915">        String currNode = node.toString();</span>

        // If equal, go down the branch
<span class="nc bnc" id="L918" title="All 2 branches missed.">        if (currNode.equals(nodes[depth].trim())) {</span>
            // If at end, return match
<span class="nc bnc" id="L920" title="All 2 branches missed.">            if (depth == nodes.length-1) {</span>
<span class="nc" id="L921">                return parent;</span>
            }

            // Traverse children
<span class="nc bnc" id="L925" title="All 2 branches missed.">            if (node.getChildCount() &gt;= 0) {</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">                for (Enumeration&lt;?&gt; e = node.children(); e.hasMoreElements(); ) {</span>
<span class="nc" id="L927">                    TreeNode n = (TreeNode)e.nextElement();</span>
<span class="nc" id="L928">                    TreePath path = parent.pathByAddingChild(n);</span>
<span class="nc" id="L929">                    TreePath result = findNextNode(path, nodes, depth + 1);</span>
                    // Found a match
<span class="nc bnc" id="L931" title="All 2 branches missed.">                    if (result != null) {</span>
<span class="nc" id="L932">                        return result;</span>
                    }
<span class="nc" id="L934">                }</span>
            }
        }
        // No match at this branch
<span class="nc" id="L938">        return null;</span>
    }
    
    @SuppressWarnings(&quot;unchecked&quot;)
    private void generateRAT() {
<span class="nc" id="L943">    	FactionRecord fRec = m_pRATGenOptions.getFaction();</span>
<span class="nc bnc" id="L944" title="All 2 branches missed.">    	if (fRec != null) {</span>
<span class="nc" id="L945">			generatedRAT = UnitTable.findTable(fRec, m_pRATGenOptions.getUnitType(),</span>
<span class="nc" id="L946">			        m_pRATGenOptions.getYear(), m_pRATGenOptions.getRating(),</span>
<span class="nc" id="L947">			        (List&lt;Integer&gt;) m_pRATGenOptions.getListOption(&quot;weightClasses&quot;),</span>
<span class="nc" id="L948">					m_pRATGenOptions.getIntegerOption(&quot;networkMask&quot;),</span>
<span class="nc" id="L949">					(List&lt;EntityMovementMode&gt;) m_pRATGenOptions.getListOption(&quot;motiveTypes&quot;),</span>
<span class="nc" id="L950">					(List&lt;MissionRole&gt;) m_pRATGenOptions.getListOption(&quot;roles&quot;),</span>
<span class="nc" id="L951">					m_pRATGenOptions.getIntegerOption(&quot;roleStrictness&quot;));</span>
<span class="nc" id="L952">			ratModel.refreshData();</span>
    	}
<span class="nc" id="L954">    }</span>

    @Override
    public void setVisible(boolean show) {
<span class="nc bnc" id="L958" title="All 2 branches missed.">        if (show) {</span>
<span class="nc" id="L959">            updatePlayerChoice();</span>
<span class="nc" id="L960">            updateTechChoice();</span>
<span class="nc" id="L961">            updateRATs();</span>
        }
<span class="nc" id="L963">        super.setVisible(show);</span>
<span class="nc" id="L964">    }</span>

    private void autoSetSkillsAndName(Entity e) {
<span class="nc" id="L967">        IClientPreferences cs = PreferenceManager.getClientPreferences();</span>
<span class="nc bnc" id="L968" title="All 2 branches missed.">        for (int i = 0; i &lt; e.getCrew().getSlotCount(); i++) {</span>
<span class="nc bnc" id="L969" title="All 2 branches missed.">            if (cs.useAverageSkills()) {</span>
<span class="nc" id="L970">                int[] skills = m_client.getRandomSkillsGenerator().getRandomSkills(e, true);</span>
    
<span class="nc" id="L972">                int gunnery = skills[0];</span>
<span class="nc" id="L973">                int piloting = skills[1];</span>
    
<span class="nc" id="L975">                e.getCrew().setGunnery(gunnery, i);</span>
<span class="nc" id="L976">                e.getCrew().setPiloting(piloting, i);</span>

<span class="nc bnc" id="L978" title="All 2 branches missed.">                if (e.getCrew() instanceof LAMPilot) {</span>
<span class="nc" id="L979">                    skills = m_client.getRandomSkillsGenerator().getRandomSkills(e, true);</span>
<span class="nc" id="L980">                    ((LAMPilot) e.getCrew()).setGunneryAero(skills[0]);</span>
<span class="nc" id="L981">                    ((LAMPilot) e.getCrew()).setPilotingAero(skills[1]);</span>
                }
            }
<span class="nc" id="L984">            e.getCrew().sortRandomSkills();</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">            if (cs.generateNames()) {</span>
<span class="nc" id="L986">                Gender gender = RandomGenderGenerator.generate();</span>
<span class="nc" id="L987">                e.getCrew().setGender(gender, i);</span>
<span class="nc" id="L988">                e.getCrew().setName(RandomNameGenerator.getInstance().generate(gender, (String) m_chPlayer.getSelectedItem()), i);</span>
            }
        }
<span class="nc" id="L991">    }</span>

    /**
     * This class now listens for game settings changes and updates the RAT year whenever
     * the game year changes. Well, whenever any game settings changes.
     */
<span class="nc" id="L997">    private GameListener gameListener = new GameListenerAdapter() {</span>
        @Override
        public void gameSettingsChange(GameSettingsChangeEvent e) {
<span class="nc bnc" id="L1000" title="All 2 branches missed.">            if(!e.isMapSettingsOnlyChange()) {</span>
<span class="nc" id="L1001">                updateRATYear();</span>
            }
<span class="nc" id="L1003">        }</span>
    };
    
    /**
     * A table model for displaying units
     */
    public static class UnitTableModel extends AbstractTableModel {

        private static final long serialVersionUID = 4819661751806908535L;

        private static final int COL_UNIT = 0;
        private static final int COL_BV = 1;
        private static final int COL_MOVE = 2;
        private static final int N_COL = 3;

        private List&lt;MechSummary&gt; data;

<span class="nc" id="L1020">        public UnitTableModel() {</span>
<span class="nc" id="L1021">            data = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1022">        }</span>

        public int getRowCount() {
<span class="nc" id="L1025">            return data.size();</span>
        }

        public void clearData() {
<span class="nc" id="L1029">            data = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L1030">            fireTableDataChanged();</span>
<span class="nc" id="L1031">        }</span>

        public int getColumnCount() {
<span class="nc" id="L1034">            return N_COL;</span>
        }

        public void addUnit(MechSummary m) {
<span class="nc" id="L1038">            data.add(m);</span>
<span class="nc" id="L1039">            fireTableDataChanged();</span>
<span class="nc" id="L1040">        }</span>

        public void setData(List&lt;MechSummary&gt; mechs) {
<span class="nc" id="L1043">            data = mechs;</span>
<span class="nc" id="L1044">            fireTableDataChanged();</span>
<span class="nc" id="L1045">        }</span>

        @Override
        public String getColumnName(int column) {
<span class="nc bnc" id="L1049" title="All 4 branches missed.">            switch (column) {</span>
                case (COL_UNIT):
<span class="nc" id="L1051">                    return Messages.getString(&quot;RandomArmyDialog.colUnit&quot;);</span>
                case (COL_MOVE):
<span class="nc" id="L1053">                    return Messages.getString(&quot;RandomArmyDialog.colMove&quot;);</span>
                case (COL_BV):
<span class="nc" id="L1055">                    return Messages.getString(&quot;RandomArmyDialog.colBV&quot;);</span>
            }
<span class="nc" id="L1057">            return &quot;??&quot;;</span>
        }

        @Override
        public Class&lt;?&gt; getColumnClass(int c) {
<span class="nc" id="L1062">            return getValueAt(0, c).getClass();</span>
        }

        @Override
        public boolean isCellEditable(int row, int col) {
<span class="nc" id="L1067">            return false;</span>
        }

        public Object getValueAt(int row, int col) {
<span class="nc" id="L1071">            MechSummary m = getUnitAt(row);</span>
<span class="nc" id="L1072">            String value = &quot;&quot;;</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">            if (col == COL_BV) {</span>
<span class="nc" id="L1074">                value += m.getBV();</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">            } else if (col == COL_MOVE) {</span>
<span class="nc" id="L1076">                value += m.getWalkMp() + &quot;/&quot; + m.getRunMp() + &quot;/&quot; + m.getJumpMp();</span>
            } else {
<span class="nc" id="L1078">                return m.getName();</span>
            }
<span class="nc" id="L1080">            return value;</span>
        }

        public MechSummary getUnitAt(int row) {
<span class="nc" id="L1084">            return data.get(row);</span>
        }

        public List&lt;MechSummary&gt; getAllUnits() {
<span class="nc" id="L1088">            return data;</span>
        }
    }
    
    /**
     * A table model for displaying a generated RAT
     */
<span class="nc" id="L1095">    public class RATTableModel extends AbstractTableModel {</span>

        /**
		 * 
		 */
		private static final long serialVersionUID = 7807207311532173654L;
		
		private static final int COL_WEIGHT = 0;
        private static final int COL_UNIT = 1;
        private static final int COL_BV = 2;
        private static final int N_COL = 3;

        public int getRowCount() {
<span class="nc bnc" id="L1108" title="All 2 branches missed.">        	if (generatedRAT == null) {</span>
<span class="nc" id="L1109">        		return 0;</span>
        	}
<span class="nc" id="L1111">            return generatedRAT.getNumEntries();</span>
        }

        public void refreshData() {
<span class="nc" id="L1115">            fireTableDataChanged();</span>
<span class="nc" id="L1116">        }</span>

        public int getColumnCount() {
<span class="nc" id="L1119">            return N_COL;</span>
        }
        
        public int getPreferredWidth(int col) {
<span class="nc bnc" id="L1123" title="All 4 branches missed.">        	switch (col) {</span>
        	case COL_WEIGHT:
<span class="nc" id="L1125">        		return 12;</span>
        	case COL_UNIT:
<span class="nc" id="L1127">        		return 240;</span>
        	case COL_BV:
<span class="nc" id="L1129">        		return 18;</span>
        	}
<span class="nc" id="L1131">        	return 0;</span>
        }
        
        @Override
        public String getColumnName(int column) {
<span class="nc bnc" id="L1136" title="All 4 branches missed.">            switch (column) {</span>
                case (COL_WEIGHT):
<span class="nc" id="L1138">                    return Messages.getString(&quot;RandomArmyDialog.colWeight&quot;);</span>
                case (COL_UNIT):
<span class="nc" id="L1140">                    return Messages.getString(&quot;RandomArmyDialog.colUnit&quot;);</span>
                case (COL_BV):
<span class="nc" id="L1142">                    return Messages.getString(&quot;RandomArmyDialog.colBV&quot;);</span>
            }
<span class="nc" id="L1144">            return &quot;??&quot;;</span>
        }

        @Override
        public Class&lt;?&gt; getColumnClass(int c) {
<span class="nc" id="L1149">            return getValueAt(0, c).getClass();</span>
        }

        @Override
        public boolean isCellEditable(int row, int col) {
<span class="nc" id="L1154">            return false;</span>
        }

        public Object getValueAt(int row, int col) {
<span class="nc bnc" id="L1158" title="All 2 branches missed.">        	if (generatedRAT != null) {</span>
<span class="nc bnc" id="L1159" title="All 4 branches missed.">		    	switch (col) {</span>
		    	case COL_WEIGHT:
<span class="nc" id="L1161">		    		return generatedRAT.getEntryWeight(row);</span>
		    	case COL_UNIT:
<span class="nc" id="L1163">		    		return generatedRAT.getEntryText(row);</span>
		    	case COL_BV:
<span class="nc" id="L1165">		    		int bv = generatedRAT.getBV(row);</span>
<span class="nc bnc" id="L1166" title="All 2 branches missed.">		    		if (bv &gt; 0) {</span>
<span class="nc" id="L1167">		    			return String.valueOf(bv);</span>
		    		}
		    	}
        	}
<span class="nc" id="L1171">		   	return &quot;&quot;;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>