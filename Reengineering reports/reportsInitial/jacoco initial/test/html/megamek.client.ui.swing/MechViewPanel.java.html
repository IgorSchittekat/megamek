<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MechViewPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">megamek</a> &gt; <a href="index.source.html" class="el_package">megamek.client.ui.swing</a> &gt; <span class="el_source">MechViewPanel.java</span></div><h1>MechViewPanel.java</h1><pre class="source lang-java linenums">/*
 * MegaMek - Copyright (C) 2000,2001,2002,2003,2004 Ben Mazur (bmazur@sev.org)
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License as published by the Free
 *  Software Foundation; either version 2 of the License, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
 *  for more details.
 */

/*
 * MechViewPanel.java
 *
 * Created on November 2, 2009 by Jay Lawson
 */

package megamek.client.ui.swing;

import java.awt.ComponentOrientation;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Image;
import java.awt.Insets;

import javax.swing.Icon;
import javax.swing.ImageIcon;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextPane;
import javax.swing.SwingConstants;

import megamek.client.ui.swing.util.FluffImageHelper;
import megamek.common.Entity;
import megamek.common.MechView;
import megamek.common.templates.TROView;


public class MechViewPanel extends JPanel {
    
    /**
     * 
     */
    private static final long serialVersionUID = 2438490306644271135L;
    
    private JTextPane txtMek;
    private JLabel lblMek;
    private JScrollPane scrMek;
    private Icon icon;
    
    public static final int DEFAULT_WIDTH = 350;
    public static final int DEFAULT_HEIGHT = 600;
    
    public MechViewPanel() {
<span class="nc" id="L60">        this(DEFAULT_WIDTH, DEFAULT_HEIGHT,true);</span>
<span class="nc" id="L61">    }</span>
    
    public MechViewPanel(int width, int height) {
<span class="nc" id="L64">        this(width,height,true);</span>
<span class="nc" id="L65">    }</span>
    
<span class="nc" id="L67">    public MechViewPanel(int width, int height, boolean noBorder) {</span>
 
<span class="nc" id="L69">        icon = null;</span>
        
<span class="nc" id="L71">        txtMek = new JTextPane();</span>
<span class="nc" id="L72">        ReportDisplay.setupStylesheet(txtMek);</span>
<span class="nc" id="L73">        txtMek.setText(&quot;&quot;);</span>
<span class="nc" id="L74">        txtMek.setEditable(false);</span>
<span class="nc" id="L75">        txtMek.setBorder(null);</span>
<span class="nc" id="L76">        txtMek.setPreferredSize(new Dimension(width, height));</span>
<span class="nc" id="L77">        lblMek = new JLabel();</span>
<span class="nc" id="L78">        lblMek.setText(&quot;&quot;);</span>
<span class="nc" id="L79">        lblMek.setVerticalAlignment(SwingConstants.TOP);</span>
<span class="nc" id="L80">        scrMek = new JScrollPane(txtMek);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">        if (noBorder){</span>
<span class="nc" id="L82">            scrMek.setBorder(null);</span>
        }
<span class="nc" id="L84">        scrMek.setComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT);</span>
<span class="nc" id="L85">        scrMek.setPreferredSize(new Dimension(width, height));</span>
<span class="nc" id="L86">        scrMek.setMinimumSize(new Dimension(width, height));</span>
        GridBagConstraints c;
<span class="nc" id="L88">        GridBagLayout gridbag = new GridBagLayout();</span>
<span class="nc" id="L89">        setLayout(gridbag);</span>
        
<span class="nc" id="L91">        c = new GridBagConstraints();</span>
<span class="nc" id="L92">        c.gridx = 0;</span>
<span class="nc" id="L93">        c.gridy = 0;</span>
<span class="nc" id="L94">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L95">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L96">        c.weightx = 0.0;</span>
<span class="nc" id="L97">        c.weighty = 1.0;</span>
<span class="nc" id="L98">        gridbag.setConstraints(scrMek, c);</span>
<span class="nc" id="L99">        add(scrMek);</span>

<span class="nc" id="L101">        c.insets = new Insets(0,0,0,0);</span>
<span class="nc" id="L102">        c.gridx = 1;</span>
<span class="nc" id="L103">        c.gridy = 0;</span>
<span class="nc" id="L104">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L105">        c.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L106">        c.weightx = 1.0;</span>
<span class="nc" id="L107">        c.weighty = 1.0;</span>
<span class="nc" id="L108">        gridbag.setConstraints(lblMek, c);</span>
<span class="nc" id="L109">        add(lblMek);</span>
<span class="nc" id="L110">    }</span>
    
    public void setMech(Entity entity, MechView mechView){
<span class="nc" id="L113">        reset();        </span>
<span class="nc" id="L114">        txtMek.setText(mechView.getMechReadout());</span>
<span class="nc" id="L115">        txtMek.setCaretPosition(0);</span>
<span class="nc" id="L116">        Image image = FluffImageHelper.getFluffImage(entity);</span>
<span class="nc" id="L117">        icon = null;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if(null != image) {</span>
            // We don't want this window to be too big, so scale large images
<span class="nc bnc" id="L120" title="All 2 branches missed.">            if (image.getWidth(this) &gt; DEFAULT_WIDTH)</span>
            {
<span class="nc" id="L122">                double aspect_ratio = (float)image.getWidth(this) / image.getHeight(this);</span>
<span class="nc" id="L123">                image = image.getScaledInstance(DEFAULT_WIDTH, </span>
                        (int)(DEFAULT_WIDTH/aspect_ratio), Image.SCALE_FAST);
            }            
<span class="nc" id="L126">            icon = new ImageIcon(image);</span>
<span class="nc" id="L127">            lblMek.setIcon(icon);</span>
        }  
<span class="nc" id="L129">    }</span>
    
    public void setMech(Entity entity, TROView troView){
<span class="nc" id="L132">        reset();</span>
<span class="nc" id="L133">        txtMek.setText(troView.processTemplate());</span>
<span class="nc" id="L134">        txtMek.setCaretPosition(0);</span>
<span class="nc" id="L135">        Image image = FluffImageHelper.getFluffImage(entity);</span>
<span class="nc" id="L136">        icon = null;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (null != image) {</span>
            // We don't want this window to be too big, so scale large images
<span class="nc bnc" id="L139" title="All 2 branches missed.">            if (image.getWidth(this) &gt; DEFAULT_WIDTH)</span>
            {
<span class="nc" id="L141">                double aspect_ratio = (float)image.getWidth(this) / image.getHeight(this);</span>
<span class="nc" id="L142">                image = image.getScaledInstance(DEFAULT_WIDTH, </span>
                        (int)(DEFAULT_WIDTH/aspect_ratio), Image.SCALE_FAST);
            }            
<span class="nc" id="L145">            icon = new ImageIcon(image);</span>
<span class="nc" id="L146">            lblMek.setIcon(icon);</span>
        }  
<span class="nc" id="L148">    }</span>
    
    public void setMech(Entity entity) {
<span class="nc" id="L151">        MechView mechView = new MechView(entity, false);</span>
<span class="nc" id="L152">        setMech(entity,mechView);</span>
<span class="nc" id="L153">    }</span>
    
    public void setMech(Entity entity, boolean useAlternateCost) {
<span class="nc" id="L156">        MechView mechView = new MechView(entity, false, useAlternateCost);</span>
<span class="nc" id="L157">        setMech(entity,mechView);</span>
<span class="nc" id="L158">    }</span>
    
    public void reset() {
<span class="nc" id="L161">        txtMek.setText(&quot;&quot;);</span>
<span class="nc" id="L162">        lblMek.setIcon(null);</span>
<span class="nc" id="L163">    }</span>
    
    public int getBestWidth() {
<span class="nc" id="L166">        int width = DEFAULT_WIDTH;</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">        if(null != icon) {</span>
<span class="nc" id="L168">            width += icon.getIconWidth() + 20;</span>
        }
<span class="nc" id="L170">        return width;</span>
    }
    
    public int getBestHeight() {
<span class="nc" id="L174">        int height = DEFAULT_HEIGHT;</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">        if(null != icon) {</span>
<span class="nc" id="L176">            height = Math.max(height, icon.getIconHeight());</span>
        }
<span class="nc" id="L178">        return height;</span>
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>